{"version":3,"file":"index-Ce98QBiq.js","sources":["../../src/core/Events.js","../../src/ui/Terminal.js","../../src/core/ServiceContainer.js","../../src/core/LogManager.js","../../src/core/ProcessManager.js","../../src/ui/TerminalManager.js","../../src/core/WorldState.js","../../src/ui/Canvas.js","../../src/ui/MapCanvas.js","../../src/comm/CommInterface.js","../../src/utils/qos.js","../../src/comm/LocalComm.js","../../src/core/SimDDS.js","../../src/ui/Graph.js","../../src/ui/RqtConsole.js","../../src/ui/Layout.js","../../src/ui/HelpModal.js","../../src/cli/commandRegistry.js","../../src/nodes/registry.js","../../src/cli/ros2_run.js","../../src/cli/ros2_node.js","../../src/cli/messageParser.js","../../src/msgs/registry.js","../../src/msgs/std_msgs.js","../../src/msgs/std_srvs.js","../../src/msgs/geometry_msgs.js","../../src/msgs/turtlesim_msgs.js","../../src/msgs/turtlesim_srvs.js","../../src/msgs/turtlesim_actions.js","../../src/msgs/tf2_msgs.js","../../src/msgs/sensor_msgs.js","../../src/msgs/nav_msgs.js","../../src/msgs/nav2_actions.js","../../src/msgs/index.js","../../src/cli/ros2_topic.js","../../src/cli/ros2_service.js","../../src/cli/ros2_action.js","../../src/cli/ros2_param.js","../../src/core/BagRecorder.js","../../src/core/BagPlayer.js","../../src/cli/ros2_bag.js","../../src/cli/ros2_interface.js","../../src/cli/ros2_pkg.js","../../src/cli/builtins/shell.js","../../src/cli/builtins/help.js","../../src/cli/builtins/rqt.js","../../src/cli/builtins/ros2.js","../../src/cli/parser.js","../../src/core/Node.js","../../src/nodes/turtlesim/TurtlesimNode.js","../../src/nodes/turtlesim/TurtleTeleopNode.js","../../src/nodes/teleop_twist_keyboard/TeleopNode.js","../../src/nodes/simple_slam/SlamNode.js","../../src/core/TFBuffer.js","../../src/nodes/tf2_ros/StaticTransformPublisher.js","../../src/nodes/tf2_ros/TF2EchoNode.js","../../src/nodes/tf2_ros/TF2MonitorNode.js","../../src/nodes/tf2_ros/ViewFramesNode.js","../../src/nodes/nav2_simple_navigator/NavigatorNode.js","../../src/app.js"],"sourcesContent":["/**\n * Events - Centralized event name constants for window.dispatchEvent/addEventListener\n * Using constants prevents typos and enables IDE autocompletion.\n */\n\nexport const Events = {\n  // Turtlesim canvas updates\n  TURTLESIM_UPDATE: 'turtlesim-update',\n\n  // Sensor data updates\n  LIDAR_UPDATE: 'lidar-update',\n\n  // Map/SLAM updates\n  MAP_UPDATE: 'map-update',\n  ROBOT_POSE_UPDATE: 'robot-pose-update',\n  SHOW_MAP: 'show-map',\n  TOGGLE_MAP_OVERLAY: 'toggle-map-overlay',\n\n  // Navigation\n  PATH_PLANNED: 'path-planned',\n  PATH_CLEARED: 'path-cleared',\n  WAYPOINTS_UPDATE: 'waypoints-update',\n  WAYPOINTS_CLEARED: 'waypoints-cleared',\n\n  // Loop closure\n  LOOP_CLOSURE_DETECTED: 'loop-closure-detected',\n\n  // Process lifecycle\n  PROCESS_STARTED: 'process-started',\n  PROCESS_STOPPED: 'process-stopped',\n\n  // World state\n  WORLD_STATE_CHANGED: 'world-state-changed',\n\n  // Layout events\n  LAYOUT_RESIZE: 'layout-resize',\n\n  // Teleop state\n  TELEOP_ACTIVE: 'teleop-active',\n  TELEOP_INACTIVE: 'teleop-inactive',\n\n  // UI panel toggles\n  TOGGLE_GRAPH: 'toggle-graph',\n  TOGGLE_CONSOLE: 'toggle-console',\n\n  // Canvas edit mode\n  CANVAS_EDIT_MODE_CHANGED: 'canvas-edit-mode-changed',\n\n  // Modals\n  OPEN_RQT_MODAL: 'open-rqt-modal'\n};\n","import { Terminal as XTerm } from 'xterm';\nimport { FitAddon } from '@xterm/addon-fit';\nimport { Events } from '../core/Events.js';\n\n/**\n * Terminal - Single xterm.js instance wrapper with command history and input handling\n */\nexport class Terminal {\n  constructor(container, options = {}) {\n    this.container = container;\n    this.id = options.id || `term_${Date.now()}`;\n    this.onCommand = options.onCommand || (() => {});\n    this.onInterrupt = options.onInterrupt || (() => {});\n\n    // Command history\n    this.history = [];\n    this.historyIndex = -1;\n    this.maxHistory = 100;\n\n    // Current input state\n    this.currentLine = '';\n    this.cursorPosition = 0;\n    this.prompt = 'ros2@sim:~$ ';\n\n    // State flags\n    this.isProcessing = false;\n    this.waitingForInput = false;\n    this.focused = false;\n\n    // Teleop state tracking\n    this.teleopActive = false;\n    this.teleopType = null;\n\n    // Active continuous commands (echo, pub, etc.)\n    this.activeSubscriptions = [];\n    this.activeBagRecorders = [];\n\n    // Initialize xterm\n    this._initTerminal();\n  }\n\n  _initTerminal() {\n    this.xterm = new XTerm({\n      theme: {\n        background: '#1e1e1e',\n        foreground: '#d4d4d4',\n        cursor: '#ffffff',\n        cursorAccent: '#1e1e1e',\n        selection: 'rgba(255, 255, 255, 0.3)',\n        black: '#000000',\n        red: '#cd3131',\n        green: '#0dbc79',\n        yellow: '#e5e510',\n        blue: '#2472c8',\n        magenta: '#bc3fbc',\n        cyan: '#11a8cd',\n        white: '#e5e5e5',\n        brightBlack: '#666666',\n        brightRed: '#f14c4c',\n        brightGreen: '#23d18b',\n        brightYellow: '#f5f543',\n        brightBlue: '#3b8eea',\n        brightMagenta: '#d670d6',\n        brightCyan: '#29b8db',\n        brightWhite: '#ffffff'\n      },\n      fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n      fontSize: 14,\n      lineHeight: 1.2,\n      cursorBlink: true,\n      cursorStyle: 'block',\n      scrollback: 1000,\n      allowTransparency: true\n    });\n\n    this.fitAddon = new FitAddon();\n    this.xterm.loadAddon(this.fitAddon);\n\n    this.xterm.open(this.container);\n    this.fit();\n\n    // Handle input\n    this.xterm.onData(this._handleInput.bind(this));\n\n    // Handle focus using DOM events on the terminal element\n    this.container.addEventListener('focus', () => {\n      this.focused = true;\n    }, true);\n\n    this.container.addEventListener('blur', () => {\n      this.focused = false;\n    }, true);\n\n    // Ensure xterm gets focus when clicking anywhere in the container\n    this.container.addEventListener('mousedown', () => {\n      this.xterm.focus();\n    });\n\n    // Custom context menu for paste support\n    // Browser security requires trusted user interaction for clipboard access,\n    // so we handle right-click ourselves and use the Clipboard API\n    this._setupContextMenu();\n\n    // Show initial prompt\n    this.writePrompt();\n\n    // Listen for teleop events\n    this._setupTeleopListeners();\n  }\n\n  _setupTeleopListeners() {\n    // Listen for teleop activation\n    window.addEventListener(Events.TELEOP_ACTIVE, (event) => {\n      this.teleopActive = true;\n      this.teleopType = event.detail?.type || 'wasd-keys';\n    });\n\n    // Listen for teleop deactivation\n    window.addEventListener(Events.TELEOP_INACTIVE, () => {\n      this.teleopActive = false;\n      this.teleopType = null;\n    });\n  }\n\n  _setupContextMenu() {\n    // Create custom context menu element\n    this.contextMenu = document.createElement('div');\n    this.contextMenu.className = 'terminal-context-menu';\n    this.contextMenu.innerHTML = `\n      <button class=\"context-menu-item\" data-action=\"copy\">Copy</button>\n      <button class=\"context-menu-item\" data-action=\"paste\">Paste</button>\n      <button class=\"context-menu-item\" data-action=\"clear\">Clear</button>\n    `;\n    this.contextMenu.style.display = 'none';\n    document.body.appendChild(this.contextMenu);\n\n    // Handle right-click on terminal\n    this.container.addEventListener('contextmenu', (e) => {\n      e.preventDefault();\n      this._showContextMenu(e.clientX, e.clientY);\n    });\n\n    // Handle context menu item clicks\n    this.contextMenu.addEventListener('click', async (e) => {\n      const action = e.target.dataset.action;\n      if (!action) return;\n\n      this._hideContextMenu();\n\n      switch (action) {\n        case 'copy':\n          await this._handleCopy();\n          break;\n        case 'paste':\n          await this._handlePaste();\n          break;\n        case 'clear':\n          this.clear();\n          this.writePrompt();\n          this._refreshLine();\n          break;\n      }\n    });\n\n    // Hide menu on click outside or scroll\n    document.addEventListener('click', (e) => {\n      if (!this.contextMenu.contains(e.target)) {\n        this._hideContextMenu();\n      }\n    });\n\n    document.addEventListener('scroll', () => {\n      this._hideContextMenu();\n    }, true);\n  }\n\n  _showContextMenu(x, y) {\n    this.contextMenu.style.display = 'block';\n    this.contextMenu.style.left = `${x}px`;\n    this.contextMenu.style.top = `${y}px`;\n\n    // Ensure menu stays within viewport\n    const rect = this.contextMenu.getBoundingClientRect();\n    if (rect.right > window.innerWidth) {\n      this.contextMenu.style.left = `${window.innerWidth - rect.width - 5}px`;\n    }\n    if (rect.bottom > window.innerHeight) {\n      this.contextMenu.style.top = `${window.innerHeight - rect.height - 5}px`;\n    }\n  }\n\n  _hideContextMenu() {\n    this.contextMenu.style.display = 'none';\n  }\n\n  async _handleCopy() {\n    const selection = this.xterm.getSelection();\n    if (selection) {\n      try {\n        await navigator.clipboard.writeText(selection);\n      } catch (err) {\n        console.error('Failed to copy:', err);\n      }\n    }\n  }\n\n  async _handlePaste() {\n    try {\n      const text = await navigator.clipboard.readText();\n      if (text) {\n        // Insert each character as if typed\n        for (const char of text) {\n          // Skip newlines or convert to space\n          if (char === '\\n' || char === '\\r') continue;\n          this._insertChar(char);\n        }\n      }\n    } catch (err) {\n      console.error('Failed to paste:', err);\n      // Fallback: prompt user that paste failed\n    }\n  }\n\n  /**\n   * Forward a key to window as a synthetic KeyboardEvent for teleop\n   */\n  _forwardKeyToWindow(key, code) {\n    // Dispatch keydown event\n    const keydownEvent = new KeyboardEvent('keydown', {\n      key,\n      code,\n      bubbles: true,\n      cancelable: true\n    });\n    window.dispatchEvent(keydownEvent);\n\n    // Schedule keyup after a short delay\n    setTimeout(() => {\n      const keyupEvent = new KeyboardEvent('keyup', {\n        key,\n        code,\n        bubbles: true,\n        cancelable: true\n      });\n      window.dispatchEvent(keyupEvent);\n    }, 50);\n  }\n\n  _handleInput(data) {\n    // Handle special keys\n    for (let i = 0; i < data.length; i++) {\n      const char = data.charCodeAt(i);\n\n      // Ctrl+C (interrupt)\n      if (char === 3) {\n        this._handleInterrupt();\n        continue;\n      }\n\n      // Ctrl+D (EOF - ignore for now)\n      if (char === 4) {\n        continue;\n      }\n\n      // Ctrl+L (clear screen)\n      if (char === 12) {\n        this.clear();\n        this.writePrompt();\n        this._refreshLine();\n        continue;\n      }\n\n      // Enter\n      if (char === 13) {\n        this._handleEnter();\n        continue;\n      }\n\n      // Backspace\n      if (char === 127 || char === 8) {\n        this._handleBackspace();\n        continue;\n      }\n\n      // Tab (completion)\n      if (char === 9) {\n        this._handleTab();\n        continue;\n      }\n\n      // Escape sequences (arrows, etc.)\n      if (char === 27) {\n        if (i + 2 < data.length && data.charCodeAt(i + 1) === 91) {\n          const code = data.charCodeAt(i + 2);\n\n          // Up arrow\n          if (code === 65) {\n            // Forward arrow keys to teleop if active with arrow-keys type\n            if (this.teleopActive && this.teleopType === 'arrow-keys') {\n              this._forwardKeyToWindow('ArrowUp', 'ArrowUp');\n              i += 2;\n              continue;\n            }\n            this._historyUp();\n            i += 2;\n            continue;\n          }\n\n          // Down arrow\n          if (code === 66) {\n            if (this.teleopActive && this.teleopType === 'arrow-keys') {\n              this._forwardKeyToWindow('ArrowDown', 'ArrowDown');\n              i += 2;\n              continue;\n            }\n            this._historyDown();\n            i += 2;\n            continue;\n          }\n\n          // Right arrow\n          if (code === 67) {\n            if (this.teleopActive && this.teleopType === 'arrow-keys') {\n              this._forwardKeyToWindow('ArrowRight', 'ArrowRight');\n              i += 2;\n              continue;\n            }\n            this._cursorRight();\n            i += 2;\n            continue;\n          }\n\n          // Left arrow\n          if (code === 68) {\n            if (this.teleopActive && this.teleopType === 'arrow-keys') {\n              this._forwardKeyToWindow('ArrowLeft', 'ArrowLeft');\n              i += 2;\n              continue;\n            }\n            this._cursorLeft();\n            i += 2;\n            continue;\n          }\n\n          // Home (Ctrl+A behavior with ^[[H)\n          if (code === 72) {\n            this._cursorHome();\n            i += 2;\n            continue;\n          }\n\n          // End (Ctrl+E behavior with ^[[F)\n          if (code === 70) {\n            this._cursorEnd();\n            i += 2;\n            continue;\n          }\n\n          // Delete key ^[[3~\n          if (code === 51 && i + 3 < data.length && data.charCodeAt(i + 3) === 126) {\n            this._handleDelete();\n            i += 3;\n            continue;\n          }\n        }\n        continue;\n      }\n\n      // Regular character\n      if (char >= 32 && char < 127) {\n        // Check for teleop WASD keys when teleop is active\n        if (this.teleopActive && this.teleopType === 'wasd-keys') {\n          const upperChar = data[i].toUpperCase();\n          if ('WASDQE'.includes(upperChar)) {\n            // Forward WASD/QE keys to window for teleop control\n            this._forwardKeyToWindow(upperChar, `Key${upperChar}`);\n            continue; // Skip normal terminal processing\n          }\n        }\n        this._insertChar(data[i]);\n      }\n    }\n  }\n\n  _insertChar(char) {\n    if (this.isProcessing) return;\n\n    // Insert character at cursor position\n    this.currentLine =\n      this.currentLine.slice(0, this.cursorPosition) +\n      char +\n      this.currentLine.slice(this.cursorPosition);\n    this.cursorPosition++;\n\n    this._refreshLine();\n  }\n\n  _handleBackspace() {\n    if (this.isProcessing) return;\n    if (this.cursorPosition === 0) return;\n\n    this.currentLine =\n      this.currentLine.slice(0, this.cursorPosition - 1) +\n      this.currentLine.slice(this.cursorPosition);\n    this.cursorPosition--;\n\n    this._refreshLine();\n  }\n\n  _handleDelete() {\n    if (this.isProcessing) return;\n    if (this.cursorPosition >= this.currentLine.length) return;\n\n    this.currentLine =\n      this.currentLine.slice(0, this.cursorPosition) +\n      this.currentLine.slice(this.cursorPosition + 1);\n\n    this._refreshLine();\n  }\n\n  _handleEnter() {\n    if (this.isProcessing) return;\n\n    this.xterm.write('\\r\\n');\n\n    const command = this.currentLine.trim();\n    this.currentLine = '';\n    this.cursorPosition = 0;\n\n    if (command) {\n      // Add to history\n      if (this.history[this.history.length - 1] !== command) {\n        this.history.push(command);\n        if (this.history.length > this.maxHistory) {\n          this.history.shift();\n        }\n      }\n      this.historyIndex = this.history.length;\n\n      // Execute command\n      this.isProcessing = true;\n      this.onCommand(command, this);\n    } else {\n      this.writePrompt();\n    }\n  }\n\n  _handleInterrupt() {\n    // Cancel any active subscriptions\n    for (const sub of this.activeSubscriptions) {\n      if (sub.destroy) {\n        sub.destroy();\n      }\n    }\n    this.activeSubscriptions = [];\n\n    // Stop any active bag recorders\n    for (const recorder of this.activeBagRecorders) {\n      if (recorder.stop) {\n        recorder.stop();\n      }\n    }\n    this.activeBagRecorders = [];\n\n    // Call interrupt handler\n    this.onInterrupt(this);\n\n    // Show ^C and new prompt\n    this.xterm.write('^C\\r\\n');\n    this.currentLine = '';\n    this.cursorPosition = 0;\n    this.isProcessing = false;\n    this.writePrompt();\n  }\n\n  _handleTab() {\n    // Tab completion - delegate to command handler\n    // For now, just insert spaces\n    this._insertChar(' ');\n    this._insertChar(' ');\n  }\n\n  _historyUp() {\n    if (this.isProcessing) return;\n    if (this.historyIndex <= 0) return;\n\n    this.historyIndex--;\n    this.currentLine = this.history[this.historyIndex];\n    this.cursorPosition = this.currentLine.length;\n    this._refreshLine();\n  }\n\n  _historyDown() {\n    if (this.isProcessing) return;\n\n    if (this.historyIndex >= this.history.length - 1) {\n      this.historyIndex = this.history.length;\n      this.currentLine = '';\n      this.cursorPosition = 0;\n      this._refreshLine();\n      return;\n    }\n\n    this.historyIndex++;\n    this.currentLine = this.history[this.historyIndex];\n    this.cursorPosition = this.currentLine.length;\n    this._refreshLine();\n  }\n\n  _cursorLeft() {\n    if (this.cursorPosition > 0) {\n      this.cursorPosition--;\n      this.xterm.write('\\x1b[D');\n    }\n  }\n\n  _cursorRight() {\n    if (this.cursorPosition < this.currentLine.length) {\n      this.cursorPosition++;\n      this.xterm.write('\\x1b[C');\n    }\n  }\n\n  _cursorHome() {\n    while (this.cursorPosition > 0) {\n      this.cursorPosition--;\n      this.xterm.write('\\x1b[D');\n    }\n  }\n\n  _cursorEnd() {\n    while (this.cursorPosition < this.currentLine.length) {\n      this.cursorPosition++;\n      this.xterm.write('\\x1b[C');\n    }\n  }\n\n  _refreshLine() {\n    // Move to start of input, clear line, rewrite\n    const promptLen = this.prompt.length;\n\n    // Move cursor to start of prompt\n    this.xterm.write('\\r');\n    // Clear line\n    this.xterm.write('\\x1b[K');\n    // Write prompt and current line\n    this.xterm.write(this.prompt + this.currentLine);\n\n    // Move cursor to correct position\n    const backspaces = this.currentLine.length - this.cursorPosition;\n    if (backspaces > 0) {\n      this.xterm.write(`\\x1b[${backspaces}D`);\n    }\n  }\n\n  /**\n   * Write text to terminal\n   */\n  write(text) {\n    this.xterm.write(text.replace(/\\r?\\n/g, '\\r\\n'));\n  }\n\n  /**\n   * Write a line (with newline)\n   */\n  writeln(text) {\n    this.xterm.write(text.replace(/\\r?\\n/g, '\\r\\n') + '\\r\\n');\n  }\n\n  /**\n   * Write the prompt\n   */\n  writePrompt() {\n    this.xterm.write(this.prompt);\n  }\n\n  /**\n   * Set custom prompt\n   */\n  setPrompt(prompt) {\n    this.prompt = prompt;\n  }\n\n  /**\n   * Finish processing and show prompt\n   */\n  finishCommand() {\n    this.isProcessing = false;\n    this.writePrompt();\n  }\n\n  /**\n   * Clear the terminal\n   */\n  clear() {\n    this.xterm.clear();\n  }\n\n  /**\n   * Fit terminal to container\n   */\n  fit() {\n    try {\n      this.fitAddon.fit();\n    } catch (e) {\n      // Ignore fit errors\n    }\n  }\n\n  /**\n   * Focus the terminal\n   */\n  focus() {\n    this.xterm.focus();\n  }\n\n  /**\n   * Add an active subscription (for Ctrl+C cleanup)\n   */\n  addSubscription(sub) {\n    this.activeSubscriptions.push(sub);\n  }\n\n  /**\n   * Remove a subscription\n   */\n  removeSubscription(sub) {\n    const idx = this.activeSubscriptions.indexOf(sub);\n    if (idx >= 0) {\n      this.activeSubscriptions.splice(idx, 1);\n    }\n  }\n\n  /**\n   * Add an active bag recorder (for Ctrl+C cleanup)\n   */\n  addBagRecorder(recorder) {\n    this.activeBagRecorders.push(recorder);\n  }\n\n  /**\n   * Remove a bag recorder\n   */\n  removeBagRecorder(recorder) {\n    const idx = this.activeBagRecorders.indexOf(recorder);\n    if (idx >= 0) {\n      this.activeBagRecorders.splice(idx, 1);\n    }\n  }\n\n  /**\n   * Destroy the terminal\n   */\n  destroy() {\n    // Cleanup subscriptions\n    for (const sub of this.activeSubscriptions) {\n      if (sub.destroy) {\n        sub.destroy();\n      }\n    }\n    this.activeSubscriptions = [];\n\n    // Cleanup bag recorders\n    for (const recorder of this.activeBagRecorders) {\n      if (recorder.stop) {\n        recorder.stop();\n      }\n    }\n    this.activeBagRecorders = [];\n\n    // Remove context menu\n    if (this.contextMenu && this.contextMenu.parentNode) {\n      this.contextMenu.parentNode.removeChild(this.contextMenu);\n    }\n\n    // Dispose xterm\n    this.xterm.dispose();\n  }\n}\n","/**\n * ServiceContainer - Simple dependency injection container\n * Enables testability by allowing mock injection of core services.\n *\n * Usage:\n *   // Registration (done by service modules)\n *   ServiceContainer.register('logManager', LogManager);\n *\n *   // Retrieval (with fallback)\n *   const logger = options.logManager || ServiceContainer.get('logManager') || LogManager;\n *\n *   // Testing\n *   ServiceContainer.register('simDDS', mockSimDDS);\n *   // ... run tests ...\n *   ServiceContainer.reset();\n */\nclass ServiceContainerClass {\n  constructor() {\n    this._services = new Map();\n  }\n\n  /**\n   * Register a service instance\n   * @param {string} name - Service name\n   * @param {*} instance - Service instance\n   */\n  register(name, instance) {\n    this._services.set(name, instance);\n  }\n\n  /**\n   * Get a service by name\n   * @param {string} name - Service name\n   * @returns {*} Service instance or undefined\n   */\n  get(name) {\n    return this._services.get(name);\n  }\n\n  /**\n   * Check if a service is registered\n   * @param {string} name - Service name\n   * @returns {boolean}\n   */\n  has(name) {\n    return this._services.has(name);\n  }\n\n  /**\n   * Reset container (useful for testing)\n   */\n  reset() {\n    this._services.clear();\n  }\n\n  /**\n   * Get all registered service names\n   * @returns {string[]}\n   */\n  getServiceNames() {\n    return Array.from(this._services.keys());\n  }\n}\n\nexport const ServiceContainer = new ServiceContainerClass();\n","import { ServiceContainer } from './ServiceContainer.js';\n\n/**\n * LogManager - Centralized logging system with severity levels\n * Supports ROS2-style logging: DEBUG, INFO, WARN, ERROR, FATAL\n */\n\nconst LOG_LEVELS = {\n  DEBUG: 0,\n  INFO: 1,\n  WARN: 2,\n  ERROR: 3,\n  FATAL: 4\n};\n\nexport class LogManagerClass {\n  constructor() {\n    this.logs = [];\n    this.maxLogs = 1000;\n    this.listeners = [];\n    this.defaultLevel = LOG_LEVELS.INFO;\n    this.nodeLevels = new Map(); // Per-node log levels\n    this.paused = false;\n  }\n\n  /**\n   * Get a logger for a specific node\n   * @param {string} nodeName - Node name\n   * @returns {Object} Logger object with debug/info/warn/error/fatal methods\n   */\n  getLogger(nodeName) {\n    return {\n      debug: (msg) => this._log(nodeName, 'DEBUG', msg),\n      info: (msg) => this._log(nodeName, 'INFO', msg),\n      warn: (msg) => this._log(nodeName, 'WARN', msg),\n      error: (msg) => this._log(nodeName, 'ERROR', msg),\n      fatal: (msg) => this._log(nodeName, 'FATAL', msg)\n    };\n  }\n\n  /**\n   * Internal log method\n   */\n  _log(nodeName, level, message) {\n    const levelValue = LOG_LEVELS[level];\n    const nodeLevel = this.nodeLevels.get(nodeName) ?? this.defaultLevel;\n\n    // Check if this log level should be output\n    if (levelValue < nodeLevel) {\n      return;\n    }\n\n    const entry = {\n      timestamp: Date.now(),\n      node: nodeName,\n      level,\n      levelValue,\n      message\n    };\n\n    // Add to log buffer\n    this.logs.push(entry);\n    if (this.logs.length > this.maxLogs) {\n      this.logs.shift();\n    }\n\n    // Console output with appropriate method\n    const consoleMsg = `[${nodeName}] [${level}]: ${message}`;\n    switch (level) {\n      case 'DEBUG':\n        console.debug(consoleMsg);\n        break;\n      case 'INFO':\n        console.info(consoleMsg);\n        break;\n      case 'WARN':\n        console.warn(consoleMsg);\n        break;\n      case 'ERROR':\n      case 'FATAL':\n        console.error(consoleMsg);\n        break;\n    }\n\n    // Notify listeners\n    if (!this.paused) {\n      for (const listener of this.listeners) {\n        try {\n          listener(entry);\n        } catch (e) {\n          console.error('Error in log listener:', e);\n        }\n      }\n    }\n  }\n\n  /**\n   * Set log level for a specific node\n   * @param {string} nodeName - Node name\n   * @param {string} level - Log level (DEBUG, INFO, WARN, ERROR, FATAL)\n   */\n  setNodeLevel(nodeName, level) {\n    const levelValue = LOG_LEVELS[level.toUpperCase()];\n    if (levelValue !== undefined) {\n      this.nodeLevels.set(nodeName, levelValue);\n    }\n  }\n\n  /**\n   * Set default log level\n   * @param {string} level - Log level\n   */\n  setDefaultLevel(level) {\n    const levelValue = LOG_LEVELS[level.toUpperCase()];\n    if (levelValue !== undefined) {\n      this.defaultLevel = levelValue;\n    }\n  }\n\n  /**\n   * Add a log listener\n   * @param {Function} callback - Callback function(entry)\n   * @returns {Function} Unsubscribe function\n   */\n  addListener(callback) {\n    this.listeners.push(callback);\n    return () => {\n      const idx = this.listeners.indexOf(callback);\n      if (idx >= 0) {\n        this.listeners.splice(idx, 1);\n      }\n    };\n  }\n\n  /**\n   * Get all logs\n   * @param {Object} filter - Optional filter { level, node, since }\n   * @returns {Array} Filtered logs\n   */\n  getLogs(filter = {}) {\n    let result = [...this.logs];\n\n    if (filter.level) {\n      const minLevel = LOG_LEVELS[filter.level.toUpperCase()] ?? 0;\n      result = result.filter(log => log.levelValue >= minLevel);\n    }\n\n    if (filter.node) {\n      result = result.filter(log => log.node.includes(filter.node));\n    }\n\n    if (filter.since) {\n      result = result.filter(log => log.timestamp >= filter.since);\n    }\n\n    return result;\n  }\n\n  /**\n   * Clear all logs\n   */\n  clear() {\n    this.logs = [];\n  }\n\n  /**\n   * Pause log notifications to listeners\n   */\n  pause() {\n    this.paused = true;\n  }\n\n  /**\n   * Resume log notifications\n   */\n  resume() {\n    this.paused = false;\n  }\n\n  /**\n   * Format a log entry for display\n   * @param {Object} entry - Log entry\n   * @returns {string} Formatted string\n   */\n  formatEntry(entry) {\n    const date = new Date(entry.timestamp);\n    const timeStr = date.toLocaleTimeString('en-US', {\n      hour12: false,\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    });\n    const ms = String(entry.timestamp % 1000).padStart(3, '0');\n    return `[${timeStr}.${ms}] [${entry.node}] [${entry.level}]: ${entry.message}`;\n  }\n\n  /**\n   * Get available log levels\n   */\n  getLevels() {\n    return Object.keys(LOG_LEVELS);\n  }\n\n  /**\n   * Parse log level from string\n   */\n  parseLevel(levelStr) {\n    return LOG_LEVELS[levelStr.toUpperCase()];\n  }\n}\n\n// Singleton instance\nexport const LogManager = new LogManagerClass();\n\n// Register with ServiceContainer for dependency injection\nServiceContainer.register('logManager', LogManager);\n","import { LogManager } from './LogManager.js';\nimport { Events } from './Events.js';\nimport { ServiceContainer } from './ServiceContainer.js';\n\n/**\n * ProcessManager - Manages running nodes and their lifecycle\n */\nexport class ProcessManagerClass {\n  constructor() {\n    this.processes = new Map(); // processId -> { node, terminalId, package, executable }\n    this.nextProcessId = 1;\n    this.logger = LogManager.getLogger('/process_manager');\n  }\n\n  /**\n   * Spawn a new node\n   * @param {Node} node - The node instance to spawn\n   * @param {string} terminalId - ID of the terminal that spawned this node\n   * @param {string} packageName - Package name\n   * @param {string} executable - Executable name\n   * @returns {string} Process ID\n   */\n  spawn(node, terminalId, packageName, executable) {\n    const processId = `proc_${this.nextProcessId++}`;\n\n    this.processes.set(processId, {\n      node,\n      terminalId,\n      package: packageName,\n      executable,\n      startTime: Date.now()\n    });\n\n    node.start();\n    this.logger.info(`Spawned ${packageName}/${executable} as ${node.fullName} (pid: ${processId})`);\n\n    // Dispatch event for UI updates\n    window.dispatchEvent(new CustomEvent(Events.PROCESS_STARTED, {\n      detail: { processId, terminalId, nodeName: node.fullName }\n    }));\n\n    return processId;\n  }\n\n  /**\n   * Kill a process by ID\n   * @param {string} processId - Process ID to kill\n   * @returns {boolean} True if process was killed\n   */\n  kill(processId) {\n    const proc = this.processes.get(processId);\n    if (!proc) {\n      return false;\n    }\n\n    const terminalId = proc.terminalId;\n    const nodeName = proc.node.fullName;\n\n    proc.node.destroy();\n    this.processes.delete(processId);\n    this.logger.info(`Killed process ${processId}`);\n\n    // Dispatch event for UI updates\n    window.dispatchEvent(new CustomEvent(Events.PROCESS_STOPPED, {\n      detail: { processId, terminalId, nodeName }\n    }));\n\n    return true;\n  }\n\n  /**\n   * Kill a process by node name\n   * @param {string} nodeName - Full node name\n   * @returns {boolean} True if process was killed\n   */\n  killByNodeName(nodeName) {\n    for (const [processId, proc] of this.processes) {\n      if (proc.node.fullName === nodeName) {\n        return this.kill(processId);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Kill all processes owned by a terminal\n   * @param {string} terminalId - Terminal ID\n   * @returns {number} Number of processes killed\n   */\n  killByTerminal(terminalId) {\n    let count = 0;\n    const toKill = [];\n\n    for (const [processId, proc] of this.processes) {\n      if (proc.terminalId === terminalId) {\n        toKill.push(processId);\n      }\n    }\n\n    for (const processId of toKill) {\n      if (this.kill(processId)) {\n        count++;\n      }\n    }\n\n    return count;\n  }\n\n  /**\n   * Get process info by ID\n   * @param {string} processId - Process ID\n   * @returns {Object|null} Process info\n   */\n  getProcess(processId) {\n    return this.processes.get(processId) || null;\n  }\n\n  /**\n   * Get process by node name\n   * @param {string} nodeName - Full node name\n   * @returns {Object|null} Process info with processId\n   */\n  getProcessByNodeName(nodeName) {\n    for (const [processId, proc] of this.processes) {\n      if (proc.node.fullName === nodeName) {\n        return { processId, ...proc };\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get all processes for a terminal\n   * @param {string} terminalId - Terminal ID\n   * @returns {Array} Array of process info\n   */\n  getProcessesByTerminal(terminalId) {\n    const result = [];\n    for (const [processId, proc] of this.processes) {\n      if (proc.terminalId === terminalId) {\n        result.push({ processId, ...proc });\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Get all running processes\n   * @returns {Array} Array of process info\n   */\n  getAllProcesses() {\n    const result = [];\n    for (const [processId, proc] of this.processes) {\n      result.push({ processId, ...proc });\n    }\n    return result;\n  }\n\n  /**\n   * Check if a node name is already running\n   * @param {string} nodeName - Node name to check\n   * @returns {boolean}\n   */\n  isNodeRunning(nodeName) {\n    for (const [, proc] of this.processes) {\n      if (proc.node.fullName === nodeName) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Get count of running processes\n   * @returns {number}\n   */\n  getProcessCount() {\n    return this.processes.size;\n  }\n\n  /**\n   * Kill all processes\n   */\n  killAll() {\n    const toKill = Array.from(this.processes.keys());\n    for (const processId of toKill) {\n      this.kill(processId);\n    }\n  }\n}\n\n// Singleton instance\nexport const ProcessManager = new ProcessManagerClass();\n\n// Register with ServiceContainer for dependency injection\nServiceContainer.register('processManager', ProcessManager);\n","import { Terminal } from './Terminal.js';\nimport { ProcessManager } from '../core/ProcessManager.js';\nimport { Events } from '../core/Events.js';\n\n/**\n * TerminalManager - Manages multiple terminal panes\n */\nexport class TerminalManager {\n  constructor(options = {}) {\n    this.containerId = options.containerId || 'terminals-container';\n    this.tabListId = options.tabListId || 'terminal-tabs';\n    this.addButtonId = options.addButtonId || 'add-terminal';\n    this.maxTerminals = options.maxTerminals || 6;\n    this.onCommand = options.onCommand || (() => {});\n\n    this.terminals = new Map();\n    this.activeTerminalId = null;\n    this.nextTerminalNum = 1;\n\n    this.container = document.getElementById(this.containerId);\n    this.tabList = document.querySelector(`#${this.tabListId} .tab-list`);\n    this.addButton = document.getElementById(this.addButtonId);\n\n    this._setupEventListeners();\n    this._addTerminal(); // Create first terminal\n  }\n\n  _setupEventListeners() {\n    // Add terminal button\n    this.addButton?.addEventListener('click', () => {\n      this._addTerminal();\n    });\n\n    // Handle window resize\n    window.addEventListener('resize', () => {\n      this._resizeAll();\n    });\n\n    // Handle layout changes\n    window.addEventListener(Events.LAYOUT_RESIZE, () => {\n      // Delay to allow layout to settle\n      setTimeout(() => this._resizeAll(), 100);\n    });\n\n    // Listen for process state changes to update tab indicators\n    window.addEventListener(Events.PROCESS_STARTED, (event) => {\n      const { terminalId } = event.detail || {};\n      if (terminalId) this._updateTabIndicator(terminalId, true);\n    });\n\n    window.addEventListener(Events.PROCESS_STOPPED, (event) => {\n      const { terminalId } = event.detail || {};\n      if (terminalId) this._updateTabIndicator(terminalId, false);\n    });\n  }\n\n  /**\n   * Update the tab process indicator dot\n   */\n  _updateTabIndicator(termId, isRunning) {\n    const termData = this.terminals.get(termId);\n    if (!termData) return;\n\n    const statusDot = termData.tab.querySelector('.tab-status');\n    if (statusDot) {\n      statusDot.classList.toggle('running', isRunning);\n    }\n  }\n\n  _addTerminal() {\n    if (this.terminals.size >= this.maxTerminals) {\n      return null;\n    }\n\n    const termId = `terminal_${this.nextTerminalNum++}`;\n    const termNum = this.terminals.size + 1;\n\n    // Create terminal container\n    const termContainer = document.createElement('div');\n    termContainer.id = termId;\n    termContainer.className = 'terminal-pane';\n    this.container.appendChild(termContainer);\n\n    // Create tab\n    const tab = document.createElement('div');\n    tab.className = 'terminal-tab';\n    tab.dataset.termId = termId;\n    tab.setAttribute('role', 'tab');\n    tab.setAttribute('aria-selected', 'false');\n    tab.innerHTML = `\n      <span class=\"tab-status\" aria-hidden=\"true\"></span>\n      <span class=\"tab-title\">Terminal ${termNum}</span>\n      <button class=\"tab-close\" aria-label=\"Close terminal ${termNum}\">&times;</button>\n    `;\n    this.tabList.appendChild(tab);\n\n    // Tab click handler\n    tab.addEventListener('click', (e) => {\n      if (!e.target.classList.contains('tab-close')) {\n        this._activateTerminal(termId);\n      }\n    });\n\n    // Close button handler\n    tab.querySelector('.tab-close').addEventListener('click', (e) => {\n      e.stopPropagation();\n      this._removeTerminal(termId);\n    });\n\n    // Create terminal\n    const terminal = new Terminal(termContainer, {\n      id: termId,\n      onCommand: (cmd, term) => this.onCommand(cmd, term),\n      onInterrupt: (term) => this._handleInterrupt(term)\n    });\n\n    this.terminals.set(termId, { terminal, tab, container: termContainer });\n\n    // Activate this terminal\n    this._activateTerminal(termId);\n\n    // Update add button visibility\n    this._updateAddButton();\n\n    return terminal;\n  }\n\n  _removeTerminal(termId) {\n    const termData = this.terminals.get(termId);\n    if (!termData) return;\n\n    // Don't remove the last terminal\n    if (this.terminals.size <= 1) {\n      return;\n    }\n\n    // Kill all processes owned by this terminal\n    ProcessManager.killByTerminal(termId);\n\n    // Destroy terminal\n    termData.terminal.destroy();\n    termData.container.remove();\n    termData.tab.remove();\n\n    this.terminals.delete(termId);\n\n    // Activate another terminal if this was active\n    if (this.activeTerminalId === termId) {\n      const nextTerm = this.terminals.keys().next().value;\n      if (nextTerm) {\n        this._activateTerminal(nextTerm);\n      }\n    }\n\n    // Renumber tabs\n    this._renumberTabs();\n\n    // Update add button visibility\n    this._updateAddButton();\n  }\n\n  _activateTerminal(termId) {\n    const termData = this.terminals.get(termId);\n    if (!termData) return;\n\n    // Deactivate current\n    if (this.activeTerminalId && this.activeTerminalId !== termId) {\n      const prevData = this.terminals.get(this.activeTerminalId);\n      if (prevData) {\n        prevData.tab.classList.remove('active');\n        prevData.tab.setAttribute('aria-selected', 'false');\n        prevData.container.classList.remove('active');\n      }\n    }\n\n    // Activate new\n    termData.tab.classList.add('active');\n    termData.tab.setAttribute('aria-selected', 'true');\n    termData.container.classList.add('active');\n    this.activeTerminalId = termId;\n\n    // Focus and fit\n    setTimeout(() => {\n      termData.terminal.focus();\n      termData.terminal.fit();\n    }, 0);\n  }\n\n  _handleInterrupt(terminal) {\n    // Kill processes owned by this terminal\n    ProcessManager.killByTerminal(terminal.id);\n  }\n\n  _renumberTabs() {\n    let num = 1;\n    for (const [, termData] of this.terminals) {\n      const title = termData.tab.querySelector('.tab-title');\n      if (title) {\n        title.textContent = `Terminal ${num}`;\n      }\n      num++;\n    }\n  }\n\n  _updateAddButton() {\n    if (this.addButton) {\n      this.addButton.style.display =\n        this.terminals.size >= this.maxTerminals ? 'none' : 'block';\n    }\n  }\n\n  _resizeAll() {\n    for (const [, termData] of this.terminals) {\n      termData.terminal.fit();\n    }\n  }\n\n  /**\n   * Get the currently active terminal\n   */\n  getActiveTerminal() {\n    if (!this.activeTerminalId) return null;\n    const termData = this.terminals.get(this.activeTerminalId);\n    return termData?.terminal || null;\n  }\n\n  /**\n   * Get a terminal by ID\n   */\n  getTerminal(termId) {\n    return this.terminals.get(termId)?.terminal || null;\n  }\n\n  /**\n   * Get all terminals\n   */\n  getAllTerminals() {\n    return Array.from(this.terminals.values()).map(td => td.terminal);\n  }\n\n  /**\n   * Get terminal count\n   */\n  getTerminalCount() {\n    return this.terminals.size;\n  }\n\n  /**\n   * Clear all terminals\n   */\n  clearAll() {\n    for (const [, termData] of this.terminals) {\n      termData.terminal.clear();\n      termData.terminal.writePrompt();\n    }\n  }\n\n  /**\n   * Focus the active terminal\n   */\n  focus() {\n    const active = this.getActiveTerminal();\n    if (active) {\n      active.focus();\n    }\n  }\n\n  /**\n   * Destroy all terminals\n   */\n  destroy() {\n    for (const [termId] of this.terminals) {\n      const termData = this.terminals.get(termId);\n      if (termData) {\n        ProcessManager.killByTerminal(termId);\n        termData.terminal.destroy();\n      }\n    }\n    this.terminals.clear();\n    this.container.innerHTML = '';\n    this.tabList.innerHTML = '';\n  }\n}\n","import { Events } from './Events.js';\nimport { ServiceContainer } from './ServiceContainer.js';\n\n/**\n * WorldState - Manages the simulation world including obstacles,\n * collision detection, and raycasting for simulated sensors\n */\nexport class WorldStateClass {\n  constructor() {\n    // World dimensions (matches turtlesim: 11x11 units)\n    this.width = 11;\n    this.height = 11;\n\n    // Obstacles: array of { type, x, y, width, height, ... }\n    this.obstacles = [];\n\n    // Turtles managed by turtlesim\n    this.turtles = new Map();\n\n    // Optional callback for change notifications (for testing/decoupling)\n    this.onChangeCallback = null;\n\n    // Default obstacles for SLAM demo\n    this._initDefaultObstacles();\n  }\n\n  /**\n   * Set a callback for change notifications (useful for testing)\n   * @param {Function|null} callback - Callback function or null to clear\n   */\n  setOnChangeCallback(callback) {\n    this.onChangeCallback = callback;\n  }\n\n  /**\n   * Initialize default obstacles for the SLAM demo\n   */\n  _initDefaultObstacles() {\n    this.obstacles = [\n      // Outer walls\n      { type: 'wall', x: 0, y: 0, width: 11, height: 0.1 },          // Bottom\n      { type: 'wall', x: 0, y: 10.9, width: 11, height: 0.1 },       // Top\n      { type: 'wall', x: 0, y: 0, width: 0.1, height: 11 },          // Left\n      { type: 'wall', x: 10.9, y: 0, width: 0.1, height: 11 },       // Right\n\n      // Interior obstacles for SLAM demo\n      { type: 'box', x: 3, y: 3, width: 1.5, height: 1.5 },\n      { type: 'box', x: 7, y: 2, width: 1, height: 2 },\n      { type: 'box', x: 2, y: 7, width: 2, height: 1 },\n      { type: 'box', x: 6, y: 6, width: 1.5, height: 1.5 },\n      { type: 'box', x: 8, y: 8, width: 1, height: 1 }\n    ];\n  }\n\n  /**\n   * Add an obstacle\n   */\n  addObstacle(obstacle) {\n    this.obstacles.push(obstacle);\n  }\n\n  /**\n   * Remove an obstacle by index\n   */\n  removeObstacle(index) {\n    if (index >= 0 && index < this.obstacles.length) {\n      this.obstacles.splice(index, 1);\n    }\n  }\n\n  /**\n   * Clear all obstacles\n   */\n  clearObstacles() {\n    this.obstacles = [];\n  }\n\n  /**\n   * Reset to default obstacles\n   */\n  resetObstacles() {\n    this._initDefaultObstacles();\n    this._notifyChange();\n  }\n\n  /**\n   * Generate random obstacles\n   * @param {number} count - Number of obstacles to generate\n   * @param {Object} options - Size options\n   */\n  randomizeObstacles(count = 5, options = {}) {\n    const {\n      minSize = 0.5,\n      maxSize = 2.0,\n      keepWalls = true,\n      margin = 1.5  // Keep obstacles away from center spawn point\n    } = options;\n\n    // Keep walls if requested\n    if (keepWalls) {\n      this.obstacles = this.obstacles.filter(obs => obs.type === 'wall');\n    } else {\n      this.obstacles = [];\n    }\n\n    // Generate random obstacles\n    for (let i = 0; i < count; i++) {\n      const width = minSize + Math.random() * (maxSize - minSize);\n      const height = minSize + Math.random() * (maxSize - minSize);\n\n      let x, y;\n      let attempts = 0;\n      const maxAttempts = 50;\n\n      // Try to find a non-overlapping position\n      do {\n        x = 0.5 + Math.random() * (this.width - width - 1);\n        y = 0.5 + Math.random() * (this.height - height - 1);\n        attempts++;\n      } while (\n        attempts < maxAttempts &&\n        (this._obstacleOverlaps(x, y, width, height) ||\n         this._tooCloseToCenter(x, y, width, height, margin))\n      );\n\n      if (attempts < maxAttempts) {\n        this.obstacles.push({\n          type: 'box',\n          x,\n          y,\n          width,\n          height\n        });\n      }\n    }\n\n    this._notifyChange();\n  }\n\n  /**\n   * Check if a new obstacle would overlap existing ones\n   */\n  _obstacleOverlaps(x, y, w, h, padding = 0.3) {\n    for (const obs of this.obstacles) {\n      if (obs.type === 'wall') continue;\n\n      const overlapX = x < obs.x + obs.width + padding && x + w + padding > obs.x;\n      const overlapY = y < obs.y + obs.height + padding && y + h + padding > obs.y;\n\n      if (overlapX && overlapY) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Check if obstacle is too close to center (turtle spawn point)\n   */\n  _tooCloseToCenter(x, y, w, h, margin) {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n\n    // Check if rectangle is within margin of center\n    const closestX = Math.max(x, Math.min(centerX, x + w));\n    const closestY = Math.max(y, Math.min(centerY, y + h));\n\n    const dx = centerX - closestX;\n    const dy = centerY - closestY;\n\n    return Math.sqrt(dx * dx + dy * dy) < margin;\n  }\n\n  /**\n   * Find obstacle at a given point\n   * @returns {number} Index of obstacle, or -1 if none found\n   */\n  findObstacleAt(x, y) {\n    for (let i = this.obstacles.length - 1; i >= 0; i--) {\n      const obs = this.obstacles[i];\n      if (obs.type === 'wall') continue; // Don't select walls\n\n      if (x >= obs.x && x <= obs.x + obs.width &&\n          y >= obs.y && y <= obs.y + obs.height) {\n        return i;\n      }\n    }\n    return -1;\n  }\n\n  /**\n   * Add obstacle at position\n   */\n  addObstacleAt(x, y, width = 1, height = 1) {\n    // Center the obstacle on the click point\n    const obs = {\n      type: 'box',\n      x: x - width / 2,\n      y: y - height / 2,\n      width,\n      height\n    };\n\n    // Clamp to world bounds\n    obs.x = Math.max(0.2, Math.min(this.width - width - 0.2, obs.x));\n    obs.y = Math.max(0.2, Math.min(this.height - height - 0.2, obs.y));\n\n    this.obstacles.push(obs);\n    this._notifyChange();\n    return this.obstacles.length - 1;\n  }\n\n  /**\n   * Remove obstacle at position\n   * @returns {boolean} True if obstacle was removed\n   */\n  removeObstacleAt(x, y) {\n    const index = this.findObstacleAt(x, y);\n    if (index >= 0) {\n      this.obstacles.splice(index, 1);\n      this._notifyChange();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Clear all non-wall obstacles\n   */\n  clearNonWallObstacles() {\n    this.obstacles = this.obstacles.filter(obs => obs.type === 'wall');\n    this._notifyChange();\n  }\n\n  /**\n   * Notify listeners of changes\n   * Uses callback if set, otherwise falls back to window event dispatch\n   */\n  _notifyChange() {\n    if (this.onChangeCallback) {\n      this.onChangeCallback();\n    } else {\n      window.dispatchEvent(new CustomEvent(Events.WORLD_STATE_CHANGED));\n    }\n  }\n\n  /**\n   * Get count of non-wall obstacles\n   */\n  getObstacleCount() {\n    return this.obstacles.filter(obs => obs.type !== 'wall').length;\n  }\n\n  /**\n   * Register a turtle\n   */\n  registerTurtle(name, x, y, theta) {\n    this.turtles.set(name, { x, y, theta });\n  }\n\n  /**\n   * Update turtle position\n   */\n  updateTurtle(name, x, y, theta) {\n    if (this.turtles.has(name)) {\n      this.turtles.set(name, { x, y, theta });\n    }\n  }\n\n  /**\n   * Remove a turtle\n   */\n  removeTurtle(name) {\n    this.turtles.delete(name);\n  }\n\n  /**\n   * Get turtle position\n   */\n  getTurtle(name) {\n    return this.turtles.get(name);\n  }\n\n  /**\n   * Check if a point collides with any obstacle\n   * @param {number} x - X coordinate\n   * @param {number} y - Y coordinate\n   * @param {number} radius - Collision radius (default 0.2)\n   * @returns {boolean} True if collision detected\n   */\n  checkCollision(x, y, radius = 0.2) {\n    // Check world bounds\n    if (x - radius < 0 || x + radius > this.width ||\n        y - radius < 0 || y + radius > this.height) {\n      return true;\n    }\n\n    // Check obstacles\n    for (const obs of this.obstacles) {\n      if (this._circleRectCollision(x, y, radius, obs.x, obs.y, obs.width, obs.height)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /**\n   * Circle-rectangle collision detection\n   */\n  _circleRectCollision(cx, cy, r, rx, ry, rw, rh) {\n    // Find closest point on rectangle to circle center\n    const closestX = Math.max(rx, Math.min(cx, rx + rw));\n    const closestY = Math.max(ry, Math.min(cy, ry + rh));\n\n    // Calculate distance\n    const dx = cx - closestX;\n    const dy = cy - closestY;\n    const distSq = dx * dx + dy * dy;\n\n    return distSq < r * r;\n  }\n\n  /**\n   * Raycast from a point in a direction\n   * @param {number} x - Start X\n   * @param {number} y - Start Y\n   * @param {number} angle - Ray angle in radians\n   * @param {number} maxRange - Maximum ray distance\n   * @returns {Object} { hit: boolean, distance: number, point: {x, y} }\n   */\n  raycast(x, y, angle, maxRange = 10) {\n    const dx = Math.cos(angle);\n    const dy = Math.sin(angle);\n\n    let closestHit = null;\n    let closestDist = maxRange;\n\n    // Check all obstacles\n    for (const obs of this.obstacles) {\n      const hit = this._rayRectIntersection(x, y, dx, dy, obs.x, obs.y, obs.width, obs.height);\n      if (hit && hit.distance < closestDist) {\n        closestDist = hit.distance;\n        closestHit = hit;\n      }\n    }\n\n    // Check world bounds\n    const boundHits = [\n      this._rayLineIntersection(x, y, dx, dy, 0, 0, this.width, 0),          // Bottom\n      this._rayLineIntersection(x, y, dx, dy, 0, this.height, this.width, this.height), // Top\n      this._rayLineIntersection(x, y, dx, dy, 0, 0, 0, this.height),          // Left\n      this._rayLineIntersection(x, y, dx, dy, this.width, 0, this.width, this.height)   // Right\n    ];\n\n    for (const hit of boundHits) {\n      if (hit && hit.distance > 0 && hit.distance < closestDist) {\n        closestDist = hit.distance;\n        closestHit = hit;\n      }\n    }\n\n    if (closestHit) {\n      return {\n        hit: true,\n        distance: closestDist,\n        point: closestHit.point\n      };\n    }\n\n    return {\n      hit: false,\n      distance: maxRange,\n      point: { x: x + dx * maxRange, y: y + dy * maxRange }\n    };\n  }\n\n  /**\n   * Ray-rectangle intersection\n   */\n  _rayRectIntersection(rx, ry, dx, dy, bx, by, bw, bh) {\n    // Check all four edges of the rectangle\n    const edges = [\n      { x1: bx, y1: by, x2: bx + bw, y2: by },           // Bottom\n      { x1: bx, y1: by + bh, x2: bx + bw, y2: by + bh }, // Top\n      { x1: bx, y1: by, x2: bx, y2: by + bh },           // Left\n      { x1: bx + bw, y1: by, x2: bx + bw, y2: by + bh }  // Right\n    ];\n\n    let closest = null;\n    let closestDist = Infinity;\n\n    for (const edge of edges) {\n      const hit = this._rayLineIntersection(rx, ry, dx, dy, edge.x1, edge.y1, edge.x2, edge.y2);\n      if (hit && hit.distance > 0.001 && hit.distance < closestDist) {\n        closestDist = hit.distance;\n        closest = hit;\n      }\n    }\n\n    return closest;\n  }\n\n  /**\n   * Ray-line segment intersection\n   */\n  _rayLineIntersection(rx, ry, dx, dy, x1, y1, x2, y2) {\n    const sx = x2 - x1;\n    const sy = y2 - y1;\n\n    const denom = dx * sy - dy * sx;\n    if (Math.abs(denom) < 0.0001) return null; // Parallel\n\n    const t = ((x1 - rx) * sy - (y1 - ry) * sx) / denom;\n    const u = ((x1 - rx) * dy - (y1 - ry) * dx) / denom;\n\n    if (t > 0 && u >= 0 && u <= 1) {\n      return {\n        distance: t,\n        point: { x: rx + dx * t, y: ry + dy * t }\n      };\n    }\n\n    return null;\n  }\n\n  /**\n   * Perform a lidar scan\n   * @param {number} x - Robot X position\n   * @param {number} y - Robot Y position\n   * @param {number} theta - Robot heading\n   * @param {Object} config - Lidar configuration\n   * @returns {Object} LaserScan-like data\n   */\n  lidarScan(x, y, theta, config = {}) {\n    const {\n      angleMin = -Math.PI,           // Start angle\n      angleMax = Math.PI,            // End angle\n      angleIncrement = Math.PI / 180, // 1 degree resolution\n      rangeMin = 0.1,\n      rangeMax = 10.0,\n      numRays = 360\n    } = config;\n\n    const ranges = [];\n    const intensities = [];\n    const actualIncrement = (angleMax - angleMin) / numRays;\n\n    for (let i = 0; i < numRays; i++) {\n      const angle = theta + angleMin + i * actualIncrement;\n      const result = this.raycast(x, y, angle, rangeMax);\n\n      if (result.hit && result.distance >= rangeMin) {\n        ranges.push(result.distance);\n        intensities.push(1.0);\n      } else if (result.distance < rangeMin) {\n        ranges.push(Infinity); // Too close\n        intensities.push(0);\n      } else {\n        ranges.push(Infinity); // No hit\n        intensities.push(0);\n      }\n    }\n\n    return {\n      angle_min: angleMin,\n      angle_max: angleMax,\n      angle_increment: actualIncrement,\n      time_increment: 0,\n      scan_time: 0.1,\n      range_min: rangeMin,\n      range_max: rangeMax,\n      ranges,\n      intensities\n    };\n  }\n\n  /**\n   * Get all obstacles for rendering\n   */\n  getObstacles() {\n    return this.obstacles;\n  }\n}\n\n// Singleton instance\nexport const WorldState = new WorldStateClass();\n\n// Register with ServiceContainer for dependency injection\nServiceContainer.register('worldState', WorldState);\n","import { WorldState } from '../core/WorldState.js';\nimport { Events } from '../core/Events.js';\n\n/**\n * Canvas - 2D visualization for turtle and obstacles\n *\n * Accepts either a canvas element or an element ID for backward compatibility.\n */\nexport class Canvas {\n  constructor(canvasOrId = 'turtle-canvas') {\n    // Support both element and ID for backward compatibility\n    if (typeof canvasOrId === 'string') {\n      this.canvas = document.getElementById(canvasOrId);\n    } else {\n      this.canvas = canvasOrId;\n    }\n    this.ctx = this.canvas.getContext('2d');\n\n    // World dimensions (turtlesim uses 11x11)\n    this.worldWidth = 11;\n    this.worldHeight = 11;\n\n    // Turtle image\n    this.turtleImage = new Image();\n    this.turtleImageLoaded = false;\n    this._loadTurtleImage();\n\n    // Visualization options\n    this.showObstacles = true;\n    this.showLidar = false;\n    this.showTF = false;\n\n    // Map overlay options\n    this.showMap = false;\n    this.mapOpacity = 0.5;\n    this.mapData = null;\n    this.mapInfo = null;\n    this.mapCanvas = null; // Off-screen canvas for map rendering\n\n    // Costmap overlay\n    this.showCostmap = false;\n    this.costmapCanvas = null;\n    this.costmapRobotRadius = 0.6;\n\n    // Map quality overlay\n    this.showMapQuality = false;\n    this.mapQualityCanvas = null;\n    this.mapQualityScore = null;\n\n    // Waypoints\n    this.waypoints = [];\n\n    // Resize debounce guard\n    this._resizeScheduled = false;\n\n    // Edit mode: 'none', 'add', 'delete'\n    this.editMode = 'none';\n    this.newObstacleSize = 1.0;\n\n    // Current state\n    this.turtles = [];\n    this.trails = [];\n    this.background = { r: 69, g: 86, b: 255 };\n    this.lidarData = null;\n    this.hasTurtlesim = false;\n\n    // Set up event listeners\n    this._setupEventListeners();\n    this._setupClickHandlers();\n\n    // Initial render\n    this._render();\n  }\n\n  _loadTurtleImage() {\n    // Create a simple turtle shape as data URL\n    const turtleSvg = `\n      <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"48\" height=\"48\" viewBox=\"0 0 48 48\">\n        <!-- Shell -->\n        <ellipse cx=\"24\" cy=\"24\" rx=\"16\" ry=\"14\" fill=\"#228B22\" stroke=\"#006400\" stroke-width=\"2\"/>\n        <!-- Shell pattern -->\n        <path d=\"M24 10 L24 38\" stroke=\"#006400\" stroke-width=\"1\"/>\n        <path d=\"M12 24 L36 24\" stroke=\"#006400\" stroke-width=\"1\"/>\n        <path d=\"M16 14 L32 34\" stroke=\"#006400\" stroke-width=\"1\"/>\n        <path d=\"M32 14 L16 34\" stroke=\"#006400\" stroke-width=\"1\"/>\n        <!-- Head -->\n        <circle cx=\"40\" cy=\"24\" r=\"6\" fill=\"#90EE90\" stroke=\"#228B22\" stroke-width=\"1.5\"/>\n        <!-- Eyes -->\n        <circle cx=\"42\" cy=\"22\" r=\"1.5\" fill=\"#000\"/>\n        <circle cx=\"42\" cy=\"26\" r=\"1.5\" fill=\"#000\"/>\n        <!-- Legs -->\n        <ellipse cx=\"14\" cy=\"12\" rx=\"5\" ry=\"4\" fill=\"#90EE90\" stroke=\"#228B22\" stroke-width=\"1\"/>\n        <ellipse cx=\"14\" cy=\"36\" rx=\"5\" ry=\"4\" fill=\"#90EE90\" stroke=\"#228B22\" stroke-width=\"1\"/>\n        <ellipse cx=\"30\" cy=\"12\" rx=\"5\" ry=\"4\" fill=\"#90EE90\" stroke=\"#228B22\" stroke-width=\"1\"/>\n        <ellipse cx=\"30\" cy=\"36\" rx=\"5\" ry=\"4\" fill=\"#90EE90\" stroke=\"#228B22\" stroke-width=\"1\"/>\n        <!-- Tail -->\n        <path d=\"M6 24 Q2 24 4 22\" stroke=\"#90EE90\" stroke-width=\"3\" fill=\"none\"/>\n      </svg>\n    `;\n\n    const blob = new Blob([turtleSvg], { type: 'image/svg+xml' });\n    const url = URL.createObjectURL(blob);\n\n    this.turtleImage.onload = () => {\n      this.turtleImageLoaded = true;\n      URL.revokeObjectURL(url);\n      this._render();\n    };\n\n    this.turtleImage.src = url;\n  }\n\n  _setupEventListeners() {\n    // Listen for turtlesim updates\n    window.addEventListener(Events.TURTLESIM_UPDATE, (event) => {\n      const { turtles, trails, background } = event.detail;\n      this.turtles = turtles;\n      this.trails = trails;\n      this.background = background;\n      this.hasTurtlesim = turtles && turtles.length > 0;\n      this._render();\n    });\n\n    // Listen for lidar data\n    window.addEventListener(Events.LIDAR_UPDATE, (event) => {\n      this.lidarData = event.detail;\n      if (this.showLidar) {\n        this._render();\n      }\n    });\n\n    // Listen for map updates\n    window.addEventListener(Events.MAP_UPDATE, (event) => {\n      const { map, info } = event.detail;\n      this.mapData = map;\n      this.mapInfo = info;\n      this._updateMapCanvas();\n      if (this.showCostmap) {\n        this._updateCostmapCanvas();\n      }\n      if (this.showMapQuality) {\n        this._updateMapQualityCanvas();\n      }\n      if (this.showMap || this.showCostmap || this.showMapQuality) {\n        this._render();\n      }\n    });\n\n    // Handle resize\n    window.addEventListener('resize', () => this._handleResize());\n    window.addEventListener(Events.LAYOUT_RESIZE, () => this._handleResize());\n\n    // Listen for world state changes\n    window.addEventListener(Events.WORLD_STATE_CHANGED, () => this._render());\n\n    // Listen for waypoint events\n    window.addEventListener(Events.WAYPOINTS_UPDATE, (event) => {\n      this.waypoints = event.detail.waypoints || [];\n      this._render();\n    });\n\n    window.addEventListener(Events.WAYPOINTS_CLEARED, () => {\n      this.waypoints = [];\n      this._render();\n    });\n\n    // Initial size\n    this._handleResize();\n  }\n\n  _setupClickHandlers() {\n    this.canvas.addEventListener('click', (event) => {\n      if (this.editMode === 'none') return;\n\n      const rect = this.canvas.getBoundingClientRect();\n      const canvasX = event.clientX - rect.left;\n      const canvasY = event.clientY - rect.top;\n\n      // Convert to world coordinates\n      const worldCoords = this._canvasToWorld(canvasX, canvasY);\n\n      if (this.editMode === 'add') {\n        WorldState.addObstacleAt(worldCoords.x, worldCoords.y, this.newObstacleSize, this.newObstacleSize);\n      } else if (this.editMode === 'delete') {\n        WorldState.removeObstacleAt(worldCoords.x, worldCoords.y);\n      }\n    });\n\n    // Show cursor hint based on edit mode\n    this.canvas.addEventListener('mousemove', (event) => {\n      if (this.editMode === 'none') {\n        this.canvas.style.cursor = 'default';\n      } else if (this.editMode === 'add') {\n        this.canvas.style.cursor = 'crosshair';\n      } else if (this.editMode === 'delete') {\n        // Check if hovering over an obstacle\n        const rect = this.canvas.getBoundingClientRect();\n        const canvasX = event.clientX - rect.left;\n        const canvasY = event.clientY - rect.top;\n        const worldCoords = this._canvasToWorld(canvasX, canvasY);\n\n        const index = WorldState.findObstacleAt(worldCoords.x, worldCoords.y);\n        this.canvas.style.cursor = index >= 0 ? 'pointer' : 'not-allowed';\n      }\n    });\n  }\n\n  /**\n   * Convert canvas coordinates to world coordinates\n   */\n  _canvasToWorld(canvasX, canvasY) {\n    const scaleX = this.worldWidth / this.canvas.width;\n    const scaleY = this.worldHeight / this.canvas.height;\n    return {\n      x: canvasX * scaleX,\n      y: (this.canvas.height - canvasY) * scaleY // Flip Y axis\n    };\n  }\n\n  _handleResize() {\n    if (this._resizeScheduled) return;\n    this._resizeScheduled = true;\n    requestAnimationFrame(() => {\n      this._resizeScheduled = false;\n      const container = this.canvas.parentElement;\n      if (!container) return;\n\n      const rect = container.getBoundingClientRect();\n      // Don't resize if container is hidden (rect would be all zeros)\n      if (rect.width === 0 || rect.height === 0) return;\n\n      const size = Math.min(rect.width, rect.height, 500);\n\n      this.canvas.width = size;\n      this.canvas.height = size;\n\n      this._render();\n    });\n  }\n\n  /**\n   * Convert world coordinates to canvas coordinates\n   */\n  _worldToCanvas(x, y) {\n    const scaleX = this.canvas.width / this.worldWidth;\n    const scaleY = this.canvas.height / this.worldHeight;\n    return {\n      x: x * scaleX,\n      y: this.canvas.height - y * scaleY // Flip Y axis\n    };\n  }\n\n  /**\n   * Convert world distance to canvas distance\n   */\n  _worldToCanvasScale(distance) {\n    return (distance / this.worldWidth) * this.canvas.width;\n  }\n\n  /**\n   * Update the off-screen map canvas when map data changes\n   */\n  _updateMapCanvas() {\n    if (!this.mapData || !this.mapInfo) return;\n\n    const { width, height, resolution, origin } = this.mapInfo;\n    if (!width || !height) return;\n\n    // Create or resize off-screen canvas\n    if (!this.mapCanvas) {\n      this.mapCanvas = document.createElement('canvas');\n    }\n    this.mapCanvas.width = width;\n    this.mapCanvas.height = height;\n\n    const mapCtx = this.mapCanvas.getContext('2d');\n    const imageData = mapCtx.createImageData(width, height);\n\n    // Render occupancy grid data to image with distinct colors\n    // Note: Grid data is stored with Y=0 at bottom (world space)\n    // Image pixels have Y=0 at top, so we flip Y when writing\n    for (let gridY = 0; gridY < height; gridY++) {\n      for (let gridX = 0; gridX < width; gridX++) {\n        const gridIndex = gridY * width + gridX;\n        const value = this.mapData[gridIndex];\n\n        // Flip Y: grid row 0 (world bottom) -> image row (height-1) (image bottom)\n        const imageY = height - 1 - gridY;\n        const pixelIndex = (imageY * width + gridX) * 4;\n\n        let r, g, b;\n\n        if (value === -1) {\n          // Unknown - transparent blue-gray (will blend with background)\n          r = 100;\n          g = 100;\n          b = 120;\n        } else if (value <= 10) {\n          // Free space - white/light green tint\n          r = 220;\n          g = 255;\n          b = 220;\n        } else if (value >= 65) {\n          // Definitely occupied - strong red/dark\n          const intensity = Math.min(100, value);\n          r = 180 - intensity;  // Gets darker red as more occupied\n          g = 20;\n          b = 20;\n        } else {\n          // Partially occupied - orange to red gradient (11-64)\n          const t = (value - 10) / 55; // 0 to 1\n          r = Math.round(255 - t * 75);  // 255 -> 180\n          g = Math.round(180 - t * 160); // 180 -> 20\n          b = Math.round(100 - t * 80);  // 100 -> 20\n        }\n\n        imageData.data[pixelIndex] = r;\n        imageData.data[pixelIndex + 1] = g;\n        imageData.data[pixelIndex + 2] = b;\n        imageData.data[pixelIndex + 3] = 255;\n      }\n    }\n\n    mapCtx.putImageData(imageData, 0, 0);\n  }\n\n  /**\n   * Update the costmap canvas showing inflation around obstacles\n   */\n  _updateCostmapCanvas() {\n    if (!this.mapData || !this.mapInfo) return;\n\n    const { width, height, resolution } = this.mapInfo;\n    if (!width || !height) return;\n\n    if (!this.costmapCanvas) {\n      this.costmapCanvas = document.createElement('canvas');\n    }\n    this.costmapCanvas.width = width;\n    this.costmapCanvas.height = height;\n\n    const ctx = this.costmapCanvas.getContext('2d');\n    const imageData = ctx.createImageData(width, height);\n\n    const radiusCells = this.costmapRobotRadius > 0 ? Math.ceil(this.costmapRobotRadius / resolution) : 0;\n    const threshold = 50; // obstacle threshold\n\n    // Pre-compute occupied cell positions\n    const occupiedCells = [];\n    for (let gy = 0; gy < height; gy++) {\n      for (let gx = 0; gx < width; gx++) {\n        const val = this.mapData[gy * width + gx];\n        if (val >= threshold) {\n          occupiedCells.push({ gx, gy });\n        }\n      }\n    }\n\n    for (let gy = 0; gy < height; gy++) {\n      for (let gx = 0; gx < width; gx++) {\n        const val = this.mapData[gy * width + gx];\n        const imageY = height - 1 - gy;\n        const pixelIndex = (imageY * width + gx) * 4;\n\n        if (val === -1 || radiusCells <= 0) {\n          // Unknown or no inflation  transparent\n          imageData.data[pixelIndex + 3] = 0;\n          continue;\n        }\n\n        if (val >= threshold) {\n          // Obstacle cell  red\n          imageData.data[pixelIndex] = 255;\n          imageData.data[pixelIndex + 1] = 0;\n          imageData.data[pixelIndex + 2] = 0;\n          imageData.data[pixelIndex + 3] = 180;\n          continue;\n        }\n\n        // Find min distance to nearest occupied cell within radiusCells\n        let minDist = Infinity;\n        for (const oc of occupiedCells) {\n          const dx = gx - oc.gx;\n          const dy = gy - oc.gy;\n          // Quick reject\n          if (Math.abs(dx) > radiusCells || Math.abs(dy) > radiusCells) continue;\n          const d2 = dx * dx + dy * dy;\n          if (d2 < minDist) minDist = d2;\n        }\n\n        const dist = Math.sqrt(minDist);\n\n        if (dist <= radiusCells) {\n          // Within inflation zone  gradient: red(0) -> orange(mid) -> yellow(edge)\n          const t = dist / radiusCells; // 0 at obstacle, 1 at edge\n          const r = 255;\n          const g = Math.round(t * 200); // 0 -> 200\n          const b = 0;\n          const alpha = Math.round(150 * (1 - t * 0.7)); // fade out toward edge\n\n          imageData.data[pixelIndex] = r;\n          imageData.data[pixelIndex + 1] = g;\n          imageData.data[pixelIndex + 2] = b;\n          imageData.data[pixelIndex + 3] = alpha;\n        } else {\n          // Outside inflation  transparent\n          imageData.data[pixelIndex + 3] = 0;\n        }\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  /**\n   * Update the map quality canvas comparing SLAM to ground truth\n   */\n  _updateMapQualityCanvas() {\n    if (!this.mapData || !this.mapInfo) return;\n\n    const { width, height, resolution, origin } = this.mapInfo;\n    if (!width || !height) return;\n\n    if (!this.mapQualityCanvas) {\n      this.mapQualityCanvas = document.createElement('canvas');\n    }\n    this.mapQualityCanvas.width = width;\n    this.mapQualityCanvas.height = height;\n\n    const ctx = this.mapQualityCanvas.getContext('2d');\n    const imageData = ctx.createImageData(width, height);\n\n    const obstacles = WorldState.getObstacles();\n    const threshold = 50;\n    let correct = 0;\n    let totalKnown = 0;\n\n    for (let gy = 0; gy < height; gy++) {\n      for (let gx = 0; gx < width; gx++) {\n        const val = this.mapData[gy * width + gx];\n        const imageY = height - 1 - gy;\n        const pixelIndex = (imageY * width + gx) * 4;\n\n        if (val === -1) {\n          // Unknown  gray\n          imageData.data[pixelIndex] = 128;\n          imageData.data[pixelIndex + 1] = 128;\n          imageData.data[pixelIndex + 2] = 128;\n          imageData.data[pixelIndex + 3] = 100;\n          continue;\n        }\n\n        // Convert grid cell center to world coordinates\n        const wx = gx * resolution + origin.position.x + resolution / 2;\n        const wy = gy * resolution + origin.position.y + resolution / 2;\n\n        const actuallyOccupied = this._isPointInAnyObstacle(wx, wy, obstacles);\n        const slamOccupied = val >= threshold;\n\n        totalKnown++;\n\n        if (slamOccupied === actuallyOccupied) {\n          // Correct  green\n          correct++;\n          imageData.data[pixelIndex] = 0;\n          imageData.data[pixelIndex + 1] = 200;\n          imageData.data[pixelIndex + 2] = 0;\n          imageData.data[pixelIndex + 3] = 100;\n        } else if (slamOccupied && !actuallyOccupied) {\n          // False positive  red\n          imageData.data[pixelIndex] = 255;\n          imageData.data[pixelIndex + 1] = 0;\n          imageData.data[pixelIndex + 2] = 0;\n          imageData.data[pixelIndex + 3] = 160;\n        } else {\n          // False negative  blue\n          imageData.data[pixelIndex] = 0;\n          imageData.data[pixelIndex + 1] = 80;\n          imageData.data[pixelIndex + 2] = 255;\n          imageData.data[pixelIndex + 3] = 160;\n        }\n      }\n    }\n\n    this.mapQualityScore = totalKnown > 0 ? (correct / totalKnown * 100) : null;\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  /**\n   * Check if a world-space point is inside any obstacle rectangle\n   */\n  _isPointInAnyObstacle(x, y, obstacles) {\n    for (const obs of obstacles) {\n      if (x >= obs.x && x <= obs.x + obs.width &&\n          y >= obs.y && y <= obs.y + obs.height) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Render map overlay on canvas\n   */\n  _renderMapOverlay() {\n    if (!this.mapCanvas || !this.mapInfo) return;\n\n    const ctx = this.ctx;\n\n    // Save context state\n    ctx.save();\n    ctx.globalAlpha = this.mapOpacity;\n\n    // Disable image smoothing for crisp pixel rendering\n    ctx.imageSmoothingEnabled = false;\n\n    // The map covers the entire world (0,0) to (worldWidth, worldHeight)\n    // Draw it to fill the entire canvas\n    ctx.drawImage(this.mapCanvas, 0, 0, this.canvas.width, this.canvas.height);\n\n    // Restore context state\n    ctx.restore();\n  }\n\n  /**\n   * Render costmap overlay\n   */\n  _renderCostmapOverlay() {\n    if (!this.costmapCanvas || !this.mapInfo) return;\n\n    const ctx = this.ctx;\n    ctx.save();\n    ctx.globalAlpha = 0.5;\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(this.costmapCanvas, 0, 0, this.canvas.width, this.canvas.height);\n    ctx.restore();\n  }\n\n  /**\n   * Render map quality overlay with accuracy score\n   */\n  _renderMapQualityOverlay() {\n    if (!this.mapQualityCanvas || !this.mapInfo) return;\n\n    const ctx = this.ctx;\n    ctx.save();\n    ctx.globalAlpha = 0.5;\n    ctx.imageSmoothingEnabled = false;\n    ctx.drawImage(this.mapQualityCanvas, 0, 0, this.canvas.width, this.canvas.height);\n    ctx.restore();\n\n    // Draw accuracy score text box\n    if (this.mapQualityScore !== null) {\n      const text = `Accuracy: ${this.mapQualityScore.toFixed(1)}%`;\n      ctx.save();\n      ctx.font = '12px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n      const metrics = ctx.measureText(text);\n      const padding = 6;\n      const boxW = metrics.width + padding * 2;\n      const boxH = 20;\n\n      ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';\n      ctx.fillRect(8, 8, boxW, boxH);\n      ctx.fillStyle = '#fff';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(text, 8 + padding, 8 + boxH / 2);\n      ctx.restore();\n    }\n  }\n\n  /**\n   * Main render function\n   */\n  _render() {\n    const ctx = this.ctx;\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n\n    // Clear canvas with background color\n    ctx.fillStyle = `rgb(${this.background.r}, ${this.background.g}, ${this.background.b})`;\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw map overlay (before obstacles, after background)\n    if (this.showMap) {\n      this._renderMapOverlay();\n    }\n\n    // Draw costmap overlay\n    if (this.showCostmap) {\n      this._renderCostmapOverlay();\n    }\n\n    // Draw map quality overlay\n    if (this.showMapQuality) {\n      this._renderMapQualityOverlay();\n    }\n\n    // Draw obstacles\n    if (this.showObstacles) {\n      this._renderObstacles();\n    }\n\n    // If no turtlesim running, show empty state hint\n    if (!this.hasTurtlesim) {\n      this._renderEmptyState();\n      return;\n    }\n\n    // Draw trails\n    this._renderTrails();\n\n    // Draw lidar rays\n    if (this.showLidar && this.lidarData) {\n      this._renderLidar();\n    }\n\n    // Draw turtles\n    this._renderTurtles();\n\n    // Draw waypoints\n    if (this.waypoints.length > 0) {\n      this._renderWaypoints();\n    }\n\n    // Draw TF frames\n    if (this.showTF) {\n      this._renderTFFrames();\n    }\n  }\n\n  /**\n   * Render empty state hint when no turtlesim is running\n   */\n  _renderEmptyState() {\n    const ctx = this.ctx;\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n\n    // Semi-transparent overlay\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n    ctx.fillRect(0, 0, width, height);\n\n    // Text\n    ctx.fillStyle = '#ffffff';\n    ctx.font = '14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    const text = 'Run: ros2 run turtlesim turtlesim_node';\n    ctx.fillText(text, width / 2, height / 2);\n\n    ctx.font = '12px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif';\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';\n    ctx.fillText('to start the simulation', width / 2, height / 2 + 20);\n  }\n\n  _renderObstacles() {\n    const ctx = this.ctx;\n    const obstacles = WorldState.getObstacles();\n\n    ctx.fillStyle = 'rgba(100, 100, 100, 0.8)';\n    ctx.strokeStyle = '#444';\n    ctx.lineWidth = 2;\n\n    for (const obs of obstacles) {\n      const topLeft = this._worldToCanvas(obs.x, obs.y + obs.height);\n      const w = this._worldToCanvasScale(obs.width);\n      const h = this._worldToCanvasScale(obs.height);\n\n      ctx.fillRect(topLeft.x, topLeft.y, w, h);\n      ctx.strokeRect(topLeft.x, topLeft.y, w, h);\n    }\n  }\n\n  _renderTrails() {\n    const ctx = this.ctx;\n\n    for (const trail of this.trails) {\n      const p1 = this._worldToCanvas(trail.x1, trail.y1);\n      const p2 = this._worldToCanvas(trail.x2, trail.y2);\n\n      ctx.beginPath();\n      ctx.moveTo(p1.x, p1.y);\n      ctx.lineTo(p2.x, p2.y);\n      ctx.strokeStyle = trail.color;\n      ctx.lineWidth = trail.width;\n      ctx.lineCap = 'round';\n      ctx.stroke();\n    }\n  }\n\n  _renderTurtles() {\n    const ctx = this.ctx;\n    const turtleSize = this._worldToCanvasScale(1.2);\n\n    for (const turtle of this.turtles) {\n      const pos = this._worldToCanvas(turtle.x, turtle.y);\n\n      ctx.save();\n      ctx.translate(pos.x, pos.y);\n      // Canvas Y is flipped, so negate angle\n      ctx.rotate(-turtle.theta);\n\n      if (this.turtleImageLoaded) {\n        ctx.drawImage(\n          this.turtleImage,\n          -turtleSize / 2,\n          -turtleSize / 2,\n          turtleSize,\n          turtleSize\n        );\n      } else {\n        // Fallback: draw simple triangle\n        ctx.beginPath();\n        ctx.moveTo(turtleSize / 2, 0);\n        ctx.lineTo(-turtleSize / 2, -turtleSize / 3);\n        ctx.lineTo(-turtleSize / 2, turtleSize / 3);\n        ctx.closePath();\n        ctx.fillStyle = '#00ff00';\n        ctx.fill();\n        ctx.strokeStyle = '#006400';\n        ctx.stroke();\n      }\n\n      ctx.restore();\n    }\n  }\n\n  /**\n   * Render waypoint markers as orange circles with numbered labels\n   */\n  _renderWaypoints() {\n    const ctx = this.ctx;\n    const radius = this._worldToCanvasScale(0.3);\n\n    for (let i = 0; i < this.waypoints.length; i++) {\n      const wp = this.waypoints[i];\n      const pos = this._worldToCanvas(wp.x, wp.y);\n\n      // Orange circle\n      ctx.beginPath();\n      ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);\n      ctx.fillStyle = 'rgba(255, 165, 0, 0.8)';\n      ctx.fill();\n      ctx.strokeStyle = '#cc7700';\n      ctx.lineWidth = 2;\n      ctx.stroke();\n\n      // White numbered label\n      ctx.fillStyle = '#ffffff';\n      ctx.font = `bold ${Math.max(10, radius)}px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif`;\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(`${i + 1}`, pos.x, pos.y);\n    }\n  }\n\n  _renderLidar() {\n    const ctx = this.ctx;\n    const { x, y, theta, scan } = this.lidarData;\n\n    if (!scan || !scan.ranges) return;\n\n    const pos = this._worldToCanvas(x, y);\n\n    ctx.strokeStyle = 'rgba(255, 0, 0, 0.3)';\n    ctx.lineWidth = 1;\n\n    const { angle_min, angle_increment, ranges } = scan;\n\n    for (let i = 0; i < ranges.length; i++) {\n      const range = ranges[i];\n      if (!isFinite(range)) continue;\n\n      const angle = theta + angle_min + i * angle_increment;\n      const endX = x + Math.cos(angle) * range;\n      const endY = y + Math.sin(angle) * range;\n      const endPos = this._worldToCanvas(endX, endY);\n\n      ctx.beginPath();\n      ctx.moveTo(pos.x, pos.y);\n      ctx.lineTo(endPos.x, endPos.y);\n      ctx.stroke();\n\n      // Draw hit point\n      if (range < scan.range_max - 0.1) {\n        ctx.fillStyle = 'red';\n        ctx.beginPath();\n        ctx.arc(endPos.x, endPos.y, 2, 0, Math.PI * 2);\n        ctx.fill();\n      }\n    }\n  }\n\n  _renderTFFrames() {\n    // TF frame visualization - show coordinate axes\n    const ctx = this.ctx;\n    const axisLength = this._worldToCanvasScale(0.5);\n\n    for (const turtle of this.turtles) {\n      const pos = this._worldToCanvas(turtle.x, turtle.y);\n\n      ctx.save();\n      ctx.translate(pos.x, pos.y);\n      ctx.rotate(-turtle.theta);\n\n      // X axis (red)\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(axisLength, 0);\n      ctx.strokeStyle = 'red';\n      ctx.lineWidth = 2;\n      ctx.stroke();\n\n      // Y axis (green)\n      ctx.beginPath();\n      ctx.moveTo(0, 0);\n      ctx.lineTo(0, -axisLength); // Negative because canvas Y is flipped\n      ctx.strokeStyle = 'green';\n      ctx.stroke();\n\n      ctx.restore();\n    }\n  }\n\n  /**\n   * Toggle obstacle visibility\n   */\n  toggleObstacles() {\n    this.showObstacles = !this.showObstacles;\n    this._render();\n  }\n\n  /**\n   * Toggle lidar visualization\n   */\n  toggleLidar() {\n    this.showLidar = !this.showLidar;\n    this._render();\n  }\n\n  /**\n   * Toggle TF frame visualization\n   */\n  toggleTF() {\n    this.showTF = !this.showTF;\n    this._render();\n  }\n\n  /**\n   * Clear trails\n   */\n  clearTrails() {\n    this.trails = [];\n    this._render();\n  }\n\n  /**\n   * Set edit mode\n   * @param {'none' | 'add' | 'delete'} mode\n   */\n  setEditMode(mode) {\n    this.editMode = mode;\n    this.canvas.style.cursor = mode === 'none' ? 'default' : mode === 'add' ? 'crosshair' : 'pointer';\n    window.dispatchEvent(new CustomEvent(Events.CANVAS_EDIT_MODE_CHANGED, { detail: { mode } }));\n  }\n\n  /**\n   * Get current edit mode\n   */\n  getEditMode() {\n    return this.editMode;\n  }\n\n  /**\n   * Set size for new obstacles\n   */\n  setObstacleSize(size) {\n    this.newObstacleSize = Math.max(0.3, Math.min(3, size));\n  }\n\n  /**\n   * Randomize obstacles\n   */\n  randomizeObstacles(count = 5) {\n    WorldState.randomizeObstacles(count);\n  }\n\n  /**\n   * Clear all obstacles (keep walls)\n   */\n  clearObstacles() {\n    WorldState.clearNonWallObstacles();\n  }\n\n  /**\n   * Reset to default obstacles\n   */\n  resetObstacles() {\n    WorldState.resetObstacles();\n  }\n\n  /**\n   * Toggle map overlay visibility\n   */\n  toggleMap() {\n    this.showMap = !this.showMap;\n    this._render();\n    return this.showMap;\n  }\n\n  /**\n   * Set map overlay opacity\n   * @param {number} opacity - Opacity value between 0 and 1\n   */\n  setMapOpacity(opacity) {\n    this.mapOpacity = Math.max(0, Math.min(1, opacity));\n    if (this.showMap) {\n      this._render();\n    }\n  }\n\n  /**\n   * Get current map opacity\n   */\n  getMapOpacity() {\n    return this.mapOpacity;\n  }\n\n  /**\n   * Check if map is currently visible\n   */\n  isMapVisible() {\n    return this.showMap;\n  }\n\n  /**\n   * Toggle costmap visualization\n   */\n  toggleCostmap() {\n    this.showCostmap = !this.showCostmap;\n    if (this.showCostmap) {\n      this._updateCostmapCanvas();\n    }\n    this._render();\n    return this.showCostmap;\n  }\n\n  /**\n   * Set costmap robot radius\n   */\n  setCostmapRobotRadius(radius) {\n    this.costmapRobotRadius = Math.max(0, Math.min(3, radius));\n    if (this.showCostmap) {\n      this._updateCostmapCanvas();\n      this._render();\n    }\n  }\n\n  /**\n   * Toggle map quality visualization\n   */\n  toggleMapQuality() {\n    this.showMapQuality = !this.showMapQuality;\n    if (this.showMapQuality) {\n      this._updateMapQualityCanvas();\n    }\n    this._render();\n    return this.showMapQuality;\n  }\n}\n","import { Events } from '../core/Events.js';\n\n/**\n * MapCanvas - Occupancy grid visualization for SLAM\n *\n * Accepts either a canvas element or an element ID for backward compatibility.\n */\nexport class MapCanvas {\n  constructor(canvasOrId = 'map-canvas') {\n    // Support both element and ID for backward compatibility\n    if (typeof canvasOrId === 'string') {\n      this.canvas = document.getElementById(canvasOrId);\n    } else {\n      this.canvas = canvasOrId;\n    }\n    this.ctx = this.canvas.getContext('2d');\n\n    // Map data\n    this.mapData = null;\n    this.mapInfo = null;\n\n    // Robot position\n    this.robotX = 0;\n    this.robotY = 0;\n    this.robotTheta = 0;\n\n    // Set up event listeners\n    this._setupEventListeners();\n\n    // Initial render\n    this._render();\n  }\n\n  _setupEventListeners() {\n    // Listen for map updates\n    window.addEventListener(Events.MAP_UPDATE, (event) => {\n      const { map, info } = event.detail;\n      this.mapData = map;\n      this.mapInfo = info;\n      this._render();\n    });\n\n    // Listen for robot pose updates\n    window.addEventListener(Events.ROBOT_POSE_UPDATE, (event) => {\n      const { x, y, theta } = event.detail;\n      this.robotX = x;\n      this.robotY = y;\n      this.robotTheta = theta;\n      this._render();\n    });\n\n    // Handle resize\n    window.addEventListener('resize', () => this._handleResize());\n    window.addEventListener(Events.LAYOUT_RESIZE, () => this._handleResize());\n\n    // Initial size\n    this._handleResize();\n  }\n\n  _handleResize() {\n    const container = this.canvas.parentElement;\n    if (!container) return;\n\n    const rect = container.getBoundingClientRect();\n    const size = Math.min(rect.width, rect.height, 500);\n\n    this.canvas.width = size;\n    this.canvas.height = size;\n\n    this._render();\n  }\n\n  /**\n   * Convert map coordinates to canvas coordinates\n   */\n  _mapToCanvas(mapX, mapY) {\n    if (!this.mapInfo) return { x: 0, y: 0 };\n\n    const { width, height, resolution, origin } = this.mapInfo;\n\n    // World coordinates\n    const worldX = origin.position.x + mapX * resolution;\n    const worldY = origin.position.y + mapY * resolution;\n\n    // Scale to canvas\n    const mapWorldWidth = width * resolution;\n    const mapWorldHeight = height * resolution;\n\n    const scaleX = this.canvas.width / mapWorldWidth;\n    const scaleY = this.canvas.height / mapWorldHeight;\n\n    return {\n      x: (worldX - origin.position.x) * scaleX,\n      y: this.canvas.height - (worldY - origin.position.y) * scaleY\n    };\n  }\n\n  /**\n   * Convert world coordinates to canvas coordinates\n   */\n  _worldToCanvas(worldX, worldY) {\n    if (!this.mapInfo) {\n      // Default to 11x11 world\n      const scale = this.canvas.width / 11;\n      return {\n        x: worldX * scale,\n        y: this.canvas.height - worldY * scale\n      };\n    }\n\n    const { width, height, resolution, origin } = this.mapInfo;\n    const mapWorldWidth = width * resolution;\n    const mapWorldHeight = height * resolution;\n\n    const scaleX = this.canvas.width / mapWorldWidth;\n    const scaleY = this.canvas.height / mapWorldHeight;\n\n    return {\n      x: (worldX - origin.position.x) * scaleX,\n      y: this.canvas.height - (worldY - origin.position.y) * scaleY\n    };\n  }\n\n  /**\n   * Main render function\n   */\n  _render() {\n    const ctx = this.ctx;\n    const width = this.canvas.width;\n    const height = this.canvas.height;\n\n    // Clear with gray (unknown)\n    ctx.fillStyle = '#808080';\n    ctx.fillRect(0, 0, width, height);\n\n    // Draw occupancy grid\n    if (this.mapData && this.mapInfo) {\n      this._renderOccupancyGrid();\n    }\n\n    // Draw robot\n    this._renderRobot();\n  }\n\n  _renderOccupancyGrid() {\n    const ctx = this.ctx;\n    const { width: mapWidth, height: mapHeight, resolution, origin } = this.mapInfo;\n    const data = this.mapData;\n\n    // Calculate cell size on canvas\n    const mapWorldWidth = mapWidth * resolution;\n    const mapWorldHeight = mapHeight * resolution;\n    const cellWidth = this.canvas.width / mapWidth;\n    const cellHeight = this.canvas.height / mapHeight;\n\n    // Create ImageData for efficient rendering\n    const imageData = ctx.createImageData(this.canvas.width, this.canvas.height);\n    const pixels = imageData.data;\n\n    for (let my = 0; my < mapHeight; my++) {\n      for (let mx = 0; mx < mapWidth; mx++) {\n        const idx = my * mapWidth + mx;\n        const value = data[idx];\n\n        // Calculate canvas position (flip Y)\n        const canvasY = mapHeight - 1 - my;\n\n        // Get color based on occupancy value\n        let r, g, b;\n        if (value === -1) {\n          // Unknown - gray\n          r = g = b = 128;\n        } else if (value === 0) {\n          // Free - white\n          r = g = b = 255;\n        } else {\n          // Occupied - black (scale from gray to black based on value)\n          const intensity = Math.max(0, 255 - (value * 2.55));\n          r = g = b = intensity;\n        }\n\n        // Fill cell in image data\n        for (let py = 0; py < Math.ceil(cellHeight); py++) {\n          for (let px = 0; px < Math.ceil(cellWidth); px++) {\n            const pixelX = Math.floor(mx * cellWidth) + px;\n            const pixelY = Math.floor(canvasY * cellHeight) + py;\n\n            if (pixelX < this.canvas.width && pixelY < this.canvas.height) {\n              const pixelIdx = (pixelY * this.canvas.width + pixelX) * 4;\n              pixels[pixelIdx] = r;\n              pixels[pixelIdx + 1] = g;\n              pixels[pixelIdx + 2] = b;\n              pixels[pixelIdx + 3] = 255;\n            }\n          }\n        }\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0);\n  }\n\n  _renderRobot() {\n    const ctx = this.ctx;\n    const pos = this._worldToCanvas(this.robotX, this.robotY);\n    const robotSize = 15;\n\n    ctx.save();\n    ctx.translate(pos.x, pos.y);\n    ctx.rotate(-this.robotTheta);\n\n    // Draw robot as arrow\n    ctx.beginPath();\n    ctx.moveTo(robotSize, 0);\n    ctx.lineTo(-robotSize / 2, -robotSize / 2);\n    ctx.lineTo(-robotSize / 3, 0);\n    ctx.lineTo(-robotSize / 2, robotSize / 2);\n    ctx.closePath();\n\n    ctx.fillStyle = 'rgba(0, 150, 255, 0.8)';\n    ctx.fill();\n    ctx.strokeStyle = '#0066cc';\n    ctx.lineWidth = 2;\n    ctx.stroke();\n\n    ctx.restore();\n  }\n\n  /**\n   * Update map data\n   */\n  updateMap(data, info) {\n    this.mapData = data;\n    this.mapInfo = info;\n    this._render();\n  }\n\n  /**\n   * Update robot pose\n   */\n  updateRobotPose(x, y, theta) {\n    this.robotX = x;\n    this.robotY = y;\n    this.robotTheta = theta;\n    this._render();\n  }\n\n  /**\n   * Clear the map\n   */\n  clear() {\n    this.mapData = null;\n    this.mapInfo = null;\n    this._render();\n  }\n}\n","/**\n * Abstract communication interface for ROS2 pub/sub/service.\n * Implement this interface to create different communication backends\n * (local, WebRTC, WebSocket, etc.)\n */\nexport class CommInterface {\n  /**\n   * Subscribe to a topic\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {Function} callback - Callback function(msg)\n   * @param {string} [nodeId] - Subscriber node ID\n   * @param {Object} [qos] - QoS profile { reliability, durability, history, depth }\n   * @returns {string} Subscription ID\n   */\n  subscribe(topic, msgType, callback, nodeId, qos) {\n    throw new Error('subscribe() must be implemented');\n  }\n\n  /**\n   * Unsubscribe from a topic\n   * @param {string} subscriptionId - Subscription ID returned from subscribe()\n   */\n  unsubscribe(subscriptionId) {\n    throw new Error('unsubscribe() must be implemented');\n  }\n\n  /**\n   * Publish a message to a topic\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {Object} message - Message data\n   */\n  publish(topic, msgType, message) {\n    throw new Error('publish() must be implemented');\n  }\n\n  /**\n   * Advertise a topic for publishing\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {string} nodeId - Publisher node ID\n   * @param {Object} [qos] - QoS profile { reliability, durability, history, depth }\n   * @returns {string} Publisher ID\n   */\n  advertise(topic, msgType, nodeId, qos) {\n    throw new Error('advertise() must be implemented');\n  }\n\n  /**\n   * Unadvertise a topic\n   * @param {string} publisherId - Publisher ID\n   */\n  unadvertise(publisherId) {\n    throw new Error('unadvertise() must be implemented');\n  }\n\n  /**\n   * Register a service server\n   * @param {string} serviceName - Service name\n   * @param {string} srvType - Service type\n   * @param {Function} handler - Handler function(request) => response\n   * @param {string} nodeId - Server node ID\n   * @returns {string} Service ID\n   */\n  advertiseService(serviceName, srvType, handler, nodeId) {\n    throw new Error('advertiseService() must be implemented');\n  }\n\n  /**\n   * Unregister a service server\n   * @param {string} serviceId - Service ID\n   */\n  unadvertiseService(serviceId) {\n    throw new Error('unadvertiseService() must be implemented');\n  }\n\n  /**\n   * Call a service\n   * @param {string} serviceName - Service name\n   * @param {string} srvType - Service type\n   * @param {Object} request - Request data\n   * @returns {Promise<Object>} Response\n   */\n  callService(serviceName, srvType, request) {\n    throw new Error('callService() must be implemented');\n  }\n\n  /**\n   * Register an action server\n   * @param {string} actionName - Action name\n   * @param {string} actionType - Action type\n   * @param {Object} handlers - { executeCallback, goalCallback, cancelCallback }\n   * @param {string} nodeId - Server node ID\n   * @returns {string} Action server ID\n   */\n  advertiseAction(actionName, actionType, handlers, nodeId) {\n    throw new Error('advertiseAction() must be implemented');\n  }\n\n  /**\n   * Unregister an action server\n   * @param {string} actionId - Action server ID\n   */\n  unadvertiseAction(actionId) {\n    throw new Error('unadvertiseAction() must be implemented');\n  }\n\n  /**\n   * Send an action goal\n   * @param {string} actionName - Action name\n   * @param {string} actionType - Action type\n   * @param {Object} goal - Goal data\n   * @param {Function} feedbackCallback - Optional feedback callback\n   * @returns {Promise<Object>} Result\n   */\n  sendActionGoal(actionName, actionType, goal, feedbackCallback) {\n    throw new Error('sendActionGoal() must be implemented');\n  }\n\n  /**\n   * Get list of all topics\n   * @returns {Array<{name: string, type: string, publishers: Array, subscribers: Array}>}\n   */\n  getTopics() {\n    throw new Error('getTopics() must be implemented');\n  }\n\n  /**\n   * Get list of all services\n   * @returns {Array<{name: string, type: string, node: string}>}\n   */\n  getServices() {\n    throw new Error('getServices() must be implemented');\n  }\n\n  /**\n   * Get list of all actions\n   * @returns {Array<{name: string, type: string, node: string}>}\n   */\n  getActions() {\n    throw new Error('getActions() must be implemented');\n  }\n\n  /**\n   * Cleanup and destroy the communication layer\n   */\n  destroy() {\n    throw new Error('destroy() must be implemented');\n  }\n}\n","/**\n * QoS (Quality of Service) profile utilities for the ROS 2 emulator.\n *\n * Provides default profiles, named presets, normalization, CLI flag parsing,\n * and formatting for verbose topic info output.\n */\n\n//  Default profile \nexport const DEFAULT_QOS = Object.freeze({\n  reliability: 'reliable',\n  durability: 'volatile',\n  history: 'keep_last',\n  depth: 10,\n});\n\n//  Named presets (match rclpy / rclcpp) \nexport const QOS_PRESETS = Object.freeze({\n  default: { ...DEFAULT_QOS },\n  system_default: { ...DEFAULT_QOS },\n  sensor_data: {\n    reliability: 'best_effort',\n    durability: 'volatile',\n    history: 'keep_last',\n    depth: 5,\n  },\n  services_default: {\n    reliability: 'reliable',\n    durability: 'volatile',\n    history: 'keep_last',\n    depth: 10,\n  },\n  parameters: {\n    reliability: 'reliable',\n    durability: 'volatile',\n    history: 'keep_last',\n    depth: 1000,\n  },\n  parameter_events: {\n    reliability: 'reliable',\n    durability: 'volatile',\n    history: 'keep_last',\n    depth: 1000,\n  },\n});\n\n//  Valid policy values \nconst VALID_RELIABILITY = ['reliable', 'best_effort'];\nconst VALID_DURABILITY = ['volatile', 'transient_local'];\nconst VALID_HISTORY = ['keep_last', 'keep_all'];\n\n//  Helpers \n\n/**\n * Fill in any missing fields with defaults.\n * @param {Object|undefined} qos - Partial or undefined QoS object\n * @returns {Object} Complete QoS profile\n */\nexport function normalizeQoS(qos) {\n  if (!qos) return { ...DEFAULT_QOS };\n  return {\n    reliability: qos.reliability || DEFAULT_QOS.reliability,\n    durability: qos.durability || DEFAULT_QOS.durability,\n    history: qos.history || DEFAULT_QOS.history,\n    depth: qos.depth != null ? qos.depth : DEFAULT_QOS.depth,\n  };\n}\n\n/**\n * Format a QoS profile for CLI verbose output (matches real ros2 CLI).\n * Returns an array of pre-indented lines.\n * @param {Object} qos - QoS profile object\n * @param {string} indent - Leading whitespace (default 4 spaces)\n * @returns {string[]}\n */\nexport function formatQoS(qos, indent = '    ') {\n  const q = normalizeQoS(qos);\n  const historyStr = q.history === 'keep_last'\n    ? `KEEP_LAST (${q.depth})`\n    : 'KEEP_ALL';\n  return [\n    `${indent}Reliability: ${q.reliability.toUpperCase()}`,\n    `${indent}Durability: ${q.durability.toUpperCase()}`,\n    `${indent}History (Depth): ${historyStr}`,\n  ];\n}\n\n/**\n * Parse QoS-related flags from a CLI args array.\n * Supports both --qos-profile <preset> and individual flags.\n * Returns { qos, remaining } where remaining has QoS flags stripped.\n * @param {string[]} args\n * @returns {{ qos: Object|null, remaining: string[] }}\n */\nexport function parseQoSArgs(args) {\n  const remaining = [];\n  let profile = null;\n  let reliability = null;\n  let durability = null;\n  let history = null;\n  let depth = null;\n\n  const qosFlags = ['--qos-profile', '--qos-reliability', '--qos-durability', '--qos-history', '--qos-depth'];\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n    // Check for missing value on any QoS flag\n    if (qosFlags.includes(arg) && i + 1 >= args.length) {\n      return { qos: null, remaining, error: `${arg} requires a value` };\n    }\n    if (arg === '--qos-profile') {\n      profile = args[++i];\n    } else if (arg === '--qos-reliability') {\n      reliability = args[++i];\n    } else if (arg === '--qos-durability') {\n      durability = args[++i];\n    } else if (arg === '--qos-history') {\n      history = args[++i];\n    } else if (arg === '--qos-depth') {\n      const depthStr = args[++i];\n      depth = parseInt(depthStr, 10);\n      if (isNaN(depth) || depth <= 0) {\n        return {\n          qos: null,\n          remaining,\n          error: `Invalid depth '${depthStr}'. Must be a positive integer.`,\n        };\n      }\n    } else {\n      remaining.push(arg);\n    }\n  }\n\n  // No QoS flags at all\n  if (!profile && !reliability && !durability && !history && depth == null) {\n    return { qos: null, remaining };\n  }\n\n  // Start from preset or defaults\n  let base;\n  if (profile) {\n    base = QOS_PRESETS[profile];\n    if (!base) {\n      return {\n        qos: null,\n        remaining,\n        error: `Unknown QoS profile '${profile}'. Available: ${Object.keys(QOS_PRESETS).join(', ')}`,\n      };\n    }\n    base = { ...base };\n  } else {\n    base = { ...DEFAULT_QOS };\n  }\n\n  // Override with individual flags\n  if (reliability != null) {\n    if (!VALID_RELIABILITY.includes(reliability)) {\n      return {\n        qos: null,\n        remaining,\n        error: `Invalid reliability '${reliability}'. Must be: ${VALID_RELIABILITY.join(' or ')}`,\n      };\n    }\n    base.reliability = reliability;\n  }\n  if (durability != null) {\n    if (!VALID_DURABILITY.includes(durability)) {\n      return {\n        qos: null,\n        remaining,\n        error: `Invalid durability '${durability}'. Must be: ${VALID_DURABILITY.join(' or ')}`,\n      };\n    }\n    base.durability = durability;\n  }\n  if (history != null) {\n    if (!VALID_HISTORY.includes(history)) {\n      return {\n        qos: null,\n        remaining,\n        error: `Invalid history '${history}'. Must be: ${VALID_HISTORY.join(' or ')}`,\n      };\n    }\n    base.history = history;\n  }\n  if (depth != null) {\n    base.depth = depth;\n  }\n\n  return { qos: base, remaining };\n}\n","import { CommInterface } from './CommInterface.js';\nimport { normalizeQoS } from '../utils/qos.js';\n\n/**\n * Local in-browser communication implementation.\n * All pub/sub happens within the same browser context.\n */\nexport class LocalComm extends CommInterface {\n  constructor() {\n    super();\n    this.topics = new Map(); // topic -> { type, publishers: Map, subscribers: Map }\n    this.services = new Map(); // serviceName -> { type, handler, nodeId }\n    this.actions = new Map(); // actionName -> { type, handlers, nodeId, activeGoals: Map }\n    this.nextId = 1;\n  }\n\n  _generateId() {\n    return `id_${this.nextId++}`;\n  }\n\n  _ensureTopic(topic, msgType) {\n    if (!this.topics.has(topic)) {\n      this.topics.set(topic, {\n        type: msgType,\n        publishers: new Map(),\n        subscribers: new Map()\n      });\n    } else {\n      const existing = this.topics.get(topic);\n      if (existing.type !== msgType && msgType !== 'unknown' && existing.type !== 'unknown') {\n        console.warn(\n          `[WARN] Topic '${topic}' already exists with type '${existing.type}', ` +\n          `but was requested with type '${msgType}'. In ROS2, all publishers and ` +\n          `subscribers on a topic must use the same type.`\n        );\n      }\n    }\n    return this.topics.get(topic);\n  }\n\n  subscribe(topic, msgType, callback, nodeId = null, qos) {\n    const topicData = this._ensureTopic(topic, msgType);\n    const subId = this._generateId();\n    topicData.subscribers.set(subId, { callback, msgType, nodeId, qos: normalizeQoS(qos) });\n    return subId;\n  }\n\n  unsubscribe(subscriptionId) {\n    for (const [, topicData] of this.topics) {\n      if (topicData.subscribers.has(subscriptionId)) {\n        topicData.subscribers.delete(subscriptionId);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  publish(topic, msgType, message) {\n    const topicData = this.topics.get(topic);\n    if (!topicData) return;\n\n    // Add timestamp if not present\n    const msgWithTimestamp = {\n      ...message,\n      _timestamp: message._timestamp || Date.now()\n    };\n\n    // Deliver to all subscribers\n    for (const [, sub] of topicData.subscribers) {\n      try {\n        sub.callback(msgWithTimestamp);\n      } catch (err) {\n        console.error(`Error in subscriber callback for ${topic}:`, err);\n      }\n    }\n  }\n\n  advertise(topic, msgType, nodeId, qos) {\n    const topicData = this._ensureTopic(topic, msgType);\n    const pubId = this._generateId();\n    topicData.publishers.set(pubId, { nodeId, msgType, qos: normalizeQoS(qos) });\n    return pubId;\n  }\n\n  unadvertise(publisherId) {\n    for (const [, topicData] of this.topics) {\n      if (topicData.publishers.has(publisherId)) {\n        topicData.publishers.delete(publisherId);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  advertiseService(serviceName, srvType, handler, nodeId) {\n    const serviceId = this._generateId();\n    this.services.set(serviceName, {\n      id: serviceId,\n      type: srvType,\n      handler,\n      nodeId\n    });\n    return serviceId;\n  }\n\n  unadvertiseService(serviceId) {\n    for (const [name, service] of this.services) {\n      if (service.id === serviceId) {\n        this.services.delete(name);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  async callService(serviceName, srvType, request) {\n    const service = this.services.get(serviceName);\n    if (!service) {\n      throw new Error(`Service '${serviceName}' not available`);\n    }\n    if (service.type !== srvType) {\n      throw new Error(`Service type mismatch: expected ${service.type}, got ${srvType}`);\n    }\n    try {\n      const response = await service.handler(request);\n      return response;\n    } catch (err) {\n      throw new Error(`Service call failed: ${err.message}`);\n    }\n  }\n\n  advertiseAction(actionName, actionType, handlers, nodeId) {\n    const actionId = this._generateId();\n    this.actions.set(actionName, {\n      id: actionId,\n      type: actionType,\n      handlers,\n      nodeId,\n      activeGoals: new Map()\n    });\n    return actionId;\n  }\n\n  unadvertiseAction(actionId) {\n    for (const [name, action] of this.actions) {\n      if (action.id === actionId) {\n        // Cancel all active goals\n        for (const [goalId, goal] of action.activeGoals) {\n          if (goal.cancelCallback) {\n            goal.cancelCallback();\n          }\n        }\n        this.actions.delete(name);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  async sendActionGoal(actionName, actionType, goal, feedbackCallback) {\n    const action = this.actions.get(actionName);\n    if (!action) {\n      throw new Error(`Action '${actionName}' not available`);\n    }\n    if (action.type !== actionType) {\n      throw new Error(`Action type mismatch: expected ${action.type}, got ${actionType}`);\n    }\n\n    const goalId = this._generateId();\n\n    // Check if goal is accepted\n    if (action.handlers.goalCallback) {\n      const accepted = await action.handlers.goalCallback(goal);\n      if (!accepted) {\n        throw new Error('Goal rejected');\n      }\n    }\n\n    // Store goal info\n    const goalInfo = {\n      id: goalId,\n      goal,\n      feedbackCallback,\n      canceled: false\n    };\n    action.activeGoals.set(goalId, goalInfo);\n\n    // Execute the goal\n    try {\n      const result = await action.handlers.executeCallback(\n        goal,\n        goalId,\n        (feedback) => {\n          if (feedbackCallback && !goalInfo.canceled) {\n            feedbackCallback(feedback);\n          }\n        },\n        () => goalInfo.canceled\n      );\n      action.activeGoals.delete(goalId);\n      return result;\n    } catch (err) {\n      action.activeGoals.delete(goalId);\n      throw err;\n    }\n  }\n\n  cancelActionGoal(actionName, goalId) {\n    const action = this.actions.get(actionName);\n    if (!action) return false;\n\n    const goalInfo = action.activeGoals.get(goalId);\n    if (!goalInfo) return false;\n\n    goalInfo.canceled = true;\n    if (action.handlers.cancelCallback) {\n      action.handlers.cancelCallback(goalId);\n    }\n    return true;\n  }\n\n  getTopics() {\n    const result = [];\n    for (const [name, data] of this.topics) {\n      result.push({\n        name,\n        type: data.type,\n        publishers: Array.from(data.publishers.values()),\n        subscribers: Array.from(data.subscribers.values())\n      });\n    }\n    return result;\n  }\n\n  getServices() {\n    const result = [];\n    for (const [name, data] of this.services) {\n      result.push({\n        name,\n        type: data.type,\n        node: data.nodeId\n      });\n    }\n    return result;\n  }\n\n  getActions() {\n    const result = [];\n    for (const [name, data] of this.actions) {\n      result.push({\n        name,\n        type: data.type,\n        node: data.nodeId\n      });\n    }\n    return result;\n  }\n\n  destroy() {\n    // Cancel all active action goals\n    for (const [, action] of this.actions) {\n      for (const [goalId, goal] of action.activeGoals) {\n        goal.canceled = true;\n      }\n    }\n\n    this.topics.clear();\n    this.services.clear();\n    this.actions.clear();\n  }\n}\n","import { LocalComm } from '../comm/LocalComm.js';\nimport { ServiceContainer } from './ServiceContainer.js';\n\n/**\n * SimDDS - Simulated DDS middleware singleton\n * Provides ROS2-like pub/sub, services, and actions\n */\nexport class SimDDSClass {\n  constructor() {\n    this.comm = new LocalComm();\n    this.nodes = new Map(); // nodeId -> node info\n  }\n\n  /**\n   * Set a different communication provider\n   * @param {CommInterface} commProvider - New communication provider\n   */\n  setCommProvider(commProvider) {\n    // Cleanup old provider\n    if (this.comm) {\n      this.comm.destroy();\n    }\n    this.comm = commProvider;\n  }\n\n  /**\n   * Register a node with the DDS\n   * @param {string} nodeId - Node name/ID\n   * @param {Object} nodeInfo - Additional node information\n   */\n  registerNode(nodeId, nodeInfo = {}) {\n    this.nodes.set(nodeId, {\n      ...nodeInfo,\n      publishers: [],\n      subscribers: [],\n      services: [],\n      actions: [],\n      parameters: new Map()\n    });\n  }\n\n  /**\n   * Unregister a node from the DDS\n   * @param {string} nodeId - Node name/ID\n   */\n  unregisterNode(nodeId) {\n    const nodeData = this.nodes.get(nodeId);\n    if (nodeData) {\n      // Cleanup all publishers\n      for (const pubId of nodeData.publishers) {\n        this.comm.unadvertise(pubId);\n      }\n      // Cleanup all subscribers\n      for (const subId of nodeData.subscribers) {\n        this.comm.unsubscribe(subId);\n      }\n      // Cleanup all services\n      for (const srvId of nodeData.services) {\n        this.comm.unadvertiseService(srvId);\n      }\n      // Cleanup all actions\n      for (const actionId of nodeData.actions) {\n        this.comm.unadvertiseAction(actionId);\n      }\n      this.nodes.delete(nodeId);\n    }\n  }\n\n  /**\n   * Create a publisher\n   * @param {string} nodeId - Node name\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {Object} [qos] - QoS profile { reliability, durability, history, depth }\n   * @returns {Object} Publisher object with publish() method\n   */\n  createPublisher(nodeId, topic, msgType, qos) {\n    const pubId = this.comm.advertise(topic, msgType, nodeId, qos);\n    const nodeData = this.nodes.get(nodeId);\n    if (nodeData) {\n      nodeData.publishers.push(pubId);\n    }\n\n    return {\n      id: pubId,\n      topic,\n      msgType,\n      publish: (message) => {\n        this.comm.publish(topic, msgType, message);\n      },\n      destroy: () => {\n        this.comm.unadvertise(pubId);\n        if (nodeData) {\n          const idx = nodeData.publishers.indexOf(pubId);\n          if (idx >= 0) nodeData.publishers.splice(idx, 1);\n        }\n      }\n    };\n  }\n\n  /**\n   * Create a subscription\n   * @param {string} nodeId - Node name\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {Function} callback - Message callback\n   * @param {Object} [qos] - QoS profile { reliability, durability, history, depth }\n   * @returns {Object} Subscription object\n   */\n  createSubscription(nodeId, topic, msgType, callback, qos) {\n    const subId = this.comm.subscribe(topic, msgType, callback, nodeId, qos);\n    const nodeData = this.nodes.get(nodeId);\n    if (nodeData) {\n      nodeData.subscribers.push(subId);\n    }\n\n    return {\n      id: subId,\n      topic,\n      msgType,\n      destroy: () => {\n        this.comm.unsubscribe(subId);\n        if (nodeData) {\n          const idx = nodeData.subscribers.indexOf(subId);\n          if (idx >= 0) nodeData.subscribers.splice(idx, 1);\n        }\n      }\n    };\n  }\n\n  /**\n   * Create a service server\n   * @param {string} nodeId - Node name\n   * @param {string} serviceName - Service name\n   * @param {string} srvType - Service type\n   * @param {Function} handler - Request handler\n   * @returns {Object} Service object\n   */\n  createService(nodeId, serviceName, srvType, handler) {\n    const srvId = this.comm.advertiseService(serviceName, srvType, handler, nodeId);\n    const nodeData = this.nodes.get(nodeId);\n    if (nodeData) {\n      nodeData.services.push(srvId);\n    }\n\n    return {\n      id: srvId,\n      name: serviceName,\n      type: srvType,\n      destroy: () => {\n        this.comm.unadvertiseService(srvId);\n        if (nodeData) {\n          const idx = nodeData.services.indexOf(srvId);\n          if (idx >= 0) nodeData.services.splice(idx, 1);\n        }\n      }\n    };\n  }\n\n  /**\n   * Call a service\n   * @param {string} serviceName - Service name\n   * @param {string} srvType - Service type\n   * @param {Object} request - Request data\n   * @returns {Promise<Object>} Response\n   */\n  async callService(serviceName, srvType, request) {\n    return this.comm.callService(serviceName, srvType, request);\n  }\n\n  /**\n   * Create an action server\n   * @param {string} nodeId - Node name\n   * @param {string} actionName - Action name\n   * @param {string} actionType - Action type\n   * @param {Object} handlers - Action handlers\n   * @returns {Object} Action server object\n   */\n  createActionServer(nodeId, actionName, actionType, handlers) {\n    const actionId = this.comm.advertiseAction(actionName, actionType, handlers, nodeId);\n    const nodeData = this.nodes.get(nodeId);\n    if (nodeData) {\n      nodeData.actions.push(actionId);\n    }\n\n    return {\n      id: actionId,\n      name: actionName,\n      type: actionType,\n      destroy: () => {\n        this.comm.unadvertiseAction(actionId);\n        if (nodeData) {\n          const idx = nodeData.actions.indexOf(actionId);\n          if (idx >= 0) nodeData.actions.splice(idx, 1);\n        }\n      }\n    };\n  }\n\n  /**\n   * Send an action goal\n   * @param {string} actionName - Action name\n   * @param {string} actionType - Action type\n   * @param {Object} goal - Goal data\n   * @param {Function} feedbackCallback - Feedback callback\n   * @returns {Promise<Object>} Result\n   */\n  async sendActionGoal(actionName, actionType, goal, feedbackCallback) {\n    return this.comm.sendActionGoal(actionName, actionType, goal, feedbackCallback);\n  }\n\n  /**\n   * Publish a message (convenience method)\n   */\n  publish(topic, msgType, message) {\n    this.comm.publish(topic, msgType, message);\n  }\n\n  /**\n   * Subscribe to a topic (convenience method for CLI)\n   */\n  subscribe(topic, msgType, callback, qos) {\n    return this.comm.subscribe(topic, msgType, callback, null, qos);\n  }\n\n  /**\n   * Unsubscribe (convenience method)\n   */\n  unsubscribe(subId) {\n    return this.comm.unsubscribe(subId);\n  }\n\n  /**\n   * Get all registered nodes\n   */\n  getNodes() {\n    return Array.from(this.nodes.keys());\n  }\n\n  /**\n   * Get node information\n   */\n  getNodeInfo(nodeId) {\n    return this.nodes.get(nodeId);\n  }\n\n  /**\n   * Get all topics\n   */\n  getTopics() {\n    return this.comm.getTopics();\n  }\n\n  /**\n   * Get topic info\n   */\n  getTopicInfo(topicName) {\n    const topics = this.comm.getTopics();\n    return topics.find(t => t.name === topicName);\n  }\n\n  /**\n   * Get all services\n   */\n  getServices() {\n    return this.comm.getServices();\n  }\n\n  /**\n   * Get service info\n   */\n  getServiceInfo(serviceName) {\n    const services = this.comm.getServices();\n    return services.find(s => s.name === serviceName);\n  }\n\n  /**\n   * Get all actions\n   */\n  getActions() {\n    return this.comm.getActions();\n  }\n\n  /**\n   * Get action info\n   */\n  getActionInfo(actionName) {\n    const actions = this.comm.getActions();\n    return actions.find(a => a.name === actionName);\n  }\n\n  /**\n   * Reset the DDS (clear all nodes, topics, services)\n   */\n  reset() {\n    for (const nodeId of this.nodes.keys()) {\n      this.unregisterNode(nodeId);\n    }\n    this.comm.destroy();\n    this.comm = new LocalComm();\n  }\n}\n\n// Singleton instance\nexport const SimDDS = new SimDDSClass();\n\n// Register with ServiceContainer for dependency injection\nServiceContainer.register('simDDS', SimDDS);\n","import cytoscape from 'cytoscape';\nimport { SimDDS } from '../core/SimDDS.js';\nimport { Events } from '../core/Events.js';\n\n/**\n * Graph - rqt_graph visualization using Cytoscape.js\n *\n * Accepts either a container element or an element ID for backward compatibility.\n */\nexport class Graph {\n  constructor(containerOrId = 'graph-container') {\n    // Support both element and ID for backward compatibility\n    if (typeof containerOrId === 'string') {\n      this.container = document.getElementById(containerOrId);\n    } else {\n      this.container = containerOrId;\n    }\n    this.cy = null;\n    this.updateInterval = null;\n\n    this._initCytoscape();\n  }\n\n  _initCytoscape() {\n    // Defer cytoscape initialization - it fails on hidden containers\n    this.cy = null;\n    this.initialized = false;\n    this.lastGraphSignature = '';\n  }\n\n  _ensureInitialized() {\n    if (this.initialized) return;\n\n    this.cy = cytoscape({\n      container: this.container,\n      elements: [],\n      style: [\n        {\n          selector: 'node[type=\"node\"]',\n          style: {\n            'background-color': '#4a90d9',\n            'label': 'data(label)',\n            'text-valign': 'center',\n            'text-halign': 'center',\n            'color': '#fff',\n            'font-size': '12px',\n            'width': '80px',\n            'height': '40px',\n            'shape': 'round-rectangle',\n            'text-wrap': 'wrap',\n            'text-max-width': '70px'\n          }\n        },\n        {\n          selector: 'node[type=\"topic\"]',\n          style: {\n            'background-color': '#6c757d',\n            'label': 'data(label)',\n            'text-valign': 'center',\n            'text-halign': 'center',\n            'color': '#fff',\n            'font-size': '10px',\n            'width': '100px',\n            'height': '30px',\n            'shape': 'rectangle',\n            'text-wrap': 'wrap',\n            'text-max-width': '90px'\n          }\n        },\n        {\n          selector: 'edge',\n          style: {\n            'width': 2,\n            'line-color': '#aaa',\n            'target-arrow-color': '#aaa',\n            'target-arrow-shape': 'triangle',\n            'curve-style': 'bezier'\n          }\n        },\n        {\n          selector: 'edge[type=\"publish\"]',\n          style: {\n            'line-color': '#28a745',\n            'target-arrow-color': '#28a745'\n          }\n        },\n        {\n          selector: 'edge[type=\"subscribe\"]',\n          style: {\n            'line-color': '#dc3545',\n            'target-arrow-color': '#dc3545'\n          }\n        }\n      ],\n      layout: {\n        name: 'preset'\n      }\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Update the graph with current ROS2 state\n   */\n  update() {\n    if (!this.initialized || !this.cy) return;\n\n    const nodes = SimDDS.getNodes();\n    const topics = SimDDS.getTopics();\n\n    // Build graph elements\n    const elements = [];\n    const nodeSet = new Set();\n    const topicSet = new Set();\n    const elementIds = [];\n\n    // Add node nodes\n    for (const nodeName of nodes) {\n      const id = `node_${nodeName}`;\n      nodeSet.add(id);\n      elementIds.push(id);\n      elements.push({\n        data: {\n          id,\n          label: nodeName.replace(/^\\//, ''),\n          type: 'node'\n        }\n      });\n    }\n\n    // Add topic nodes and edges\n    for (const topic of topics) {\n      const topicId = `topic_${topic.name}`;\n\n      // Only add topic if it has publishers or subscribers\n      if (topic.publishers.length === 0 && topic.subscribers.length === 0) {\n        continue;\n      }\n\n      if (!topicSet.has(topicId)) {\n        topicSet.add(topicId);\n        elementIds.push(topicId);\n        elements.push({\n          data: {\n            id: topicId,\n            label: topic.name,\n            type: 'topic'\n          }\n        });\n      }\n\n      // Add edges from publishers to topic\n      for (const pub of topic.publishers) {\n        const nodeId = `node_${pub.nodeId}`;\n        if (nodeSet.has(nodeId)) {\n          const edgeId = `${nodeId}_to_${topicId}`;\n          elementIds.push(edgeId);\n          elements.push({\n            data: {\n              id: edgeId,\n              source: nodeId,\n              target: topicId,\n              type: 'publish'\n            }\n          });\n        }\n      }\n\n      // Add edges from topic to subscribers\n      for (const sub of topic.subscribers) {\n        const nodeId = `node_${sub.nodeId}`;\n        if (nodeSet.has(nodeId)) {\n          const edgeId = `${topicId}_to_${nodeId}`;\n          elementIds.push(edgeId);\n          elements.push({\n            data: {\n              id: edgeId,\n              source: topicId,\n              target: nodeId,\n              type: 'subscribe'\n            }\n          });\n        }\n      }\n    }\n\n    // Create a signature of current graph structure\n    const signature = elementIds.sort().join(',');\n\n    // Only rebuild if structure changed\n    if (signature === this.lastGraphSignature) {\n      return;\n    }\n    this.lastGraphSignature = signature;\n\n    // Ensure container is sized properly\n    this.cy.resize();\n\n    // Clear and rebuild graph\n    this.cy.elements().remove();\n    this.cy.add(elements);\n\n    // Apply layout only if there are elements\n    if (elements.length > 0) {\n      this.cy.layout({\n        name: 'cose',\n        animate: false,\n        nodeDimensionsIncludeLabels: true,\n        nodeRepulsion: 4000,\n        idealEdgeLength: 80,\n        padding: 50\n      }).run();\n\n      // Fit to view with padding\n      this.cy.fit(undefined, 50);\n      this.cy.center();\n    }\n  }\n\n  /**\n   * Start auto-updating\n   */\n  startAutoUpdate(intervalMs = 1000) {\n    this.stopAutoUpdate();\n    this.update();\n    this.updateInterval = setInterval(() => this.update(), intervalMs);\n  }\n\n  /**\n   * Stop auto-updating\n   */\n  stopAutoUpdate() {\n    if (this.updateInterval) {\n      clearInterval(this.updateInterval);\n      this.updateInterval = null;\n    }\n  }\n\n  /**\n   * Show the graph\n   */\n  show() {\n    // Hide canvas to give graph full space\n    const canvasContainer = document.getElementById('canvas-container');\n    canvasContainer?.classList.add('hidden');\n\n    this.container.classList.remove('hidden');\n\n    // Initialize cytoscape now that container is visible\n    setTimeout(() => {\n      this._ensureInitialized();\n      if (this.cy) {\n        this.cy.resize();\n      }\n      this.startAutoUpdate();\n      // Additional resize and center after layout settles\n      setTimeout(() => {\n        if (this.cy) {\n          this.cy.resize();\n          this.cy.fit(undefined, 50);\n          this.cy.center();\n        }\n      }, 200);\n    }, 100);\n  }\n\n  /**\n   * Hide the graph\n   */\n  hide() {\n    this.container.classList.add('hidden');\n    this.stopAutoUpdate();\n\n    // Show canvas again\n    const canvasContainer = document.getElementById('canvas-container');\n    canvasContainer?.classList.remove('hidden');\n\n    // Trigger resize so canvas recalculates its size\n    window.dispatchEvent(new Event(Events.LAYOUT_RESIZE));\n  }\n\n  /**\n   * Toggle visibility\n   */\n  toggle() {\n    if (this.container.classList.contains('hidden')) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n\n  /**\n   * Destroy the graph\n   */\n  destroy() {\n    this.stopAutoUpdate();\n    if (this.cy) {\n      this.cy.destroy();\n      this.cy = null;\n    }\n    this.initialized = false;\n  }\n}\n","import { LogManager } from '../core/LogManager.js';\n\n/**\n * RqtConsole - Log viewer with filtering capabilities\n *\n * Accepts optional elements object for dependency injection/testing.\n * Falls back to document.getElementById for backward compatibility.\n */\nexport class RqtConsole {\n  constructor(elements = {}) {\n    // Support both explicit elements and ID-based lookup for backward compatibility\n    this.panel = elements.panel || document.getElementById('console-panel');\n    this.messagesContainer = elements.messages || document.getElementById('console-messages');\n    this.filterLevel = elements.filterLevel || document.getElementById('console-filter-level');\n    this.filterNode = elements.filterNode || document.getElementById('console-filter-node');\n    this.clearButton = elements.clearButton || document.getElementById('console-clear');\n    this.pauseButton = elements.pauseButton || document.getElementById('console-pause');\n    this.closeButton = elements.closeButton || document.getElementById('console-close');\n\n    this.paused = false;\n    this.pendingLogs = [];\n    this.maxDisplayedLogs = 500;\n    this.unsubscribe = null;\n\n    this._setupEventListeners();\n  }\n\n  _setupEventListeners() {\n    // Filter level change\n    this.filterLevel?.addEventListener('change', () => {\n      this._refreshLogs();\n    });\n\n    // Filter node change\n    this.filterNode?.addEventListener('input', () => {\n      this._refreshLogs();\n    });\n\n    // Clear button\n    this.clearButton?.addEventListener('click', () => {\n      this._clearLogs();\n    });\n\n    // Pause button\n    this.pauseButton?.addEventListener('click', () => {\n      this._togglePause();\n    });\n\n    // Close button\n    this.closeButton?.addEventListener('click', () => {\n      this.hide();\n    });\n\n    // Subscribe to log events\n    this.unsubscribe = LogManager.addListener((entry) => {\n      this._handleLogEntry(entry);\n    });\n  }\n\n  _handleLogEntry(entry) {\n    if (this.paused) {\n      this.pendingLogs.push(entry);\n      return;\n    }\n\n    this._addLogEntry(entry);\n  }\n\n  _addLogEntry(entry) {\n    if (!this.messagesContainer) return;\n\n    // Check filters\n    const minLevel = LogManager.parseLevel(this.filterLevel?.value || 'INFO');\n    if (entry.levelValue < minLevel) return;\n\n    const nodeFilter = this.filterNode?.value?.toLowerCase();\n    if (nodeFilter && !entry.node.toLowerCase().includes(nodeFilter)) return;\n\n    // Create log element\n    const logEl = document.createElement('div');\n    logEl.className = `log-entry log-${entry.level.toLowerCase()}`;\n    logEl.textContent = LogManager.formatEntry(entry);\n\n    // Add to container\n    this.messagesContainer.appendChild(logEl);\n\n    // Limit displayed logs\n    while (this.messagesContainer.children.length > this.maxDisplayedLogs) {\n      this.messagesContainer.removeChild(this.messagesContainer.firstChild);\n    }\n\n    // Auto-scroll to bottom\n    this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;\n  }\n\n  _refreshLogs() {\n    if (!this.messagesContainer) return;\n\n    // Clear current display\n    this.messagesContainer.innerHTML = '';\n\n    // Get filtered logs\n    const filter = {\n      level: this.filterLevel?.value,\n      node: this.filterNode?.value\n    };\n\n    const logs = LogManager.getLogs(filter);\n\n    // Display last N logs\n    const startIdx = Math.max(0, logs.length - this.maxDisplayedLogs);\n    for (let i = startIdx; i < logs.length; i++) {\n      this._addLogEntry(logs[i]);\n    }\n  }\n\n  _clearLogs() {\n    if (this.messagesContainer) {\n      this.messagesContainer.innerHTML = '';\n    }\n    LogManager.clear();\n    this.pendingLogs = [];\n  }\n\n  _togglePause() {\n    this.paused = !this.paused;\n\n    if (this.pauseButton) {\n      this.pauseButton.textContent = this.paused ? 'Resume' : 'Pause';\n    }\n\n    if (!this.paused) {\n      // Flush pending logs\n      for (const entry of this.pendingLogs) {\n        this._addLogEntry(entry);\n      }\n      this.pendingLogs = [];\n    }\n  }\n\n  /**\n   * Show the console\n   */\n  show() {\n    this.panel?.classList.remove('hidden');\n    this._refreshLogs();\n  }\n\n  /**\n   * Hide the console\n   */\n  hide() {\n    this.panel?.classList.add('hidden');\n  }\n\n  /**\n   * Toggle visibility\n   */\n  toggle() {\n    if (this.panel?.classList.contains('hidden')) {\n      this.show();\n    } else {\n      this.hide();\n    }\n  }\n\n  /**\n   * Destroy the console\n   */\n  destroy() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n    }\n  }\n}\n","import { Events } from '../core/Events.js';\n\n/**\n * Layout - Manages responsive layout for terminal/canvas/graph panels\n *\n * Accepts optional elements object for dependency injection/testing.\n * Falls back to document.getElementById for backward compatibility.\n */\nexport class Layout {\n  constructor(elements = {}) {\n    // Support both explicit elements and ID-based lookup for backward compatibility\n    this.visualizationPanel = elements.visualizationPanel || document.getElementById('visualization-panel');\n    this.terminalPanel = elements.terminalPanel || document.getElementById('terminal-panel');\n    this.canvasContainer = elements.canvasContainer || document.getElementById('canvas-container');\n    this.mapContainer = elements.mapContainer || document.getElementById('map-container');\n    this.graphContainer = elements.graphContainer || document.getElementById('graph-container');\n    this.consolePanel = elements.consolePanel || document.getElementById('console-panel');\n\n    this.resizing = false;\n    this.currentLayout = 'desktop';\n\n    this._detectLayout();\n    this._setupResizeObserver();\n    this._setupMobileSwipe();\n  }\n\n  _detectLayout() {\n    const width = window.innerWidth;\n\n    if (width < 768) {\n      this.currentLayout = 'mobile';\n      document.body.classList.add('mobile-layout');\n      document.body.classList.remove('tablet-layout', 'desktop-layout');\n    } else if (width < 1024) {\n      this.currentLayout = 'tablet';\n      document.body.classList.add('tablet-layout');\n      document.body.classList.remove('mobile-layout', 'desktop-layout');\n    } else {\n      this.currentLayout = 'desktop';\n      document.body.classList.add('desktop-layout');\n      document.body.classList.remove('mobile-layout', 'tablet-layout');\n    }\n  }\n\n  _setupResizeObserver() {\n    window.addEventListener('resize', () => {\n      this._detectLayout();\n      this._triggerResize();\n    });\n  }\n\n  _setupMobileSwipe() {\n    if (!this.terminalPanel) return;\n\n    let startX = 0;\n    let startY = 0;\n\n    this.terminalPanel.addEventListener('touchstart', (e) => {\n      startX = e.touches[0].clientX;\n      startY = e.touches[0].clientY;\n    }, { passive: true });\n\n    this.terminalPanel.addEventListener('touchend', (e) => {\n      const endX = e.changedTouches[0].clientX;\n      const endY = e.changedTouches[0].clientY;\n      const diffX = endX - startX;\n      const diffY = endY - startY;\n\n      // Only handle horizontal swipes\n      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {\n        // Emit swipe event for mobile terminal switching\n        const event = new CustomEvent('terminal-swipe', {\n          detail: { direction: diffX > 0 ? 'right' : 'left' }\n        });\n        this.terminalPanel.dispatchEvent(event);\n      }\n    }, { passive: true });\n  }\n\n  _triggerResize() {\n    // Dispatch resize event for components to handle\n    window.dispatchEvent(new Event(Events.LAYOUT_RESIZE));\n  }\n\n  /**\n   * Show the canvas panel\n   */\n  showCanvas() {\n    this.canvasContainer?.classList.remove('hidden');\n  }\n\n  /**\n   * Hide the canvas panel\n   */\n  hideCanvas() {\n    this.canvasContainer?.classList.add('hidden');\n  }\n\n  /**\n   * Toggle the map overlay (dispatches event for Canvas to handle)\n   */\n  toggleMap() {\n    // Dispatch event for Canvas to toggle its map overlay\n    window.dispatchEvent(new CustomEvent(Events.TOGGLE_MAP_OVERLAY));\n    this._triggerResize();\n  }\n\n  /**\n   * Show the map panel\n   */\n  showMap() {\n    this.mapContainer?.classList.remove('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Hide the map panel\n   */\n  hideMap() {\n    this.mapContainer?.classList.add('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Toggle the graph panel\n   */\n  toggleGraph() {\n    this.graphContainer?.classList.toggle('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Show the graph panel\n   */\n  showGraph() {\n    this.graphContainer?.classList.remove('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Hide the graph panel\n   */\n  hideGraph() {\n    this.graphContainer?.classList.add('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Toggle the console panel\n   */\n  toggleConsole() {\n    this.consolePanel?.classList.toggle('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Show the console panel\n   */\n  showConsole() {\n    this.consolePanel?.classList.remove('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Hide the console panel\n   */\n  hideConsole() {\n    this.consolePanel?.classList.add('hidden');\n    this._triggerResize();\n  }\n\n  /**\n   * Get current layout mode\n   */\n  getLayout() {\n    return this.currentLayout;\n  }\n\n  /**\n   * Check if mobile layout\n   */\n  isMobile() {\n    return this.currentLayout === 'mobile';\n  }\n\n  /**\n   * Check if tablet layout\n   */\n  isTablet() {\n    return this.currentLayout === 'tablet';\n  }\n\n  /**\n   * Check if desktop layout\n   */\n  isDesktop() {\n    return this.currentLayout === 'desktop';\n  }\n}\n","/**\n * HelpModal - Tabbed help modal component\n */\n\nexport class HelpModal {\n  constructor() {\n    this.activeTab = 'quickstart';\n    this.modal = null;\n    this.body = null;\n    this.tabContent = {};\n  }\n\n  /**\n   * Show the help modal\n   * @param {HTMLElement} modalElement - The modal overlay element\n   */\n  show(modalElement) {\n    this.modal = modalElement;\n    const title = document.getElementById('modal-title');\n    this.body = document.getElementById('modal-body');\n\n    if (!this.modal || !this.body) return;\n\n    title.textContent = 'ROS 2 Turtle School - Help';\n    this.body.innerHTML = this._renderTabs() + this._renderContent();\n\n    this._setupTabListeners();\n    this._showTab(this.activeTab);\n\n    this.modal.classList.remove('hidden');\n  }\n\n  _renderTabs() {\n    return `\n      <div class=\"help-tabs\" role=\"tablist\" aria-label=\"Help sections\">\n        <button class=\"help-tab active\" data-tab=\"quickstart\" role=\"tab\" aria-selected=\"true\" aria-controls=\"panel-quickstart\">Quick Start</button>\n        <button class=\"help-tab\" data-tab=\"commands\" role=\"tab\" aria-selected=\"false\" aria-controls=\"panel-commands\">Commands</button>\n        <button class=\"help-tab\" data-tab=\"slam\" role=\"tab\" aria-selected=\"false\" aria-controls=\"panel-slam\">SLAM Tutorial</button>\n        <button class=\"help-tab\" data-tab=\"nav2\" role=\"tab\" aria-selected=\"false\" aria-controls=\"panel-nav2\">Nav2 Tutorial</button>\n      </div>\n    `;\n  }\n\n  _renderContent() {\n    return `\n      <div class=\"help-panels\">\n        <div id=\"panel-quickstart\" class=\"help-panel active\" role=\"tabpanel\" aria-labelledby=\"tab-quickstart\">\n          ${this._renderQuickStart()}\n        </div>\n        <div id=\"panel-commands\" class=\"help-panel\" role=\"tabpanel\" aria-labelledby=\"tab-commands\" hidden>\n          ${this._renderCommands()}\n        </div>\n        <div id=\"panel-slam\" class=\"help-panel\" role=\"tabpanel\" aria-labelledby=\"tab-slam\" hidden>\n          ${this._renderSlam()}\n        </div>\n        <div id=\"panel-nav2\" class=\"help-panel\" role=\"tabpanel\" aria-labelledby=\"tab-nav2\" hidden>\n          ${this._renderNav2()}\n        </div>\n      </div>\n    `;\n  }\n\n  _renderQuickStart() {\n    return `\n      <div class=\"help-content\">\n        <div class=\"help-section help-intro\">\n          <p>This emulator lets you learn ROS2 CLI commands in your browser. Follow along with the official tutorial:</p>\n          <a href=\"https://docs.ros.org/en/jazzy/Tutorials/Beginner-CLI-Tools.html\" target=\"_blank\" rel=\"noopener\" class=\"tutorial-link\">\n            ROS2 Jazzy - Beginner CLI Tools Tutorial\n          </a>\n        </div>\n\n        <h3>Quick Start</h3>\n        <ol>\n          <li>Run <code>ros2 run turtlesim turtlesim_node</code> to start turtlesim</li>\n          <li>Open a new terminal with the <strong>+</strong> button</li>\n          <li>Run <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code></li>\n          <li>Use <strong>W/A/S/D</strong> keys to move the turtle</li>\n        </ol>\n\n        <h3>Available Packages</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 run turtlesim turtlesim_node</code></td><td>Start turtlesim simulator</td></tr>\n          <tr><td><code>ros2 run turtlesim turtle_teleop_key</code></td><td>Control with arrow keys</td></tr>\n          <tr><td><code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code></td><td>Control with WASD keys</td></tr>\n          <tr><td><code>ros2 run simple_slam slam_node</code></td><td>Start SLAM mapping node</td></tr>\n          <tr><td><code>ros2 run tf2_ros static_transform_publisher</code></td><td>Publish static TF</td></tr>\n          <tr><td><code>ros2 run tf2_ros tf2_echo &lt;src&gt; &lt;tgt&gt;</code></td><td>Query transform between frames</td></tr>\n          <tr><td><code>ros2 run tf2_ros tf2_monitor</code></td><td>Monitor all TF broadcasts</td></tr>\n          <tr><td><code>ros2 run tf2_ros view_frames</code></td><td>Print TF frame tree</td></tr>\n          <tr><td><code>ros2 run nav2_simple_navigator navigator_node</code></td><td>Start Nav2 path planner</td></tr>\n        </table>\n\n        <h3>Keyboard Shortcuts</h3>\n        <ul>\n          <li><strong>Ctrl+C</strong> - Stop running command</li>\n          <li><strong>Up/Down</strong> - Command history</li>\n        </ul>\n      </div>\n    `;\n  }\n\n  _renderCommands() {\n    return `\n      <div class=\"help-content\">\n        <h3>ros2 run Options</h3>\n        <table class=\"help-table\">\n          <tr><td><code>--ros-args --remap __node:=name</code></td><td>Rename node</td></tr>\n          <tr><td><code>--ros-args --remap topic:=new_topic</code></td><td>Remap topic</td></tr>\n          <tr><td><code>--ros-args --log-level WARN</code></td><td>Set log level</td></tr>\n        </table>\n\n        <h3>ros2 node Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 node list</code></td><td>List running nodes</td></tr>\n          <tr><td><code>ros2 node info &lt;node&gt;</code></td><td>Show node details</td></tr>\n        </table>\n\n        <h3>ros2 topic Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 topic list</code></td><td>List all topics</td></tr>\n          <tr><td><code>ros2 topic list -t</code></td><td>List with types</td></tr>\n          <tr><td><code>ros2 topic info &lt;topic&gt;</code></td><td>Show topic info</td></tr>\n          <tr><td><code>ros2 topic info &lt;topic&gt; --verbose</code></td><td>Show info with QoS profiles</td></tr>\n          <tr><td><code>ros2 topic type &lt;topic&gt;</code></td><td>Show message type</td></tr>\n          <tr><td><code>ros2 topic echo &lt;topic&gt;</code></td><td>Print messages</td></tr>\n          <tr><td><code>ros2 topic pub &lt;topic&gt; &lt;type&gt; \"&lt;yaml&gt;\"</code></td><td>Publish message</td></tr>\n          <tr><td><code>ros2 topic pub --once ...</code></td><td>Publish once</td></tr>\n          <tr><td><code>ros2 topic pub -r 10 ...</code></td><td>Publish at rate</td></tr>\n          <tr><td><code>ros2 topic hz &lt;topic&gt;</code></td><td>Show publish rate</td></tr>\n          <tr><td><code>ros2 topic bw &lt;topic&gt;</code></td><td>Show bandwidth</td></tr>\n        </table>\n\n        <h3>QoS Flags (for pub/echo)</h3>\n        <table class=\"help-table\">\n          <tr><td><code>--qos-profile &lt;name&gt;</code></td><td>Use named profile (sensor_data, default, etc.)</td></tr>\n          <tr><td><code>--qos-reliability &lt;policy&gt;</code></td><td>reliable or best_effort</td></tr>\n          <tr><td><code>--qos-durability &lt;policy&gt;</code></td><td>volatile or transient_local</td></tr>\n          <tr><td><code>--qos-history &lt;policy&gt;</code></td><td>keep_last or keep_all</td></tr>\n          <tr><td><code>--qos-depth &lt;n&gt;</code></td><td>Queue depth for keep_last (default: 10)</td></tr>\n        </table>\n\n        <h3>ros2 service Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 service list</code></td><td>List all services</td></tr>\n          <tr><td><code>ros2 service list -t</code></td><td>List with types</td></tr>\n          <tr><td><code>ros2 service type &lt;service&gt;</code></td><td>Show service type</td></tr>\n          <tr><td><code>ros2 service call &lt;srv&gt; &lt;type&gt; \"&lt;yaml&gt;\"</code></td><td>Call service</td></tr>\n        </table>\n        <p><em>Turtlesim services: /spawn, /kill, /turtle1/set_pen, /turtle1/teleport_absolute</em></p>\n\n        <h3>ros2 action Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 action list</code></td><td>List all actions</td></tr>\n          <tr><td><code>ros2 action list -t</code></td><td>List with types</td></tr>\n          <tr><td><code>ros2 action info &lt;action&gt;</code></td><td>Show action info</td></tr>\n          <tr><td><code>ros2 action send_goal &lt;action&gt; &lt;type&gt; \"&lt;yaml&gt;\"</code></td><td>Send goal</td></tr>\n          <tr><td><code>ros2 action send_goal ... --feedback</code></td><td>With feedback</td></tr>\n        </table>\n        <p><em>Turtlesim action: /turtle1/rotate_absolute</em></p>\n\n        <h3>ros2 param Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 param list</code></td><td>List all parameters</td></tr>\n          <tr><td><code>ros2 param list &lt;node&gt;</code></td><td>List node params</td></tr>\n          <tr><td><code>ros2 param get &lt;node&gt; &lt;param&gt;</code></td><td>Get parameter value</td></tr>\n          <tr><td><code>ros2 param set &lt;node&gt; &lt;param&gt; &lt;value&gt;</code></td><td>Set parameter</td></tr>\n          <tr><td><code>ros2 param dump &lt;node&gt;</code></td><td>Dump all params</td></tr>\n        </table>\n        <p><em>Turtlesim params: background_r, background_g, background_b</em></p>\n\n        <h3>ros2 bag Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 bag record &lt;topics&gt;</code></td><td>Record topics</td></tr>\n          <tr><td><code>ros2 bag record -o &lt;name&gt; &lt;topics&gt;</code></td><td>Record with name</td></tr>\n          <tr><td><code>ros2 bag record -a</code></td><td>Record all topics</td></tr>\n          <tr><td><code>ros2 bag info &lt;bag&gt;</code></td><td>Show bag info</td></tr>\n          <tr><td><code>ros2 bag play &lt;bag&gt;</code></td><td>Play back bag</td></tr>\n          <tr><td><code>ros2 bag play &lt;bag&gt; --rate 2.0</code></td><td>Play at 2x speed</td></tr>\n        </table>\n\n        <h3>ros2 interface Commands</h3>\n        <table class=\"help-table\">\n          <tr><td><code>ros2 interface show &lt;type&gt;</code></td><td>Show message/service definition</td></tr>\n          <tr><td><code>ros2 pkg executables &lt;pkg&gt;</code></td><td>List package executables</td></tr>\n        </table>\n\n        <h3>rqt Tools</h3>\n        <table class=\"help-table\">\n          <tr><td><code>rqt_graph</code></td><td>Node/topic graph visualization</td></tr>\n          <tr><td><code>rqt_console</code></td><td>Log message viewer</td></tr>\n          <tr><td><code>rqt</code></td><td>Open tool selector</td></tr>\n        </table>\n      </div>\n    `;\n  }\n\n  _renderSlam() {\n    return `\n      <div class=\"help-content\">\n        <div class=\"slam-tutorial\">\n          <p>Learn how occupancy grid mapping works with our simple SLAM demo.</p>\n\n          <h4>Step 1: Start Turtlesim</h4>\n          <p>In Terminal 1:</p>\n          <code>ros2 run turtlesim turtlesim_node</code>\n          <p>This spawns a turtle with a simulated LIDAR sensor. The gray boxes are obstacles.</p>\n\n          <h4>Step 2: Start SLAM Node</h4>\n          <p>Click <strong>+</strong> to add Terminal 2, then run:</p>\n          <code>ros2 run simple_slam slam_node</code>\n          <p>The SLAM node subscribes to <code>/scan</code> (LIDAR) and <code>/turtle1/pose</code> (position).</p>\n\n          <h4>Step 3: View the Map</h4>\n          <p>Click the <strong>Map</strong> button in the header. You'll see a gray grid (unknown space).</p>\n\n          <h4>Step 4: Start Teleop</h4>\n          <p>Click <strong>+</strong> to add Terminal 3, then run:</p>\n          <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code>\n          <p>Use <strong>W/A/S/D</strong> keys to drive the turtle around.</p>\n\n          <h4>Step 5: Watch the Map Build</h4>\n          <p>As the turtle moves:</p>\n          <ul>\n            <li><strong>White cells</strong> = Free space (LIDAR rays passed through)</li>\n            <li><strong>Black cells</strong> = Obstacles (LIDAR rays hit something)</li>\n            <li><strong>Gray cells</strong> = Unknown (not yet scanned)</li>\n          </ul>\n          <p>Drive around all the obstacles to build a complete map!</p>\n\n          <h4>Step 6: Inspect the System</h4>\n          <p>Open a 4th terminal and explore what SLAM is doing:</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 node info /slam_node</code></td><td>See what the SLAM node subscribes to and publishes</td></tr>\n            <tr><td><code>ros2 topic list -t</code></td><td>See all active topics with their types</td></tr>\n            <tr><td><code>ros2 interface show sensor_msgs/msg/LaserScan</code></td><td>Understand the lidar message structure</td></tr>\n            <tr><td><code>ros2 interface show nav_msgs/msg/OccupancyGrid</code></td><td>Understand the map message structure</td></tr>\n          </table>\n\n          <h4>Step 7: Monitor Live Data</h4>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 topic echo /scan</code></td><td>Watch raw lidar data streaming in</td></tr>\n            <tr><td><code>ros2 topic echo /map</code></td><td>Watch occupancy grid values update</td></tr>\n            <tr><td><code>ros2 topic hz /scan</code></td><td>Check lidar rate (~10 Hz)</td></tr>\n            <tr><td><code>ros2 topic hz /map</code></td><td>Check map publish rate (~2 Hz)</td></tr>\n            <tr><td><code>ros2 topic bw /scan</code></td><td>Measure lidar bandwidth</td></tr>\n          </table>\n\n          <h4>Step 8: Tune Parameters</h4>\n          <p>Change SLAM behavior at runtime:</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 param list /slam_node</code></td><td>See all tunable parameters</td></tr>\n            <tr><td><code>ros2 param get /slam_node hit_prob</code></td><td>Check obstacle detection confidence</td></tr>\n            <tr><td><code>ros2 param set /slam_node hit_prob 0.95</code></td><td>Increase obstacle confidence</td></tr>\n            <tr><td><code>ros2 param set /slam_node miss_prob 0.1</code></td><td>More confident free-space marking</td></tr>\n            <tr><td><code>ros2 param dump /slam_node</code></td><td>Dump all current parameter values</td></tr>\n          </table>\n\n          <h4>Step 9: Record and Replay</h4>\n          <p>Record a mapping session for later analysis:</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 bag record -o my_run /scan /turtle1/pose /map</code></td><td>Record SLAM topics</td></tr>\n            <tr><td><code>ros2 bag info my_run</code></td><td>Inspect recorded data</td></tr>\n            <tr><td><code>ros2 bag play my_run</code></td><td>Replay the session</td></tr>\n            <tr><td><code>ros2 bag play my_run --rate 0.5</code></td><td>Replay at half speed</td></tr>\n          </table>\n\n          <h4>Step 10: Map Quality Visualization</h4>\n          <p>Click the <strong>Quality</strong> button in the canvas toolbar to compare the SLAM map against the ground truth obstacles:</p>\n          <ul>\n            <li><strong>Green</strong> = SLAM matches ground truth (correct)</li>\n            <li><strong>Red</strong> = False positive (SLAM says occupied, actually free)</li>\n            <li><strong>Blue</strong> = False negative (SLAM says free, actually occupied)</li>\n            <li><strong>Gray</strong> = Unknown (not yet scanned)</li>\n          </ul>\n          <p>An accuracy percentage is shown in the top-left corner.</p>\n\n          <h4>SLAM Cell Values</h4>\n          <p><code>ros2 topic echo /map</code> shows OccupancyGrid data: <strong>-1</strong> = unknown, <strong>0</strong> = free, <strong>100</strong> = occupied.</p>\n        </div>\n      </div>\n    `;\n  }\n\n  _renderNav2() {\n    return `\n      <div class=\"help-content\">\n        <div class=\"slam-tutorial\">\n          <p>Learn autonomous navigation: build a map with SLAM, then use Nav2 to plan and follow paths.</p>\n\n          <h4>Step 1: Build a Map</h4>\n          <p>Follow the SLAM Tutorial first to build a map. You need three terminals:</p>\n          <code>ros2 run turtlesim turtlesim_node</code><br>\n          <code>ros2 run simple_slam slam_node</code><br>\n          <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code>\n          <p>Drive the turtle around with <strong>W/A/S/D</strong> to scan all obstacles.</p>\n\n          <h4>Step 2: Start the Navigator</h4>\n          <p>Open a new terminal and start the Nav2 path planner:</p>\n          <code>ros2 run nav2_simple_navigator navigator_node</code>\n          <p>The navigator subscribes to <code>/map</code> from SLAM and waits for goals.</p>\n\n          <h4>Step 3: Send a Navigation Goal</h4>\n          <p>Send the turtle to a target position using an action goal:</p>\n          <code>ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose \"{pose: {position: {x: 8.0, y: 8.0}}}\"</code>\n          <p>Watch the turtle plan a path and drive itself to the goal!</p>\n\n          <h4>Step 4: Monitor Navigation</h4>\n          <p>Open a 5th terminal to inspect the system while all nodes keep running:</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 topic echo /plan</code></td><td>See the planned path waypoints</td></tr>\n            <tr><td><code>ros2 action send_goal ... --feedback</code></td><td>Watch distance remaining</td></tr>\n            <tr><td><code>ros2 param get /navigator_node goal_tolerance</code></td><td>Check goal tolerance</td></tr>\n          </table>\n\n          <h4>Step 5: Tune Navigator Parameters</h4>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 param set /navigator_node goal_tolerance 0.5</code></td><td>Increase tolerance (reach goals sooner)</td></tr>\n            <tr><td><code>ros2 param set /navigator_node max_speed 2.0</code></td><td>Drive faster</td></tr>\n            <tr><td><code>ros2 param set /navigator_node obstacle_threshold 30</code></td><td>Avoid even partially occupied cells</td></tr>\n            <tr><td><code>ros2 param set /navigator_node robot_radius 0.8</code></td><td>Increase clearance from obstacles</td></tr>\n          </table>\n\n          <h4>Step 6: Loop Closure &amp; Drift</h4>\n          <p>Explore how odometry drift affects mapping and why loop closure matters:</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 param set /slam_node drift_enabled true</code></td><td>Enable simulated odometry drift</td></tr>\n            <tr><td><code>ros2 param set /slam_node drift_rate 0.02</code></td><td>Increase drift rate to see the effect</td></tr>\n            <tr><td><code>ros2 topic echo /loop_closures</code></td><td>Watch for loop closure events</td></tr>\n            <tr><td><code>ros2 param set /slam_node loop_closure_enabled true</code></td><td>Enable loop closure correction</td></tr>\n          </table>\n          <p>Drive in a loop and watch the SLAM node detect when you revisit a location!</p>\n\n          <h4>Step 7: Localization Mode</h4>\n          <p>Save your map and switch to localization (no new mapping):</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 service call /slam/save_map std_srvs/srv/Empty</code></td><td>Save the current map</td></tr>\n            <tr><td><code>ros2 param set /slam_node localization_mode true</code></td><td>Switch to localization mode</td></tr>\n            <tr><td><code>ros2 param set /slam_node localization_mode false</code></td><td>Switch back to mapping</td></tr>\n          </table>\n\n          <h4>Step 8: TF2 Frame Queries</h4>\n          <p>Explore coordinate transforms between frames:</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 world base_link</code></td><td>Publish a transform</td></tr>\n            <tr><td><code>ros2 run tf2_ros tf2_echo world base_link</code></td><td>Continuously print the transform</td></tr>\n            <tr><td><code>ros2 run tf2_ros view_frames</code></td><td>Print the frame tree</td></tr>\n            <tr><td><code>ros2 run tf2_ros tf2_monitor</code></td><td>Monitor all TF broadcasts</td></tr>\n          </table>\n\n          <h4>Step 9: Waypoint Following</h4>\n          <p>Send the turtle through a sequence of waypoints:</p>\n          <code>ros2 action send_goal /follow_waypoints nav2_msgs/action/FollowWaypoints \"{poses: [{position: {x: 3, y: 3}}, {position: {x: 8, y: 3}}, {position: {x: 8, y: 8}}]}\"</code>\n          <p>Numbered orange markers appear on the canvas. The turtle visits each in order. Missed waypoints are reported in the result.</p>\n\n          <h4>Step 10: Recovery Behaviors</h4>\n          <p>When the robot gets stuck, it automatically spins and backs up to try to free itself.</p>\n          <table class=\"help-table\">\n            <tr><td><code>ros2 topic echo /recovery_status</code></td><td>Watch recovery events</td></tr>\n            <tr><td><code>ros2 param set /navigator_node stuck_timeout 5.0</code></td><td>Seconds before recovery triggers</td></tr>\n            <tr><td><code>ros2 param set /navigator_node max_recovery_attempts 5</code></td><td>Max retries before abort</td></tr>\n            <tr><td><code>ros2 param set /navigator_node recovery_enabled false</code></td><td>Disable recovery</td></tr>\n          </table>\n\n          <h4>Step 11: Costmap Visualization</h4>\n          <p>Click the <strong>Costmap</strong> button in the canvas toolbar to see the inflation zone around obstacles. Red = obstacle, orange/yellow = inflation radius.</p>\n\n          <h4>How A* Path Planning Works</h4>\n          <p>The navigator uses the A* algorithm on the occupancy grid:</p>\n          <ul>\n            <li>Converts start and goal positions to grid cells</li>\n            <li>Searches the grid using A* with 8-connected neighbors</li>\n            <li>Avoids cells with occupancy above <code>obstacle_threshold</code></li>\n            <li>Publishes the path to <code>/plan</code></li>\n            <li>Follows the path using a proportional controller on <code>/turtle1/cmd_vel</code></li>\n          </ul>\n        </div>\n      </div>\n    `;\n  }\n\n  _setupTabListeners() {\n    const tabs = this.body.querySelectorAll('.help-tab');\n    tabs.forEach(tab => {\n      tab.addEventListener('click', () => {\n        const tabName = tab.dataset.tab;\n        this._showTab(tabName);\n      });\n    });\n  }\n\n  _showTab(tabName) {\n    this.activeTab = tabName;\n\n    // Update tab buttons\n    const tabs = this.body.querySelectorAll('.help-tab');\n    tabs.forEach(tab => {\n      const isActive = tab.dataset.tab === tabName;\n      tab.classList.toggle('active', isActive);\n      tab.setAttribute('aria-selected', isActive ? 'true' : 'false');\n    });\n\n    // Update panels\n    const panels = this.body.querySelectorAll('.help-panel');\n    panels.forEach(panel => {\n      const isActive = panel.id === `panel-${tabName}`;\n      panel.classList.toggle('active', isActive);\n      panel.hidden = !isActive;\n    });\n  }\n}\n\n// Singleton instance\nexport const helpModal = new HelpModal();\n","/**\n * Command Registry - Central registry for CLI commands.\n * Command handlers self-register by importing this singleton and calling register().\n */\n\nclass CommandRegistryClass {\n  constructor() {\n    this.commands = new Map();\n    this.ros2Commands = new Map();\n  }\n\n  /**\n   * Register a top-level command\n   * @param {string} name - Command name (e.g., 'clear', 'ls', 'rqt_graph')\n   * @param {Function} handler - Handler function (args, terminal) => void\n   */\n  register(name, handler) {\n    this.commands.set(name, handler);\n  }\n\n  /**\n   * Register a ros2 subcommand\n   * @param {string} name - Subcommand name (e.g., 'run', 'topic', 'node')\n   * @param {Function} handler - Handler function (args, terminal) => void\n   */\n  registerRos2(name, handler) {\n    this.ros2Commands.set(name, handler);\n  }\n\n  /**\n   * Check if a command exists\n   */\n  hasCommand(name) {\n    return this.commands.has(name);\n  }\n\n  /**\n   * Check if a ros2 subcommand exists\n   */\n  hasRos2Command(name) {\n    return this.ros2Commands.has(name);\n  }\n\n  /**\n   * Execute a top-level command\n   * @returns {boolean} True if command was handled\n   */\n  async execute(name, args, terminal) {\n    const handler = this.commands.get(name);\n    if (!handler) return false;\n    await handler(args, terminal);\n    return true;\n  }\n\n  /**\n   * Execute a ros2 subcommand\n   * @returns {boolean} True if command was handled\n   */\n  async executeRos2(name, args, terminal) {\n    const handler = this.ros2Commands.get(name);\n    if (!handler) return false;\n    await handler(args, terminal);\n    return true;\n  }\n\n  /**\n   * List all registered top-level commands\n   */\n  listCommands() {\n    return Array.from(this.commands.keys());\n  }\n\n  /**\n   * List all registered ros2 subcommands\n   */\n  listRos2Commands() {\n    return Array.from(this.ros2Commands.keys());\n  }\n}\n\nexport const commandRegistry = new CommandRegistryClass();\n","/**\n * Node Registry - Maps package/executable names to node classes\n * Nodes self-register by importing this singleton and calling register().\n */\n\nclass NodeRegistryClass {\n  constructor() {\n    this.packages = {};\n  }\n\n  /**\n   * Get a node class by package and executable name\n   * @param {string} packageName - Package name\n   * @param {string} executableName - Executable name\n   * @returns {Class|null} Node class or null if not found\n   */\n  getNode(packageName, executableName) {\n    const pkg = this.packages[packageName];\n    if (!pkg) return null;\n    return pkg[executableName] || null;\n  }\n\n  /**\n   * List all available packages\n   * @returns {string[]} Package names\n   */\n  listPackages() {\n    return Object.keys(this.packages);\n  }\n\n  /**\n   * List executables in a package\n   * @param {string} packageName - Package name\n   * @returns {string[]} Executable names\n   */\n  listExecutables(packageName) {\n    const pkg = this.packages[packageName];\n    if (!pkg) return [];\n    return Object.keys(pkg);\n  }\n\n  /**\n   * Register a new node\n   * @param {string} packageName - Package name\n   * @param {string} executableName - Executable name\n   * @param {Class} nodeClass - Node class\n   */\n  register(packageName, executableName, nodeClass) {\n    if (!this.packages[packageName]) {\n      this.packages[packageName] = {};\n    }\n    this.packages[packageName][executableName] = nodeClass;\n  }\n\n  /**\n   * Check if a package exists\n   * @param {string} packageName - Package name\n   * @returns {boolean}\n   */\n  hasPackage(packageName) {\n    return !!this.packages[packageName];\n  }\n\n  /**\n   * Check if an executable exists\n   * @param {string} packageName - Package name\n   * @param {string} executableName - Executable name\n   * @returns {boolean}\n   */\n  hasExecutable(packageName, executableName) {\n    return !!this.getNode(packageName, executableName);\n  }\n}\n\nexport const nodeRegistry = new NodeRegistryClass();\n","import { nodeRegistry } from '../nodes/registry.js';\nimport { ProcessManager } from '../core/ProcessManager.js';\nimport { LogManager } from '../core/LogManager.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 run command\n * Usage: ros2 run <package> <executable> [--ros-args ...]\n */\nexport async function handleRos2Run(args, terminal) {\n  if (args.length < 2) {\n    terminal.writeln('usage: ros2 run <package_name> <executable_name>');\n    terminal.writeln('');\n    terminal.writeln('Run an executable from a package.');\n    terminal.finishCommand();\n    return;\n  }\n\n  const packageName = args[0];\n  const executableName = args[1];\n\n  // Parse --ros-args options\n  const rosArgs = parseRosArgs(args.slice(2));\n\n  // Check if package/executable exists\n  const nodeClass = nodeRegistry.getNode(packageName, executableName);\n  if (!nodeClass) {\n    terminal.writeln(`\\x1b[31mPackage '${packageName}' not found or executable '${executableName}' not found\\x1b[0m`);\n    terminal.writeln('');\n    terminal.writeln('Available packages and executables:');\n\n    const packages = nodeRegistry.listPackages();\n    for (const pkg of packages) {\n      const execs = nodeRegistry.listExecutables(pkg);\n      for (const exec of execs) {\n        terminal.writeln(`  ${pkg} ${exec}`);\n      }\n    }\n\n    terminal.finishCommand();\n    return;\n  }\n\n  // Determine node name\n  let nodeName = executableName;\n  if (rosArgs.remap && rosArgs.remap['__node']) {\n    nodeName = rosArgs.remap['__node'];\n  }\n\n  // Check if node already running with this name\n  const fullNodeName = `/${nodeName}`;\n  if (ProcessManager.isNodeRunning(fullNodeName)) {\n    terminal.writeln(`\\x1b[33mNode with name '${fullNodeName}' is already running\\x1b[0m`);\n    terminal.finishCommand();\n    return;\n  }\n\n  // Set log level if specified\n  if (rosArgs.logLevel) {\n    LogManager.setNodeLevel(fullNodeName, rosArgs.logLevel);\n  }\n\n  try {\n    // Collect positional args (before --ros-args)\n    const positionalArgs = [];\n    for (const arg of args.slice(2)) {\n      if (arg === '--ros-args') break;\n      positionalArgs.push(arg);\n    }\n\n    // Create node instance\n    const node = new nodeClass(nodeName, {\n      namespace: rosArgs.namespace,\n      parameters: rosArgs.params,\n      remappings: rosArgs.remap,\n      args: positionalArgs\n    });\n\n    // Spawn the node\n    const processId = ProcessManager.spawn(node, terminal.id, packageName, executableName);\n\n    terminal.writeln(`\\x1b[32m[INFO] Started ${packageName}/${executableName}\\x1b[0m`);\n\n    // For interactive nodes like turtlesim, don't finish - wait for Ctrl+C\n    // The node runs in background via timers\n\n  } catch (err) {\n    terminal.writeln(`\\x1b[31mError starting node: ${err.message}\\x1b[0m`);\n    terminal.finishCommand();\n  }\n}\n\n/**\n * Parse --ros-args options\n */\nfunction parseRosArgs(args) {\n  const result = {\n    remap: {},\n    params: {},\n    namespace: '',\n    logLevel: null,\n    paramsFile: null\n  };\n\n  let i = 0;\n  let inRosArgs = false;\n\n  while (i < args.length) {\n    const arg = args[i];\n\n    if (arg === '--ros-args') {\n      inRosArgs = true;\n      i++;\n      continue;\n    }\n\n    if (!inRosArgs) {\n      i++;\n      continue;\n    }\n\n    // Handle --remap or -r\n    if (arg === '--remap' || arg === '-r') {\n      if (i + 1 < args.length) {\n        const remapArg = args[i + 1];\n        const parts = remapArg.split(':=');\n        if (parts.length === 2) {\n          result.remap[parts[0]] = parts[1];\n        }\n        i += 2;\n      } else {\n        i++;\n      }\n      continue;\n    }\n\n    // Handle remapping directly (old:=new)\n    if (arg.includes(':=')) {\n      const parts = arg.split(':=');\n      if (parts.length === 2) {\n        result.remap[parts[0]] = parts[1];\n      }\n      i++;\n      continue;\n    }\n\n    // Handle --param or -p\n    if (arg === '--param' || arg === '-p') {\n      if (i + 1 < args.length) {\n        const paramArg = args[i + 1];\n        const parts = paramArg.split(':=');\n        if (parts.length === 2) {\n          result.params[parts[0]] = parseParamValue(parts[1]);\n        }\n        i += 2;\n      } else {\n        i++;\n      }\n      continue;\n    }\n\n    // Handle --params-file\n    if (arg === '--params-file') {\n      if (i + 1 < args.length) {\n        result.paramsFile = args[i + 1];\n        i += 2;\n      } else {\n        i++;\n      }\n      continue;\n    }\n\n    // Handle --log-level\n    if (arg === '--log-level') {\n      if (i + 1 < args.length) {\n        result.logLevel = args[i + 1].toUpperCase();\n        i += 2;\n      } else {\n        i++;\n      }\n      continue;\n    }\n\n    // Handle -n (namespace)\n    if (arg === '-n' || arg === '--namespace') {\n      if (i + 1 < args.length) {\n        result.namespace = args[i + 1];\n        i += 2;\n      } else {\n        i++;\n      }\n      continue;\n    }\n\n    i++;\n  }\n\n  return result;\n}\n\n/**\n * Parse a parameter value string\n */\nfunction parseParamValue(str) {\n  // Boolean\n  if (str === 'true') return true;\n  if (str === 'false') return false;\n\n  // Number\n  const num = Number(str);\n  if (!isNaN(num)) return num;\n\n  // String\n  return str;\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('run', handleRos2Run);\n\nexport default { handleRos2Run };\n","import { SimDDS } from '../core/SimDDS.js';\nimport { ProcessManager } from '../core/ProcessManager.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 node commands\n */\nexport async function handleRos2Node(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'list':\n      handleList(subArgs, terminal);\n      break;\n\n    case 'info':\n      handleInfo(subArgs, terminal);\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n  }\n\n  terminal.finishCommand();\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 node <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  list    List running nodes');\n  terminal.writeln('  info    Show information about a node');\n}\n\n/**\n * Handle ros2 node list\n */\nfunction handleList(args, terminal) {\n  const nodes = SimDDS.getNodes();\n\n  if (nodes.length === 0) {\n    terminal.writeln('No nodes are currently running.');\n    return;\n  }\n\n  for (const node of nodes.sort()) {\n    terminal.writeln(node);\n  }\n}\n\n/**\n * Handle ros2 node info <node_name>\n */\nfunction handleInfo(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 node info <node_name>');\n    return;\n  }\n\n  let nodeName = args[0];\n  // Add leading slash if not present\n  if (!nodeName.startsWith('/')) {\n    nodeName = '/' + nodeName;\n  }\n\n  const nodeInfo = SimDDS.getNodeInfo(nodeName);\n  if (!nodeInfo) {\n    terminal.writeln(`\\x1b[31mNode '${nodeName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(`${nodeName}`);\n\n  // Get process info for more details\n  const procInfo = ProcessManager.getProcessByNodeName(nodeName);\n  const node = procInfo?.node;\n\n  const sections = [\n    { label: 'Subscribers', items: node?.subscriptions?.map(s => `${s.topic}: ${s.msgType}`) || [] },\n    { label: 'Publishers', items: node?.publishers?.map(p => `${p.topic}: ${p.msgType}`) || [] },\n    { label: 'Service Servers', items: node?.services?.map(s => `${s.name}: ${s.type}`) || [] },\n    { label: 'Service Clients', items: [] },\n    { label: 'Action Servers', items: node?.actionServers?.map(a => `${a.name}: ${a.type}`) || [] },\n    { label: 'Action Clients', items: [] },\n  ];\n\n  for (const section of sections) {\n    terminal.writeln(`  ${section.label}:`);\n    if (section.items.length > 0) {\n      for (const item of section.items) {\n        terminal.writeln(`    ${item}`);\n      }\n    }\n  }\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('node', handleRos2Node);\n\nexport default { handleRos2Node };\n","/**\n * messageParser - Parse YAML-like message strings into JavaScript objects\n * Handles ROS2 CLI message format: \"{linear: {x: 2.0}, angular: {z: 1.0}}\"\n */\n\n/**\n * Parse a YAML-like message string into an object\n * @param {string} input - The message string\n * @returns {Object} Parsed object\n */\nexport function parseMessage(input) {\n  if (!input || typeof input !== 'string') {\n    return {};\n  }\n\n  // Remove outer braces if present\n  let str = input.trim();\n  if (str.startsWith('{') && str.endsWith('}')) {\n    str = str.slice(1, -1);\n  }\n\n  // Handle empty input\n  if (!str.trim()) {\n    return {};\n  }\n\n  try {\n    // Try JSON parse first (handles proper JSON)\n    // This is the fast path - JSON.parse is highly optimized in V8\n    return JSON.parse(`{${str}}`);\n  } catch (e) {\n    // PERFORMANCE NOTE: YAML-like parser fallback\n    // The parseYamlLike() function below is a character-by-character parser\n    // with O(n) time complexity. For typical ROS2 message sizes (< 1KB),\n    // this is fast enough (< 1ms). For very large messages, consider:\n    // 1. Using proper JSON format in commands when possible\n    // 2. The parser handles nested objects/arrays but allocates intermediate strings\n    // 3. No caching is implemented since messages are typically unique\n    return parseYamlLike(str);\n  }\n}\n\n/**\n * Parse YAML-like syntax\n * @param {string} str - The string to parse\n * @returns {Object} Parsed object\n */\nfunction parseYamlLike(str) {\n  const result = {};\n  let depth = 0;\n  let currentKey = '';\n  let currentValue = '';\n  let inValue = false;\n  let inString = false;\n  let stringChar = '';\n  let i = 0;\n\n  while (i < str.length) {\n    const char = str[i];\n\n    // Handle string literals\n    if ((char === '\"' || char === \"'\") && !inString) {\n      inString = true;\n      stringChar = char;\n      if (inValue) currentValue += char;\n      i++;\n      continue;\n    }\n\n    if (inString && char === stringChar) {\n      inString = false;\n      if (inValue) currentValue += char;\n      i++;\n      continue;\n    }\n\n    if (inString) {\n      if (inValue) currentValue += char;\n      else currentKey += char;\n      i++;\n      continue;\n    }\n\n    // Track brace depth\n    if (char === '{' || char === '[') {\n      depth++;\n      if (inValue) currentValue += char;\n      i++;\n      continue;\n    }\n\n    if (char === '}' || char === ']') {\n      depth--;\n      if (inValue) currentValue += char;\n      i++;\n      continue;\n    }\n\n    // Handle key-value separator\n    if (char === ':' && depth === 0 && !inValue) {\n      inValue = true;\n      i++;\n      // Skip whitespace after colon\n      while (i < str.length && str[i] === ' ') i++;\n      continue;\n    }\n\n    // Handle comma separator (at depth 0)\n    if (char === ',' && depth === 0) {\n      // Save current key-value pair\n      if (currentKey.trim()) {\n        result[currentKey.trim()] = parseValue(currentValue.trim());\n      }\n      currentKey = '';\n      currentValue = '';\n      inValue = false;\n      i++;\n      // Skip whitespace after comma\n      while (i < str.length && str[i] === ' ') i++;\n      continue;\n    }\n\n    // Accumulate characters\n    if (inValue) {\n      currentValue += char;\n    } else {\n      currentKey += char;\n    }\n    i++;\n  }\n\n  // Save last key-value pair\n  if (currentKey.trim()) {\n    result[currentKey.trim()] = parseValue(currentValue.trim());\n  }\n\n  return result;\n}\n\n/**\n * Parse a value string into appropriate type\n * @param {string} str - The value string\n * @returns {*} Parsed value\n */\nfunction parseValue(str) {\n  if (!str) return null;\n\n  // Check for nested object\n  if (str.startsWith('{') && str.endsWith('}')) {\n    return parseMessage(str);\n  }\n\n  // Check for array\n  if (str.startsWith('[') && str.endsWith(']')) {\n    return parseArray(str.slice(1, -1));\n  }\n\n  // Check for string\n  if ((str.startsWith('\"') && str.endsWith('\"')) ||\n      (str.startsWith(\"'\") && str.endsWith(\"'\"))) {\n    return str.slice(1, -1);\n  }\n\n  // Check for boolean\n  if (str === 'true') return true;\n  if (str === 'false') return false;\n\n  // Check for null\n  if (str === 'null' || str === '~') return null;\n\n  // Check for number\n  const num = Number(str);\n  if (!isNaN(num)) {\n    return num;\n  }\n\n  // Return as string\n  return str;\n}\n\n/**\n * Parse an array string\n * @param {string} str - The array content string\n * @returns {Array} Parsed array\n */\nfunction parseArray(str) {\n  const result = [];\n  let depth = 0;\n  let current = '';\n  let inString = false;\n  let stringChar = '';\n\n  for (let i = 0; i < str.length; i++) {\n    const char = str[i];\n\n    // Handle strings\n    if ((char === '\"' || char === \"'\") && !inString) {\n      inString = true;\n      stringChar = char;\n      current += char;\n      continue;\n    }\n\n    if (inString && char === stringChar) {\n      inString = false;\n      current += char;\n      continue;\n    }\n\n    if (inString) {\n      current += char;\n      continue;\n    }\n\n    // Track depth\n    if (char === '{' || char === '[') {\n      depth++;\n      current += char;\n      continue;\n    }\n\n    if (char === '}' || char === ']') {\n      depth--;\n      current += char;\n      continue;\n    }\n\n    // Handle comma at depth 0\n    if (char === ',' && depth === 0) {\n      if (current.trim()) {\n        result.push(parseValue(current.trim()));\n      }\n      current = '';\n      continue;\n    }\n\n    current += char;\n  }\n\n  // Add last element\n  if (current.trim()) {\n    result.push(parseValue(current.trim()));\n  }\n\n  return result;\n}\n\n/**\n * Format a message object as a string for display\n * @param {Object} msg - The message object\n * @param {number} indent - Indentation level\n * @returns {string} Formatted string\n */\nexport function formatMessage(msg, indent = 0) {\n  if (msg === null || msg === undefined) {\n    return 'null';\n  }\n\n  if (typeof msg !== 'object') {\n    return String(msg);\n  }\n\n  if (Array.isArray(msg)) {\n    if (msg.length === 0) return '[]';\n    const items = msg.map(item => formatMessage(item, indent));\n    return `[${items.join(', ')}]`;\n  }\n\n  const spaces = '  '.repeat(indent);\n  const lines = [];\n\n  for (const [key, value] of Object.entries(msg)) {\n    // Skip internal properties\n    if (key.startsWith('_')) continue;\n\n    if (typeof value === 'object' && value !== null && !Array.isArray(value)) {\n      lines.push(`${spaces}${key}:`);\n      lines.push(formatMessage(value, indent + 1));\n    } else {\n      const formattedValue = formatMessage(value, indent);\n      lines.push(`${spaces}${key}: ${formattedValue}`);\n    }\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format a message as compact single-line string\n * @param {Object} msg - The message object\n * @returns {string} Formatted string\n */\nexport function formatMessageCompact(msg) {\n  if (msg === null || msg === undefined) {\n    return 'null';\n  }\n\n  if (typeof msg !== 'object') {\n    return String(msg);\n  }\n\n  if (Array.isArray(msg)) {\n    const items = msg.map(item => formatMessageCompact(item));\n    return `[${items.join(', ')}]`;\n  }\n\n  const parts = [];\n  for (const [key, value] of Object.entries(msg)) {\n    // Skip internal properties\n    if (key.startsWith('_')) continue;\n    parts.push(`${key}: ${formatMessageCompact(value)}`);\n  }\n\n  return `{${parts.join(', ')}}`;\n}\n\nexport default {\n  parseMessage,\n  formatMessage,\n  formatMessageCompact\n};\n","/**\n * Message Registry - Central registry for all ROS2 message, service, and action types.\n * Message modules self-register by importing this singleton and calling register().\n */\n\nclass MessageRegistryClass {\n  constructor() {\n    this.messages = {};\n    this.services = {};\n    this.actions = {};\n  }\n\n  /**\n   * Register a message type\n   * @param {string} typeName - Full type name (e.g., 'geometry_msgs/msg/Twist')\n   * @param {Object} definition - Message definition object\n   */\n  registerMessage(typeName, definition) {\n    this.messages[typeName] = definition;\n  }\n\n  /**\n   * Register a service type\n   * @param {string} typeName - Full type name (e.g., 'turtlesim/srv/Spawn')\n   * @param {Object} definition - Service definition object\n   */\n  registerService(typeName, definition) {\n    this.services[typeName] = definition;\n  }\n\n  /**\n   * Register an action type\n   * @param {string} typeName - Full type name (e.g., 'turtlesim/action/RotateAbsolute')\n   * @param {Object} definition - Action definition object\n   */\n  registerAction(typeName, definition) {\n    this.actions[typeName] = definition;\n  }\n\n  /**\n   * Get a message type definition\n   */\n  getMessage(typeName) {\n    return this.messages[typeName] || null;\n  }\n\n  /**\n   * Get a service type definition\n   */\n  getService(typeName) {\n    return this.services[typeName] || null;\n  }\n\n  /**\n   * Get an action type definition\n   */\n  getAction(typeName) {\n    return this.actions[typeName] || null;\n  }\n\n  /**\n   * Get any interface type (message, service, or action)\n   */\n  getInterface(typeName) {\n    return this.messages[typeName] || this.services[typeName] || this.actions[typeName] || null;\n  }\n\n  /**\n   * List all available message types\n   */\n  listMessages() {\n    return Object.keys(this.messages);\n  }\n\n  /**\n   * List all available service types\n   */\n  listServices() {\n    return Object.keys(this.services);\n  }\n\n  /**\n   * List all available action types\n   */\n  listActions() {\n    return Object.keys(this.actions);\n  }\n\n  /**\n   * Find message types matching a pattern\n   */\n  findMessages(pattern) {\n    const regex = new RegExp(pattern, 'i');\n    return Object.keys(this.messages).filter(name => regex.test(name));\n  }\n\n  /**\n   * Find service types matching a pattern\n   */\n  findServices(pattern) {\n    const regex = new RegExp(pattern, 'i');\n    return Object.keys(this.services).filter(name => regex.test(name));\n  }\n\n  /**\n   * Find action types matching a pattern\n   */\n  findActions(pattern) {\n    const regex = new RegExp(pattern, 'i');\n    return Object.keys(this.actions).filter(name => regex.test(name));\n  }\n\n  /**\n   * Validate a message against its type definition\n   */\n  validateMessage(typeName, message) {\n    const msgDef = this.messages[typeName];\n    if (!msgDef) {\n      return { valid: false, errors: [`Unknown message type: ${typeName}`] };\n    }\n\n    const errors = [];\n    for (const [field, fieldDef] of Object.entries(msgDef.fields || {})) {\n      if (message[field] === undefined) {\n        if (fieldDef.default === undefined) {\n          errors.push(`Missing required field: ${field}`);\n        }\n      }\n    }\n\n    return { valid: errors.length === 0, errors };\n  }\n\n  /**\n   * Create a message with default values\n   */\n  createMessage(typeName, data = {}) {\n    const msgDef = this.messages[typeName];\n    if (!msgDef || !msgDef.create) {\n      return null;\n    }\n    return msgDef.create(data);\n  }\n\n  /**\n   * Get the definition string for a type (for ros2 interface show)\n   */\n  getDefinition(typeName) {\n    const iface = this.getInterface(typeName);\n    return iface?.definition || null;\n  }\n}\n\nexport const messageRegistry = new MessageRegistryClass();\n","/**\n * std_msgs - Standard ROS2 message types\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const Header = {\n  name: 'std_msgs/msg/Header',\n  fields: {\n    stamp: { type: 'builtin_interfaces/msg/Time', default: { sec: 0, nanosec: 0 } },\n    frame_id: { type: 'string', default: '' }\n  },\n  create: (data = {}) => ({\n    stamp: data.stamp || { sec: 0, nanosec: 0 },\n    frame_id: data.frame_id || ''\n  }),\n  definition: `# Standard metadata for higher-level stamped data types.\nbuiltin_interfaces/Time stamp\nstring frame_id`\n};\n\nexport const String = {\n  name: 'std_msgs/msg/String',\n  fields: {\n    data: { type: 'string', default: '' }\n  },\n  create: (data = {}) => ({\n    data: data.data || ''\n  }),\n  definition: `# A simple string message.\nstring data`\n};\n\nexport const Bool = {\n  name: 'std_msgs/msg/Bool',\n  fields: {\n    data: { type: 'bool', default: false }\n  },\n  create: (data = {}) => ({\n    data: data.data || false\n  }),\n  definition: `# A simple boolean message.\nbool data`\n};\n\nexport const Int32 = {\n  name: 'std_msgs/msg/Int32',\n  fields: {\n    data: { type: 'int32', default: 0 }\n  },\n  create: (data = {}) => ({\n    data: data.data || 0\n  }),\n  definition: `# A 32-bit signed integer.\nint32 data`\n};\n\nexport const Int64 = {\n  name: 'std_msgs/msg/Int64',\n  fields: {\n    data: { type: 'int64', default: 0 }\n  },\n  create: (data = {}) => ({\n    data: data.data || 0\n  }),\n  definition: `# A 64-bit signed integer.\nint64 data`\n};\n\nexport const Float32 = {\n  name: 'std_msgs/msg/Float32',\n  fields: {\n    data: { type: 'float32', default: 0.0 }\n  },\n  create: (data = {}) => ({\n    data: data.data || 0.0\n  }),\n  definition: `# A 32-bit floating point number.\nfloat32 data`\n};\n\nexport const Float64 = {\n  name: 'std_msgs/msg/Float64',\n  fields: {\n    data: { type: 'float64', default: 0.0 }\n  },\n  create: (data = {}) => ({\n    data: data.data || 0.0\n  }),\n  definition: `# A 64-bit floating point number.\nfloat64 data`\n};\n\nexport const Empty = {\n  name: 'std_msgs/msg/Empty',\n  fields: {},\n  create: () => ({}),\n  definition: `# Empty message type.`\n};\n\nexport const ColorRGBA = {\n  name: 'std_msgs/msg/ColorRGBA',\n  fields: {\n    r: { type: 'float32', default: 0.0 },\n    g: { type: 'float32', default: 0.0 },\n    b: { type: 'float32', default: 0.0 },\n    a: { type: 'float32', default: 1.0 }\n  },\n  create: (data = {}) => ({\n    r: data.r ?? 0.0,\n    g: data.g ?? 0.0,\n    b: data.b ?? 0.0,\n    a: data.a ?? 1.0\n  }),\n  definition: `# RGBA color with float values.\nfloat32 r\nfloat32 g\nfloat32 b\nfloat32 a`\n};\n\n// Self-register all message types\nmessageRegistry.registerMessage('std_msgs/msg/Header', Header);\nmessageRegistry.registerMessage('std_msgs/msg/String', String);\nmessageRegistry.registerMessage('std_msgs/msg/Bool', Bool);\nmessageRegistry.registerMessage('std_msgs/msg/Int32', Int32);\nmessageRegistry.registerMessage('std_msgs/msg/Int64', Int64);\nmessageRegistry.registerMessage('std_msgs/msg/Float32', Float32);\nmessageRegistry.registerMessage('std_msgs/msg/Float64', Float64);\nmessageRegistry.registerMessage('std_msgs/msg/Empty', Empty);\nmessageRegistry.registerMessage('std_msgs/msg/ColorRGBA', ColorRGBA);\n\n// Export all message types\nexport default {\n  Header,\n  String,\n  Bool,\n  Int32,\n  Int64,\n  Float32,\n  Float64,\n  Empty,\n  ColorRGBA\n};\n","/**\n * std_srvs - Standard ROS 2 service definitions\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const Empty = {\n  name: 'std_srvs/srv/Empty',\n  type: 'service',\n  request: {},\n  response: {},\n  createRequest: () => ({}),\n  createResponse: () => ({}),\n  definition: `# Empty service - no request or response data.\n---`\n};\n\n// Self-register all service types\nmessageRegistry.registerService('std_srvs/srv/Empty', Empty);\n\n// Export all service types\nexport default { Empty };\n","/**\n * geometry_msgs - Geometry-related ROS2 message types\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const Vector3 = {\n  name: 'geometry_msgs/msg/Vector3',\n  fields: {\n    x: { type: 'float64', default: 0.0 },\n    y: { type: 'float64', default: 0.0 },\n    z: { type: 'float64', default: 0.0 }\n  },\n  create: (data = {}) => ({\n    x: data.x ?? 0.0,\n    y: data.y ?? 0.0,\n    z: data.z ?? 0.0\n  }),\n  definition: `# A 3D vector.\nfloat64 x\nfloat64 y\nfloat64 z`\n};\n\nexport const Point = {\n  name: 'geometry_msgs/msg/Point',\n  fields: {\n    x: { type: 'float64', default: 0.0 },\n    y: { type: 'float64', default: 0.0 },\n    z: { type: 'float64', default: 0.0 }\n  },\n  create: (data = {}) => ({\n    x: data.x ?? 0.0,\n    y: data.y ?? 0.0,\n    z: data.z ?? 0.0\n  }),\n  definition: `# A point in 3D space.\nfloat64 x\nfloat64 y\nfloat64 z`\n};\n\nexport const Quaternion = {\n  name: 'geometry_msgs/msg/Quaternion',\n  fields: {\n    x: { type: 'float64', default: 0.0 },\n    y: { type: 'float64', default: 0.0 },\n    z: { type: 'float64', default: 0.0 },\n    w: { type: 'float64', default: 1.0 }\n  },\n  create: (data = {}) => ({\n    x: data.x ?? 0.0,\n    y: data.y ?? 0.0,\n    z: data.z ?? 0.0,\n    w: data.w ?? 1.0\n  }),\n  definition: `# A quaternion representing orientation.\nfloat64 x\nfloat64 y\nfloat64 z\nfloat64 w`\n};\n\nexport const Pose = {\n  name: 'geometry_msgs/msg/Pose',\n  fields: {\n    position: { type: 'geometry_msgs/msg/Point' },\n    orientation: { type: 'geometry_msgs/msg/Quaternion' }\n  },\n  create: (data = {}) => ({\n    position: Point.create(data.position),\n    orientation: Quaternion.create(data.orientation)\n  }),\n  definition: `# A representation of pose in free space.\nPoint position\nQuaternion orientation`\n};\n\nexport const PoseStamped = {\n  name: 'geometry_msgs/msg/PoseStamped',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    pose: { type: 'geometry_msgs/msg/Pose' }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: '' },\n    pose: Pose.create(data.pose)\n  }),\n  definition: `# A Pose with reference coordinate frame and timestamp.\nstd_msgs/Header header\nPose pose`\n};\n\nexport const Twist = {\n  name: 'geometry_msgs/msg/Twist',\n  fields: {\n    linear: { type: 'geometry_msgs/msg/Vector3' },\n    angular: { type: 'geometry_msgs/msg/Vector3' }\n  },\n  create: (data = {}) => ({\n    linear: Vector3.create(data.linear),\n    angular: Vector3.create(data.angular)\n  }),\n  definition: `# Velocity in free space, broken into linear and angular parts.\nVector3 linear\nVector3 angular`\n};\n\nexport const TwistStamped = {\n  name: 'geometry_msgs/msg/TwistStamped',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    twist: { type: 'geometry_msgs/msg/Twist' }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: '' },\n    twist: Twist.create(data.twist)\n  }),\n  definition: `# A twist with reference coordinate frame and timestamp.\nstd_msgs/Header header\nTwist twist`\n};\n\nexport const Transform = {\n  name: 'geometry_msgs/msg/Transform',\n  fields: {\n    translation: { type: 'geometry_msgs/msg/Vector3' },\n    rotation: { type: 'geometry_msgs/msg/Quaternion' }\n  },\n  create: (data = {}) => ({\n    translation: Vector3.create(data.translation),\n    rotation: Quaternion.create(data.rotation)\n  }),\n  definition: `# A transform between two coordinate frames.\nVector3 translation\nQuaternion rotation`\n};\n\nexport const TransformStamped = {\n  name: 'geometry_msgs/msg/TransformStamped',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    child_frame_id: { type: 'string', default: '' },\n    transform: { type: 'geometry_msgs/msg/Transform' }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: '' },\n    child_frame_id: data.child_frame_id || '',\n    transform: Transform.create(data.transform)\n  }),\n  definition: `# A transform with reference and child coordinate frames.\nstd_msgs/Header header\nstring child_frame_id\nTransform transform`\n};\n\n// Self-register all message types\nmessageRegistry.registerMessage('geometry_msgs/msg/Vector3', Vector3);\nmessageRegistry.registerMessage('geometry_msgs/msg/Point', Point);\nmessageRegistry.registerMessage('geometry_msgs/msg/Quaternion', Quaternion);\nmessageRegistry.registerMessage('geometry_msgs/msg/Pose', Pose);\nmessageRegistry.registerMessage('geometry_msgs/msg/PoseStamped', PoseStamped);\nmessageRegistry.registerMessage('geometry_msgs/msg/Twist', Twist);\nmessageRegistry.registerMessage('geometry_msgs/msg/TwistStamped', TwistStamped);\nmessageRegistry.registerMessage('geometry_msgs/msg/Transform', Transform);\nmessageRegistry.registerMessage('geometry_msgs/msg/TransformStamped', TransformStamped);\n\n// Export all message types\nexport default {\n  Vector3,\n  Point,\n  Quaternion,\n  Pose,\n  PoseStamped,\n  Twist,\n  TwistStamped,\n  Transform,\n  TransformStamped\n};\n","/**\n * turtlesim_msgs - Turtlesim-specific message types\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const Pose = {\n  name: 'turtlesim/msg/Pose',\n  fields: {\n    x: { type: 'float32', default: 0.0 },\n    y: { type: 'float32', default: 0.0 },\n    theta: { type: 'float32', default: 0.0 },\n    linear_velocity: { type: 'float32', default: 0.0 },\n    angular_velocity: { type: 'float32', default: 0.0 }\n  },\n  create: (data = {}) => ({\n    x: data.x ?? 0.0,\n    y: data.y ?? 0.0,\n    theta: data.theta ?? 0.0,\n    linear_velocity: data.linear_velocity ?? 0.0,\n    angular_velocity: data.angular_velocity ?? 0.0\n  }),\n  definition: `# Pose of a turtle in turtlesim.\nfloat32 x\nfloat32 y\nfloat32 theta\n\nfloat32 linear_velocity\nfloat32 angular_velocity`\n};\n\nexport const Color = {\n  name: 'turtlesim/msg/Color',\n  fields: {\n    r: { type: 'uint8', default: 0 },\n    g: { type: 'uint8', default: 0 },\n    b: { type: 'uint8', default: 0 }\n  },\n  create: (data = {}) => ({\n    r: data.r ?? 0,\n    g: data.g ?? 0,\n    b: data.b ?? 0\n  }),\n  definition: `# RGB color values.\nuint8 r\nuint8 g\nuint8 b`\n};\n\n// Self-register all message types\nmessageRegistry.registerMessage('turtlesim/msg/Pose', Pose);\nmessageRegistry.registerMessage('turtlesim/msg/Color', Color);\n\n// Export all message types\nexport default {\n  Pose,\n  Color\n};\n","/**\n * turtlesim_srvs - Turtlesim service definitions\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const Spawn = {\n  name: 'turtlesim/srv/Spawn',\n  type: 'service',\n  request: {\n    x: { type: 'float32', default: 0.0 },\n    y: { type: 'float32', default: 0.0 },\n    theta: { type: 'float32', default: 0.0 },\n    name: { type: 'string', default: '' }\n  },\n  response: {\n    name: { type: 'string' }\n  },\n  createRequest: (data = {}) => ({\n    x: data.x ?? 5.544445,\n    y: data.y ?? 5.544445,\n    theta: data.theta ?? 0.0,\n    name: data.name || ''\n  }),\n  createResponse: (data = {}) => ({\n    name: data.name || ''\n  }),\n  definition: `# Spawn a new turtle.\nfloat32 x\nfloat32 y\nfloat32 theta\nstring name\n---\nstring name`\n};\n\nexport const Kill = {\n  name: 'turtlesim/srv/Kill',\n  type: 'service',\n  request: {\n    name: { type: 'string', default: '' }\n  },\n  response: {},\n  createRequest: (data = {}) => ({\n    name: data.name || ''\n  }),\n  createResponse: () => ({}),\n  definition: `# Kill a turtle by name.\nstring name\n---`\n};\n\nexport const SetPen = {\n  name: 'turtlesim/srv/SetPen',\n  type: 'service',\n  request: {\n    r: { type: 'uint8', default: 0 },\n    g: { type: 'uint8', default: 0 },\n    b: { type: 'uint8', default: 0 },\n    width: { type: 'uint8', default: 1 },\n    off: { type: 'uint8', default: 0 }\n  },\n  response: {},\n  createRequest: (data = {}) => ({\n    r: data.r ?? 255,\n    g: data.g ?? 255,\n    b: data.b ?? 255,\n    width: data.width ?? 3,\n    off: data.off ?? 0\n  }),\n  createResponse: () => ({}),\n  definition: `# Set the pen parameters.\nuint8 r\nuint8 g\nuint8 b\nuint8 width\nuint8 off\n---`\n};\n\nexport const TeleportAbsolute = {\n  name: 'turtlesim/srv/TeleportAbsolute',\n  type: 'service',\n  request: {\n    x: { type: 'float32', default: 0.0 },\n    y: { type: 'float32', default: 0.0 },\n    theta: { type: 'float32', default: 0.0 }\n  },\n  response: {},\n  createRequest: (data = {}) => ({\n    x: data.x ?? 0.0,\n    y: data.y ?? 0.0,\n    theta: data.theta ?? 0.0\n  }),\n  createResponse: () => ({}),\n  definition: `# Teleport the turtle to an absolute position.\nfloat32 x\nfloat32 y\nfloat32 theta\n---`\n};\n\nexport const TeleportRelative = {\n  name: 'turtlesim/srv/TeleportRelative',\n  type: 'service',\n  request: {\n    linear: { type: 'float32', default: 0.0 },\n    angular: { type: 'float32', default: 0.0 }\n  },\n  response: {},\n  createRequest: (data = {}) => ({\n    linear: data.linear ?? 0.0,\n    angular: data.angular ?? 0.0\n  }),\n  createResponse: () => ({}),\n  definition: `# Teleport the turtle relative to its current position.\nfloat32 linear\nfloat32 angular\n---`\n};\n\n// Self-register all service types\nmessageRegistry.registerService('turtlesim/srv/Spawn', Spawn);\nmessageRegistry.registerService('turtlesim/srv/Kill', Kill);\nmessageRegistry.registerService('turtlesim/srv/SetPen', SetPen);\nmessageRegistry.registerService('turtlesim/srv/TeleportAbsolute', TeleportAbsolute);\nmessageRegistry.registerService('turtlesim/srv/TeleportRelative', TeleportRelative);\n\n// Export all service types\nexport default {\n  Spawn,\n  Kill,\n  SetPen,\n  TeleportAbsolute,\n  TeleportRelative\n};\n","/**\n * turtlesim_actions - Turtlesim action definitions\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const RotateAbsolute = {\n  name: 'turtlesim/action/RotateAbsolute',\n  type: 'action',\n  goal: {\n    theta: { type: 'float32', default: 0.0 }\n  },\n  result: {\n    delta: { type: 'float32' }\n  },\n  feedback: {\n    remaining: { type: 'float32' }\n  },\n  createGoal: (data = {}) => ({\n    theta: data.theta ?? 0.0\n  }),\n  createResult: (data = {}) => ({\n    delta: data.delta ?? 0.0\n  }),\n  createFeedback: (data = {}) => ({\n    remaining: data.remaining ?? 0.0\n  }),\n  definition: `# Rotate the turtle to an absolute orientation.\n# Goal\nfloat32 theta\n---\n# Result\nfloat32 delta\n---\n# Feedback\nfloat32 remaining`\n};\n\n// Self-register all action types\nmessageRegistry.registerAction('turtlesim/action/RotateAbsolute', RotateAbsolute);\n\n// Export all action types\nexport default {\n  RotateAbsolute\n};\n","/**\n * tf2_msgs - TF2 message types\n */\n\nimport { TransformStamped } from './geometry_msgs.js';\nimport { messageRegistry } from './registry.js';\n\nexport const TFMessage = {\n  name: 'tf2_msgs/msg/TFMessage',\n  fields: {\n    transforms: { type: 'geometry_msgs/msg/TransformStamped[]', default: [] }\n  },\n  create: (data = {}) => ({\n    transforms: (data.transforms || []).map(t => TransformStamped.create(t))\n  }),\n  definition: `# TF2 transform message.\ngeometry_msgs/TransformStamped[] transforms`\n};\n\n// Self-register all message types\nmessageRegistry.registerMessage('tf2_msgs/msg/TFMessage', TFMessage);\n\n// Export all message types\nexport default {\n  TFMessage\n};\n","/**\n * sensor_msgs - Sensor-related ROS2 message types\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const LaserScan = {\n  name: 'sensor_msgs/msg/LaserScan',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    angle_min: { type: 'float32', default: 0.0 },\n    angle_max: { type: 'float32', default: 0.0 },\n    angle_increment: { type: 'float32', default: 0.0 },\n    time_increment: { type: 'float32', default: 0.0 },\n    scan_time: { type: 'float32', default: 0.0 },\n    range_min: { type: 'float32', default: 0.0 },\n    range_max: { type: 'float32', default: 0.0 },\n    ranges: { type: 'float32[]', default: [] },\n    intensities: { type: 'float32[]', default: [] }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'laser' },\n    angle_min: data.angle_min ?? -Math.PI,\n    angle_max: data.angle_max ?? Math.PI,\n    angle_increment: data.angle_increment ?? (Math.PI / 180),\n    time_increment: data.time_increment ?? 0.0,\n    scan_time: data.scan_time ?? 0.1,\n    range_min: data.range_min ?? 0.1,\n    range_max: data.range_max ?? 10.0,\n    ranges: data.ranges || [],\n    intensities: data.intensities || []\n  }),\n  definition: `# Single scan from a planar laser range-finder.\nstd_msgs/Header header\n\nfloat32 angle_min        # start angle of the scan [rad]\nfloat32 angle_max        # end angle of the scan [rad]\nfloat32 angle_increment  # angular distance between measurements [rad]\n\nfloat32 time_increment   # time between measurements [seconds]\nfloat32 scan_time        # time between scans [seconds]\n\nfloat32 range_min        # minimum range value [m]\nfloat32 range_max        # maximum range value [m]\n\nfloat32[] ranges         # range data [m]\nfloat32[] intensities    # intensity data [device-specific units]`\n};\n\nexport const Imu = {\n  name: 'sensor_msgs/msg/Imu',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    orientation: { type: 'geometry_msgs/msg/Quaternion' },\n    orientation_covariance: { type: 'float64[9]', default: new Array(9).fill(0) },\n    angular_velocity: { type: 'geometry_msgs/msg/Vector3' },\n    angular_velocity_covariance: { type: 'float64[9]', default: new Array(9).fill(0) },\n    linear_acceleration: { type: 'geometry_msgs/msg/Vector3' },\n    linear_acceleration_covariance: { type: 'float64[9]', default: new Array(9).fill(0) }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'imu' },\n    orientation: data.orientation || { x: 0, y: 0, z: 0, w: 1 },\n    orientation_covariance: data.orientation_covariance || new Array(9).fill(0),\n    angular_velocity: data.angular_velocity || { x: 0, y: 0, z: 0 },\n    angular_velocity_covariance: data.angular_velocity_covariance || new Array(9).fill(0),\n    linear_acceleration: data.linear_acceleration || { x: 0, y: 0, z: 0 },\n    linear_acceleration_covariance: data.linear_acceleration_covariance || new Array(9).fill(0)\n  }),\n  definition: `# IMU sensor data.\nstd_msgs/Header header\n\ngeometry_msgs/Quaternion orientation\nfloat64[9] orientation_covariance\n\ngeometry_msgs/Vector3 angular_velocity\nfloat64[9] angular_velocity_covariance\n\ngeometry_msgs/Vector3 linear_acceleration\nfloat64[9] linear_acceleration_covariance`\n};\n\n// Self-register all message types\nmessageRegistry.registerMessage('sensor_msgs/msg/LaserScan', LaserScan);\nmessageRegistry.registerMessage('sensor_msgs/msg/Imu', Imu);\n\n// Export all message types\nexport default {\n  LaserScan,\n  Imu\n};\n","/**\n * nav_msgs - Navigation-related ROS2 message types\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const MapMetaData = {\n  name: 'nav_msgs/msg/MapMetaData',\n  fields: {\n    map_load_time: { type: 'builtin_interfaces/msg/Time', default: { sec: 0, nanosec: 0 } },\n    resolution: { type: 'float32', default: 0.05 },\n    width: { type: 'uint32', default: 0 },\n    height: { type: 'uint32', default: 0 },\n    origin: { type: 'geometry_msgs/msg/Pose' }\n  },\n  create: (data = {}) => ({\n    map_load_time: data.map_load_time || { sec: 0, nanosec: 0 },\n    resolution: data.resolution ?? 0.05,\n    width: data.width ?? 0,\n    height: data.height ?? 0,\n    origin: data.origin || {\n      position: { x: 0, y: 0, z: 0 },\n      orientation: { x: 0, y: 0, z: 0, w: 1 }\n    }\n  }),\n  definition: `# Metadata about a map.\nbuiltin_interfaces/Time map_load_time\nfloat32 resolution\nuint32 width\nuint32 height\ngeometry_msgs/Pose origin`\n};\n\nexport const OccupancyGrid = {\n  name: 'nav_msgs/msg/OccupancyGrid',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    info: { type: 'nav_msgs/msg/MapMetaData' },\n    data: { type: 'int8[]', default: [] }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'map' },\n    info: MapMetaData.create(data.info),\n    data: data.data || []\n  }),\n  definition: `# 2D occupancy grid map.\n# Values: -1 = unknown, 0 = free, 100 = occupied\nstd_msgs/Header header\nMapMetaData info\nint8[] data`\n};\n\nexport const Odometry = {\n  name: 'nav_msgs/msg/Odometry',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    child_frame_id: { type: 'string', default: '' },\n    pose: { type: 'geometry_msgs/msg/PoseWithCovariance' },\n    twist: { type: 'geometry_msgs/msg/TwistWithCovariance' }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'odom' },\n    child_frame_id: data.child_frame_id || 'base_link',\n    pose: data.pose || {\n      pose: {\n        position: { x: 0, y: 0, z: 0 },\n        orientation: { x: 0, y: 0, z: 0, w: 1 }\n      },\n      covariance: new Array(36).fill(0)\n    },\n    twist: data.twist || {\n      twist: {\n        linear: { x: 0, y: 0, z: 0 },\n        angular: { x: 0, y: 0, z: 0 }\n      },\n      covariance: new Array(36).fill(0)\n    }\n  }),\n  definition: `# Robot odometry.\nstd_msgs/Header header\nstring child_frame_id\ngeometry_msgs/PoseWithCovariance pose\ngeometry_msgs/TwistWithCovariance twist`\n};\n\nexport const Path = {\n  name: 'nav_msgs/msg/Path',\n  fields: {\n    header: { type: 'std_msgs/msg/Header' },\n    poses: { type: 'geometry_msgs/msg/PoseStamped[]', default: [] }\n  },\n  create: (data = {}) => ({\n    header: data.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'map' },\n    poses: data.poses || []\n  }),\n  definition: `# A path represented as a series of poses.\nstd_msgs/Header header\ngeometry_msgs/PoseStamped[] poses`\n};\n\n// Self-register all message types\nmessageRegistry.registerMessage('nav_msgs/msg/MapMetaData', MapMetaData);\nmessageRegistry.registerMessage('nav_msgs/msg/OccupancyGrid', OccupancyGrid);\nmessageRegistry.registerMessage('nav_msgs/msg/Odometry', Odometry);\nmessageRegistry.registerMessage('nav_msgs/msg/Path', Path);\n\n// Export all message types\nexport default {\n  MapMetaData,\n  OccupancyGrid,\n  Odometry,\n  Path\n};\n","/**\n * nav2_msgs - Nav2 action definitions for path planning\n */\n\nimport { messageRegistry } from './registry.js';\n\nexport const NavigateToPose = {\n  name: 'nav2_msgs/action/NavigateToPose',\n  type: 'action',\n  goal: {\n    pose: { type: 'geometry_msgs/msg/PoseStamped' }\n  },\n  result: {},\n  feedback: {\n    current_pose: { type: 'geometry_msgs/msg/PoseStamped' },\n    distance_remaining: { type: 'float32', default: 0.0 }\n  },\n  createGoal: (data = {}) => ({\n    pose: {\n      header: data.pose?.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'map' },\n      pose: {\n        position: {\n          x: data.pose?.pose?.position?.x ?? data.pose?.position?.x ?? 0.0,\n          y: data.pose?.pose?.position?.y ?? data.pose?.position?.y ?? 0.0,\n          z: data.pose?.pose?.position?.z ?? data.pose?.position?.z ?? 0.0\n        },\n        orientation: { x: 0, y: 0, z: 0, w: 1 }\n      }\n    }\n  }),\n  createResult: () => ({}),\n  createFeedback: (data = {}) => ({\n    current_pose: {\n      header: { stamp: { sec: 0, nanosec: 0 }, frame_id: 'map' },\n      pose: {\n        position: { x: data.current_pose?.pose?.position?.x ?? 0, y: data.current_pose?.pose?.position?.y ?? 0, z: 0 },\n        orientation: { x: 0, y: 0, z: 0, w: 1 }\n      }\n    },\n    distance_remaining: data.distance_remaining ?? 0.0\n  }),\n  definition: `# Navigate to a pose.\n# Goal\ngeometry_msgs/PoseStamped pose\n---\n# Result (empty - status conveyed by action state)\n---\n# Feedback\ngeometry_msgs/PoseStamped current_pose\nfloat32 distance_remaining`\n};\n\nmessageRegistry.registerAction('nav2_msgs/action/NavigateToPose', NavigateToPose);\n\nexport const FollowWaypoints = {\n  name: 'nav2_msgs/action/FollowWaypoints',\n  type: 'action',\n  goal: {\n    poses: { type: 'geometry_msgs/msg/PoseStamped[]' }\n  },\n  result: {\n    missed_waypoint_indices: { type: 'int32[]', default: [] }\n  },\n  feedback: {\n    current_waypoint: { type: 'int32', default: 0 },\n    number_of_poses: { type: 'int32', default: 0 },\n    distance_remaining: { type: 'float32', default: 0.0 }\n  },\n  createGoal: (data = {}) => ({\n    poses: (data.poses || []).map(p => ({\n      header: p.header || { stamp: { sec: 0, nanosec: 0 }, frame_id: 'map' },\n      pose: {\n        position: {\n          x: p.pose?.position?.x ?? p.position?.x ?? 0.0,\n          y: p.pose?.position?.y ?? p.position?.y ?? 0.0,\n          z: p.pose?.position?.z ?? p.position?.z ?? 0.0\n        },\n        orientation: { x: 0, y: 0, z: 0, w: 1 }\n      }\n    }))\n  }),\n  createResult: (data = {}) => ({\n    missed_waypoint_indices: data.missed_waypoint_indices || []\n  }),\n  createFeedback: (data = {}) => ({\n    current_waypoint: data.current_waypoint ?? 0,\n    number_of_poses: data.number_of_poses ?? 0,\n    distance_remaining: data.distance_remaining ?? 0.0\n  }),\n  definition: `# Follow a sequence of waypoints.\n# Goal\ngeometry_msgs/PoseStamped[] poses\n---\n# Result\nint32[] missed_waypoint_indices\n---\n# Feedback\nint32 current_waypoint\nint32 number_of_poses\nfloat32 distance_remaining`\n};\n\nmessageRegistry.registerAction('nav2_msgs/action/FollowWaypoints', FollowWaypoints);\n\nexport default { NavigateToPose, FollowWaypoints };\n","/**\n * Message Registry - Central registry for all ROS2 message, service, and action types\n *\n * This file imports all message modules (triggering self-registration) and re-exports\n * the registry methods for use by other parts of the codebase.\n */\n\n// Import all message modules to trigger registration\nimport './loader.js';\n\n// Import the registry\nimport { messageRegistry } from './registry.js';\n\n// Re-export individual modules for backward compatibility\nimport std_msgs from './std_msgs.js';\nimport geometry_msgs from './geometry_msgs.js';\nimport turtlesim_msgs from './turtlesim_msgs.js';\nimport turtlesim_srvs from './turtlesim_srvs.js';\nimport turtlesim_actions from './turtlesim_actions.js';\nimport tf2_msgs from './tf2_msgs.js';\nimport sensor_msgs from './sensor_msgs.js';\nimport nav_msgs from './nav_msgs.js';\n\n/**\n * Get a message type definition\n * @param {string} typeName - Full message type name (e.g., 'geometry_msgs/msg/Twist')\n * @returns {Object|null} Message definition or null if not found\n */\nexport function getMessage(typeName) {\n  return messageRegistry.getMessage(typeName);\n}\n\n/**\n * Get a service type definition\n * @param {string} typeName - Full service type name (e.g., 'turtlesim/srv/Spawn')\n * @returns {Object|null} Service definition or null if not found\n */\nexport function getService(typeName) {\n  return messageRegistry.getService(typeName);\n}\n\n/**\n * Get an action type definition\n * @param {string} typeName - Full action type name (e.g., 'turtlesim/action/RotateAbsolute')\n * @returns {Object|null} Action definition or null if not found\n */\nexport function getAction(typeName) {\n  return messageRegistry.getAction(typeName);\n}\n\n/**\n * Get any interface type (message, service, or action)\n * @param {string} typeName - Full type name\n * @returns {Object|null} Interface definition or null if not found\n */\nexport function getInterface(typeName) {\n  return messageRegistry.getInterface(typeName);\n}\n\n/**\n * List all available message types\n * @returns {string[]} Array of message type names\n */\nexport function listMessages() {\n  return messageRegistry.listMessages();\n}\n\n/**\n * List all available service types\n * @returns {string[]} Array of service type names\n */\nexport function listServices() {\n  return messageRegistry.listServices();\n}\n\n/**\n * List all available action types\n * @returns {string[]} Array of action type names\n */\nexport function listActions() {\n  return messageRegistry.listActions();\n}\n\n/**\n * Find message types matching a pattern\n * @param {string} pattern - Search pattern\n * @returns {string[]} Matching type names\n */\nexport function findMessages(pattern) {\n  return messageRegistry.findMessages(pattern);\n}\n\n/**\n * Find service types matching a pattern\n * @param {string} pattern - Search pattern\n * @returns {string[]} Matching type names\n */\nexport function findServices(pattern) {\n  return messageRegistry.findServices(pattern);\n}\n\n/**\n * Find action types matching a pattern\n * @param {string} pattern - Search pattern\n * @returns {string[]} Matching type names\n */\nexport function findActions(pattern) {\n  return messageRegistry.findActions(pattern);\n}\n\n/**\n * Validate a message against its type definition\n * @param {string} typeName - Message type name\n * @param {Object} message - Message to validate\n * @returns {{ valid: boolean, errors: string[] }}\n */\nexport function validateMessage(typeName, message) {\n  return messageRegistry.validateMessage(typeName, message);\n}\n\n/**\n * Create a message with default values\n * @param {string} typeName - Message type name\n * @param {Object} data - Optional partial data\n * @returns {Object|null} Created message or null if type not found\n */\nexport function createMessage(typeName, data = {}) {\n  return messageRegistry.createMessage(typeName, data);\n}\n\n/**\n * Get the definition string for a type (for ros2 interface show)\n * @param {string} typeName - Type name\n * @returns {string|null} Definition string or null if not found\n */\nexport function getDefinition(typeName) {\n  return messageRegistry.getDefinition(typeName);\n}\n\n// Export modules for direct access\nexport { std_msgs, geometry_msgs, turtlesim_msgs, turtlesim_srvs, turtlesim_actions, tf2_msgs, sensor_msgs, nav_msgs };\n\n// Export the registry for advanced use\nexport { messageRegistry };\n\n// Default export\nexport default {\n  getMessage,\n  getService,\n  getAction,\n  getInterface,\n  listMessages,\n  listServices,\n  listActions,\n  findMessages,\n  findServices,\n  findActions,\n  validateMessage,\n  createMessage,\n  getDefinition,\n  messageRegistry\n};\n","import { SimDDS } from '../core/SimDDS.js';\nimport { parseMessage, formatMessage } from './messageParser.js';\nimport { getMessage, findMessages } from '../msgs/index.js';\nimport { commandRegistry } from './commandRegistry.js';\nimport { formatQoS, parseQoSArgs } from '../utils/qos.js';\n\n/**\n * Handle ros2 topic commands\n */\nexport async function handleRos2Topic(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'list':\n      handleList(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'info':\n      handleInfo(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'type':\n      handleType(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'find':\n      handleFind(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'echo':\n      handleEcho(subArgs, terminal);\n      // Don't finish command - runs until Ctrl+C\n      break;\n\n    case 'pub':\n      await handlePub(subArgs, terminal);\n      break;\n\n    case 'hz':\n      handleHz(subArgs, terminal);\n      // Don't finish command - runs until Ctrl+C\n      break;\n\n    case 'bw':\n      handleBw(subArgs, terminal);\n      // Don't finish command - runs until Ctrl+C\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n      terminal.finishCommand();\n  }\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 topic <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  list    List all active topics');\n  terminal.writeln('  info    Show information about a topic');\n  terminal.writeln('  type    Show the type of a topic');\n  terminal.writeln('  find    Find topics by type');\n  terminal.writeln('  echo    Subscribe and print messages');\n  terminal.writeln('  pub     Publish a message to a topic');\n  terminal.writeln('  hz      Show message rate for a topic');\n  terminal.writeln('  bw      Show bandwidth for a topic');\n}\n\n/**\n * Handle ros2 topic list\n */\nfunction handleList(args, terminal) {\n  const showTypes = args.includes('-t') || args.includes('--show-types');\n  const topics = SimDDS.getTopics();\n\n  if (topics.length === 0) {\n    terminal.writeln('No topics are currently active.');\n    return;\n  }\n\n  for (const topic of topics.sort((a, b) => a.name.localeCompare(b.name))) {\n    if (showTypes) {\n      terminal.writeln(`${topic.name} [${topic.type}]`);\n    } else {\n      terminal.writeln(topic.name);\n    }\n  }\n}\n\n/**\n * Handle ros2 topic info <topic>\n */\nfunction handleInfo(args, terminal) {\n  const verbose = args.includes('--verbose') || args.includes('-v');\n  const topicName = args.find(a => !a.startsWith('-'));\n\n  if (!topicName) {\n    terminal.writeln('usage: ros2 topic info <topic_name> [--verbose]');\n    return;\n  }\n\n  const topicInfo = SimDDS.getTopicInfo(topicName);\n  if (!topicInfo) {\n    terminal.writeln(`\\x1b[31mTopic '${topicName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(`Type: ${topicInfo.type}`);\n  terminal.writeln(`Publisher count: ${topicInfo.publishers.length}`);\n  terminal.writeln(`Subscription count: ${topicInfo.subscribers.length}`);\n\n  if (verbose) {\n    terminal.writeln('');\n    terminal.writeln('Publishers:');\n    for (const pub of topicInfo.publishers) {\n      terminal.writeln(`  Node: ${pub.nodeId}`);\n      for (const line of formatQoS(pub.qos, '    ')) {\n        terminal.writeln(line);\n      }\n    }\n    terminal.writeln('');\n    terminal.writeln('Subscribers:');\n    for (const sub of topicInfo.subscribers) {\n      terminal.writeln(`  Node: ${sub.nodeId || '(anonymous)'}`);\n      for (const line of formatQoS(sub.qos, '    ')) {\n        terminal.writeln(line);\n      }\n    }\n  }\n}\n\n/**\n * Handle ros2 topic type <topic>\n */\nfunction handleType(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 topic type <topic_name>');\n    return;\n  }\n\n  const topicName = args[0];\n  const topicInfo = SimDDS.getTopicInfo(topicName);\n\n  if (!topicInfo) {\n    terminal.writeln(`\\x1b[31mTopic '${topicName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(topicInfo.type);\n}\n\n/**\n * Handle ros2 topic find <type>\n */\nfunction handleFind(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 topic find <msg_type>');\n    return;\n  }\n\n  const msgType = args[0];\n  const topics = SimDDS.getTopics();\n  const matching = topics.filter(t => t.type === msgType);\n\n  if (matching.length === 0) {\n    terminal.writeln(`No topics of type '${msgType}' found.`);\n    return;\n  }\n\n  for (const topic of matching) {\n    terminal.writeln(topic.name);\n  }\n}\n\n/**\n * Handle ros2 topic echo <topic>\n */\nfunction handleEcho(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 topic echo <topic_name> [--qos-*]');\n    terminal.finishCommand();\n    return;\n  }\n\n  // Parse QoS flags\n  const { qos, remaining, error } = parseQoSArgs(args);\n  if (error) {\n    terminal.writeln(`\\x1b[31m${error}\\x1b[0m`);\n    terminal.finishCommand();\n    return;\n  }\n\n  const topicName = remaining[0];\n  if (!topicName) {\n    terminal.writeln('usage: ros2 topic echo <topic_name> [--qos-*]');\n    terminal.finishCommand();\n    return;\n  }\n\n  let topicInfo = SimDDS.getTopicInfo(topicName);\n  let sub = null;\n  let pollInterval = null;\n\n  // Helper to subscribe with correct type\n  const subscribeToTopic = (type) => {\n    // Unsubscribe from previous subscription if any\n    if (sub) {\n      SimDDS.unsubscribe(sub);\n    }\n    sub = SimDDS.subscribe(topicName, type, (msg) => {\n      terminal.writeln('---');\n      terminal.writeln(formatMessage(msg));\n    }, qos);\n  };\n\n  if (!topicInfo) {\n    // Topic doesn't exist yet - show clear message and poll for availability\n    terminal.writeln(`\\x1b[33mTopic '${topicName}' does not exist yet.\\x1b[0m`);\n    terminal.writeln(`\\x1b[33mWill start echoing when a publisher creates it...\\x1b[0m`);\n\n    // Poll every second to check if topic becomes available\n    pollInterval = setInterval(() => {\n      const newTopicInfo = SimDDS.getTopicInfo(topicName);\n      if (newTopicInfo && newTopicInfo.type !== 'unknown') {\n        // Topic is now available - resubscribe with correct type\n        terminal.writeln(`\\x1b[32mTopic '${topicName}' is now available [${newTopicInfo.type}]\\x1b[0m`);\n        clearInterval(pollInterval);\n        pollInterval = null;\n        subscribeToTopic(newTopicInfo.type);\n      }\n    }, 1000);\n\n    // Subscribe with unknown type initially (won't receive messages)\n    subscribeToTopic('unknown');\n  } else {\n    // Topic exists - subscribe normally\n    subscribeToTopic(topicInfo.type);\n  }\n\n  // Store subscription for Ctrl+C cleanup\n  terminal.addSubscription({\n    destroy: () => {\n      if (pollInterval) {\n        clearInterval(pollInterval);\n      }\n      if (sub) {\n        SimDDS.unsubscribe(sub);\n      }\n    }\n  });\n}\n\n/**\n * Handle ros2 topic pub <topic> <type> \"<data>\"\n */\nasync function handlePub(args, terminal) {\n  // Parse QoS flags first\n  const { qos, remaining, error } = parseQoSArgs(args);\n  if (error) {\n    terminal.writeln(`\\x1b[31m${error}\\x1b[0m`);\n    terminal.finishCommand();\n    return;\n  }\n\n  // Parse remaining arguments\n  let once = false;\n  let rate = 1;\n  let waitCount = 0;\n  let topicName = null;\n  let msgType = null;\n  let msgData = null;\n\n  for (let i = 0; i < remaining.length; i++) {\n    const arg = remaining[i];\n\n    if (arg === '--once' || arg === '-1') {\n      once = true;\n    } else if (arg === '-r' || arg === '--rate') {\n      rate = parseFloat(remaining[++i]) || 1;\n    } else if (arg === '-w' || arg === '--wait') {\n      waitCount = parseInt(remaining[++i]) || 0;\n    } else if (!topicName) {\n      topicName = arg;\n    } else if (!msgType) {\n      msgType = arg;\n    } else if (!msgData) {\n      msgData = arg;\n    }\n  }\n\n  if (!topicName || !msgType) {\n    terminal.writeln('usage: ros2 topic pub [--once] [-r RATE] <topic> <msg_type> \"<data>\" [--qos-*]');\n    terminal.finishCommand();\n    return;\n  }\n\n  // Validate message type\n  const msgDef = getMessage(msgType);\n  if (!msgDef) {\n    terminal.writeln(`\\x1b[31mUnknown message type: ${msgType}\\x1b[0m`);\n    terminal.writeln('');\n    terminal.writeln('Available message types matching this pattern:');\n    const matches = findMessages(msgType.split('/').pop());\n    for (const match of matches.slice(0, 10)) {\n      terminal.writeln(`  ${match}`);\n    }\n    terminal.finishCommand();\n    return;\n  }\n\n  // Parse message data\n  const data = msgData ? parseMessage(msgData) : {};\n  const message = msgDef.create(data);\n\n  // Register a tracked publisher so QoS shows in topic info --verbose\n  const pubId = SimDDS.comm.advertise(topicName, msgType, '/_cli_pub', qos);\n\n  terminal.writeln(`publisher: beginning loop`);\n  terminal.writeln(`publishing #1: ${JSON.stringify(message)}`);\n\n  // Publish first message\n  SimDDS.publish(topicName, msgType, message);\n\n  if (once) {\n    SimDDS.comm.unadvertise(pubId);\n    terminal.finishCommand();\n    return;\n  }\n\n  // Set up repeating publish\n  let count = 1;\n  const interval = setInterval(() => {\n    count++;\n    terminal.writeln(`publishing #${count}: ${JSON.stringify(message)}`);\n    SimDDS.publish(topicName, msgType, message);\n  }, 1000 / rate);\n\n  // Store for Ctrl+C cleanup\n  terminal.addSubscription({\n    destroy: () => {\n      clearInterval(interval);\n      SimDDS.comm.unadvertise(pubId);\n    }\n  });\n}\n\n/**\n * Handle ros2 topic hz <topic>\n */\nfunction handleHz(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 topic hz <topic_name>');\n    terminal.finishCommand();\n    return;\n  }\n\n  const topicName = args[0];\n  const topicInfo = SimDDS.getTopicInfo(topicName);\n\n  if (!topicInfo) {\n    terminal.writeln(`\\x1b[33mWaiting for topic '${topicName}'...\\x1b[0m`);\n  }\n\n  const timestamps = [];\n  const windowSize = 100;\n\n  const sub = SimDDS.subscribe(topicName, topicInfo?.type || 'unknown', () => {\n    const now = Date.now();\n    timestamps.push(now);\n\n    // Keep only recent timestamps\n    while (timestamps.length > windowSize) {\n      timestamps.shift();\n    }\n\n    if (timestamps.length >= 2) {\n      const duration = Math.max((timestamps[timestamps.length - 1] - timestamps[0]) / 1000, 0.001);\n      const rate = (timestamps.length - 1) / duration;\n      const avgPeriod = duration / (timestamps.length - 1);\n\n      terminal.writeln(`average rate: ${rate.toFixed(3)}`);\n      terminal.writeln(`  min: ${(avgPeriod * 0.9).toFixed(3)}s max: ${(avgPeriod * 1.1).toFixed(3)}s std dev: ${(avgPeriod * 0.05).toFixed(5)}s window: ${timestamps.length}`);\n    }\n  });\n\n  terminal.addSubscription({\n    destroy: () => SimDDS.unsubscribe(sub)\n  });\n}\n\n/**\n * Format byte count for display (matches ROS 2 CLI format)\n */\nfunction formatBytes(bytes) {\n  if (bytes >= 1000000) {\n    return `${(bytes / 1000000).toFixed(2)} MB`;\n  } else if (bytes >= 1000) {\n    return `${(bytes / 1000).toFixed(2)} KB`;\n  }\n  return `${Math.round(bytes)} B`;\n}\n\n/**\n * Handle ros2 topic bw <topic>\n */\nfunction handleBw(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 topic bw <topic_name>');\n    terminal.finishCommand();\n    return;\n  }\n\n  const topicName = args[0];\n  const topicInfo = SimDDS.getTopicInfo(topicName);\n\n  if (!topicInfo) {\n    terminal.writeln(`\\x1b[33mWaiting for topic '${topicName}'...\\x1b[0m`);\n  }\n\n  const samples = [];\n  const windowSize = 100;\n  let subscribedPrinted = false;\n\n  const sub = SimDDS.subscribe(topicName, topicInfo?.type || 'unknown', (msg) => {\n    const now = Date.now();\n    const size = JSON.stringify(msg).length;\n    samples.push({ time: now, size });\n\n    while (samples.length > windowSize) {\n      samples.shift();\n    }\n\n    if (!subscribedPrinted) {\n      terminal.writeln(`Subscribed to [${topicName}]`);\n      subscribedPrinted = true;\n    }\n\n    if (samples.length >= 2) {\n      const duration = Math.max((samples[samples.length - 1].time - samples[0].time) / 1000, 0.001);\n      const totalBytes = samples.reduce((sum, s) => sum + s.size, 0);\n      const bw = totalBytes / duration;\n      const meanSize = totalBytes / samples.length;\n      const minSize = Math.min(...samples.map(s => s.size));\n      const maxSize = Math.max(...samples.map(s => s.size));\n\n      terminal.writeln(`${formatBytes(bw)}/s from ${samples.length} messages`);\n      terminal.writeln(`  Message size mean: ${formatBytes(meanSize)} min: ${formatBytes(minSize)} max: ${formatBytes(maxSize)}`);\n    }\n  });\n\n  terminal.addSubscription({\n    destroy: () => SimDDS.unsubscribe(sub)\n  });\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('topic', handleRos2Topic);\n\nexport default { handleRos2Topic };\n","import { SimDDS } from '../core/SimDDS.js';\nimport { parseMessage, formatMessage } from './messageParser.js';\nimport { getService, findServices } from '../msgs/index.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 service commands\n */\nexport async function handleRos2Service(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'list':\n      handleList(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'type':\n      handleType(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'info':\n      handleInfo(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'find':\n      handleFind(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'call':\n      await handleCall(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'echo':\n      handleEcho(subArgs, terminal);\n      // Don't finish - runs until Ctrl+C\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n      terminal.finishCommand();\n  }\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 service <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  list    List all active services');\n  terminal.writeln('  type    Show the type of a service');\n  terminal.writeln('  info    Show information about a service');\n  terminal.writeln('  find    Find services by type');\n  terminal.writeln('  call    Call a service');\n  terminal.writeln('  echo    Echo service calls');\n}\n\n/**\n * Handle ros2 service list\n */\nfunction handleList(args, terminal) {\n  const showTypes = args.includes('-t') || args.includes('--show-types');\n  const services = SimDDS.getServices();\n\n  if (services.length === 0) {\n    terminal.writeln('No services are currently available.');\n    return;\n  }\n\n  for (const srv of services.sort((a, b) => a.name.localeCompare(b.name))) {\n    if (showTypes) {\n      terminal.writeln(`${srv.name} [${srv.type}]`);\n    } else {\n      terminal.writeln(srv.name);\n    }\n  }\n}\n\n/**\n * Handle ros2 service type <service>\n */\nfunction handleType(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 service type <service_name>');\n    return;\n  }\n\n  const serviceName = args[0];\n  const serviceInfo = SimDDS.getServiceInfo(serviceName);\n\n  if (!serviceInfo) {\n    terminal.writeln(`\\x1b[31mService '${serviceName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(serviceInfo.type);\n}\n\n/**\n * Handle ros2 service info <service>\n */\nfunction handleInfo(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 service info <service_name>');\n    return;\n  }\n\n  const serviceName = args[0];\n  const serviceInfo = SimDDS.getServiceInfo(serviceName);\n\n  if (!serviceInfo) {\n    terminal.writeln(`\\x1b[31mService '${serviceName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(`Type: ${serviceInfo.type}`);\n  terminal.writeln(`Node: ${serviceInfo.node}`);\n}\n\n/**\n * Handle ros2 service find <type>\n */\nfunction handleFind(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 service find <srv_type>');\n    return;\n  }\n\n  const srvType = args[0];\n  const services = SimDDS.getServices();\n  const matching = services.filter(s => s.type === srvType);\n\n  if (matching.length === 0) {\n    terminal.writeln(`No services of type '${srvType}' found.`);\n    return;\n  }\n\n  for (const srv of matching) {\n    terminal.writeln(srv.name);\n  }\n}\n\n/**\n * Handle ros2 service call <service> <type> \"<data>\"\n */\nasync function handleCall(args, terminal) {\n  // Parse arguments\n  let serviceName = null;\n  let srvType = null;\n  let reqData = null;\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n\n    if (!serviceName) {\n      serviceName = arg;\n    } else if (!srvType) {\n      srvType = arg;\n    } else if (!reqData) {\n      reqData = arg;\n    }\n  }\n\n  if (!serviceName || !srvType) {\n    terminal.writeln('usage: ros2 service call <service_name> <srv_type> \"<request_data>\"');\n    return;\n  }\n\n  // Validate service type\n  const srvDef = getService(srvType);\n  if (!srvDef) {\n    terminal.writeln(`\\x1b[31mUnknown service type: ${srvType}\\x1b[0m`);\n    terminal.writeln('');\n    terminal.writeln('Available service types:');\n    const matches = findServices(srvType.split('/').pop());\n    for (const match of matches.slice(0, 10)) {\n      terminal.writeln(`  ${match}`);\n    }\n    return;\n  }\n\n  // Check if service exists\n  const serviceInfo = SimDDS.getServiceInfo(serviceName);\n  if (!serviceInfo) {\n    terminal.writeln(`\\x1b[31mService '${serviceName}' not available\\x1b[0m`);\n    return;\n  }\n\n  // Parse request data\n  const data = reqData ? parseMessage(reqData) : {};\n  const request = srvDef.createRequest(data);\n\n  terminal.writeln(`requester: making request: ${serviceName}`);\n  terminal.writeln('');\n\n  try {\n    const response = await SimDDS.callService(serviceName, srvType, request);\n    terminal.writeln('response:');\n    terminal.writeln(formatMessage(response));\n  } catch (err) {\n    terminal.writeln(`\\x1b[31mService call failed: ${err.message}\\x1b[0m`);\n  }\n}\n\n/**\n * Handle ros2 service echo <service>\n */\nfunction handleEcho(args, terminal) {\n  // Service echo is not fully implemented in this simulation\n  // Would require intercepting service calls\n  terminal.writeln('\\x1b[33mService echo is not fully supported in this simulation.\\x1b[0m');\n  terminal.finishCommand();\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('service', handleRos2Service);\n\nexport default { handleRos2Service };\n","import { SimDDS } from '../core/SimDDS.js';\nimport { parseMessage, formatMessage } from './messageParser.js';\nimport { getAction, findActions } from '../msgs/index.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 action commands\n */\nexport async function handleRos2Action(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'list':\n      handleList(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'type':\n      handleType(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'info':\n      handleInfo(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'send_goal':\n      await handleSendGoal(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n      terminal.finishCommand();\n  }\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 action <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  list       List all action servers');\n  terminal.writeln('  type       Show the type of an action');\n  terminal.writeln('  info       Show information about an action');\n  terminal.writeln('  send_goal  Send a goal to an action server');\n}\n\n/**\n * Handle ros2 action list\n */\nfunction handleList(args, terminal) {\n  const showTypes = args.includes('-t') || args.includes('--show-types');\n  const actions = SimDDS.getActions();\n\n  if (actions.length === 0) {\n    terminal.writeln('No action servers are currently available.');\n    return;\n  }\n\n  for (const action of actions.sort((a, b) => a.name.localeCompare(b.name))) {\n    if (showTypes) {\n      terminal.writeln(`${action.name} [${action.type}]`);\n    } else {\n      terminal.writeln(action.name);\n    }\n  }\n}\n\n/**\n * Handle ros2 action type <action>\n */\nfunction handleType(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 action type <action_name>');\n    return;\n  }\n\n  const actionName = args[0];\n  const actionInfo = SimDDS.getActionInfo(actionName);\n\n  if (!actionInfo) {\n    terminal.writeln(`\\x1b[31mAction '${actionName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(actionInfo.type);\n}\n\n/**\n * Handle ros2 action info <action>\n */\nfunction handleInfo(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 action info <action_name>');\n    return;\n  }\n\n  const actionName = args[0];\n  const actionInfo = SimDDS.getActionInfo(actionName);\n\n  if (!actionInfo) {\n    terminal.writeln(`\\x1b[31mAction '${actionName}' not found\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(`Action: ${actionName}`);\n  terminal.writeln('Action clients: 0');\n  terminal.writeln('Action servers: 1');\n  terminal.writeln(`    ${actionInfo.node}`);\n}\n\n/**\n * Handle ros2 action send_goal <action> <type> \"<goal>\" [--feedback]\n */\nasync function handleSendGoal(args, terminal) {\n  // Parse arguments\n  let actionName = null;\n  let actionType = null;\n  let goalData = null;\n  let showFeedback = false;\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n\n    if (arg === '--feedback' || arg === '-f') {\n      showFeedback = true;\n    } else if (!actionName) {\n      actionName = arg;\n    } else if (!actionType) {\n      actionType = arg;\n    } else if (!goalData) {\n      goalData = arg;\n    }\n  }\n\n  if (!actionName || !actionType) {\n    terminal.writeln('usage: ros2 action send_goal <action_name> <action_type> \"<goal>\" [--feedback]');\n    return;\n  }\n\n  // Validate action type\n  const actionDef = getAction(actionType);\n  if (!actionDef) {\n    terminal.writeln(`\\x1b[31mUnknown action type: ${actionType}\\x1b[0m`);\n    terminal.writeln('');\n    terminal.writeln('Available action types:');\n    const matches = findActions(actionType.split('/').pop());\n    for (const match of matches.slice(0, 10)) {\n      terminal.writeln(`  ${match}`);\n    }\n    return;\n  }\n\n  // Check if action exists\n  const actionInfo = SimDDS.getActionInfo(actionName);\n  if (!actionInfo) {\n    terminal.writeln(`\\x1b[31mAction '${actionName}' not available\\x1b[0m`);\n    return;\n  }\n\n  // Parse goal data\n  const data = goalData ? parseMessage(goalData) : {};\n  const goal = actionDef.createGoal(data);\n\n  terminal.writeln('Waiting for an action server to become available...');\n  terminal.writeln('Sending goal:');\n  terminal.writeln(formatMessage(goal));\n  terminal.writeln('');\n\n  try {\n    let feedbackCallback = null;\n    if (showFeedback) {\n      feedbackCallback = (feedback) => {\n        terminal.writeln('Feedback:');\n        terminal.writeln(formatMessage(feedback));\n        terminal.writeln('');\n      };\n    }\n\n    terminal.writeln('Goal accepted with ID: goal_1');\n    terminal.writeln('');\n\n    const result = await SimDDS.sendActionGoal(actionName, actionType, goal, feedbackCallback);\n\n    terminal.writeln('Result:');\n    terminal.writeln(formatMessage(result));\n    terminal.writeln('');\n    terminal.writeln('Goal finished with status: SUCCEEDED');\n  } catch (err) {\n    terminal.writeln(`\\x1b[31mAction failed: ${err.message}\\x1b[0m`);\n  }\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('action', handleRos2Action);\n\nexport default { handleRos2Action };\n","import { SimDDS } from '../core/SimDDS.js';\nimport { ProcessManager } from '../core/ProcessManager.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 param commands\n */\nexport async function handleRos2Param(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'list':\n      handleList(subArgs, terminal);\n      break;\n\n    case 'get':\n      handleGet(subArgs, terminal);\n      break;\n\n    case 'set':\n      handleSet(subArgs, terminal);\n      break;\n\n    case 'dump':\n      handleDump(subArgs, terminal);\n      break;\n\n    case 'load':\n      handleLoad(subArgs, terminal);\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n  }\n\n  terminal.finishCommand();\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 param <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  list    List all parameters');\n  terminal.writeln('  get     Get a parameter value');\n  terminal.writeln('  set     Set a parameter value');\n  terminal.writeln('  dump    Dump all parameters for a node');\n  terminal.writeln('  load    Load parameters from a file (not supported in sim)');\n}\n\n/**\n * Get node from args, normalizing the name\n */\nfunction getNodeName(name) {\n  if (!name) return null;\n  return name.startsWith('/') ? name : '/' + name;\n}\n\n/**\n * Get node process\n */\nfunction getNodeProcess(nodeName) {\n  return ProcessManager.getProcessByNodeName(nodeName);\n}\n\n/**\n * Handle ros2 param list [node_name]\n */\nfunction handleList(args, terminal) {\n  const nodeName = args.length > 0 ? getNodeName(args[0]) : null;\n\n  if (nodeName) {\n    // List parameters for specific node\n    const proc = getNodeProcess(nodeName);\n    if (!proc) {\n      terminal.writeln(`\\x1b[31mNode '${nodeName}' not found\\x1b[0m`);\n      return;\n    }\n\n    const params = proc.node.getParameterNames();\n    if (params.length === 0) {\n      terminal.writeln('No parameters.');\n      return;\n    }\n\n    terminal.writeln(`${nodeName}:`);\n    for (const param of params.sort()) {\n      terminal.writeln(`  ${param}`);\n    }\n  } else {\n    // List all nodes with parameters\n    const nodes = SimDDS.getNodes();\n\n    for (const nodeId of nodes.sort()) {\n      const proc = getNodeProcess(nodeId);\n      if (proc && proc.node) {\n        const params = proc.node.getParameterNames();\n        if (params.length > 0) {\n          terminal.writeln(`${nodeId}:`);\n          for (const param of params.sort()) {\n            terminal.writeln(`  ${param}`);\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * Handle ros2 param get <node> <param>\n */\nfunction handleGet(args, terminal) {\n  if (args.length < 2) {\n    terminal.writeln('usage: ros2 param get <node_name> <parameter_name>');\n    return;\n  }\n\n  const nodeName = getNodeName(args[0]);\n  const paramName = args[1];\n\n  const proc = getNodeProcess(nodeName);\n  if (!proc) {\n    terminal.writeln(`\\x1b[31mNode '${nodeName}' not found\\x1b[0m`);\n    return;\n  }\n\n  const value = proc.node.getParameter(paramName);\n  if (value === undefined) {\n    terminal.writeln(`\\x1b[31mParameter '${paramName}' not found on node '${nodeName}'\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(`${getTypeLabel(value)} ${formatValue(value)}`);\n}\n\n/**\n * Handle ros2 param set <node> <param> <value>\n */\nfunction handleSet(args, terminal) {\n  if (args.length < 3) {\n    terminal.writeln('usage: ros2 param set <node_name> <parameter_name> <value>');\n    return;\n  }\n\n  const nodeName = getNodeName(args[0]);\n  const paramName = args[1];\n  const valueStr = args.slice(2).join(' ');\n\n  const proc = getNodeProcess(nodeName);\n  if (!proc) {\n    terminal.writeln(`\\x1b[31mNode '${nodeName}' not found\\x1b[0m`);\n    return;\n  }\n\n  // Parse value\n  const value = parseValue(valueStr);\n\n  // Try to set with validation feedback\n  const result = proc.node.setParameters({ [paramName]: value });\n  if (!result.successful) {\n    terminal.writeln(`\\x1b[31m${result.reason}\\x1b[0m`);\n    return;\n  }\n\n  terminal.writeln(`Set parameter '${paramName}' to: ${formatValue(value)}`);\n}\n\n/**\n * Handle ros2 param dump <node>\n */\nfunction handleDump(args, terminal) {\n  if (args.length < 1) {\n    terminal.writeln('usage: ros2 param dump <node_name>');\n    return;\n  }\n\n  const nodeName = getNodeName(args[0]);\n\n  const proc = getNodeProcess(nodeName);\n  if (!proc) {\n    terminal.writeln(`\\x1b[31mNode '${nodeName}' not found\\x1b[0m`);\n    return;\n  }\n\n  const params = proc.node.getParameterNames();\n  if (params.length === 0) {\n    terminal.writeln('No parameters.');\n    return;\n  }\n\n  terminal.writeln(`${nodeName}:`);\n  terminal.writeln('  ros__parameters:');\n  for (const param of params.sort()) {\n    const value = proc.node.getParameter(param);\n    terminal.writeln(`    ${param}: ${formatValue(value)}`);\n  }\n}\n\n/**\n * Handle ros2 param load <node> <file>\n */\nfunction handleLoad(args, terminal) {\n  terminal.writeln('\\x1b[33mParameter file loading is not supported in this simulation.\\x1b[0m');\n  terminal.writeln('Use ros2 param set to set individual parameters.');\n}\n\n/**\n * Get the type label for a parameter value (matches ROS 2 CLI format)\n */\nfunction getTypeLabel(value) {\n  if (typeof value === 'boolean') return 'Boolean value is:';\n  if (typeof value === 'number') {\n    return Number.isInteger(value) ? 'Integer value is:' : 'Double value is:';\n  }\n  if (typeof value === 'string') return 'String value is:';\n  if (Array.isArray(value)) {\n    if (value.length === 0) return 'String values are:';\n    const first = value[0];\n    if (typeof first === 'boolean') return 'Boolean values are:';\n    if (typeof first === 'number') {\n      return Number.isInteger(first) ? 'Integer values are:' : 'Double values are:';\n    }\n    return 'String values are:';\n  }\n  return 'String value is:';\n}\n\n/**\n * Parse a value string\n */\nfunction parseValue(str) {\n  // Boolean\n  if (str === 'true') return true;\n  if (str === 'false') return false;\n\n  // Number\n  const num = Number(str);\n  if (!isNaN(num)) return num;\n\n  // String (remove quotes if present)\n  if ((str.startsWith('\"') && str.endsWith('\"')) ||\n      (str.startsWith(\"'\") && str.endsWith(\"'\"))) {\n    return str.slice(1, -1);\n  }\n\n  return str;\n}\n\n/**\n * Format a value for display\n */\nfunction formatValue(value) {\n  if (typeof value === 'string') {\n    return `\"${value}\"`;\n  }\n  if (typeof value === 'boolean') {\n    return value ? 'true' : 'false';\n  }\n  if (typeof value === 'number') {\n    return Number.isInteger(value) ? value.toString() : value.toFixed(6);\n  }\n  if (Array.isArray(value)) {\n    return `[${value.map(formatValue).join(', ')}]`;\n  }\n  return String(value);\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('param', handleRos2Param);\n\nexport default { handleRos2Param };\n","import { SimDDS } from './SimDDS.js';\n\n/**\n * BagRecorder - Records topic messages with timestamps\n */\nexport class BagRecorder {\n  constructor(name, topics = []) {\n    this.name = name;\n    this.topics = topics;\n    this.messages = [];\n    this.subscriptions = [];\n    this.recording = false;\n    this.startTime = null;\n    this.endTime = null;\n  }\n\n  /**\n   * Start recording\n   */\n  start() {\n    if (this.recording) return;\n\n    this.recording = true;\n    this.startTime = Date.now();\n    this.messages = [];\n\n    // Subscribe to all topics\n    for (const topic of this.topics) {\n      const topicInfo = SimDDS.getTopicInfo(topic);\n      if (topicInfo) {\n        const subId = SimDDS.subscribe(topic, topicInfo.type, (msg) => {\n          if (this.recording) {\n            this.messages.push({\n              topic,\n              type: topicInfo.type,\n              timestamp: Date.now() - this.startTime,\n              message: { ...msg }\n            });\n          }\n        });\n        this.subscriptions.push(subId);\n      }\n    }\n  }\n\n  /**\n   * Stop recording\n   */\n  stop() {\n    if (!this.recording) return;\n\n    this.recording = false;\n    this.endTime = Date.now();\n\n    // Unsubscribe from all topics\n    for (const subId of this.subscriptions) {\n      SimDDS.unsubscribe(subId);\n    }\n    this.subscriptions = [];\n  }\n\n  /**\n   * Get recording info\n   */\n  getInfo() {\n    const topicCounts = {};\n    for (const msg of this.messages) {\n      topicCounts[msg.topic] = (topicCounts[msg.topic] || 0) + 1;\n    }\n\n    return {\n      name: this.name,\n      duration: this.endTime ? (this.endTime - this.startTime) / 1000 : null,\n      startTime: this.startTime,\n      endTime: this.endTime,\n      messageCount: this.messages.length,\n      topics: this.topics,\n      topicCounts\n    };\n  }\n\n  /**\n   * Get all recorded messages\n   */\n  getMessages() {\n    return this.messages;\n  }\n\n  /**\n   * Export to JSON\n   */\n  toJSON() {\n    return {\n      name: this.name,\n      startTime: this.startTime,\n      endTime: this.endTime,\n      topics: this.topics,\n      messages: this.messages\n    };\n  }\n\n  /**\n   * Import from JSON\n   */\n  static fromJSON(data) {\n    const recorder = new BagRecorder(data.name, data.topics);\n    recorder.startTime = data.startTime;\n    recorder.endTime = data.endTime;\n    recorder.messages = data.messages;\n    return recorder;\n  }\n\n  /**\n   * Save to localStorage\n   */\n  saveToStorage() {\n    try {\n      const key = `ros2bag_${this.name}`;\n      localStorage.setItem(key, JSON.stringify(this.toJSON()));\n      return true;\n    } catch (e) {\n      console.error('Failed to save bag to localStorage:', e);\n      return false;\n    }\n  }\n\n  /**\n   * Load from localStorage\n   */\n  static loadFromStorage(name) {\n    try {\n      const key = `ros2bag_${name}`;\n      const data = localStorage.getItem(key);\n      if (data) {\n        return BagRecorder.fromJSON(JSON.parse(data));\n      }\n    } catch (e) {\n      console.error('Failed to load bag from localStorage:', e);\n    }\n    return null;\n  }\n\n  /**\n   * List all bags in localStorage\n   */\n  static listStoredBags() {\n    const bags = [];\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key.startsWith('ros2bag_')) {\n        bags.push(key.substring(8));\n      }\n    }\n    return bags;\n  }\n\n  /**\n   * Delete a bag from localStorage\n   */\n  static deleteFromStorage(name) {\n    const key = `ros2bag_${name}`;\n    localStorage.removeItem(key);\n  }\n}\n\n/**\n * BagStorage - Manages in-memory bag storage\n */\nclass BagStorageClass {\n  constructor() {\n    this.bags = new Map();\n  }\n\n  /**\n   * Store a bag\n   */\n  store(recorder) {\n    this.bags.set(recorder.name, recorder);\n  }\n\n  /**\n   * Get a bag by name\n   */\n  get(name) {\n    // Check in-memory first\n    if (this.bags.has(name)) {\n      return this.bags.get(name);\n    }\n    // Try localStorage\n    return BagRecorder.loadFromStorage(name);\n  }\n\n  /**\n   * List all bags\n   */\n  list() {\n    const memoryBags = Array.from(this.bags.keys());\n    const storageBags = BagRecorder.listStoredBags();\n    return [...new Set([...memoryBags, ...storageBags])];\n  }\n\n  /**\n   * Delete a bag\n   */\n  delete(name) {\n    this.bags.delete(name);\n    BagRecorder.deleteFromStorage(name);\n  }\n}\n\nexport const BagStorage = new BagStorageClass();\n","import { SimDDS } from './SimDDS.js';\n\n/**\n * BagPlayer - Plays back recorded bag messages\n */\nexport class BagPlayer {\n  constructor(recorder) {\n    this.recorder = recorder;\n    this.messages = recorder.getMessages();\n    this.playing = false;\n    this.paused = false;\n    this.rate = 1.0;\n    this.currentIndex = 0;\n    this.playStartTime = null;\n    this.pauseTime = null;\n    this.timeouts = [];\n    this.onComplete = null;\n    this.onMessage = null;\n    // Playback ID to guard against stale timeout callbacks after stop/rate change\n    this.playbackId = 0;\n  }\n\n  /**\n   * Start playback\n   * @param {number} rate - Playback rate (1.0 = normal, 2.0 = 2x speed)\n   */\n  play(rate = 1.0) {\n    if (this.playing) return;\n\n    this.rate = rate;\n    this.playing = true;\n    this.paused = false;\n    this.currentIndex = 0;\n    this.playStartTime = Date.now();\n    // Increment playbackId to invalidate any stale callbacks\n    this.playbackId++;\n\n    this._scheduleMessages();\n  }\n\n  /**\n   * Schedule all messages for playback\n   */\n  _scheduleMessages() {\n    // Clear any existing timeouts\n    this._clearTimeouts();\n\n    // Capture current playbackId to guard against stale callbacks\n    const currentPlaybackId = this.playbackId;\n\n    for (let i = this.currentIndex; i < this.messages.length; i++) {\n      const msg = this.messages[i];\n      const delay = msg.timestamp / this.rate;\n\n      const timeout = setTimeout(() => {\n        // Guard: ignore callback if playbackId changed (stop/rate change occurred)\n        if (currentPlaybackId !== this.playbackId) return;\n\n        if (this.playing && !this.paused) {\n          this._publishMessage(msg);\n          this.currentIndex = i + 1;\n\n          // Check if playback complete\n          if (this.currentIndex >= this.messages.length) {\n            this.stop();\n            if (this.onComplete) {\n              this.onComplete();\n            }\n          }\n        }\n      }, delay);\n\n      this.timeouts.push(timeout);\n    }\n  }\n\n  /**\n   * Publish a single message\n   */\n  _publishMessage(msg) {\n    SimDDS.publish(msg.topic, msg.type, msg.message);\n    if (this.onMessage) {\n      this.onMessage(msg);\n    }\n  }\n\n  /**\n   * Clear all scheduled timeouts\n   */\n  _clearTimeouts() {\n    for (const timeout of this.timeouts) {\n      clearTimeout(timeout);\n    }\n    this.timeouts = [];\n  }\n\n  /**\n   * Pause playback\n   */\n  pause() {\n    if (!this.playing || this.paused) return;\n\n    this.paused = true;\n    this.pauseTime = Date.now();\n    this._clearTimeouts();\n  }\n\n  /**\n   * Resume playback\n   */\n  resume() {\n    if (!this.playing || !this.paused) return;\n\n    this.paused = false;\n    const pauseDuration = Date.now() - this.pauseTime;\n    this.playStartTime += pauseDuration;\n\n    // Reschedule remaining messages\n    this._scheduleRemainingMessages();\n  }\n\n  /**\n   * Schedule remaining messages after resume\n   */\n  _scheduleRemainingMessages() {\n    const elapsed = (Date.now() - this.playStartTime) * this.rate;\n\n    // Capture current playbackId to guard against stale callbacks\n    const currentPlaybackId = this.playbackId;\n\n    for (let i = this.currentIndex; i < this.messages.length; i++) {\n      const msg = this.messages[i];\n      const delay = Math.max(0, (msg.timestamp - elapsed) / this.rate);\n\n      const timeout = setTimeout(() => {\n        // Guard: ignore callback if playbackId changed (stop/rate change occurred)\n        if (currentPlaybackId !== this.playbackId) return;\n\n        if (this.playing && !this.paused) {\n          this._publishMessage(msg);\n          this.currentIndex = i + 1;\n\n          if (this.currentIndex >= this.messages.length) {\n            this.stop();\n            if (this.onComplete) {\n              this.onComplete();\n            }\n          }\n        }\n      }, delay);\n\n      this.timeouts.push(timeout);\n    }\n  }\n\n  /**\n   * Stop playback\n   */\n  stop() {\n    // Clear timeouts BEFORE state changes to prevent race conditions\n    this._clearTimeouts();\n    // Increment playbackId to invalidate any in-flight callbacks\n    this.playbackId++;\n    this.playing = false;\n    this.paused = false;\n  }\n\n  /**\n   * Change playback rate\n   */\n  setRate(rate) {\n    if (this.playing && !this.paused) {\n      // Clear timeouts and increment playbackId BEFORE rate change to prevent race conditions\n      this._clearTimeouts();\n      this.playbackId++;\n      // Recalculate timing for remaining messages\n      this.paused = true;\n      this.pauseTime = Date.now();\n      this.rate = rate;\n      this.resume();\n    } else {\n      this.rate = rate;\n    }\n  }\n\n  /**\n   * Get playback status\n   */\n  getStatus() {\n    return {\n      playing: this.playing,\n      paused: this.paused,\n      rate: this.rate,\n      progress: this.currentIndex / this.messages.length,\n      currentIndex: this.currentIndex,\n      totalMessages: this.messages.length\n    };\n  }\n}\n","import { SimDDS } from '../core/SimDDS.js';\nimport { BagRecorder, BagStorage } from '../core/BagRecorder.js';\nimport { BagPlayer } from '../core/BagPlayer.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 bag commands\n */\nexport async function handleRos2Bag(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'record':\n      handleRecord(subArgs, terminal);\n      // Don't finish - runs until Ctrl+C\n      break;\n\n    case 'play':\n      await handlePlay(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    case 'info':\n      handleInfo(subArgs, terminal);\n      terminal.finishCommand();\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n      terminal.finishCommand();\n  }\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 bag <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  record  Record topics to a bag');\n  terminal.writeln('  play    Play back a recorded bag');\n  terminal.writeln('  info    Show information about a bag');\n}\n\n/**\n * Handle ros2 bag record [-a] [-o name] <topics...>\n */\nfunction handleRecord(args, terminal) {\n  let recordAll = false;\n  let bagName = `rosbag2_${Date.now()}`;\n  const topics = [];\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n\n    if (arg === '-a' || arg === '--all') {\n      recordAll = true;\n    } else if (arg === '-o' || arg === '--output') {\n      if (i + 1 < args.length) {\n        bagName = args[++i];\n      }\n    } else if (!arg.startsWith('-')) {\n      topics.push(arg);\n    }\n  }\n\n  // Get topics to record\n  let topicsToRecord = topics;\n\n  if (recordAll) {\n    topicsToRecord = SimDDS.getTopics().map(t => t.name);\n    if (topicsToRecord.length === 0) {\n      terminal.writeln('\\x1b[33mNo topics available to record.\\x1b[0m');\n      terminal.finishCommand();\n      return;\n    }\n  }\n\n  if (topicsToRecord.length === 0) {\n    terminal.writeln('usage: ros2 bag record [-a] [-o <bag_name>] <topic1> <topic2> ...');\n    terminal.finishCommand();\n    return;\n  }\n\n  // Create and start recorder\n  const recorder = new BagRecorder(bagName, topicsToRecord);\n  recorder.start();\n\n  terminal.writeln(`\\x1b[32m[INFO] Recording to '${bagName}'\\x1b[0m`);\n  terminal.writeln('Topics:');\n  for (const topic of topicsToRecord) {\n    terminal.writeln(`  ${topic}`);\n  }\n  terminal.writeln('');\n  terminal.writeln('Press Ctrl+C to stop recording...');\n\n  // Store recorder for Ctrl+C cleanup\n  terminal.addBagRecorder({\n    stop: () => {\n      recorder.stop();\n      BagStorage.store(recorder);\n\n      const info = recorder.getInfo();\n      terminal.writeln('');\n      terminal.writeln(`\\x1b[32m[INFO] Stopped recording.\\x1b[0m`);\n      terminal.writeln(`Bag: ${bagName}`);\n      terminal.writeln(`Duration: ${info.duration?.toFixed(2) || 0}s`);\n      terminal.writeln(`Messages: ${info.messageCount}`);\n    }\n  });\n}\n\n/**\n * Handle ros2 bag play <bag_name> [--rate N]\n */\nasync function handlePlay(args, terminal) {\n  let bagName = null;\n  let rate = 1.0;\n\n  for (let i = 0; i < args.length; i++) {\n    const arg = args[i];\n\n    if (arg === '--rate' || arg === '-r') {\n      if (i + 1 < args.length) {\n        rate = parseFloat(args[++i]) || 1.0;\n      }\n    } else if (!arg.startsWith('-')) {\n      bagName = arg;\n    }\n  }\n\n  if (!bagName) {\n    terminal.writeln('usage: ros2 bag play <bag_name> [--rate N]');\n    terminal.writeln('');\n    terminal.writeln('Available bags:');\n    const bags = BagStorage.list();\n    for (const name of bags) {\n      terminal.writeln(`  ${name}`);\n    }\n    return;\n  }\n\n  // Load bag\n  const recorder = BagStorage.get(bagName);\n  if (!recorder) {\n    terminal.writeln(`\\x1b[31mBag '${bagName}' not found.\\x1b[0m`);\n    terminal.writeln('');\n    terminal.writeln('Available bags:');\n    const bags = BagStorage.list();\n    for (const name of bags) {\n      terminal.writeln(`  ${name}`);\n    }\n    return;\n  }\n\n  const info = recorder.getInfo();\n  terminal.writeln(`\\x1b[32m[INFO] Playing bag '${bagName}'\\x1b[0m`);\n  terminal.writeln(`Duration: ${info.duration?.toFixed(2) || 0}s`);\n  terminal.writeln(`Rate: ${rate}x`);\n  terminal.writeln('');\n\n  // Play bag\n  const player = new BagPlayer(recorder);\n\n  return new Promise((resolve) => {\n    player.onComplete = () => {\n      terminal.writeln('');\n      terminal.writeln('\\x1b[32m[INFO] Playback complete.\\x1b[0m');\n      resolve();\n    };\n\n    player.onMessage = (msg) => {\n      // Optionally show messages being played\n      // terminal.writeln(`Playing: ${msg.topic}`);\n    };\n\n    player.play(rate);\n  });\n}\n\n/**\n * Handle ros2 bag info <bag_name>\n */\nfunction handleInfo(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 bag info <bag_name>');\n    terminal.writeln('');\n    terminal.writeln('Available bags:');\n    const bags = BagStorage.list();\n    for (const name of bags) {\n      terminal.writeln(`  ${name}`);\n    }\n    return;\n  }\n\n  const bagName = args[0];\n  const recorder = BagStorage.get(bagName);\n\n  if (!recorder) {\n    terminal.writeln(`\\x1b[31mBag '${bagName}' not found.\\x1b[0m`);\n    return;\n  }\n\n  const info = recorder.getInfo();\n\n  terminal.writeln(`Bag: ${info.name}`);\n  terminal.writeln(`Duration: ${info.duration?.toFixed(2) || 0}s`);\n  terminal.writeln(`Messages: ${info.messageCount}`);\n  terminal.writeln('');\n  terminal.writeln('Topics:');\n\n  for (const topic of info.topics) {\n    const count = info.topicCounts[topic] || 0;\n    terminal.writeln(`  ${topic}: ${count} messages`);\n  }\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('bag', handleRos2Bag);\n\nexport default { handleRos2Bag };\n","import { getInterface, getDefinition, listMessages, listServices, listActions } from '../msgs/index.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 interface commands\n */\nexport async function handleRos2Interface(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'show':\n      handleShow(subArgs, terminal);\n      break;\n\n    case 'list':\n      handleList(subArgs, terminal);\n      break;\n\n    case 'package':\n      handlePackage(subArgs, terminal);\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n  }\n\n  terminal.finishCommand();\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 interface <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  show      Show the definition of an interface');\n  terminal.writeln('  list      List all available interfaces');\n  terminal.writeln('  package   List interfaces in a package');\n}\n\n/**\n * Handle ros2 interface show <type>\n */\nfunction handleShow(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 interface show <interface_type>');\n    return;\n  }\n\n  const typeName = args[0];\n  const definition = getDefinition(typeName);\n\n  if (!definition) {\n    terminal.writeln(`\\x1b[31mInterface '${typeName}' not found.\\x1b[0m`);\n    terminal.writeln('');\n    terminal.writeln('Use \"ros2 interface list\" to see available interfaces.');\n    return;\n  }\n\n  terminal.writeln(definition);\n}\n\n/**\n * Handle ros2 interface list\n */\nfunction handleList(args, terminal) {\n  const showMsgs = args.includes('-m') || args.includes('--only-msgs');\n  const showSrvs = args.includes('-s') || args.includes('--only-srvs');\n  const showActions = args.includes('-a') || args.includes('--only-actions');\n\n  const showAll = !showMsgs && !showSrvs && !showActions;\n\n  if (showAll || showMsgs) {\n    terminal.writeln('Messages:');\n    for (const msg of listMessages().sort()) {\n      terminal.writeln(`    ${msg}`);\n    }\n    terminal.writeln('');\n  }\n\n  if (showAll || showSrvs) {\n    terminal.writeln('Services:');\n    for (const srv of listServices().sort()) {\n      terminal.writeln(`    ${srv}`);\n    }\n    terminal.writeln('');\n  }\n\n  if (showAll || showActions) {\n    terminal.writeln('Actions:');\n    for (const action of listActions().sort()) {\n      terminal.writeln(`    ${action}`);\n    }\n  }\n}\n\n/**\n * Handle ros2 interface package <package_name>\n */\nfunction handlePackage(args, terminal) {\n  if (args.length === 0) {\n    terminal.writeln('usage: ros2 interface package <package_name>');\n    return;\n  }\n\n  const packageName = args[0];\n  const prefix = packageName + '/';\n\n  const matchingMsgs = listMessages().filter(m => m.startsWith(prefix));\n  const matchingSrvs = listServices().filter(s => s.startsWith(prefix));\n  const matchingActions = listActions().filter(a => a.startsWith(prefix));\n\n  if (matchingMsgs.length === 0 && matchingSrvs.length === 0 && matchingActions.length === 0) {\n    terminal.writeln(`\\x1b[31mNo interfaces found in package '${packageName}'.\\x1b[0m`);\n    return;\n  }\n\n  for (const msg of matchingMsgs.sort()) {\n    terminal.writeln(msg);\n  }\n  for (const srv of matchingSrvs.sort()) {\n    terminal.writeln(srv);\n  }\n  for (const action of matchingActions.sort()) {\n    terminal.writeln(action);\n  }\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('interface', handleRos2Interface);\n\nexport default { handleRos2Interface };\n","import { nodeRegistry } from '../nodes/registry.js';\nimport { commandRegistry } from './commandRegistry.js';\n\n/**\n * Handle ros2 pkg commands\n */\nexport async function handleRos2Pkg(args, terminal) {\n  if (args.length === 0) {\n    showHelp(terminal);\n    terminal.finishCommand();\n    return;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  switch (subcommand) {\n    case 'executables':\n      handleExecutables(subArgs, terminal);\n      break;\n\n    case 'list':\n      handleList(subArgs, terminal);\n      break;\n\n    default:\n      terminal.writeln(`\\x1b[31mUnknown subcommand: ${subcommand}\\x1b[0m`);\n      showHelp(terminal);\n  }\n\n  terminal.finishCommand();\n}\n\n/**\n * Show help message\n */\nfunction showHelp(terminal) {\n  terminal.writeln('usage: ros2 pkg <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  executables   List executables in a package');\n  terminal.writeln('  list          List available packages');\n}\n\n/**\n * Handle ros2 pkg executables [package_name]\n */\nfunction handleExecutables(args, terminal) {\n  if (args.length === 0) {\n    // List all executables\n    const packages = nodeRegistry.listPackages();\n\n    for (const pkg of packages.sort()) {\n      const execs = nodeRegistry.listExecutables(pkg);\n      for (const exec of execs.sort()) {\n        terminal.writeln(`${pkg} ${exec}`);\n      }\n    }\n    return;\n  }\n\n  const packageName = args[0];\n  const executables = nodeRegistry.listExecutables(packageName);\n\n  if (executables.length === 0) {\n    terminal.writeln(`\\x1b[31mPackage '${packageName}' not found or has no executables.\\x1b[0m`);\n    return;\n  }\n\n  for (const exec of executables.sort()) {\n    terminal.writeln(`${packageName} ${exec}`);\n  }\n}\n\n/**\n * Handle ros2 pkg list\n */\nfunction handleList(args, terminal) {\n  const packages = nodeRegistry.listPackages();\n\n  if (packages.length === 0) {\n    terminal.writeln('No packages available.');\n    return;\n  }\n\n  for (const pkg of packages.sort()) {\n    terminal.writeln(pkg);\n  }\n}\n\n// Self-register with the command registry\ncommandRegistry.registerRos2('pkg', handleRos2Pkg);\n\nexport default { handleRos2Pkg };\n","/**\n * Shell built-in commands - clear, ls, pwd, echo\n */\n\nimport { commandRegistry } from '../commandRegistry.js';\n\n/**\n * Clear terminal\n */\nfunction handleClear(args, terminal) {\n  terminal.clear();\n  terminal.finishCommand();\n  return true;\n}\n\n/**\n * List directory (simulated)\n */\nfunction handleLs(args, terminal) {\n  // Check for -la, -l, -a flags\n  const showAll = args.includes('-a') || args.includes('-la') || args.includes('-al');\n  const longFormat = args.includes('-l') || args.includes('-la') || args.includes('-al');\n\n  // Simulated directory contents\n  const files = [\n    { name: 'src', type: 'd', size: 4096 },\n    { name: 'install', type: 'd', size: 4096 },\n    { name: 'build', type: 'd', size: 4096 },\n    { name: 'log', type: 'd', size: 4096 },\n    { name: 'package.xml', type: '-', size: 1024 },\n    { name: 'CMakeLists.txt', type: '-', size: 2048 },\n    { name: 'setup.py', type: '-', size: 512 }\n  ];\n\n  const hiddenFiles = [\n    { name: '.', type: 'd', size: 4096 },\n    { name: '..', type: 'd', size: 4096 },\n    { name: '.colcon', type: 'd', size: 4096 }\n  ];\n\n  const allFiles = showAll ? [...hiddenFiles, ...files] : files;\n\n  if (longFormat) {\n    terminal.writeln('total ' + allFiles.length);\n    for (const file of allFiles) {\n      const perms = file.type === 'd' ? 'drwxr-xr-x' : '-rw-r--r--';\n      const size = String(file.size).padStart(6);\n      const date = 'Jan 27 12:00';\n      const color = file.type === 'd' ? '\\x1b[34m' : '';\n      const reset = file.type === 'd' ? '\\x1b[0m' : '';\n      terminal.writeln(`${perms} 1 ros2 ros2 ${size} ${date} ${color}${file.name}${reset}`);\n    }\n  } else {\n    // Simple listing\n    const names = allFiles.map(f => {\n      const color = f.type === 'd' ? '\\x1b[34m' : '';\n      const reset = f.type === 'd' ? '\\x1b[0m' : '';\n      return `${color}${f.name}${reset}`;\n    });\n    terminal.writeln(names.join('  '));\n  }\n\n  terminal.finishCommand();\n  return true;\n}\n\n/**\n * Print working directory\n */\nfunction handlePwd(args, terminal) {\n  terminal.writeln('/home/ros2/ws');\n  terminal.finishCommand();\n  return true;\n}\n\n/**\n * Echo - print text\n */\nfunction handleEcho(args, terminal) {\n  if (args.length > 0) {\n    terminal.writeln(args.join(' '));\n  }\n  terminal.finishCommand();\n  return true;\n}\n\n// Register all shell commands\ncommandRegistry.register('clear', handleClear);\ncommandRegistry.register('ls', handleLs);\ncommandRegistry.register('pwd', handlePwd);\ncommandRegistry.register('echo', handleEcho);\n","/**\n * Help command - show available commands\n */\n\nimport { commandRegistry } from '../commandRegistry.js';\n\n/**\n * Show general help\n */\nfunction handleHelp(args, terminal) {\n  terminal.writeln('ROS2 Web Emulator - Available Commands:');\n  terminal.writeln('');\n  terminal.writeln('\\x1b[33mROS2 Commands:\\x1b[0m');\n  terminal.writeln('  ros2 <subcommand>  - ROS2 CLI commands (type \"ros2 --help\")');\n  terminal.writeln('  rqt               - Open rqt tool selector');\n  terminal.writeln('  rqt_graph         - Open node graph visualization');\n  terminal.writeln('  rqt_console       - Open log console');\n  terminal.writeln('');\n  terminal.writeln('\\x1b[33mShell Commands:\\x1b[0m');\n  terminal.writeln('  ls [-la]          - List directory contents');\n  terminal.writeln('  pwd               - Print working directory');\n  terminal.writeln('  clear             - Clear the terminal');\n  terminal.writeln('  echo <text>       - Print text');\n  terminal.writeln('  help              - Show this help message');\n  terminal.writeln('');\n  terminal.writeln('Type \"ros2 --help\" for ros2 subcommands.');\n  terminal.finishCommand();\n  return true;\n}\n\n// Register help command\ncommandRegistry.register('help', handleHelp);\n","/**\n * RQT commands - rqt, rqt_graph, rqt_console\n */\n\nimport { commandRegistry } from '../commandRegistry.js';\nimport { Events } from '../../core/Events.js';\n\n/**\n * Handle rqt command - open tool selector\n */\nfunction handleRqt(args, terminal) {\n  window.dispatchEvent(new CustomEvent(Events.OPEN_RQT_MODAL));\n  terminal.finishCommand();\n  return true;\n}\n\n/**\n * Handle rqt_graph command\n */\nfunction handleRqtGraph(args, terminal) {\n  window.dispatchEvent(new CustomEvent(Events.TOGGLE_GRAPH));\n  terminal.writeln('Opening rqt_graph...');\n  terminal.finishCommand();\n  return true;\n}\n\n/**\n * Handle rqt_console command\n */\nfunction handleRqtConsole(args, terminal) {\n  window.dispatchEvent(new CustomEvent(Events.TOGGLE_CONSOLE));\n  terminal.writeln('Opening rqt_console...');\n  terminal.finishCommand();\n  return true;\n}\n\n// Register rqt commands\ncommandRegistry.register('rqt', handleRqt);\ncommandRegistry.register('rqt_graph', handleRqtGraph);\ncommandRegistry.register('rqt_console', handleRqtConsole);\n","/**\n * ROS2 main command handler\n */\n\nimport { commandRegistry } from '../commandRegistry.js';\n\n/**\n * Show ros2 help\n */\nfunction showRos2Help(terminal) {\n  terminal.writeln('usage: ros2 <command> [options]');\n  terminal.writeln('');\n  terminal.writeln('Commands:');\n  terminal.writeln('  run        Run an executable from a package');\n  terminal.writeln('  node       Node-related commands');\n  terminal.writeln('  topic      Topic-related commands');\n  terminal.writeln('  service    Service-related commands');\n  terminal.writeln('  action     Action-related commands');\n  terminal.writeln('  param      Parameter-related commands');\n  terminal.writeln('  bag        Bag file commands');\n  terminal.writeln('  interface  Interface introspection');\n  terminal.writeln('  pkg        Package-related commands');\n}\n\n/**\n * Handle ros2 command - routes to subcommands via registry\n */\nasync function handleRos2(args, terminal) {\n  if (args.length === 0 || args[0] === '--help' || args[0] === '-h') {\n    showRos2Help(terminal);\n    terminal.finishCommand();\n    return true;\n  }\n\n  const subcommand = args[0];\n  const subArgs = args.slice(1);\n\n  // Try to execute via registry\n  const handled = await commandRegistry.executeRos2(subcommand, subArgs, terminal);\n\n  if (!handled) {\n    terminal.writeln(`\\x1b[31mUnknown ros2 command: ${subcommand}\\x1b[0m`);\n    showRos2Help(terminal);\n    terminal.finishCommand();\n  }\n\n  return true;\n}\n\n// Register ros2 command\ncommandRegistry.register('ros2', handleRos2);\n","/**\n * Command Parser - Routes all commands to handlers via the command registry.\n * No more switch statement - all commands are registered handlers.\n */\n\nimport { commandRegistry } from './commandRegistry.js';\n\n// Import all ROS2 subcommand handlers to trigger registration\nimport './ros2_run.js';\nimport './ros2_node.js';\nimport './ros2_topic.js';\nimport './ros2_service.js';\nimport './ros2_action.js';\nimport './ros2_param.js';\nimport './ros2_bag.js';\nimport './ros2_interface.js';\nimport './ros2_pkg.js';\n\n// Import all builtin commands to trigger registration\nimport './builtins/index.js';\n\n/**\n * Main command parser - routes all commands through the registry\n */\nexport async function parseCommand(input, terminal) {\n  const trimmed = input.trim();\n\n  if (!trimmed) {\n    terminal.finishCommand();\n    return;\n  }\n\n  // Parse the command\n  const parts = parseCommandLine(trimmed);\n\n  if (parts.length === 0) {\n    terminal.finishCommand();\n    return;\n  }\n\n  const command = parts[0];\n  const args = parts.slice(1);\n\n  // Try to execute via registry\n  const handled = await commandRegistry.execute(command, args, terminal);\n\n  if (!handled) {\n    terminal.writeln(`\\x1b[31mCommand not found: ${command}\\x1b[0m`);\n    terminal.writeln('Type \"help\" for available commands.');\n    terminal.finishCommand();\n  }\n}\n\n/**\n * Parse command line into parts, handling quoted strings\n */\nfunction parseCommandLine(input) {\n  const parts = [];\n  let current = '';\n  let inQuotes = false;\n  let quoteChar = '';\n  let i = 0;\n\n  while (i < input.length) {\n    const char = input[i];\n\n    // Handle quotes\n    if ((char === '\"' || char === \"'\") && !inQuotes) {\n      inQuotes = true;\n      quoteChar = char;\n      i++;\n      continue;\n    }\n\n    if (inQuotes && char === quoteChar) {\n      inQuotes = false;\n      quoteChar = '';\n      i++;\n      continue;\n    }\n\n    // Handle spaces outside quotes\n    if (char === ' ' && !inQuotes) {\n      if (current) {\n        parts.push(current);\n        current = '';\n      }\n      i++;\n      continue;\n    }\n\n    current += char;\n    i++;\n  }\n\n  if (current) {\n    parts.push(current);\n  }\n\n  return parts;\n}\n\nexport default { parseCommand };\n","import { SimDDS } from './SimDDS.js';\nimport { LogManager } from './LogManager.js';\nimport { ServiceContainer } from './ServiceContainer.js';\n\n/**\n * Base class for all simulated ROS2 nodes\n *\n * Supports dependency injection for testing:\n *   new Node('test', { simDDS: mockDDS, logManager: mockLogger })\n */\nexport class Node {\n  constructor(name, options = {}) {\n    this.name = name;\n    this.namespace = options.namespace || '';\n    this.fullName = this.namespace ? `${this.namespace}/${name}` : `/${name}`;\n    this.publishers = [];\n    this.subscriptions = [];\n    this.services = [];\n    this.actionServers = [];\n    this.timers = [];\n    this.parameters = new Map();\n    this.parameterCallbacks = [];\n    this.running = false;\n\n    // Support dependency injection with fallback chain:\n    // 1. Explicit option passed to constructor\n    // 2. ServiceContainer registration\n    // 3. Default singleton import\n    this.simDDS = options.simDDS || ServiceContainer.get('simDDS') || SimDDS;\n    this.logManager = options.logManager || ServiceContainer.get('logManager') || LogManager;\n    this.logger = this.logManager.getLogger(this.fullName);\n\n    // Register with SimDDS\n    this.simDDS.registerNode(this.fullName, {\n      name: this.name,\n      namespace: this.namespace\n    });\n\n    // Initialize default parameters\n    if (options.parameters) {\n      for (const [key, value] of Object.entries(options.parameters)) {\n        this.declareParameter(key, value);\n      }\n    }\n  }\n\n  /**\n   * Declare a parameter with default value\n   */\n  declareParameter(name, defaultValue) {\n    if (!this.parameters.has(name)) {\n      this.parameters.set(name, defaultValue);\n    }\n    return this.parameters.get(name);\n  }\n\n  /**\n   * Get a parameter value\n   */\n  getParameter(name) {\n    return this.parameters.get(name);\n  }\n\n  /**\n   * Set a parameter value\n   * @returns {boolean} True if parameter was set successfully\n   */\n  setParameter(name, value) {\n    const result = this.setParameters({ [name]: value });\n    return result.successful;\n  }\n\n  /**\n   * Set multiple parameters atomically with callback validation\n   * @param {Object} params - Object of {name: value} pairs\n   * @returns {Object} { successful: boolean, reason: string }\n   */\n  setParameters(params) {\n    // Validate all parameters exist\n    for (const name of Object.keys(params)) {\n      if (!this.parameters.has(name)) {\n        return {\n          successful: false,\n          reason: `Parameter '${name}' not declared on node '${this.fullName}'`\n        };\n      }\n    }\n\n    // Run through callback chain\n    const validationResult = this._validateParameterChanges(params);\n    if (!validationResult.successful) {\n      return validationResult;\n    }\n\n    // All validated - apply changes\n    for (const [name, value] of Object.entries(params)) {\n      this.parameters.set(name, value);\n      this.onParameterChange(name, value);\n    }\n\n    return { successful: true, reason: '' };\n  }\n\n  /**\n   * Get all parameter names\n   */\n  getParameterNames() {\n    return Array.from(this.parameters.keys());\n  }\n\n  /**\n   * Called when a parameter changes - override in subclasses\n   */\n  onParameterChange(name, value) {\n    // Override in subclasses\n  }\n\n  /**\n   * Register a callback to validate parameter changes before they take effect.\n   * Callback receives an object of {name: value} pairs and must return\n   * { successful: boolean, reason: string }.\n   * @param {Function} callback - Validation callback\n   * @returns {number} Callback ID for removal\n   */\n  addOnSetParametersCallback(callback) {\n    this.parameterCallbacks.push(callback);\n    return this.parameterCallbacks.length - 1;\n  }\n\n  /**\n   * Remove a parameter callback by ID\n   * @param {number} callbackId - ID returned from addOnSetParametersCallback\n   */\n  removeParameterCallback(callbackId) {\n    if (callbackId >= 0 && callbackId < this.parameterCallbacks.length) {\n      this.parameterCallbacks[callbackId] = null;\n    }\n  }\n\n  /**\n   * Validate parameter changes through the callback chain\n   * @private\n   */\n  _validateParameterChanges(params) {\n    for (const callback of this.parameterCallbacks) {\n      if (callback === null) continue;\n      try {\n        const result = callback(params);\n        if (!result.successful) {\n          return result;\n        }\n      } catch (err) {\n        return { successful: false, reason: `Callback error: ${err.message}` };\n      }\n    }\n    return { successful: true, reason: '' };\n  }\n\n  /**\n   * Create a publisher\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {Object} [qos] - QoS profile { reliability, durability, history, depth }\n   */\n  createPublisher(topic, msgType, qos) {\n    const pub = this.simDDS.createPublisher(this.fullName, topic, msgType, qos);\n    this.publishers.push(pub);\n    return pub;\n  }\n\n  /**\n   * Create a subscription\n   * @param {string} topic - Topic name\n   * @param {string} msgType - Message type\n   * @param {Function} callback - Message callback\n   * @param {Object} [qos] - QoS profile { reliability, durability, history, depth }\n   */\n  createSubscription(topic, msgType, callback, qos) {\n    const sub = this.simDDS.createSubscription(this.fullName, topic, msgType, callback.bind(this), qos);\n    this.subscriptions.push(sub);\n    return sub;\n  }\n\n  /**\n   * Create a service server\n   */\n  createService(serviceName, srvType, handler) {\n    const srv = this.simDDS.createService(this.fullName, serviceName, srvType, handler.bind(this));\n    this.services.push(srv);\n    return srv;\n  }\n\n  /**\n   * Create an action server\n   */\n  createActionServer(actionName, actionType, handlers) {\n    const boundHandlers = {\n      executeCallback: handlers.executeCallback.bind(this),\n      goalCallback: handlers.goalCallback?.bind(this),\n      cancelCallback: handlers.cancelCallback?.bind(this)\n    };\n    const actionServer = this.simDDS.createActionServer(this.fullName, actionName, actionType, boundHandlers);\n    this.actionServers.push(actionServer);\n    return actionServer;\n  }\n\n  /**\n   * Create a timer\n   */\n  createTimer(periodMs, callback) {\n    const timerId = setInterval(() => {\n      if (this.running) {\n        callback.call(this);\n      }\n    }, periodMs);\n    this.timers.push(timerId);\n    return timerId;\n  }\n\n  /**\n   * Cancel a timer\n   */\n  cancelTimer(timerId) {\n    clearInterval(timerId);\n    const idx = this.timers.indexOf(timerId);\n    if (idx >= 0) {\n      this.timers.splice(idx, 1);\n    }\n  }\n\n  /**\n   * Get the current time\n   */\n  now() {\n    return {\n      sec: Math.floor(Date.now() / 1000),\n      nanosec: (Date.now() % 1000) * 1000000\n    };\n  }\n\n  /**\n   * Log methods\n   */\n  logDebug(msg) {\n    this.logger.debug(msg);\n  }\n\n  logInfo(msg) {\n    this.logger.info(msg);\n  }\n\n  logWarn(msg) {\n    this.logger.warn(msg);\n  }\n\n  logError(msg) {\n    this.logger.error(msg);\n  }\n\n  logFatal(msg) {\n    this.logger.fatal(msg);\n  }\n\n  /**\n   * Called when node is started - override in subclasses\n   */\n  onInit() {\n    // Override in subclasses\n  }\n\n  /**\n   * Called when node is about to be destroyed - override in subclasses\n   */\n  onShutdown() {\n    // Override in subclasses\n  }\n\n  /**\n   * Start the node\n   */\n  start() {\n    this.running = true;\n    this.onInit();\n    this.logInfo('Node started');\n  }\n\n  /**\n   * Stop and destroy the node\n   */\n  destroy() {\n    this.running = false;\n    this.onShutdown();\n\n    // Cancel all timers (timers are local, not managed by SimDDS)\n    for (const timerId of this.timers) {\n      clearInterval(timerId);\n    }\n    this.timers = [];\n\n    // Log before unregister so the logger still works\n    this.logInfo('Node destroyed');\n\n    // Clear local arrays without calling individual destroy() methods.\n    // SimDDS.unregisterNode() owns the comm cleanup to avoid double-cleanup.\n    this.publishers = [];\n    this.subscriptions = [];\n    this.services = [];\n    this.actionServers = [];\n\n    // Unregister from DDS (handles all comm cleanup)\n    this.simDDS.unregisterNode(this.fullName);\n  }\n}\n","import { Node } from '../../core/Node.js';\nimport { WorldState } from '../../core/WorldState.js';\nimport { Events } from '../../core/Events.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * TurtlesimNode - Main turtlesim simulation node\n * Renders turtles on canvas, handles physics, and provides ROS2 interface\n */\nexport class TurtlesimNode extends Node {\n  constructor(name = 'turtlesim', options = {}) {\n    super(name, {\n      ...options,\n      parameters: {\n        background_r: 69,\n        background_g: 86,\n        background_b: 255,\n        ...options.parameters\n      }\n    });\n\n    // Turtles in the simulation\n    this.turtles = new Map();\n\n    // Canvas reference (set by Canvas.js)\n    this.canvas = null;\n    this.ctx = null;\n\n    // Turtle image\n    this.turtleImage = null;\n    this.turtleImageLoaded = false;\n\n    // Pen trails\n    this.trails = [];\n\n    // Physics update rate\n    this.updateRate = 60; // Hz\n    this.publishRate = 10; // Hz for pose\n    this.lastPosePublish = 0;\n\n    // Lidar config for SLAM\n    this.lidarEnabled = true;\n    this.lidarPublishRate = 10; // Hz\n    this.lastLidarPublish = 0;\n  }\n\n  onInit() {\n    // Create default turtle\n    this._spawnTurtle('turtle1', 5.544445, 5.544445, 0);\n\n    // Register services\n    this.createService('/spawn', 'turtlesim/srv/Spawn', this._handleSpawn.bind(this));\n    this.createService('/kill', 'turtlesim/srv/Kill', this._handleKill.bind(this));\n    this.createService('/clear', 'turtlesim/srv/Empty', this._handleClear.bind(this));\n    this.createService('/reset', 'turtlesim/srv/Empty', this._handleReset.bind(this));\n\n    // Start update loop\n    this.createTimer(1000 / this.updateRate, this._update.bind(this));\n\n    // Notify canvas to render\n    this._notifyCanvas();\n\n    // Register parameter validation callback\n    this.addOnSetParametersCallback((params) => {\n      for (const key of ['background_r', 'background_g', 'background_b']) {\n        if (key in params) {\n          const val = params[key];\n          if (typeof val !== 'number' || !Number.isInteger(val) || val < 0 || val > 255) {\n            return { successful: false, reason: `${key} must be an integer between 0 and 255` };\n          }\n        }\n      }\n      return { successful: true, reason: '' };\n    });\n\n    this.logInfo('Turtlesim node started');\n  }\n\n  onShutdown() {\n    // Clear all turtles and their active action intervals\n    for (const [name, turtle] of this.turtles) {\n      // Clear any active action interval to prevent memory leak\n      if (turtle.activeActionInterval) {\n        clearInterval(turtle.activeActionInterval);\n        turtle.activeActionInterval = null;\n      }\n      WorldState.removeTurtle(name);\n    }\n    this.turtles.clear();\n    this.trails = [];\n  }\n\n  onParameterChange(name, value) {\n    if (name.startsWith('background_')) {\n      // Trigger canvas redraw\n      this._notifyCanvas();\n    }\n  }\n\n  /**\n   * Spawn a new turtle\n   */\n  _spawnTurtle(name, x, y, theta) {\n    if (this.turtles.has(name)) {\n      return null;\n    }\n\n    const turtle = {\n      name,\n      x,\n      y,\n      theta,\n      linearVelocity: 0,\n      angularVelocity: 0,\n      pen: {\n        r: 184,\n        g: 184,\n        b: 184,\n        width: 3,\n        off: false\n      },\n      // Track active action interval for cleanup\n      activeActionInterval: null\n    };\n\n    this.turtles.set(name, turtle);\n    WorldState.registerTurtle(name, x, y, theta);\n\n    // Create turtle-specific publishers and subscribers\n    const prefix = `/${name}`;\n\n    turtle.posePub = this.createPublisher(`${prefix}/pose`, 'turtlesim/msg/Pose');\n    turtle.colorPub = this.createPublisher(`${prefix}/color_sensor`, 'turtlesim/msg/Color');\n\n    turtle.cmdVelSub = this.createSubscription(\n      `${prefix}/cmd_vel`,\n      'geometry_msgs/msg/Twist',\n      (msg) => this._handleCmdVel(name, msg)\n    );\n\n    // Create turtle-specific services\n    turtle.setPenService = this.createService(\n      `${prefix}/set_pen`,\n      'turtlesim/srv/SetPen',\n      (req) => this._handleSetPen(name, req)\n    );\n\n    turtle.teleportAbsService = this.createService(\n      `${prefix}/teleport_absolute`,\n      'turtlesim/srv/TeleportAbsolute',\n      (req) => this._handleTeleportAbsolute(name, req)\n    );\n\n    turtle.teleportRelService = this.createService(\n      `${prefix}/teleport_relative`,\n      'turtlesim/srv/TeleportRelative',\n      (req) => this._handleTeleportRelative(name, req)\n    );\n\n    // Create rotate absolute action for first turtle\n    if (name === 'turtle1') {\n      turtle.rotateAbsAction = this.createActionServer(\n        `${prefix}/rotate_absolute`,\n        'turtlesim/action/RotateAbsolute',\n        {\n          executeCallback: (goal, goalId, feedbackCb, isCanceled) =>\n            this._executeRotateAbsolute(name, goal, feedbackCb, isCanceled),\n          goalCallback: () => true\n        }\n      );\n\n      // Create lidar publisher for SLAM demo\n      if (this.lidarEnabled) {\n        turtle.scanPub = this.createPublisher('/scan', 'sensor_msgs/msg/LaserScan');\n      }\n    }\n\n    this.logInfo(`Spawned turtle '${name}' at (${x.toFixed(2)}, ${y.toFixed(2)})`);\n    return name;\n  }\n\n  /**\n   * Handle /spawn service\n   */\n  _handleSpawn(request) {\n    let name = request.name;\n    if (!name) {\n      // Generate unique name\n      let i = 1;\n      while (this.turtles.has(`turtle${i}`)) i++;\n      name = `turtle${i}`;\n    }\n\n    const result = this._spawnTurtle(name, request.x, request.y, request.theta);\n    return { name: result || '' };\n  }\n\n  /**\n   * Handle /kill service\n   */\n  _handleKill(request) {\n    const turtle = this.turtles.get(request.name);\n    if (!turtle) {\n      throw new Error(`Turtle '${request.name}' not found`);\n    }\n\n    // Clear any active action interval to prevent memory leak\n    if (turtle.activeActionInterval) {\n      clearInterval(turtle.activeActionInterval);\n      turtle.activeActionInterval = null;\n    }\n\n    // Cleanup turtle resources\n    if (turtle.posePub) turtle.posePub.destroy();\n    if (turtle.colorPub) turtle.colorPub.destroy();\n    if (turtle.cmdVelSub) turtle.cmdVelSub.destroy();\n    if (turtle.setPenService) turtle.setPenService.destroy();\n    if (turtle.teleportAbsService) turtle.teleportAbsService.destroy();\n    if (turtle.teleportRelService) turtle.teleportRelService.destroy();\n    if (turtle.rotateAbsAction) turtle.rotateAbsAction.destroy();\n    if (turtle.scanPub) turtle.scanPub.destroy();\n\n    this.turtles.delete(request.name);\n    WorldState.removeTurtle(request.name);\n\n    this.logInfo(`Killed turtle '${request.name}'`);\n    return {};\n  }\n\n  /**\n   * Handle /clear service\n   */\n  _handleClear() {\n    this.trails = [];\n    this._notifyCanvas();\n    return {};\n  }\n\n  /**\n   * Handle /reset service\n   */\n  _handleReset() {\n    // Kill all turtles except turtle1\n    for (const [name] of this.turtles) {\n      if (name !== 'turtle1') {\n        this._handleKill({ name });\n      }\n    }\n\n    // Reset turtle1\n    const turtle1 = this.turtles.get('turtle1');\n    if (turtle1) {\n      turtle1.x = 5.544445;\n      turtle1.y = 5.544445;\n      turtle1.theta = 0;\n      turtle1.linearVelocity = 0;\n      turtle1.angularVelocity = 0;\n      WorldState.updateTurtle('turtle1', turtle1.x, turtle1.y, turtle1.theta);\n    }\n\n    this.trails = [];\n    this._notifyCanvas();\n    return {};\n  }\n\n  /**\n   * Handle cmd_vel message\n   */\n  _handleCmdVel(turtleName, msg) {\n    const turtle = this.turtles.get(turtleName);\n    if (!turtle) return;\n\n    turtle.linearVelocity = msg.linear?.x || 0;\n    turtle.angularVelocity = msg.angular?.z || 0;\n  }\n\n  /**\n   * Handle set_pen service\n   */\n  _handleSetPen(turtleName, request) {\n    const turtle = this.turtles.get(turtleName);\n    if (!turtle) {\n      throw new Error(`Turtle '${turtleName}' not found`);\n    }\n\n    turtle.pen = {\n      r: request.r,\n      g: request.g,\n      b: request.b,\n      width: request.width,\n      off: request.off !== 0\n    };\n\n    return {};\n  }\n\n  /**\n   * Handle teleport_absolute service\n   */\n  _handleTeleportAbsolute(turtleName, request) {\n    const turtle = this.turtles.get(turtleName);\n    if (!turtle) {\n      throw new Error(`Turtle '${turtleName}' not found`);\n    }\n\n    // Teleport without drawing\n    turtle.x = request.x;\n    turtle.y = request.y;\n    turtle.theta = request.theta;\n    WorldState.updateTurtle(turtleName, turtle.x, turtle.y, turtle.theta);\n\n    return {};\n  }\n\n  /**\n   * Handle teleport_relative service\n   */\n  _handleTeleportRelative(turtleName, request) {\n    const turtle = this.turtles.get(turtleName);\n    if (!turtle) {\n      throw new Error(`Turtle '${turtleName}' not found`);\n    }\n\n    // Apply relative movement\n    turtle.theta += request.angular;\n    turtle.x += Math.cos(turtle.theta) * request.linear;\n    turtle.y += Math.sin(turtle.theta) * request.linear;\n    WorldState.updateTurtle(turtleName, turtle.x, turtle.y, turtle.theta);\n\n    return {};\n  }\n\n  /**\n   * Execute rotate_absolute action\n   */\n  async _executeRotateAbsolute(turtleName, goal, feedbackCb, isCanceled) {\n    const turtle = this.turtles.get(turtleName);\n    if (!turtle) {\n      throw new Error(`Turtle '${turtleName}' not found`);\n    }\n\n    // Clear any existing action interval before starting new one\n    if (turtle.activeActionInterval) {\n      clearInterval(turtle.activeActionInterval);\n      turtle.activeActionInterval = null;\n    }\n\n    const targetTheta = goal.theta;\n    const startTheta = turtle.theta;\n\n    // Calculate shortest rotation\n    let delta = targetTheta - turtle.theta;\n    while (delta > Math.PI) delta -= 2 * Math.PI;\n    while (delta < -Math.PI) delta += 2 * Math.PI;\n\n    const rotationSpeed = 1.0; // rad/s\n    const direction = delta > 0 ? 1 : -1;\n    const totalDelta = Math.abs(delta);\n    let rotated = 0;\n\n    return new Promise((resolve) => {\n      const interval = setInterval(() => {\n        if (isCanceled()) {\n          clearInterval(interval);\n          turtle.activeActionInterval = null;\n          resolve({ delta: rotated * direction });\n          return;\n        }\n\n        const step = rotationSpeed / 30; // 30 Hz update\n        rotated += step;\n\n        if (rotated >= totalDelta) {\n          // Done\n          turtle.theta = targetTheta;\n          clearInterval(interval);\n          turtle.activeActionInterval = null;\n          resolve({ delta: totalDelta * direction });\n        } else {\n          turtle.theta = startTheta + rotated * direction;\n          WorldState.updateTurtle(turtleName, turtle.x, turtle.y, turtle.theta);\n\n          // Send feedback\n          const remaining = totalDelta - rotated;\n          feedbackCb({ remaining });\n        }\n      }, 1000 / 30);\n\n      // Store interval reference for cleanup\n      turtle.activeActionInterval = interval;\n    });\n  }\n\n  /**\n   * Main update loop\n   */\n  _update() {\n    const dt = 1.0 / this.updateRate;\n    const now = Date.now();\n\n    for (const [name, turtle] of this.turtles) {\n      // Store previous position\n      const prevX = turtle.x;\n      const prevY = turtle.y;\n\n      // Update position based on velocity\n      if (turtle.linearVelocity !== 0 || turtle.angularVelocity !== 0) {\n        turtle.theta += turtle.angularVelocity * dt;\n\n        // Normalize theta to [-PI, PI]\n        while (turtle.theta > Math.PI) turtle.theta -= 2 * Math.PI;\n        while (turtle.theta < -Math.PI) turtle.theta += 2 * Math.PI;\n\n        const newX = turtle.x + Math.cos(turtle.theta) * turtle.linearVelocity * dt;\n        const newY = turtle.y + Math.sin(turtle.theta) * turtle.linearVelocity * dt;\n\n        // Clamp to world bounds\n        turtle.x = Math.max(0, Math.min(11, newX));\n        turtle.y = Math.max(0, Math.min(11, newY));\n\n        WorldState.updateTurtle(name, turtle.x, turtle.y, turtle.theta);\n\n        // Add trail if pen is on and moved\n        if (!turtle.pen.off && (turtle.x !== prevX || turtle.y !== prevY)) {\n          this.trails.push({\n            x1: prevX,\n            y1: prevY,\n            x2: turtle.x,\n            y2: turtle.y,\n            color: `rgb(${turtle.pen.r}, ${turtle.pen.g}, ${turtle.pen.b})`,\n            width: turtle.pen.width\n          });\n        }\n      }\n\n      // Publish pose at lower rate\n      if (now - this.lastPosePublish >= 1000 / this.publishRate) {\n        const pose = {\n          x: turtle.x,\n          y: turtle.y,\n          theta: turtle.theta,\n          linear_velocity: turtle.linearVelocity,\n          angular_velocity: turtle.angularVelocity\n        };\n        turtle.posePub.publish(pose);\n      }\n\n      // Publish lidar scan for turtle1\n      if (name === 'turtle1' && this.lidarEnabled && turtle.scanPub) {\n        if (now - this.lastLidarPublish >= 1000 / this.lidarPublishRate) {\n          const scan = WorldState.lidarScan(turtle.x, turtle.y, turtle.theta, {\n            angleMin: -Math.PI,\n            angleMax: Math.PI,\n            numRays: 360,\n            rangeMax: 10.0\n          });\n\n          scan.header = {\n            stamp: this.now(),\n            frame_id: 'base_link'\n          };\n\n          turtle.scanPub.publish(scan);\n          this.lastLidarPublish = now;\n        }\n      }\n    }\n\n    if (now - this.lastPosePublish >= 1000 / this.publishRate) {\n      this.lastPosePublish = now;\n    }\n\n    // Notify canvas to redraw\n    this._notifyCanvas();\n  }\n\n  /**\n   * Notify canvas component to redraw\n   */\n  _notifyCanvas() {\n    window.dispatchEvent(new CustomEvent(Events.TURTLESIM_UPDATE, {\n      detail: {\n        turtles: Array.from(this.turtles.values()),\n        trails: this.trails,\n        background: {\n          r: this.getParameter('background_r'),\n          g: this.getParameter('background_g'),\n          b: this.getParameter('background_b')\n        }\n      }\n    }));\n  }\n\n  /**\n   * Get turtle data for canvas\n   */\n  getTurtleData() {\n    return {\n      turtles: Array.from(this.turtles.values()),\n      trails: this.trails,\n      background: {\n        r: this.getParameter('background_r'),\n        g: this.getParameter('background_g'),\n        b: this.getParameter('background_b')\n      }\n    };\n  }\n}\n\n// Self-register with the node registry\nnodeRegistry.register('turtlesim', 'turtlesim_node', TurtlesimNode);\n","import { Node } from '../../core/Node.js';\nimport { Events } from '../../core/Events.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * TurtleTeleopNode - Keyboard teleop for turtlesim using arrow keys\n * Matches the real turtle_teleop_key node behavior\n */\nexport class TurtleTeleopNode extends Node {\n  constructor(name = 'turtle_teleop_key', options = {}) {\n    super(name, {\n      ...options,\n      parameters: {\n        scale_linear: 2.0,\n        scale_angular: 2.0,\n        ...options.parameters\n      }\n    });\n\n    this.targetTopic = options.remappings?.['cmd_vel'] || '/turtle1/cmd_vel';\n    this.keyHandler = null;\n    this.activeKeys = new Set();\n  }\n\n  onInit() {\n    // Create publisher\n    this.cmdVelPub = this.createPublisher(this.targetTopic, 'geometry_msgs/msg/Twist');\n\n    // Set up keyboard handling\n    this.keyHandler = this._handleKeyDown.bind(this);\n    this.keyUpHandler = this._handleKeyUp.bind(this);\n\n    window.addEventListener('keydown', this.keyHandler);\n    window.addEventListener('keyup', this.keyUpHandler);\n\n    // Publish at regular rate while keys are held\n    this.createTimer(100, this._publishVelocity.bind(this));\n\n    this.logInfo('Turtle teleop started. Use arrow keys to move the turtle.');\n    this.logInfo(`Publishing to: ${this.targetTopic}`);\n\n    // Dispatch event to show keyboard hint\n    window.dispatchEvent(new CustomEvent(Events.TELEOP_ACTIVE, {\n      detail: { type: 'arrow-keys', node: this.fullName }\n    }));\n  }\n\n  onShutdown() {\n    if (this.keyHandler) {\n      window.removeEventListener('keydown', this.keyHandler);\n      window.removeEventListener('keyup', this.keyUpHandler);\n    }\n    this.activeKeys.clear();\n\n    window.dispatchEvent(new CustomEvent(Events.TELEOP_INACTIVE, {\n      detail: { node: this.fullName }\n    }));\n  }\n\n  _handleKeyDown(event) {\n    // Only respond to arrow keys\n    if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {\n      return;\n    }\n\n    event.preventDefault();\n    this.activeKeys.add(event.key);\n  }\n\n  _handleKeyUp(event) {\n    if (!['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(event.key)) {\n      return;\n    }\n\n    event.preventDefault();\n    this.activeKeys.delete(event.key);\n  }\n\n  _publishVelocity() {\n    const scaleLinear = this.getParameter('scale_linear');\n    const scaleAngular = this.getParameter('scale_angular');\n\n    let linear = 0;\n    let angular = 0;\n\n    if (this.activeKeys.has('ArrowUp')) {\n      linear += scaleLinear;\n    }\n    if (this.activeKeys.has('ArrowDown')) {\n      linear -= scaleLinear;\n    }\n    if (this.activeKeys.has('ArrowLeft')) {\n      angular += scaleAngular;\n    }\n    if (this.activeKeys.has('ArrowRight')) {\n      angular -= scaleAngular;\n    }\n\n    // Only publish if there's velocity or we just stopped\n    if (linear !== 0 || angular !== 0 || this.lastVelocity) {\n      const twist = {\n        linear: { x: linear, y: 0, z: 0 },\n        angular: { x: 0, y: 0, z: angular }\n      };\n\n      this.cmdVelPub.publish(twist);\n      this.lastVelocity = linear !== 0 || angular !== 0;\n    }\n  }\n}\n\n// Self-register with the node registry\nnodeRegistry.register('turtlesim', 'turtle_teleop_key', TurtleTeleopNode);\n","import { Node } from '../../core/Node.js';\nimport { Events } from '../../core/Events.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * TeleopTwistKeyboardNode - General keyboard teleop using WASD keys\n * Matches teleop_twist_keyboard package behavior\n */\nexport class TeleopTwistKeyboardNode extends Node {\n  constructor(name = 'teleop_twist_keyboard', options = {}) {\n    super(name, {\n      ...options,\n      parameters: {\n        speed: 0.5,\n        turn: 1.0,\n        speed_limit: 2.0,\n        turn_limit: 2.0,\n        ...options.parameters\n      }\n    });\n\n    this.targetTopic = options.remappings?.['cmd_vel'] || '/turtle1/cmd_vel';\n    this.keyHandler = null;\n    this.keyUpHandler = null;\n    this.activeKeys = new Set();\n\n    // Current velocity state\n    this.currentSpeed = 0.5;\n    this.currentTurn = 1.0;\n  }\n\n  onInit() {\n    // Create publisher\n    this.cmdVelPub = this.createPublisher(this.targetTopic, 'geometry_msgs/msg/Twist');\n\n    // Set up keyboard handling\n    this.keyHandler = this._handleKeyDown.bind(this);\n    this.keyUpHandler = this._handleKeyUp.bind(this);\n\n    window.addEventListener('keydown', this.keyHandler);\n    window.addEventListener('keyup', this.keyUpHandler);\n\n    // Publish at regular rate while keys are held\n    this.createTimer(100, this._publishVelocity.bind(this));\n\n    this.logInfo('Teleop Twist Keyboard started.');\n    this.logInfo('W/S: forward/back, A/D: turn, Q/E: diagonal, X: stop');\n    this.logInfo(`Publishing to: ${this.targetTopic}`);\n\n    // Dispatch event to show keyboard hint\n    window.dispatchEvent(new CustomEvent(Events.TELEOP_ACTIVE, {\n      detail: { type: 'wasd-keys', node: this.fullName }\n    }));\n  }\n\n  onShutdown() {\n    if (this.keyHandler) {\n      window.removeEventListener('keydown', this.keyHandler);\n      window.removeEventListener('keyup', this.keyUpHandler);\n    }\n    this.activeKeys.clear();\n\n    window.dispatchEvent(new CustomEvent(Events.TELEOP_INACTIVE, {\n      detail: { node: this.fullName }\n    }));\n  }\n\n  _handleKeyDown(event) {\n    const key = event.key.toLowerCase();\n\n    // Movement keys\n    if (['w', 'a', 's', 'd', 'q', 'e', 'x'].includes(key)) {\n      event.preventDefault();\n      this.activeKeys.add(key);\n      return;\n    }\n\n    // Speed adjustment keys\n    if (key === 'i') {\n      this.currentSpeed = Math.min(this.getParameter('speed_limit'), this.currentSpeed + 0.1);\n      this.logInfo(`Speed: ${this.currentSpeed.toFixed(1)}`);\n      event.preventDefault();\n      return;\n    }\n    if (key === 'k') {\n      this.currentSpeed = Math.max(0.1, this.currentSpeed - 0.1);\n      this.logInfo(`Speed: ${this.currentSpeed.toFixed(1)}`);\n      event.preventDefault();\n      return;\n    }\n    if (key === 'o') {\n      this.currentTurn = Math.min(this.getParameter('turn_limit'), this.currentTurn + 0.1);\n      this.logInfo(`Turn: ${this.currentTurn.toFixed(1)}`);\n      event.preventDefault();\n      return;\n    }\n    if (key === 'l') {\n      this.currentTurn = Math.max(0.1, this.currentTurn - 0.1);\n      this.logInfo(`Turn: ${this.currentTurn.toFixed(1)}`);\n      event.preventDefault();\n      return;\n    }\n  }\n\n  _handleKeyUp(event) {\n    const key = event.key.toLowerCase();\n    if (['w', 'a', 's', 'd', 'q', 'e', 'x'].includes(key)) {\n      event.preventDefault();\n      this.activeKeys.delete(key);\n    }\n  }\n\n  _publishVelocity() {\n    let linear = 0;\n    let angular = 0;\n\n    // Stop command\n    if (this.activeKeys.has('x')) {\n      // Publish zero velocity\n      const twist = {\n        linear: { x: 0, y: 0, z: 0 },\n        angular: { x: 0, y: 0, z: 0 }\n      };\n      this.cmdVelPub.publish(twist);\n      this.lastVelocity = false;\n      return;\n    }\n\n    // Forward/backward\n    if (this.activeKeys.has('w')) {\n      linear += this.currentSpeed;\n    }\n    if (this.activeKeys.has('s')) {\n      linear -= this.currentSpeed;\n    }\n\n    // Pure rotation (A = turn left, D = turn right)\n    if (this.activeKeys.has('a')) {\n      angular += this.currentTurn;\n    }\n    if (this.activeKeys.has('d')) {\n      angular -= this.currentTurn;\n    }\n\n    // Diagonal movement (Q = forward + turn left, E = forward + turn right)\n    if (this.activeKeys.has('q')) {\n      linear += this.currentSpeed;\n      angular += this.currentTurn;\n    }\n    if (this.activeKeys.has('e')) {\n      linear += this.currentSpeed;\n      angular -= this.currentTurn;\n    }\n\n    // Only publish if there's velocity or we just stopped\n    if (linear !== 0 || angular !== 0 || this.lastVelocity) {\n      const twist = {\n        linear: { x: linear, y: 0, z: 0 },\n        angular: { x: 0, y: 0, z: angular }\n      };\n\n      this.cmdVelPub.publish(twist);\n      this.lastVelocity = linear !== 0 || angular !== 0;\n    }\n  }\n}\n\n// Self-register with the node registry\nnodeRegistry.register('teleop_twist_keyboard', 'teleop_twist_keyboard', TeleopTwistKeyboardNode);\n","import { Node } from '../../core/Node.js';\nimport { Events } from '../../core/Events.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * SlamNode - Simple occupancy grid mapping for educational purposes\n * Demonstrates core SLAM concepts:\n * - Lidar scan processing\n * - Ray tracing through grid\n * - Occupancy grid updates\n * - Loop closure detection (educational)\n * - Localization against a pre-built map\n */\nexport class SlamNode extends Node {\n  constructor(name = 'slam_node', options = {}) {\n    super(name, {\n      ...options,\n      parameters: {\n        map_resolution: 0.1,  // meters per cell\n        map_width: 110,       // cells (11m / 0.1m)\n        map_height: 110,      // cells\n        origin_x: 0.0,        // world X origin\n        origin_y: 0.0,        // world Y origin\n        hit_prob: 0.9,        // probability of occupied on hit\n        miss_prob: 0.3,       // probability of occupied on miss\n        // Loop closure parameters\n        loop_closure_enabled: true,\n        loop_closure_distance: 0.5,     // meters - how close to trigger closure\n        loop_closure_min_travel: 3.0,   // meters - minimum travel before checking\n        loop_closure_cooldown: 5000,    // ms between detections\n        drift_enabled: false,           // odometry drift simulation\n        drift_rate: 0.005,              // drift per meter traveled\n        drift_max: 0.3,                 // max cumulative drift\n        // Localization mode\n        localization_mode: false,       // if true, localize against stored map\n        ...options.parameters\n      }\n    });\n\n    // Occupancy grid (log-odds representation)\n    this.grid = null;\n    this.gridWidth = 0;\n    this.gridHeight = 0;\n    this.resolution = 0;\n    this.originX = 0;\n    this.originY = 0;\n\n    // Robot pose (true)\n    this.robotX = 5.5;\n    this.robotY = 5.5;\n    this.robotTheta = 0;\n\n    // Drifted pose (used for mapping when drift is enabled)\n    this.driftX = 0;\n    this.driftY = 0;\n    this.driftTheta = 0;\n\n    // Log-odds constants\n    this.l0 = 0;\n    this.lOcc = 0;\n    this.lFree = 0;\n\n    // Clamping values\n    this.lMin = -5;\n    this.lMax = 5;\n\n    // Pose graph for loop closure\n    this.poseGraph = [];          // Array of { x, y, theta, timestamp, distanceTraveled }\n    this.totalDistanceTraveled = 0;\n    this.lastPoseX = 5.5;\n    this.lastPoseY = 5.5;\n    this.lastLoopClosureTime = 0;\n    this.loopClosureCount = 0;\n\n    // Stored map for localization mode\n    this.storedGrid = null;\n  }\n\n  onInit() {\n    // Initialize grid\n    this._initializeGrid();\n\n    // Calculate log-odds\n    const hitProb = this.getParameter('hit_prob');\n    const missProb = this.getParameter('miss_prob');\n    this.lOcc = Math.log(hitProb / (1 - hitProb));\n    this.lFree = Math.log(missProb / (1 - missProb));\n\n    // Subscribe to pose\n    this.createSubscription('/turtle1/pose', 'turtlesim/msg/Pose', this._handlePose.bind(this));\n\n    // Subscribe to lidar scan\n    this.createSubscription('/scan', 'sensor_msgs/msg/LaserScan', this._handleScan.bind(this));\n\n    // Create map publisher\n    this.mapPub = this.createPublisher('/map', 'nav_msgs/msg/OccupancyGrid');\n\n    // Create loop closure publisher\n    this.loopClosurePub = this.createPublisher('/loop_closures', 'std_msgs/msg/String');\n\n    // Publish map periodically\n    this.createTimer(500, this._publishMap.bind(this)); // 2 Hz\n\n    // Service to save/load map for localization\n    this.createService('/slam/save_map', 'std_srvs/srv/Empty', this._handleSaveMap.bind(this));\n    this.createService('/slam/load_map', 'std_srvs/srv/Empty', this._handleLoadMap.bind(this));\n\n    // Register parameter validation callback\n    this.addOnSetParametersCallback((params) => {\n      if ('map_resolution' in params) {\n        const v = params.map_resolution;\n        if (typeof v !== 'number' || v <= 0 || v > 1.0) {\n          return { successful: false, reason: 'map_resolution must be between 0.0 (exclusive) and 1.0' };\n        }\n      }\n      if ('hit_prob' in params) {\n        const v = params.hit_prob;\n        if (typeof v !== 'number' || v < 0.5 || v > 1.0) {\n          return { successful: false, reason: 'hit_prob must be between 0.5 and 1.0' };\n        }\n      }\n      if ('miss_prob' in params) {\n        const v = params.miss_prob;\n        if (typeof v !== 'number' || v < 0.0 || v > 0.5) {\n          return { successful: false, reason: 'miss_prob must be between 0.0 and 0.5' };\n        }\n      }\n      if ('loop_closure_distance' in params) {\n        const v = params.loop_closure_distance;\n        if (typeof v !== 'number' || v <= 0) {\n          return { successful: false, reason: 'loop_closure_distance must be positive' };\n        }\n      }\n      if ('drift_rate' in params) {\n        const v = params.drift_rate;\n        if (typeof v !== 'number' || v < 0) {\n          return { successful: false, reason: 'drift_rate must be non-negative' };\n        }\n      }\n      return { successful: true, reason: '' };\n    });\n\n    const mode = this.getParameter('localization_mode') ? 'LOCALIZATION' : 'MAPPING';\n    this.logInfo(`SLAM node started in ${mode} mode. Subscribe to /scan and /turtle1/pose`);\n    this.logInfo(`Map: ${this.gridWidth}x${this.gridHeight} cells, ${this.resolution}m resolution`);\n\n    if (this.getParameter('loop_closure_enabled')) {\n      this.logInfo('Loop closure detection enabled');\n    }\n    if (this.getParameter('drift_enabled')) {\n      this.logInfo(`Odometry drift simulation enabled (rate: ${this.getParameter('drift_rate')})`);\n    }\n\n    // Automatically show the map visualization\n    window.dispatchEvent(new CustomEvent(Events.SHOW_MAP));\n    this.logInfo('Map visualization enabled - watch the occupancy grid build as you explore!');\n  }\n\n  _initializeGrid() {\n    this.gridWidth = this.getParameter('map_width');\n    this.gridHeight = this.getParameter('map_height');\n    this.resolution = this.getParameter('map_resolution');\n    this.originX = this.getParameter('origin_x');\n    this.originY = this.getParameter('origin_y');\n\n    // Initialize grid with unknown (log-odds = 0)\n    this.grid = new Float32Array(this.gridWidth * this.gridHeight);\n    this.grid.fill(0);\n  }\n\n  _handlePose(msg) {\n    const prevX = this.robotX;\n    const prevY = this.robotY;\n\n    this.robotX = msg.x;\n    this.robotY = msg.y;\n    this.robotTheta = msg.theta;\n\n    // Track distance traveled\n    const dx = this.robotX - prevX;\n    const dy = this.robotY - prevY;\n    const distStep = Math.sqrt(dx * dx + dy * dy);\n    this.totalDistanceTraveled += distStep;\n\n    // Simulate odometry drift\n    if (this.getParameter('drift_enabled') && distStep > 0.001) {\n      this._simulateDrift(distStep);\n    }\n\n    // Add to pose graph periodically (every ~0.5m traveled)\n    const distFromLast = Math.sqrt(\n      (this.robotX - this.lastPoseX) ** 2 +\n      (this.robotY - this.lastPoseY) ** 2\n    );\n    if (distFromLast >= 0.5) {\n      this._addToPoseGraph();\n      this.lastPoseX = this.robotX;\n      this.lastPoseY = this.robotY;\n    }\n\n    // Notify UI of robot pose update (use true pose for display)\n    window.dispatchEvent(new CustomEvent(Events.ROBOT_POSE_UPDATE, {\n      detail: {\n        x: this.robotX,\n        y: this.robotY,\n        theta: this.robotTheta\n      }\n    }));\n  }\n\n  _simulateDrift(distStep) {\n    const rate = this.getParameter('drift_rate');\n    const maxDrift = this.getParameter('drift_max');\n\n    // Add small random drift proportional to distance traveled\n    this.driftX += (Math.random() - 0.5) * rate * distStep * 2;\n    this.driftY += (Math.random() - 0.5) * rate * distStep * 2;\n    this.driftTheta += (Math.random() - 0.5) * rate * distStep * 0.5;\n\n    // Clamp drift\n    this.driftX = Math.max(-maxDrift, Math.min(maxDrift, this.driftX));\n    this.driftY = Math.max(-maxDrift, Math.min(maxDrift, this.driftY));\n    this.driftTheta = Math.max(-maxDrift * 0.3, Math.min(maxDrift * 0.3, this.driftTheta));\n  }\n\n  _addToPoseGraph() {\n    this.poseGraph.push({\n      x: this.robotX,\n      y: this.robotY,\n      theta: this.robotTheta,\n      timestamp: Date.now(),\n      distanceTraveled: this.totalDistanceTraveled\n    });\n\n    // Keep graph manageable\n    if (this.poseGraph.length > 1000) {\n      this.poseGraph = this.poseGraph.slice(-500);\n    }\n  }\n\n  _handleScan(msg) {\n    // In localization mode, don't update the map\n    if (this.getParameter('localization_mode') && this.storedGrid) {\n      return;\n    }\n\n    // Use drifted pose for mapping (to demonstrate why loop closure matters)\n    const mapX = this.robotX + this.driftX;\n    const mapY = this.robotY + this.driftY;\n    const mapTheta = this.robotTheta + this.driftTheta;\n\n    // Process lidar scan and update occupancy grid\n    const { angle_min, angle_increment, ranges, range_max } = msg;\n\n    for (let i = 0; i < ranges.length; i++) {\n      const range = ranges[i];\n      const angle = mapTheta + angle_min + i * angle_increment;\n\n      if (!isFinite(range) || range <= 0) {\n        continue;\n      }\n\n      const isHit = range < range_max - 0.1;\n      const effectiveRange = isHit ? Math.max(0, range - this.resolution * 0.5) : range;\n\n      const hitX = mapX + Math.cos(angle) * effectiveRange;\n      const hitY = mapY + Math.sin(angle) * effectiveRange;\n\n      this._rayTrace(mapX, mapY, hitX, hitY, isHit);\n    }\n\n    // Check for loop closure after scan processing\n    if (this.getParameter('loop_closure_enabled')) {\n      this._checkLoopClosure();\n    }\n  }\n\n  _checkLoopClosure() {\n    const now = Date.now();\n    const cooldown = this.getParameter('loop_closure_cooldown');\n    const minTravel = this.getParameter('loop_closure_min_travel');\n    const closureDist = this.getParameter('loop_closure_distance');\n\n    // Respect cooldown\n    if (now - this.lastLoopClosureTime < cooldown) return;\n\n    // Need enough travel to have meaningful loop\n    if (this.totalDistanceTraveled < minTravel) return;\n\n    // Need enough pose history\n    if (this.poseGraph.length < 10) return;\n\n    // Check if current pose is close to any older pose\n    // Skip recent poses (last 10) to avoid false positives\n    const searchEnd = this.poseGraph.length - 10;\n    for (let i = 0; i < searchEnd; i++) {\n      const pose = this.poseGraph[i];\n      const dx = this.robotX - pose.x;\n      const dy = this.robotY - pose.y;\n      const dist = Math.sqrt(dx * dx + dy * dy);\n\n      // Must have traveled significantly since that pose\n      const travelSince = this.totalDistanceTraveled - pose.distanceTraveled;\n      if (travelSince < minTravel) continue;\n\n      if (dist < closureDist) {\n        this._applyLoopClosure(pose);\n        this.lastLoopClosureTime = now;\n        return;\n      }\n    }\n  }\n\n  _applyLoopClosure(matchedPose) {\n    this.loopClosureCount++;\n\n    // Calculate the drift error\n    const errorX = this.driftX;\n    const errorY = this.driftY;\n    const errorTheta = this.driftTheta;\n\n    this.logInfo(`Loop closure #${this.loopClosureCount} detected!`);\n    this.logInfo(`  Matched pose: (${matchedPose.x.toFixed(2)}, ${matchedPose.y.toFixed(2)})`);\n    this.logInfo(`  Current pose: (${this.robotX.toFixed(2)}, ${this.robotY.toFixed(2)})`);\n\n    if (this.getParameter('drift_enabled')) {\n      this.logInfo(`  Drift corrected: dx=${errorX.toFixed(3)}, dy=${errorY.toFixed(3)}, dtheta=${errorTheta.toFixed(3)}`);\n\n      // Reset drift (simulate correction)\n      this.driftX = 0;\n      this.driftY = 0;\n      this.driftTheta = 0;\n    }\n\n    // Publish loop closure event\n    this.loopClosurePub.publish({\n      data: `Loop closure #${this.loopClosureCount} at (${this.robotX.toFixed(2)}, ${this.robotY.toFixed(2)})`\n    });\n\n    // Notify UI\n    window.dispatchEvent(new CustomEvent(Events.LOOP_CLOSURE_DETECTED, {\n      detail: {\n        currentPose: { x: this.robotX, y: this.robotY, theta: this.robotTheta },\n        matchedPose: { x: matchedPose.x, y: matchedPose.y, theta: matchedPose.theta },\n        error: { x: errorX, y: errorY, theta: errorTheta },\n        count: this.loopClosureCount\n      }\n    }));\n  }\n\n  /**\n   * Save current map for later localization\n   */\n  _handleSaveMap() {\n    this.storedGrid = new Float32Array(this.grid);\n    this.logInfo('Map saved for localization. Use ros2 param set /slam_node localization_mode true to switch.');\n    return {};\n  }\n\n  /**\n   * Load stored map for localization\n   */\n  _handleLoadMap() {\n    if (this.storedGrid) {\n      this.grid = new Float32Array(this.storedGrid);\n      this.logInfo('Stored map loaded into active grid.');\n    } else {\n      this.logWarn('No stored map available. Save a map first with /slam/save_map.');\n    }\n    return {};\n  }\n\n  /**\n   * Bresenham ray tracing through the grid\n   */\n  _rayTrace(x0, y0, x1, y1, hit) {\n    const gx0 = this._worldToGridX(x0);\n    const gy0 = this._worldToGridY(y0);\n    const gx1 = this._worldToGridX(x1);\n    const gy1 = this._worldToGridY(y1);\n\n    const dx = gx1 - gx0;\n    const dy = gy1 - gy0;\n    const steps = Math.max(Math.abs(dx), Math.abs(dy));\n\n    if (steps === 0) {\n      if (gx0 >= 0 && gx0 < this.gridWidth && gy0 >= 0 && gy0 < this.gridHeight) {\n        const idx = gy0 * this.gridWidth + gx0;\n        if (hit) {\n          this.grid[idx] = Math.min(this.lMax, this.grid[idx] + this.lOcc);\n        }\n      }\n      return;\n    }\n\n    const xIncrement = dx / steps;\n    const yIncrement = dy / steps;\n\n    let x = gx0;\n    let y = gy0;\n    let lastGridX = -1;\n    let lastGridY = -1;\n\n    for (let i = 0; i <= steps; i++) {\n      const gridX = Math.round(x);\n      const gridY = Math.round(y);\n\n      if (gridX === lastGridX && gridY === lastGridY) {\n        x += xIncrement;\n        y += yIncrement;\n        continue;\n      }\n\n      lastGridX = gridX;\n      lastGridY = gridY;\n\n      if (gridX >= 0 && gridX < this.gridWidth && gridY >= 0 && gridY < this.gridHeight) {\n        const idx = gridY * this.gridWidth + gridX;\n\n        if (i === steps) {\n          if (hit) {\n            this.grid[idx] = Math.min(this.lMax, this.grid[idx] + this.lOcc);\n          }\n        } else {\n          this.grid[idx] = Math.max(this.lMin, this.grid[idx] + this.lFree);\n        }\n      }\n\n      x += xIncrement;\n      y += yIncrement;\n    }\n  }\n\n  _worldToGridX(worldX) {\n    return Math.floor((worldX - this.originX) / this.resolution);\n  }\n\n  _worldToGridY(worldY) {\n    return Math.floor((worldY - this.originY) / this.resolution);\n  }\n\n  /**\n   * Convert log-odds to probability\n   */\n  _logOddsToProbability(l) {\n    return 1 - 1 / (1 + Math.exp(l));\n  }\n\n  /**\n   * Publish the occupancy grid\n   */\n  _publishMap() {\n    const data = new Int8Array(this.grid.length);\n\n    for (let i = 0; i < this.grid.length; i++) {\n      const l = this.grid[i];\n\n      if (Math.abs(l) < 0.1) {\n        data[i] = -1;\n      } else {\n        const prob = this._logOddsToProbability(l);\n        data[i] = Math.round(prob * 100);\n      }\n    }\n\n    const map = {\n      header: {\n        stamp: this.now(),\n        frame_id: 'map'\n      },\n      info: {\n        map_load_time: this.now(),\n        resolution: this.resolution,\n        width: this.gridWidth,\n        height: this.gridHeight,\n        origin: {\n          position: { x: this.originX, y: this.originY, z: 0 },\n          orientation: { x: 0, y: 0, z: 0, w: 1 }\n        }\n      },\n      data: Array.from(data)\n    };\n\n    this.mapPub.publish(map);\n\n    // Also notify UI directly\n    window.dispatchEvent(new CustomEvent(Events.MAP_UPDATE, {\n      detail: {\n        map: Array.from(data),\n        info: map.info\n      }\n    }));\n  }\n\n  onParameterChange(name, value) {\n    if (name === 'hit_prob') {\n      this.lOcc = Math.log(value / (1 - value));\n    } else if (name === 'miss_prob') {\n      this.lFree = Math.log(value / (1 - value));\n    } else if (name === 'localization_mode') {\n      if (value && this.storedGrid) {\n        this.grid = new Float32Array(this.storedGrid);\n        this.logInfo('Switched to LOCALIZATION mode - using stored map');\n      } else if (value && !this.storedGrid) {\n        this.logWarn('No stored map available. Save map first: ros2 service call /slam/save_map std_srvs/srv/Empty');\n      } else {\n        this.logInfo('Switched to MAPPING mode');\n      }\n    } else if (name === 'drift_enabled') {\n      if (value) {\n        this.logInfo('Odometry drift simulation enabled');\n      } else {\n        this.driftX = 0;\n        this.driftY = 0;\n        this.driftTheta = 0;\n        this.logInfo('Odometry drift simulation disabled, drift reset');\n      }\n    }\n  }\n\n  onShutdown() {\n    this.grid = null;\n    this.storedGrid = null;\n    this.poseGraph = [];\n  }\n}\n\n// Self-register with the node registry\nnodeRegistry.register('simple_slam', 'slam_node', SlamNode);\n","/**\n * TFBuffer - Transform buffer for TF2 functionality\n * Stores and retrieves transforms between coordinate frames\n */\nclass TFBufferClass {\n  constructor() {\n    // transforms[childFrame][parentFrame] = transform\n    this.transforms = new Map();\n    this.staticTransforms = new Map();\n    this.bufferDuration = 10000; // 10 seconds buffer\n  }\n\n  /**\n   * Set a transform\n   * @param {Object} transform - TransformStamped message\n   * @param {boolean} isStatic - Whether this is a static transform\n   */\n  setTransform(transform, isStatic = false) {\n    const { header, child_frame_id, transform: tf } = transform;\n    const parentFrame = header.frame_id;\n    const childFrame = child_frame_id;\n\n    const storage = isStatic ? this.staticTransforms : this.transforms;\n\n    if (!storage.has(childFrame)) {\n      storage.set(childFrame, new Map());\n    }\n\n    const frameTransforms = storage.get(childFrame);\n\n    if (!frameTransforms.has(parentFrame)) {\n      frameTransforms.set(parentFrame, []);\n    }\n\n    const tfList = frameTransforms.get(parentFrame);\n    const entry = {\n      timestamp: header.stamp.sec * 1000 + header.stamp.nanosec / 1000000,\n      transform: tf\n    };\n\n    if (isStatic) {\n      // Static transforms just keep the latest\n      frameTransforms.set(parentFrame, [entry]);\n    } else {\n      tfList.push(entry);\n      // Cleanup old transforms\n      this._cleanupBuffer(tfList);\n    }\n  }\n\n  /**\n   * Cleanup old transforms from buffer\n   */\n  _cleanupBuffer(tfList) {\n    const now = Date.now();\n    const cutoff = now - this.bufferDuration;\n\n    while (tfList.length > 0 && tfList[0].timestamp < cutoff) {\n      tfList.shift();\n    }\n  }\n\n  /**\n   * Lookup transform from source to target frame\n   * @param {string} targetFrame - Target frame ID\n   * @param {string} sourceFrame - Source frame ID\n   * @param {number} time - Time to lookup (ms), 0 for latest\n   * @returns {Object|null} Transform or null if not found\n   */\n  lookupTransform(targetFrame, sourceFrame, time = 0) {\n    // Direct transform\n    let transform = this._getDirectTransform(sourceFrame, targetFrame, time);\n    if (transform) {\n      return transform;\n    }\n\n    // Inverse transform\n    transform = this._getDirectTransform(targetFrame, sourceFrame, time);\n    if (transform) {\n      return this._invertTransform(transform);\n    }\n\n    // Try to find path through tree\n    const path = this._findPath(sourceFrame, targetFrame);\n    if (path) {\n      return this._chainTransforms(path, time);\n    }\n\n    return null;\n  }\n\n  /**\n   * Get direct transform between frames\n   */\n  _getDirectTransform(childFrame, parentFrame, time) {\n    // Check static transforms first\n    const staticFrames = this.staticTransforms.get(childFrame);\n    if (staticFrames && staticFrames.has(parentFrame)) {\n      const entries = staticFrames.get(parentFrame);\n      if (entries.length > 0) {\n        return entries[entries.length - 1].transform;\n      }\n    }\n\n    // Check dynamic transforms\n    const dynamicFrames = this.transforms.get(childFrame);\n    if (dynamicFrames && dynamicFrames.has(parentFrame)) {\n      const entries = dynamicFrames.get(parentFrame);\n      if (entries.length === 0) return null;\n\n      if (time === 0) {\n        return entries[entries.length - 1].transform;\n      }\n\n      // Find closest transform to requested time\n      for (let i = entries.length - 1; i >= 0; i--) {\n        if (entries[i].timestamp <= time) {\n          return entries[i].transform;\n        }\n      }\n      return entries[0].transform;\n    }\n\n    return null;\n  }\n\n  /**\n   * Invert a transform\n   */\n  _invertTransform(transform) {\n    // Invert translation and rotation\n    const { translation, rotation } = transform;\n\n    // For quaternion, invert by negating x, y, z (conjugate for unit quaternion)\n    const invRotation = {\n      x: -rotation.x,\n      y: -rotation.y,\n      z: -rotation.z,\n      w: rotation.w\n    };\n\n    // Rotate translation by inverse rotation and negate\n    const invTranslation = this._rotateVector(\n      { x: -translation.x, y: -translation.y, z: -translation.z },\n      invRotation\n    );\n\n    return {\n      translation: invTranslation,\n      rotation: invRotation\n    };\n  }\n\n  /**\n   * Rotate a vector by a quaternion\n   */\n  _rotateVector(v, q) {\n    // Quaternion rotation: q * v * q^-1\n    const { x, y, z, w } = q;\n\n    // Simplified rotation formula\n    const t = [\n      2 * (y * v.z - z * v.y),\n      2 * (z * v.x - x * v.z),\n      2 * (x * v.y - y * v.x)\n    ];\n\n    return {\n      x: v.x + w * t[0] + y * t[2] - z * t[1],\n      y: v.y + w * t[1] + z * t[0] - x * t[2],\n      z: v.z + w * t[2] + x * t[1] - y * t[0]\n    };\n  }\n\n  /**\n   * Find path between frames using BFS\n   */\n  _findPath(sourceFrame, targetFrame) {\n    const allFrames = this._getAllFrames();\n    const visited = new Set();\n    const queue = [[sourceFrame, [sourceFrame]]];\n\n    while (queue.length > 0) {\n      const [current, path] = queue.shift();\n\n      if (current === targetFrame) {\n        return path;\n      }\n\n      if (visited.has(current)) continue;\n      visited.add(current);\n\n      // Find connected frames\n      const connected = this._getConnectedFrames(current);\n      for (const frame of connected) {\n        if (!visited.has(frame)) {\n          queue.push([frame, [...path, frame]]);\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Get all frames connected to a given frame\n   */\n  _getConnectedFrames(frame) {\n    const connected = new Set();\n\n    // Frames where this is the child\n    for (const [storage] of [[this.transforms], [this.staticTransforms]]) {\n      const frameData = storage.get(frame);\n      if (frameData) {\n        for (const parent of frameData.keys()) {\n          connected.add(parent);\n        }\n      }\n\n      // Frames where this is the parent\n      for (const [child, parents] of storage) {\n        if (parents.has(frame)) {\n          connected.add(child);\n        }\n      }\n    }\n\n    return connected;\n  }\n\n  /**\n   * Chain transforms along a path\n   */\n  _chainTransforms(path, time) {\n    let result = {\n      translation: { x: 0, y: 0, z: 0 },\n      rotation: { x: 0, y: 0, z: 0, w: 1 }\n    };\n\n    for (let i = 0; i < path.length - 1; i++) {\n      const from = path[i];\n      const to = path[i + 1];\n\n      let tf = this._getDirectTransform(from, to, time);\n      if (!tf) {\n        tf = this._getDirectTransform(to, from, time);\n        if (tf) {\n          tf = this._invertTransform(tf);\n        } else {\n          return null;\n        }\n      }\n\n      result = this._composeTransforms(result, tf);\n    }\n\n    return result;\n  }\n\n  /**\n   * Compose two transforms\n   */\n  _composeTransforms(t1, t2) {\n    // Compose rotations (quaternion multiplication)\n    const r1 = t1.rotation;\n    const r2 = t2.rotation;\n    const rotation = {\n      x: r1.w * r2.x + r1.x * r2.w + r1.y * r2.z - r1.z * r2.y,\n      y: r1.w * r2.y - r1.x * r2.z + r1.y * r2.w + r1.z * r2.x,\n      z: r1.w * r2.z + r1.x * r2.y - r1.y * r2.x + r1.z * r2.w,\n      w: r1.w * r2.w - r1.x * r2.x - r1.y * r2.y - r1.z * r2.z\n    };\n\n    // Compose translations\n    const rotatedT2 = this._rotateVector(t2.translation, r1);\n    const translation = {\n      x: t1.translation.x + rotatedT2.x,\n      y: t1.translation.y + rotatedT2.y,\n      z: t1.translation.z + rotatedT2.z\n    };\n\n    return { translation, rotation };\n  }\n\n  /**\n   * Get all known frames\n   */\n  _getAllFrames() {\n    const frames = new Set();\n\n    for (const storage of [this.transforms, this.staticTransforms]) {\n      for (const [child, parents] of storage) {\n        frames.add(child);\n        for (const parent of parents.keys()) {\n          frames.add(parent);\n        }\n      }\n    }\n\n    return frames;\n  }\n\n  /**\n   * Get frame tree as adjacency list\n   */\n  getFrameTree() {\n    const tree = {};\n    const frames = this._getAllFrames();\n\n    for (const frame of frames) {\n      tree[frame] = {\n        parents: [],\n        children: []\n      };\n    }\n\n    for (const storage of [this.transforms, this.staticTransforms]) {\n      for (const [child, parents] of storage) {\n        for (const parent of parents.keys()) {\n          if (tree[child]) tree[child].parents.push(parent);\n          if (tree[parent]) tree[parent].children.push(child);\n        }\n      }\n    }\n\n    return tree;\n  }\n\n  /**\n   * Clear all transforms\n   */\n  clear() {\n    this.transforms.clear();\n    this.staticTransforms.clear();\n  }\n}\n\n// Singleton instance\nexport const TFBuffer = new TFBufferClass();\n","import { Node } from '../../core/Node.js';\nimport { TFBuffer } from '../../core/TFBuffer.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * StaticTransformPublisher - Publishes static transforms\n * Usage: ros2 run tf2_ros static_transform_publisher x y z yaw pitch roll frame_id child_frame_id\n *    or: ros2 run tf2_ros static_transform_publisher x y z qx qy qz qw frame_id child_frame_id\n */\nexport class StaticTransformPublisher extends Node {\n  constructor(name = 'static_transform_publisher', options = {}) {\n    super(name, options);\n\n    // Parse transform from options or use defaults\n    this.transform = {\n      translation: { x: 0, y: 0, z: 0 },\n      rotation: { x: 0, y: 0, z: 0, w: 1 }\n    };\n    this.frameId = 'world';\n    this.childFrameId = 'base_link';\n\n    // Parse from command line args if provided\n    this._parseArgs(options.args || []);\n  }\n\n  _parseArgs(args) {\n    if (args.length === 0) return;\n\n    // Try to parse arguments\n    // Format 1: x y z yaw pitch roll frame_id child_frame_id\n    // Format 2: x y z qx qy qz qw frame_id child_frame_id\n\n    if (args.length >= 8) {\n      this.transform.translation.x = parseFloat(args[0]) || 0;\n      this.transform.translation.y = parseFloat(args[1]) || 0;\n      this.transform.translation.z = parseFloat(args[2]) || 0;\n\n      if (args.length === 8) {\n        // Euler angles (yaw, pitch, roll)\n        const yaw = parseFloat(args[3]) || 0;\n        const pitch = parseFloat(args[4]) || 0;\n        const roll = parseFloat(args[5]) || 0;\n        this.transform.rotation = this._eulerToQuaternion(yaw, pitch, roll);\n        this.frameId = args[6];\n        this.childFrameId = args[7];\n      } else if (args.length >= 9) {\n        // Quaternion\n        this.transform.rotation.x = parseFloat(args[3]) || 0;\n        this.transform.rotation.y = parseFloat(args[4]) || 0;\n        this.transform.rotation.z = parseFloat(args[5]) || 0;\n        this.transform.rotation.w = parseFloat(args[6]) || 1;\n        this.frameId = args[7];\n        this.childFrameId = args[8];\n      }\n    }\n  }\n\n  _eulerToQuaternion(yaw, pitch, roll) {\n    // Convert Euler angles to quaternion\n    const cy = Math.cos(yaw * 0.5);\n    const sy = Math.sin(yaw * 0.5);\n    const cp = Math.cos(pitch * 0.5);\n    const sp = Math.sin(pitch * 0.5);\n    const cr = Math.cos(roll * 0.5);\n    const sr = Math.sin(roll * 0.5);\n\n    return {\n      w: cr * cp * cy + sr * sp * sy,\n      x: sr * cp * cy - cr * sp * sy,\n      y: cr * sp * cy + sr * cp * sy,\n      z: cr * cp * sy - sr * sp * cy\n    };\n  }\n\n  onInit() {\n    // Create publisher for /tf_static\n    this.tfPub = this.createPublisher('/tf_static', 'tf2_msgs/msg/TFMessage');\n\n    // Create the transform message\n    const transformStamped = {\n      header: {\n        stamp: this.now(),\n        frame_id: this.frameId\n      },\n      child_frame_id: this.childFrameId,\n      transform: this.transform\n    };\n\n    // Add to TF buffer\n    TFBuffer.setTransform(transformStamped, true);\n\n    // Publish immediately\n    this.tfPub.publish({\n      transforms: [transformStamped]\n    });\n\n    // Publish periodically (static transforms are latched, but we simulate with periodic publishing)\n    this.createTimer(1000, () => {\n      const msg = {\n        transforms: [{\n          header: {\n            stamp: this.now(),\n            frame_id: this.frameId\n          },\n          child_frame_id: this.childFrameId,\n          transform: this.transform\n        }]\n      };\n      this.tfPub.publish(msg);\n    });\n\n    this.logInfo(`Publishing static transform: ${this.frameId} -> ${this.childFrameId}`);\n    this.logInfo(`  Translation: (${this.transform.translation.x}, ${this.transform.translation.y}, ${this.transform.translation.z})`);\n    this.logInfo(`  Rotation: (${this.transform.rotation.x}, ${this.transform.rotation.y}, ${this.transform.rotation.z}, ${this.transform.rotation.w})`);\n  }\n}\n\n// Self-register with the node registry\nnodeRegistry.register('tf2_ros', 'static_transform_publisher', StaticTransformPublisher);\n","import { Node } from '../../core/Node.js';\nimport { TFBuffer } from '../../core/TFBuffer.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * TF2EchoNode - Continuously prints transform between two frames\n * Usage: ros2 run tf2_ros tf2_echo <source_frame> <target_frame>\n */\nexport class TF2EchoNode extends Node {\n  constructor(name = 'tf2_echo', options = {}) {\n    super(name, options);\n    const args = options.args || [];\n    this.sourceFrame = args[0] || 'world';\n    this.targetFrame = args[1] || 'base_link';\n  }\n\n  onInit() {\n    this.logInfo(`Listening to transform from ${this.sourceFrame} to ${this.targetFrame}`);\n    this.createTimer(1000, this._queryTransform.bind(this));\n  }\n\n  _queryTransform() {\n    const transform = TFBuffer.lookupTransform(this.targetFrame, this.sourceFrame);\n    if (transform) {\n      const { translation: t, rotation: r } = transform;\n      this.logInfo(`At time ${(Date.now() / 1000).toFixed(3)}`);\n      this.logInfo(`- Translation: [${t.x.toFixed(3)}, ${t.y.toFixed(3)}, ${t.z.toFixed(3)}]`);\n      this.logInfo(`- Rotation: in Quaternion [${r.x.toFixed(3)}, ${r.y.toFixed(3)}, ${r.z.toFixed(3)}, ${r.w.toFixed(3)}]`);\n      // Also show as Euler (yaw only for 2D)\n      const yaw = Math.atan2(2.0 * (r.w * r.z + r.x * r.y), 1.0 - 2.0 * (r.y * r.y + r.z * r.z));\n      this.logInfo(`- Rotation: in RPY (radian) [0.000, 0.000, ${yaw.toFixed(3)}]`);\n    } else {\n      this.logWarn(`Could not transform ${this.sourceFrame} to ${this.targetFrame}: frame not found`);\n    }\n  }\n}\n\nnodeRegistry.register('tf2_ros', 'tf2_echo', TF2EchoNode);\n","import { Node } from '../../core/Node.js';\nimport { TFBuffer } from '../../core/TFBuffer.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * TF2MonitorNode - Monitors all active TF broadcasts and shows rates\n * Usage: ros2 run tf2_ros tf2_monitor\n */\nexport class TF2MonitorNode extends Node {\n  constructor(name = 'tf2_monitor', options = {}) {\n    super(name, options);\n    this.frameCounts = new Map();  // \"parent->child\" -> count\n    this.lastResetTime = Date.now();\n  }\n\n  onInit() {\n    this.createSubscription('/tf', 'tf2_msgs/msg/TFMessage', this._handleTF.bind(this));\n    this.createSubscription('/tf_static', 'tf2_msgs/msg/TFMessage', this._handleStaticTF.bind(this));\n    this.createTimer(1000, this._displayStatus.bind(this));\n    this.logInfo('Monitoring all transforms. Press Ctrl+C to stop.');\n  }\n\n  _handleTF(msg) {\n    if (!msg.transforms) return;\n    for (const tf of msg.transforms) {\n      const key = `${tf.header.frame_id} -> ${tf.child_frame_id}`;\n      this.frameCounts.set(key, (this.frameCounts.get(key) || 0) + 1);\n    }\n  }\n\n  _handleStaticTF(msg) {\n    if (!msg.transforms) return;\n    for (const tf of msg.transforms) {\n      const key = `${tf.header.frame_id} -> ${tf.child_frame_id} [static]`;\n      this.frameCounts.set(key, (this.frameCounts.get(key) || 0) + 1);\n    }\n  }\n\n  _displayStatus() {\n    const now = Date.now();\n    const elapsed = (now - this.lastResetTime) / 1000;\n    const tree = TFBuffer.getFrameTree();\n    const frames = Object.keys(tree);\n\n    this.logInfo('');\n    this.logInfo(`Frames: ${frames.length}`);\n\n    if (this.frameCounts.size === 0) {\n      this.logInfo('No transforms received yet.');\n    } else {\n      for (const [key, count] of this.frameCounts.entries()) {\n        const rate = elapsed > 0 ? (count / elapsed).toFixed(1) : '0.0';\n        this.logInfo(`  ${key}  Average rate: ${rate} Hz`);\n      }\n    }\n\n    // Reset counters periodically\n    this.frameCounts.clear();\n    this.lastResetTime = now;\n  }\n}\n\nnodeRegistry.register('tf2_ros', 'tf2_monitor', TF2MonitorNode);\n","import { Node } from '../../core/Node.js';\nimport { TFBuffer } from '../../core/TFBuffer.js';\nimport { ProcessManager } from '../../core/ProcessManager.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * ViewFramesNode - Prints the TF frame tree and exits\n * Usage: ros2 run tf2_ros view_frames\n */\nexport class ViewFramesNode extends Node {\n  constructor(name = 'view_frames', options = {}) {\n    super(name, options);\n  }\n\n  onInit() {\n    const tree = TFBuffer.getFrameTree();\n    const frames = Object.keys(tree);\n\n    if (frames.length === 0) {\n      this.logInfo('No transform data available. Publish transforms first.');\n      this.logInfo('Example: ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 world base_link');\n    } else {\n      // Find root frames (frames with no parents)\n      const roots = frames.filter(f => tree[f].parents.length === 0);\n\n      this.logInfo(`Frames (${frames.length}):`);\n      if (roots.length === 0) {\n        // No clear root - just list all frames\n        for (const frame of frames.sort()) {\n          const parents = tree[frame].parents.join(', ');\n          const children = tree[frame].children.join(', ');\n          this.logInfo(`  ${frame}  parents: [${parents}]  children: [${children}]`);\n        }\n      } else {\n        for (const root of roots) {\n          this._printTree(root, tree, '', true);\n        }\n      }\n    }\n\n    // Self-destruct after output\n    setTimeout(() => {\n      const proc = ProcessManager.getProcessByNodeName(this.fullName);\n      if (proc) {\n        ProcessManager.kill(proc.processId);\n      }\n    }, 100);\n  }\n\n  _printTree(frame, tree, prefix, isLast) {\n    const connector = prefix === '' ? '' : (isLast ? '\\\\-- ' : '+-- ');\n    this.logInfo(prefix + connector + frame);\n\n    const children = tree[frame].children;\n    const newPrefix = prefix === '' ? '    ' : prefix + (isLast ? '    ' : '|   ');\n\n    children.forEach((child, index) => {\n      const isLastChild = index === children.length - 1;\n      this._printTree(child, tree, newPrefix, isLastChild);\n    });\n  }\n}\n\nnodeRegistry.register('tf2_ros', 'view_frames', ViewFramesNode);\n","import { Node } from '../../core/Node.js';\nimport { Events } from '../../core/Events.js';\nimport { nodeRegistry } from '../registry.js';\n\n/**\n * NavigatorNode - Simple Nav2-style path planner for educational purposes\n * Demonstrates: A* path planning, action servers, autonomous navigation\n *\n * Usage:\n *   ros2 run nav2_simple_navigator navigator_node\n *   ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose \"{pose: {position: {x: 8.0, y: 8.0}}}\"\n *   ros2 action send_goal /follow_waypoints nav2_msgs/action/FollowWaypoints \"{poses: [{position: {x: 3, y: 3}}, {position: {x: 8, y: 8}}]}\"\n */\nexport class NavigatorNode extends Node {\n  constructor(name = 'navigator_node', options = {}) {\n    super(name, {\n      ...options,\n      parameters: {\n        goal_tolerance: 0.3,\n        max_speed: 1.5,\n        max_angular_speed: 2.5,\n        obstacle_threshold: 50,\n        robot_radius: 0.6,\n        recovery_enabled: true,\n        stuck_timeout: 3.0,\n        max_recovery_attempts: 3,\n        ...options.parameters\n      }\n    });\n\n    this.mapData = null;\n    this.mapInfo = null;\n    this._inflationRadiusCells = 0;\n    this.currentPose = { x: 5.5, y: 5.5, theta: 0 };\n    this.isNavigating = false;\n  }\n\n  onInit() {\n    this.createSubscription('/map', 'nav_msgs/msg/OccupancyGrid', this._handleMap.bind(this));\n    this.createSubscription('/turtle1/pose', 'turtlesim/msg/Pose', this._handlePose.bind(this));\n\n    this.pathPub = this.createPublisher('/plan', 'nav_msgs/msg/Path');\n    this.cmdVelPub = this.createPublisher('/turtle1/cmd_vel', 'geometry_msgs/msg/Twist');\n    this.recoveryPub = this.createPublisher('/recovery_status', 'std_msgs/msg/String');\n\n    this.createActionServer('/navigate_to_pose', 'nav2_msgs/action/NavigateToPose', {\n      executeCallback: this._executeNavigate.bind(this),\n      goalCallback: () => true\n    });\n\n    this.createActionServer('/follow_waypoints', 'nav2_msgs/action/FollowWaypoints', {\n      executeCallback: this._executeFollowWaypoints.bind(this),\n      goalCallback: () => true\n    });\n\n    this.addOnSetParametersCallback((params) => {\n      if ('goal_tolerance' in params && (params.goal_tolerance <= 0 || params.goal_tolerance > 5.0)) {\n        return { successful: false, reason: 'goal_tolerance must be between 0 (exclusive) and 5.0' };\n      }\n      if ('max_speed' in params && (params.max_speed <= 0 || params.max_speed > 10.0)) {\n        return { successful: false, reason: 'max_speed must be between 0 (exclusive) and 10.0' };\n      }\n      if ('obstacle_threshold' in params && (params.obstacle_threshold < 0 || params.obstacle_threshold > 100)) {\n        return { successful: false, reason: 'obstacle_threshold must be between 0 and 100' };\n      }\n      if ('robot_radius' in params && (params.robot_radius < 0 || params.robot_radius > 3.0)) {\n        return { successful: false, reason: 'robot_radius must be between 0 and 3.0' };\n      }\n      if ('stuck_timeout' in params && (params.stuck_timeout < 0 || params.stuck_timeout > 30)) {\n        return { successful: false, reason: 'stuck_timeout must be between 0 and 30' };\n      }\n      if ('max_recovery_attempts' in params && (params.max_recovery_attempts < 0 || params.max_recovery_attempts > 10)) {\n        return { successful: false, reason: 'max_recovery_attempts must be between 0 and 10' };\n      }\n      return { successful: true, reason: '' };\n    });\n\n    this.logInfo('Navigator node started. Waiting for map and goals...');\n    this.logInfo('Send goals: ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose \"{pose: {position: {x: 8, y: 8}}}\"');\n  }\n\n  _handleMap(msg) {\n    this.mapInfo = msg.info;\n    this.mapData = msg.data;\n    this._updateInflationRadius();\n  }\n\n  _updateInflationRadius() {\n    if (!this.mapInfo) return;\n    const radius = this.getParameter('robot_radius');\n    this._inflationRadiusCells = radius > 0 ? Math.ceil(radius / this.mapInfo.resolution) : 0;\n  }\n\n  _handlePose(msg) {\n    this.currentPose = { x: msg.x, y: msg.y, theta: msg.theta };\n  }\n\n  /**\n   * Navigate to a single pose. Core logic extracted for reuse.\n   * @returns {{ success: boolean }}\n   */\n  async _navigateToSinglePose(targetX, targetY, isCanceled, feedbackCb) {\n    if (!this.mapData || !this.mapInfo) {\n      this.logError('No map available. Start SLAM node first: ros2 run simple_slam slam_node');\n      return { success: false };\n    }\n\n    // Plan path using A*\n    const path = this._planPath(this.currentPose.x, this.currentPose.y, targetX, targetY);\n    if (!path) {\n      this.logError('Failed to find path to goal. Target may be in an obstacle or unreachable.');\n      return { success: false };\n    }\n\n    this.logInfo(`Path planned with ${path.length} waypoints`);\n    this._publishPath(path);\n    this._visualizePath(path);\n\n    // Follow path\n    this.isNavigating = true;\n    const tolerance = this.getParameter('goal_tolerance');\n    let waypointIdx = 0;\n    const step = Math.max(1, Math.floor(path.length / 50));\n\n    // Stuck detection state\n    let lastProgressTime = Date.now();\n    let lastProgressDist = Infinity;\n    let recoveryAttempts = 0;\n\n    while (waypointIdx < path.length && this.running) {\n      if (isCanceled()) {\n        this._stopRobot();\n        this.logInfo('Navigation cancelled');\n        this.isNavigating = false;\n        this._clearPath();\n        return { success: false };\n      }\n\n      const target = path[waypointIdx];\n      const dist = this._distance(this.currentPose, target);\n\n      if (feedbackCb) {\n        feedbackCb({\n          current_pose: {\n            header: { stamp: this.now(), frame_id: 'map' },\n            pose: {\n              position: { x: this.currentPose.x, y: this.currentPose.y, z: 0 },\n              orientation: { x: 0, y: 0, z: 0, w: 1 }\n            }\n          },\n          distance_remaining: this._pathDistanceFrom(path, waypointIdx)\n        });\n      }\n\n      if (dist < tolerance) {\n        waypointIdx += step;\n        lastProgressTime = Date.now();\n        lastProgressDist = Infinity;\n        continue;\n      }\n\n      // Stuck detection\n      const goalDist = this._distance(this.currentPose, { x: targetX, y: targetY });\n      if (goalDist < lastProgressDist - 0.05) {\n        lastProgressDist = goalDist;\n        lastProgressTime = Date.now();\n      }\n\n      const stuckTimeout = this.getParameter('stuck_timeout');\n      const maxRecovery = this.getParameter('max_recovery_attempts');\n      const recoveryEnabled = this.getParameter('recovery_enabled');\n\n      if (recoveryEnabled && stuckTimeout > 0 && (Date.now() - lastProgressTime) / 1000 > stuckTimeout) {\n        if (recoveryAttempts >= maxRecovery) {\n          this.logError(`Stuck after ${recoveryAttempts} recovery attempts. Aborting navigation.`);\n          this._stopRobot();\n          this.isNavigating = false;\n          this._clearPath();\n          return { success: false };\n        }\n\n        recoveryAttempts++;\n        this.logWarn(`Robot appears stuck. Executing recovery behavior (attempt ${recoveryAttempts}/${maxRecovery})`);\n        await this._executeRecovery(recoveryAttempts);\n\n        // Re-plan after recovery\n        const newPath = this._planPath(this.currentPose.x, this.currentPose.y, targetX, targetY);\n        if (!newPath) {\n          this.logError('Re-planning failed after recovery. Aborting navigation.');\n          this._stopRobot();\n          this.isNavigating = false;\n          this._clearPath();\n          return { success: false };\n        }\n\n        // Replace remaining path\n        path.length = 0;\n        path.push(...newPath);\n        waypointIdx = 0;\n        this._publishPath(path);\n        this._visualizePath(path);\n        lastProgressTime = Date.now();\n        lastProgressDist = Infinity;\n        continue;\n      }\n\n      // Proportional controller\n      const cmd = this._computeControl(this.currentPose, target);\n      this.cmdVelPub.publish(cmd);\n\n      await this._sleep(100);\n    }\n\n    this._stopRobot();\n    this.isNavigating = false;\n    this._clearPath();\n\n    const finalDist = this._distance(this.currentPose, { x: targetX, y: targetY });\n    if (finalDist < tolerance * 2) {\n      this.logInfo(`Goal reached! Final distance: ${finalDist.toFixed(2)}m`);\n      return { success: true };\n    } else {\n      this.logWarn(`Navigation ended. Distance to goal: ${finalDist.toFixed(2)}m`);\n      return { success: false };\n    }\n  }\n\n  async _executeNavigate(goal, goalId, feedbackCb, isCanceled) {\n    const targetX = goal.pose?.pose?.position?.x ?? goal.pose?.position?.x ?? 0;\n    const targetY = goal.pose?.pose?.position?.y ?? goal.pose?.position?.y ?? 0;\n\n    this.logInfo(`Received navigation goal: (${targetX.toFixed(2)}, ${targetY.toFixed(2)})`);\n\n    const result = await this._navigateToSinglePose(targetX, targetY, isCanceled, feedbackCb);\n    if (!result.success) {\n      throw new Error('Navigation failed');\n    }\n    return {};\n  }\n\n  async _executeFollowWaypoints(goal, goalId, feedbackCb, isCanceled) {\n    const poses = goal.poses || [];\n    const missedIndices = [];\n\n    if (poses.length === 0) {\n      this.logWarn('No waypoints provided');\n      return { missed_waypoint_indices: [] };\n    }\n\n    this.logInfo(`Following ${poses.length} waypoints`);\n    this._visualizeWaypoints(poses);\n\n    for (let i = 0; i < poses.length; i++) {\n      if (isCanceled()) {\n        this._stopRobot();\n        this.logInfo('Waypoint following cancelled');\n        this._clearWaypoints();\n        return { missed_waypoint_indices: missedIndices };\n      }\n\n      const pose = poses[i];\n      const targetX = pose.pose?.position?.x ?? pose.position?.x ?? 0;\n      const targetY = pose.pose?.position?.y ?? pose.position?.y ?? 0;\n\n      this.logInfo(`Navigating to waypoint ${i + 1}/${poses.length}: (${targetX.toFixed(2)}, ${targetY.toFixed(2)})`);\n\n      // Send waypoint-level feedback\n      feedbackCb({\n        current_waypoint: i,\n        number_of_poses: poses.length,\n        distance_remaining: this._distance(this.currentPose, { x: targetX, y: targetY })\n      });\n\n      const result = await this._navigateToSinglePose(targetX, targetY, isCanceled, (navFeedback) => {\n        feedbackCb({\n          current_waypoint: i,\n          number_of_poses: poses.length,\n          distance_remaining: navFeedback.distance_remaining\n        });\n      });\n\n      if (!result.success) {\n        this.logWarn(`Missed waypoint ${i} at (${targetX.toFixed(2)}, ${targetY.toFixed(2)})`);\n        missedIndices.push(i);\n      }\n    }\n\n    this._clearWaypoints();\n    this.logInfo(`Waypoint following complete. Missed ${missedIndices.length}/${poses.length} waypoints`);\n    return { missed_waypoint_indices: missedIndices };\n  }\n\n  /**\n   * Execute recovery behavior: spin in place, back up, stop\n   */\n  async _executeRecovery(attemptNumber) {\n    this._publishRecovery(`Recovery attempt ${attemptNumber}: spinning in place`);\n    this.logInfo(`Recovery attempt ${attemptNumber}: spinning in place`);\n\n    // Spin in place for ~2 seconds\n    const spinEnd = Date.now() + 2000;\n    while (Date.now() < spinEnd && this.running) {\n      this.cmdVelPub.publish({\n        linear: { x: 0, y: 0, z: 0 },\n        angular: { x: 0, y: 0, z: 2.0 }\n      });\n      await this._sleep(100);\n    }\n\n    this._publishRecovery(`Recovery attempt ${attemptNumber}: backing up`);\n    this.logInfo(`Recovery attempt ${attemptNumber}: backing up`);\n\n    // Back up for ~0.5 seconds\n    const backupEnd = Date.now() + 500;\n    while (Date.now() < backupEnd && this.running) {\n      this.cmdVelPub.publish({\n        linear: { x: -0.5, y: 0, z: 0 },\n        angular: { x: 0, y: 0, z: 0 }\n      });\n      await this._sleep(100);\n    }\n\n    this._stopRobot();\n    this._publishRecovery(`Recovery attempt ${attemptNumber}: complete`);\n    this.logInfo(`Recovery attempt ${attemptNumber}: complete`);\n  }\n\n  _publishRecovery(msg) {\n    this.recoveryPub.publish({ data: msg });\n  }\n\n  _visualizeWaypoints(poses) {\n    const waypoints = poses.map(p => ({\n      x: p.pose?.position?.x ?? p.position?.x ?? 0,\n      y: p.pose?.position?.y ?? p.position?.y ?? 0\n    }));\n    window.dispatchEvent(new CustomEvent(Events.WAYPOINTS_UPDATE, {\n      detail: { waypoints }\n    }));\n  }\n\n  _clearWaypoints() {\n    window.dispatchEvent(new CustomEvent(Events.WAYPOINTS_CLEARED));\n  }\n\n  /**\n   * A* path planning on occupancy grid\n   */\n  _planPath(startX, startY, goalX, goalY) {\n    const threshold = this.getParameter('obstacle_threshold');\n    this._updateInflationRadius();\n    const radiusCells = this._inflationRadiusCells;\n    const startG = this._worldToGrid(startX, startY);\n    const goalG = this._worldToGrid(goalX, goalY);\n\n    if (!this._isGridFreeInflated(goalG.gx, goalG.gy, threshold, radiusCells)) {\n      this.logWarn('Goal position is inside an obstacle');\n      return null;\n    }\n\n    const key = (gx, gy) => `${gx},${gy}`;\n    const startKey = key(startG.gx, startG.gy);\n    const goalKey = key(goalG.gx, goalG.gy);\n\n    const openSet = new MinHeap();\n    const gScore = new Map();\n    const cameFrom = new Map();\n    const closedSet = new Set();\n\n    gScore.set(startKey, 0);\n    openSet.push(this._heuristic(startG, goalG), startKey);\n\n    const neighbors = [[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];\n    let iterations = 0;\n    const maxIterations = 50000;\n\n    while (!openSet.isEmpty() && iterations < maxIterations) {\n      iterations++;\n      const currentKey = openSet.pop();\n\n      if (closedSet.has(currentKey)) continue;\n      closedSet.add(currentKey);\n\n      if (currentKey === goalKey) {\n        return this._reconstructPath(cameFrom, currentKey);\n      }\n\n      const [cx, cy] = currentKey.split(',').map(Number);\n\n      for (const [dx, dy] of neighbors) {\n        const nx = cx + dx;\n        const ny = cy + dy;\n\n        if (!this._isGridFreeInflated(nx, ny, threshold, radiusCells)) continue;\n\n        const nKey = key(nx, ny);\n        const moveCost = (dx !== 0 && dy !== 0) ? 1.414 : 1.0;\n        const tentativeG = gScore.get(currentKey) + moveCost;\n\n        if (!gScore.has(nKey) || tentativeG < gScore.get(nKey)) {\n          cameFrom.set(nKey, currentKey);\n          gScore.set(nKey, tentativeG);\n          const f = tentativeG + this._heuristic({ gx: nx, gy: ny }, goalG);\n          openSet.push(f, nKey);\n        }\n      }\n    }\n\n    return null;\n  }\n\n  _heuristic(from, to) {\n    const dx = to.gx - from.gx;\n    const dy = to.gy - from.gy;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  _isGridFree(gx, gy, threshold) {\n    if (!this.mapInfo) return false;\n    if (gx < 0 || gx >= this.mapInfo.width || gy < 0 || gy >= this.mapInfo.height) return false;\n    const idx = gy * this.mapInfo.width + gx;\n    const value = this.mapData[idx];\n    return value >= 0 && value < threshold;\n  }\n\n  _isGridFreeInflated(gx, gy, threshold, radiusCells) {\n    if (radiusCells <= 0) return this._isGridFree(gx, gy, threshold);\n    const r2 = radiusCells * radiusCells;\n    for (let dx = -radiusCells; dx <= radiusCells; dx++) {\n      for (let dy = -radiusCells; dy <= radiusCells; dy++) {\n        if (dx * dx + dy * dy > r2) continue;\n        if (!this._isGridFree(gx + dx, gy + dy, threshold)) return false;\n      }\n    }\n    return true;\n  }\n\n  _worldToGrid(x, y) {\n    const gx = Math.floor((x - this.mapInfo.origin.position.x) / this.mapInfo.resolution);\n    const gy = Math.floor((y - this.mapInfo.origin.position.y) / this.mapInfo.resolution);\n    return { gx, gy };\n  }\n\n  _gridToWorld(gx, gy) {\n    const x = gx * this.mapInfo.resolution + this.mapInfo.origin.position.x + this.mapInfo.resolution / 2;\n    const y = gy * this.mapInfo.resolution + this.mapInfo.origin.position.y + this.mapInfo.resolution / 2;\n    return { x, y };\n  }\n\n  _reconstructPath(cameFrom, goalKey) {\n    const path = [];\n    let current = goalKey;\n    while (current) {\n      const [gx, gy] = current.split(',').map(Number);\n      path.unshift(this._gridToWorld(gx, gy));\n      current = cameFrom.get(current);\n    }\n    return path;\n  }\n\n  _computeControl(current, target) {\n    const dx = target.x - current.x;\n    const dy = target.y - current.y;\n    const distance = Math.sqrt(dx * dx + dy * dy);\n    const targetAngle = Math.atan2(dy, dx);\n\n    let angleError = targetAngle - current.theta;\n    while (angleError > Math.PI) angleError -= 2 * Math.PI;\n    while (angleError < -Math.PI) angleError += 2 * Math.PI;\n\n    const maxSpeed = this.getParameter('max_speed');\n    const maxAngular = this.getParameter('max_angular_speed');\n\n    // Slow down when turning sharply\n    const turnFactor = Math.max(0.1, 1.0 - Math.abs(angleError) / Math.PI);\n    let linear = Math.min(maxSpeed, 0.8 * distance) * turnFactor;\n    let angular = Math.max(-maxAngular, Math.min(maxAngular, 2.5 * angleError));\n\n    return {\n      linear: { x: linear, y: 0, z: 0 },\n      angular: { x: 0, y: 0, z: angular }\n    };\n  }\n\n  _stopRobot() {\n    this.cmdVelPub.publish({\n      linear: { x: 0, y: 0, z: 0 },\n      angular: { x: 0, y: 0, z: 0 }\n    });\n  }\n\n  _publishPath(path) {\n    this.pathPub.publish({\n      header: { stamp: this.now(), frame_id: 'map' },\n      poses: path.map(p => ({\n        header: { stamp: this.now(), frame_id: 'map' },\n        pose: {\n          position: { x: p.x, y: p.y, z: 0 },\n          orientation: { x: 0, y: 0, z: 0, w: 1 }\n        }\n      }))\n    });\n  }\n\n  _visualizePath(path) {\n    window.dispatchEvent(new CustomEvent(Events.PATH_PLANNED, {\n      detail: { path }\n    }));\n  }\n\n  _clearPath() {\n    window.dispatchEvent(new CustomEvent(Events.PATH_CLEARED));\n  }\n\n  _distance(p1, p2) {\n    const dx = p2.x - p1.x;\n    const dy = p2.y - p1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  _pathDistanceFrom(path, fromIndex) {\n    let dist = 0;\n    for (let i = fromIndex; i < path.length - 1; i++) {\n      dist += this._distance(path[i], path[i + 1]);\n    }\n    return dist;\n  }\n\n  _sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  onShutdown() {\n    this._stopRobot();\n    this._clearPath();\n    this._clearWaypoints();\n    this.isNavigating = false;\n  }\n}\n\n/**\n * MinHeap for A* priority queue\n */\nclass MinHeap {\n  constructor() {\n    this.heap = [];\n  }\n\n  push(priority, value) {\n    this.heap.push({ priority, value });\n    this._bubbleUp(this.heap.length - 1);\n  }\n\n  pop() {\n    if (this.heap.length === 0) return null;\n    const min = this.heap[0];\n    const last = this.heap.pop();\n    if (this.heap.length > 0) {\n      this.heap[0] = last;\n      this._bubbleDown(0);\n    }\n    return min.value;\n  }\n\n  isEmpty() {\n    return this.heap.length === 0;\n  }\n\n  _bubbleUp(i) {\n    while (i > 0) {\n      const parent = Math.floor((i - 1) / 2);\n      if (this.heap[i].priority >= this.heap[parent].priority) break;\n      [this.heap[i], this.heap[parent]] = [this.heap[parent], this.heap[i]];\n      i = parent;\n    }\n  }\n\n  _bubbleDown(i) {\n    while (true) {\n      let min = i;\n      const left = 2 * i + 1;\n      const right = 2 * i + 2;\n      if (left < this.heap.length && this.heap[left].priority < this.heap[min].priority) min = left;\n      if (right < this.heap.length && this.heap[right].priority < this.heap[min].priority) min = right;\n      if (min === i) break;\n      [this.heap[i], this.heap[min]] = [this.heap[min], this.heap[i]];\n      i = min;\n    }\n  }\n}\n\nnodeRegistry.register('nav2_simple_navigator', 'navigator_node', NavigatorNode);\n","/**\n * ROS 2 Turtle School - Main Application Entry\n */\n\nimport { TerminalManager } from './ui/TerminalManager.js';\nimport { Canvas } from './ui/Canvas.js';\nimport { MapCanvas } from './ui/MapCanvas.js';\nimport { Graph } from './ui/Graph.js';\nimport { RqtConsole } from './ui/RqtConsole.js';\nimport { Layout } from './ui/Layout.js';\nimport { helpModal } from './ui/HelpModal.js';\nimport { parseCommand } from './cli/parser.js';\nimport { ProcessManager } from './core/ProcessManager.js';\nimport { SimDDS } from './core/SimDDS.js';\nimport { LogManager } from './core/LogManager.js';\nimport { Events } from './core/Events.js';\n\n// Import all nodes (triggers self-registration)\nimport './nodes/index.js';\n\n// Import xterm CSS\nimport 'xterm/css/xterm.css';\n\n/**\n * Main application class\n */\nclass App {\n  constructor() {\n    this.terminalManager = null;\n    this.canvas = null;\n    this.mapCanvas = null;\n    this.graph = null;\n    this.rqtConsole = null;\n    this.layout = null;\n    this.logger = LogManager.getLogger('/ros2_turtle_school');\n  }\n\n  /**\n   * Initialize the application\n   */\n  init() {\n    this.logger.info('Initializing ROS 2 Turtle School...');\n\n    // Initialize layout manager\n    this.layout = new Layout();\n\n    // Initialize terminal manager\n    this.terminalManager = new TerminalManager({\n      containerId: 'terminals-container',\n      tabListId: 'terminal-tabs',\n      addButtonId: 'add-terminal',\n      onCommand: (cmd, terminal) => parseCommand(cmd, terminal)\n    });\n\n    // Initialize canvas\n    this.canvas = new Canvas('turtle-canvas');\n\n    // Initialize map canvas\n    this.mapCanvas = new MapCanvas('map-canvas');\n\n    // Initialize graph\n    this.graph = new Graph('graph-container');\n\n    // Initialize rqt console\n    this.rqtConsole = new RqtConsole();\n\n    // Set up UI event listeners\n    this._setupEventListeners();\n\n    // Focus terminal\n    this.terminalManager.focus();\n\n    // Show welcome message\n    const terminal = this.terminalManager.getActiveTerminal();\n    if (terminal) {\n      terminal.writeln('');\n      terminal.writeln('\\x1b[32m\\x1b[0m');\n      terminal.writeln('\\x1b[32m                    ROS 2 Turtle School                       \\x1b[0m');\n      terminal.writeln('\\x1b[32m\\x1b[0m');\n      terminal.writeln('');\n      terminal.writeln('Welcome! This is a browser-based ROS2 CLI emulator.');\n      terminal.writeln('Try these commands to get started:');\n      terminal.writeln('');\n      terminal.writeln('  \\x1b[33mros2 run turtlesim turtlesim_node\\x1b[0m  - Start turtlesim');\n      terminal.writeln('  \\x1b[33mros2 topic list\\x1b[0m                   - List topics');\n      terminal.writeln('  \\x1b[33mros2 node list\\x1b[0m                    - List nodes');\n      terminal.writeln('  \\x1b[33mhelp\\x1b[0m                              - Show all commands');\n      terminal.writeln('');\n      terminal.writeln('Use the \\x1b[36m+\\x1b[0m button to add more terminal panes.');\n      terminal.writeln('Press \\x1b[36mCtrl+C\\x1b[0m to stop running commands.');\n      terminal.writeln('');\n      terminal.finishCommand();\n    }\n\n    this.logger.info('ROS 2 Turtle School initialized');\n  }\n\n  _setupEventListeners() {\n    // Toggle graph button\n    const graphBtn = document.getElementById('toggle-graph');\n    graphBtn?.addEventListener('click', () => {\n      this.graph.toggle();\n    });\n\n    // Toggle map button\n    const mapBtn = document.getElementById('toggle-map');\n    mapBtn?.addEventListener('click', () => {\n      this.layout.toggleMap();\n    });\n\n    // Toggle console button\n    const consoleBtn = document.getElementById('toggle-console');\n    consoleBtn?.addEventListener('click', () => {\n      this.rqtConsole.toggle();\n    });\n\n    // Help button\n    const helpBtn = document.getElementById('show-help');\n    helpBtn?.addEventListener('click', () => {\n      this._showHelpModal();\n    });\n\n    // Obstacle management buttons\n    this._setupObstacleButtons();\n\n    // Map overlay buttons\n    this._setupMapOverlayButtons();\n\n    // Costmap toggle\n    const costmapBtn = document.getElementById('toggle-costmap');\n    costmapBtn?.addEventListener('click', () => {\n      const isVisible = this.canvas.toggleCostmap();\n      costmapBtn.classList.toggle('active', isVisible);\n    });\n\n    // Map quality toggle\n    const qualityBtn = document.getElementById('toggle-map-quality');\n    qualityBtn?.addEventListener('click', () => {\n      const isVisible = this.canvas.toggleMapQuality();\n      qualityBtn.classList.toggle('active', isVisible);\n    });\n\n    // Custom events\n    window.addEventListener(Events.TOGGLE_GRAPH, () => {\n      this.graph.toggle();\n    });\n\n    window.addEventListener(Events.TOGGLE_CONSOLE, () => {\n      this.rqtConsole.toggle();\n    });\n\n    window.addEventListener(Events.SHOW_MAP, () => {\n      this.layout.showMap();\n    });\n\n    window.addEventListener(Events.OPEN_RQT_MODAL, () => {\n      this._showRqtModal();\n    });\n\n    // Quick command buttons\n    const quickButtons = document.querySelectorAll('#quick-commands button');\n    quickButtons.forEach(btn => {\n      btn.addEventListener('click', () => {\n        const cmd = btn.dataset.cmd;\n        if (cmd) {\n          const terminal = this.terminalManager.getActiveTerminal();\n          if (terminal) {\n            terminal.writeln(cmd);\n            parseCommand(cmd, terminal);\n          }\n        }\n      });\n    });\n\n    // Teleop active indicator\n    window.addEventListener(Events.TELEOP_ACTIVE, (event) => {\n      const { type } = event.detail;\n      this._showTeleopHint(type);\n    });\n\n    window.addEventListener(Events.TELEOP_INACTIVE, () => {\n      this._hideTeleopHint();\n    });\n\n    // Handle modal\n    const modalOverlay = document.getElementById('modal-overlay');\n    const modalClose = document.getElementById('modal-close');\n\n    modalOverlay?.addEventListener('click', (e) => {\n      if (e.target === modalOverlay) {\n        modalOverlay.classList.add('hidden');\n      }\n    });\n\n    modalClose?.addEventListener('click', () => {\n      modalOverlay?.classList.add('hidden');\n    });\n  }\n\n  _setupObstacleButtons() {\n    const randomizeBtn = document.getElementById('randomize-obstacles');\n    const addBtn = document.getElementById('add-obstacle-mode');\n    const deleteBtn = document.getElementById('delete-obstacle-mode');\n    const clearBtn = document.getElementById('clear-obstacles');\n    const resetBtn = document.getElementById('reset-obstacles');\n\n    // Randomize obstacles\n    randomizeBtn?.addEventListener('click', () => {\n      this.canvas.randomizeObstacles(5);\n    });\n\n    // Toggle add mode\n    addBtn?.addEventListener('click', () => {\n      const currentMode = this.canvas.getEditMode();\n      const newMode = currentMode === 'add' ? 'none' : 'add';\n      this.canvas.setEditMode(newMode);\n      this._updateObstacleButtons(newMode);\n    });\n\n    // Toggle delete mode\n    deleteBtn?.addEventListener('click', () => {\n      const currentMode = this.canvas.getEditMode();\n      const newMode = currentMode === 'delete' ? 'none' : 'delete';\n      this.canvas.setEditMode(newMode);\n      this._updateObstacleButtons(newMode);\n    });\n\n    // Clear obstacles\n    clearBtn?.addEventListener('click', () => {\n      this.canvas.clearObstacles();\n    });\n\n    // Reset to defaults\n    resetBtn?.addEventListener('click', () => {\n      this.canvas.resetObstacles();\n    });\n\n    // Listen for edit mode changes\n    window.addEventListener(Events.CANVAS_EDIT_MODE_CHANGED, (event) => {\n      this._updateObstacleButtons(event.detail.mode);\n    });\n  }\n\n  _updateObstacleButtons(mode) {\n    const addBtn = document.getElementById('add-obstacle-mode');\n    const deleteBtn = document.getElementById('delete-obstacle-mode');\n\n    addBtn?.classList.toggle('active', mode === 'add');\n    deleteBtn?.classList.toggle('active', mode === 'delete');\n  }\n\n  _setupMapOverlayButtons() {\n    const toggleBtn = document.getElementById('toggle-map-overlay');\n    const opacityControl = document.getElementById('map-opacity-control');\n    const opacitySlider = document.getElementById('map-opacity-slider');\n    const opacityValue = document.getElementById('map-opacity-value');\n\n    // Toggle map overlay\n    toggleBtn?.addEventListener('click', () => {\n      const isVisible = this.canvas.toggleMap();\n      toggleBtn.classList.toggle('active', isVisible);\n      opacityControl?.classList.toggle('hidden', !isVisible);\n    });\n\n    // Opacity slider\n    opacitySlider?.addEventListener('input', (e) => {\n      const opacity = parseInt(e.target.value, 10) / 100;\n      this.canvas.setMapOpacity(opacity);\n      if (opacityValue) {\n        opacityValue.textContent = `${e.target.value}%`;\n      }\n    });\n\n    // Listen for toggle-map-overlay event (from Layout.toggleMap)\n    window.addEventListener(Events.TOGGLE_MAP_OVERLAY, () => {\n      const isVisible = this.canvas.toggleMap();\n      toggleBtn?.classList.toggle('active', isVisible);\n      opacityControl?.classList.toggle('hidden', !isVisible);\n    });\n  }\n\n  _showRqtModal() {\n    const modal = document.getElementById('modal-overlay');\n    const title = document.getElementById('modal-title');\n    const body = document.getElementById('modal-body');\n\n    if (!modal || !body) return;\n\n    title.textContent = 'rqt - ROS2 Tools';\n    body.innerHTML = `\n      <div class=\"rqt-tools\">\n        <button class=\"rqt-tool-btn\" data-tool=\"graph\">\n          <span class=\"icon\"></span>\n          <span class=\"label\">Node Graph</span>\n          <span class=\"desc\">Visualize nodes and topics</span>\n        </button>\n        <button class=\"rqt-tool-btn\" data-tool=\"console\">\n          <span class=\"icon\"></span>\n          <span class=\"label\">Console</span>\n          <span class=\"desc\">View log messages</span>\n        </button>\n      </div>\n    `;\n\n    // Add click handlers\n    body.querySelectorAll('.rqt-tool-btn').forEach(btn => {\n      btn.addEventListener('click', () => {\n        const tool = btn.dataset.tool;\n        modal.classList.add('hidden');\n\n        if (tool === 'graph') {\n          this.graph.toggle();\n        } else if (tool === 'console') {\n          this.rqtConsole.toggle();\n        }\n      });\n    });\n\n    modal.classList.remove('hidden');\n  }\n\n  _showHelpModal() {\n    const modal = document.getElementById('modal-overlay');\n    helpModal.show(modal);\n  }\n\n  _showTeleopHint(type) {\n    let hint = document.getElementById('teleop-hint');\n    if (!hint) {\n      hint = document.createElement('div');\n      hint.id = 'teleop-hint';\n      document.body.appendChild(hint);\n    }\n\n    if (type === 'arrow-keys') {\n      hint.innerHTML = 'Use <kbd></kbd> <kbd></kbd> <kbd></kbd> <kbd></kbd> to control turtle';\n    } else if (type === 'wasd-keys') {\n      hint.innerHTML = 'Use <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> to move, <kbd>Q</kbd><kbd>E</kbd> to rotate';\n    }\n\n    hint.classList.add('visible');\n  }\n\n  _hideTeleopHint() {\n    const hint = document.getElementById('teleop-hint');\n    if (hint) {\n      hint.classList.remove('visible');\n    }\n  }\n\n  /**\n   * Cleanup and destroy the application\n   */\n  destroy() {\n    ProcessManager.killAll();\n    SimDDS.reset();\n    this.terminalManager?.destroy();\n    this.graph?.destroy();\n    this.rqtConsole?.destroy();\n  }\n}\n\n// Initialize app when DOM is ready\ndocument.addEventListener('DOMContentLoaded', () => {\n  const app = new App();\n  app.init();\n\n  // Expose for debugging in development only\n  if (import.meta.env.DEV) {\n    window.ros2app = app;\n    window.SimDDS = SimDDS;\n    window.ProcessManager = ProcessManager;\n  }\n});\n"],"names":["Events","Terminal","container","options","XTerm","FitAddon","event","_a","e","action","x","y","rect","selection","err","text","char","key","code","keydownEvent","keyupEvent","data","i","upperChar","command","sub","recorder","backspaces","prompt","idx","ServiceContainerClass","name","instance","ServiceContainer","LOG_LEVELS","LogManagerClass","nodeName","msg","level","message","levelValue","nodeLevel","entry","consoleMsg","listener","callback","filter","result","minLevel","log","timeStr","ms","levelStr","LogManager","ProcessManagerClass","node","terminalId","packageName","executable","processId","proc","count","toKill","ProcessManager","TerminalManager","termId","isRunning","termData","statusDot","termNum","termContainer","tab","terminal","cmd","term","nextTerm","prevData","num","title","td","active","WorldStateClass","obstacle","index","minSize","maxSize","keepWalls","margin","obs","width","height","attempts","maxAttempts","w","h","padding","overlapX","overlapY","centerX","centerY","closestX","closestY","dx","dy","theta","radius","cx","cy","r","rx","ry","rw","rh","angle","maxRange","closestHit","closestDist","hit","boundHits","bx","by","bw","bh","edges","closest","edge","x1","y1","x2","y2","sx","sy","denom","t","u","config","angleMin","angleMax","angleIncrement","rangeMin","rangeMax","numRays","ranges","intensities","actualIncrement","WorldState","Canvas","canvasOrId","turtleSvg","blob","url","turtles","trails","background","map","info","canvasX","canvasY","worldCoords","scaleX","scaleY","size","distance","resolution","origin","mapCtx","imageData","gridY","gridX","gridIndex","value","pixelIndex","b","ctx","radiusCells","threshold","occupiedCells","gy","gx","val","minDist","oc","d2","dist","g","alpha","obstacles","correct","totalKnown","wx","wy","actuallyOccupied","slamOccupied","metrics","boxW","boxH","topLeft","trail","p1","p2","turtleSize","turtle","pos","wp","scan","angle_min","angle_increment","range","endX","endY","endPos","axisLength","mode","opacity","MapCanvas","mapX","mapY","worldX","worldY","mapWorldWidth","mapWorldHeight","scale","mapWidth","mapHeight","cellWidth","cellHeight","pixels","my","mx","py","px","pixelX","pixelY","pixelIdx","robotSize","CommInterface","topic","msgType","nodeId","qos","subscriptionId","publisherId","serviceName","srvType","handler","serviceId","request","actionName","actionType","handlers","actionId","goal","feedbackCallback","DEFAULT_QOS","QOS_PRESETS","VALID_RELIABILITY","VALID_DURABILITY","VALID_HISTORY","normalizeQoS","formatQoS","indent","q","historyStr","parseQoSArgs","args","remaining","profile","reliability","durability","history","depth","qosFlags","arg","depthStr","base","LocalComm","existing","topicData","subId","msgWithTimestamp","pubId","service","goalId","goalInfo","feedback","SimDDSClass","commProvider","nodeInfo","nodeData","srvId","topicName","a","SimDDS","Graph","containerOrId","cytoscape","nodes","topics","elements","nodeSet","topicSet","elementIds","id","topicId","pub","edgeId","signature","intervalMs","canvasContainer","RqtConsole","_b","_c","_d","_e","nodeFilter","logEl","logs","startIdx","Layout","startX","startY","diffX","diffY","HelpModal","modalElement","tabName","isActive","panel","helpModal","CommandRegistryClass","commandRegistry","NodeRegistryClass","executableName","pkg","nodeClass","nodeRegistry","handleRos2Run","rosArgs","parseRosArgs","packages","execs","exec","fullNodeName","positionalArgs","inRosArgs","parts","parseParamValue","str","handleRos2Node","showHelp","subcommand","subArgs","handleList","handleInfo","procInfo","sections","s","p","section","item","parseMessage","input","parseYamlLike","currentKey","currentValue","inValue","inString","stringChar","parseValue","parseArray","current","formatMessage","spaces","lines","formattedValue","MessageRegistryClass","typeName","definition","pattern","regex","msgDef","errors","field","fieldDef","iface","messageRegistry","Header","String","Bool","Int32","Int64","Float32","Float64","Empty","ColorRGBA","Vector3","Point","Quaternion","Pose","PoseStamped","Twist","TwistStamped","Transform","TransformStamped","Color","Spawn","Kill","SetPen","TeleportAbsolute","TeleportRelative","RotateAbsolute","TFMessage","LaserScan","Imu","MapMetaData","OccupancyGrid","Odometry","Path","NavigateToPose","_f","_i","_h","_g","_k","_j","_n","_m","_l","_p","_o","FollowWaypoints","getMessage","getService","getAction","listMessages","listServices","listActions","findMessages","findServices","findActions","getDefinition","handleRos2Topic","handleType","handleFind","handleEcho","handlePub","handleHz","handleBw","showTypes","verbose","topicInfo","line","matching","error","pollInterval","subscribeToTopic","type","newTopicInfo","once","rate","msgData","matches","match","interval","timestamps","windowSize","now","duration","avgPeriod","formatBytes","bytes","samples","subscribedPrinted","totalBytes","sum","meanSize","handleRos2Service","handleCall","services","srv","serviceInfo","reqData","srvDef","response","handleRos2Action","handleSendGoal","actions","actionInfo","goalData","showFeedback","actionDef","handleRos2Param","handleGet","handleSet","handleDump","handleLoad","getNodeName","getNodeProcess","params","param","paramName","getTypeLabel","formatValue","valueStr","first","BagRecorder","topicCounts","bags","BagStorageClass","memoryBags","storageBags","BagStorage","BagPlayer","currentPlaybackId","delay","timeout","pauseDuration","elapsed","handleRos2Bag","handleRecord","handlePlay","recordAll","bagName","topicsToRecord","player","resolve","handleRos2Interface","handleShow","handlePackage","showMsgs","showSrvs","showActions","showAll","prefix","matchingMsgs","m","matchingSrvs","matchingActions","handleRos2Pkg","handleExecutables","executables","handleClear","handleLs","longFormat","files","allFiles","file","perms","date","color","reset","names","f","handlePwd","handleHelp","handleRqt","handleRqtGraph","handleRqtConsole","showRos2Help","handleRos2","parseCommand","trimmed","parseCommandLine","inQuotes","quoteChar","Node","defaultValue","validationResult","callbackId","boundHandlers","actionServer","periodMs","timerId","TurtlesimNode","req","feedbackCb","isCanceled","turtle1","turtleName","targetTheta","startTheta","delta","rotationSpeed","direction","totalDelta","rotated","step","dt","prevX","prevY","newX","newY","pose","TurtleTeleopNode","scaleLinear","scaleAngular","linear","angular","twist","TeleopTwistKeyboardNode","SlamNode","hitProb","missProb","v","distStep","maxDrift","mapTheta","range_max","isHit","effectiveRange","hitX","hitY","cooldown","minTravel","closureDist","searchEnd","matchedPose","errorX","errorY","errorTheta","x0","y0","gx0","gy0","gx1","gy1","steps","xIncrement","yIncrement","lastGridX","lastGridY","l","prob","TFBufferClass","transform","isStatic","header","child_frame_id","tf","parentFrame","childFrame","storage","frameTransforms","tfList","cutoff","targetFrame","sourceFrame","time","path","staticFrames","entries","dynamicFrames","translation","rotation","invRotation","z","visited","queue","connected","frame","frameData","parent","child","parents","from","to","t1","t2","r1","r2","rotatedT2","frames","tree","TFBuffer","StaticTransformPublisher","yaw","pitch","roll","cp","sp","cr","sr","transformStamped","TF2EchoNode","TF2MonitorNode","ViewFramesNode","roots","children","root","isLast","connector","newPrefix","isLastChild","NavigatorNode","targetX","targetY","tolerance","waypointIdx","lastProgressTime","lastProgressDist","recoveryAttempts","target","goalDist","stuckTimeout","maxRecovery","newPath","finalDist","poses","missedIndices","navFeedback","attemptNumber","spinEnd","backupEnd","waypoints","goalX","goalY","startG","goalG","startKey","goalKey","openSet","MinHeap","gScore","cameFrom","closedSet","neighbors","iterations","maxIterations","nx","ny","nKey","moveCost","tentativeG","angleError","maxSpeed","maxAngular","turnFactor","fromIndex","priority","min","last","left","right","App","graphBtn","mapBtn","consoleBtn","helpBtn","costmapBtn","isVisible","qualityBtn","btn","modalOverlay","modalClose","randomizeBtn","addBtn","deleteBtn","clearBtn","resetBtn","newMode","toggleBtn","opacityControl","opacitySlider","opacityValue","modal","body","tool","hint"],"mappings":"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"}