import{r as yt,a as wt}from"./vendor-xterm-DgJRGhIz.js";import{c as _t}from"./vendor-cytoscape-BQaXIfA_.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();var vt=yt(),xt=wt();const f={TURTLESIM_UPDATE:"turtlesim-update",LIDAR_UPDATE:"lidar-update",MAP_UPDATE:"map-update",ROBOT_POSE_UPDATE:"robot-pose-update",SHOW_MAP:"show-map",TOGGLE_MAP_OVERLAY:"toggle-map-overlay",PATH_PLANNED:"path-planned",PATH_CLEARED:"path-cleared",LOOP_CLOSURE_DETECTED:"loop-closure-detected",PROCESS_STARTED:"process-started",PROCESS_STOPPED:"process-stopped",WORLD_STATE_CHANGED:"world-state-changed",LAYOUT_RESIZE:"layout-resize",TELEOP_ACTIVE:"teleop-active",TELEOP_INACTIVE:"teleop-inactive",TOGGLE_GRAPH:"toggle-graph",TOGGLE_CONSOLE:"toggle-console",CANVAS_EDIT_MODE_CHANGED:"canvas-edit-mode-changed",OPEN_RQT_MODAL:"open-rqt-modal"};class Tt{constructor(t,e={}){this.container=t,this.id=e.id||`term_${Date.now()}`,this.onCommand=e.onCommand||(()=>{}),this.onInterrupt=e.onInterrupt||(()=>{}),this.history=[],this.historyIndex=-1,this.maxHistory=100,this.currentLine="",this.cursorPosition=0,this.prompt="ros2@sim:~$ ",this.isProcessing=!1,this.waitingForInput=!1,this.focused=!1,this.teleopActive=!1,this.teleopType=null,this.activeSubscriptions=[],this.activeBagRecorders=[],this._initTerminal()}_initTerminal(){this.xterm=new vt.Terminal({theme:{background:"#1e1e1e",foreground:"#d4d4d4",cursor:"#ffffff",cursorAccent:"#1e1e1e",selection:"rgba(255, 255, 255, 0.3)",black:"#000000",red:"#cd3131",green:"#0dbc79",yellow:"#e5e510",blue:"#2472c8",magenta:"#bc3fbc",cyan:"#11a8cd",white:"#e5e5e5",brightBlack:"#666666",brightRed:"#f14c4c",brightGreen:"#23d18b",brightYellow:"#f5f543",brightBlue:"#3b8eea",brightMagenta:"#d670d6",brightCyan:"#29b8db",brightWhite:"#ffffff"},fontFamily:'Menlo, Monaco, "Courier New", monospace',fontSize:14,lineHeight:1.2,cursorBlink:!0,cursorStyle:"block",scrollback:1e3,allowTransparency:!0}),this.fitAddon=new xt.FitAddon,this.xterm.loadAddon(this.fitAddon),this.xterm.open(this.container),this.fit(),this.xterm.onData(this._handleInput.bind(this)),this.container.addEventListener("focus",()=>{this.focused=!0},!0),this.container.addEventListener("blur",()=>{this.focused=!1},!0),this.container.addEventListener("mousedown",()=>{this.xterm.focus()}),this._setupContextMenu(),this.writePrompt(),this._setupTeleopListeners()}_setupTeleopListeners(){window.addEventListener(f.TELEOP_ACTIVE,t=>{var e;this.teleopActive=!0,this.teleopType=((e=t.detail)==null?void 0:e.type)||"wasd-keys"}),window.addEventListener(f.TELEOP_INACTIVE,()=>{this.teleopActive=!1,this.teleopType=null})}_setupContextMenu(){this.contextMenu=document.createElement("div"),this.contextMenu.className="terminal-context-menu",this.contextMenu.innerHTML=`
      <button class="context-menu-item" data-action="copy">Copy</button>
      <button class="context-menu-item" data-action="paste">Paste</button>
      <button class="context-menu-item" data-action="clear">Clear</button>
    `,this.contextMenu.style.display="none",document.body.appendChild(this.contextMenu),this.container.addEventListener("contextmenu",t=>{t.preventDefault(),this._showContextMenu(t.clientX,t.clientY)}),this.contextMenu.addEventListener("click",async t=>{const e=t.target.dataset.action;if(e)switch(this._hideContextMenu(),e){case"copy":await this._handleCopy();break;case"paste":await this._handlePaste();break;case"clear":this.clear(),this.writePrompt(),this._refreshLine();break}}),document.addEventListener("click",t=>{this.contextMenu.contains(t.target)||this._hideContextMenu()}),document.addEventListener("scroll",()=>{this._hideContextMenu()},!0)}_showContextMenu(t,e){this.contextMenu.style.display="block",this.contextMenu.style.left=`${t}px`,this.contextMenu.style.top=`${e}px`;const s=this.contextMenu.getBoundingClientRect();s.right>window.innerWidth&&(this.contextMenu.style.left=`${window.innerWidth-s.width-5}px`),s.bottom>window.innerHeight&&(this.contextMenu.style.top=`${window.innerHeight-s.height-5}px`)}_hideContextMenu(){this.contextMenu.style.display="none"}async _handleCopy(){const t=this.xterm.getSelection();if(t)try{await navigator.clipboard.writeText(t)}catch(e){console.error("Failed to copy:",e)}}async _handlePaste(){try{const t=await navigator.clipboard.readText();if(t)for(const e of t)e===`
`||e==="\r"||this._insertChar(e)}catch(t){console.error("Failed to paste:",t)}}_forwardKeyToWindow(t,e){const s=new KeyboardEvent("keydown",{key:t,code:e,bubbles:!0,cancelable:!0});window.dispatchEvent(s),setTimeout(()=>{const i=new KeyboardEvent("keyup",{key:t,code:e,bubbles:!0,cancelable:!0});window.dispatchEvent(i)},50)}_handleInput(t){for(let e=0;e<t.length;e++){const s=t.charCodeAt(e);if(s===3){this._handleInterrupt();continue}if(s!==4){if(s===12){this.clear(),this.writePrompt(),this._refreshLine();continue}if(s===13){this._handleEnter();continue}if(s===127||s===8){this._handleBackspace();continue}if(s===9){this._handleTab();continue}if(s===27){if(e+2<t.length&&t.charCodeAt(e+1)===91){const i=t.charCodeAt(e+2);if(i===65){if(this.teleopActive&&this.teleopType==="arrow-keys"){this._forwardKeyToWindow("ArrowUp","ArrowUp"),e+=2;continue}this._historyUp(),e+=2;continue}if(i===66){if(this.teleopActive&&this.teleopType==="arrow-keys"){this._forwardKeyToWindow("ArrowDown","ArrowDown"),e+=2;continue}this._historyDown(),e+=2;continue}if(i===67){if(this.teleopActive&&this.teleopType==="arrow-keys"){this._forwardKeyToWindow("ArrowRight","ArrowRight"),e+=2;continue}this._cursorRight(),e+=2;continue}if(i===68){if(this.teleopActive&&this.teleopType==="arrow-keys"){this._forwardKeyToWindow("ArrowLeft","ArrowLeft"),e+=2;continue}this._cursorLeft(),e+=2;continue}if(i===72){this._cursorHome(),e+=2;continue}if(i===70){this._cursorEnd(),e+=2;continue}if(i===51&&e+3<t.length&&t.charCodeAt(e+3)===126){this._handleDelete(),e+=3;continue}}continue}if(s>=32&&s<127){if(this.teleopActive&&this.teleopType==="wasd-keys"){const i=t[e].toUpperCase();if("WASDQE".includes(i)){this._forwardKeyToWindow(i,`Key${i}`);continue}}this._insertChar(t[e])}}}}_insertChar(t){this.isProcessing||(this.currentLine=this.currentLine.slice(0,this.cursorPosition)+t+this.currentLine.slice(this.cursorPosition),this.cursorPosition++,this._refreshLine())}_handleBackspace(){this.isProcessing||this.cursorPosition!==0&&(this.currentLine=this.currentLine.slice(0,this.cursorPosition-1)+this.currentLine.slice(this.cursorPosition),this.cursorPosition--,this._refreshLine())}_handleDelete(){this.isProcessing||this.cursorPosition>=this.currentLine.length||(this.currentLine=this.currentLine.slice(0,this.cursorPosition)+this.currentLine.slice(this.cursorPosition+1),this._refreshLine())}_handleEnter(){if(this.isProcessing)return;this.xterm.write(`\r
`);const t=this.currentLine.trim();this.currentLine="",this.cursorPosition=0,t?(this.history[this.history.length-1]!==t&&(this.history.push(t),this.history.length>this.maxHistory&&this.history.shift()),this.historyIndex=this.history.length,this.isProcessing=!0,this.onCommand(t,this)):this.writePrompt()}_handleInterrupt(){for(const t of this.activeSubscriptions)t.destroy&&t.destroy();this.activeSubscriptions=[];for(const t of this.activeBagRecorders)t.stop&&t.stop();this.activeBagRecorders=[],this.onInterrupt(this),this.xterm.write(`^C\r
`),this.currentLine="",this.cursorPosition=0,this.isProcessing=!1,this.writePrompt()}_handleTab(){this._insertChar(" "),this._insertChar(" ")}_historyUp(){this.isProcessing||this.historyIndex<=0||(this.historyIndex--,this.currentLine=this.history[this.historyIndex],this.cursorPosition=this.currentLine.length,this._refreshLine())}_historyDown(){if(!this.isProcessing){if(this.historyIndex>=this.history.length-1){this.historyIndex=this.history.length,this.currentLine="",this.cursorPosition=0,this._refreshLine();return}this.historyIndex++,this.currentLine=this.history[this.historyIndex],this.cursorPosition=this.currentLine.length,this._refreshLine()}}_cursorLeft(){this.cursorPosition>0&&(this.cursorPosition--,this.xterm.write("\x1B[D"))}_cursorRight(){this.cursorPosition<this.currentLine.length&&(this.cursorPosition++,this.xterm.write("\x1B[C"))}_cursorHome(){for(;this.cursorPosition>0;)this.cursorPosition--,this.xterm.write("\x1B[D")}_cursorEnd(){for(;this.cursorPosition<this.currentLine.length;)this.cursorPosition++,this.xterm.write("\x1B[C")}_refreshLine(){this.prompt.length,this.xterm.write("\r"),this.xterm.write("\x1B[K"),this.xterm.write(this.prompt+this.currentLine);const t=this.currentLine.length-this.cursorPosition;t>0&&this.xterm.write(`\x1B[${t}D`)}write(t){this.xterm.write(t)}writeln(t){this.xterm.write(t+`\r
`)}writePrompt(){this.xterm.write(this.prompt)}setPrompt(t){this.prompt=t}finishCommand(){this.isProcessing=!1,this.writePrompt()}clear(){this.xterm.clear()}fit(){try{this.fitAddon.fit()}catch{}}focus(){this.xterm.focus()}addSubscription(t){this.activeSubscriptions.push(t)}removeSubscription(t){const e=this.activeSubscriptions.indexOf(t);e>=0&&this.activeSubscriptions.splice(e,1)}addBagRecorder(t){this.activeBagRecorders.push(t)}removeBagRecorder(t){const e=this.activeBagRecorders.indexOf(t);e>=0&&this.activeBagRecorders.splice(e,1)}destroy(){for(const t of this.activeSubscriptions)t.destroy&&t.destroy();this.activeSubscriptions=[];for(const t of this.activeBagRecorders)t.stop&&t.stop();this.activeBagRecorders=[],this.contextMenu&&this.contextMenu.parentNode&&this.contextMenu.parentNode.removeChild(this.contextMenu),this.xterm.dispose()}}class St{constructor(){this._services=new Map}register(t,e){this._services.set(t,e)}get(t){return this._services.get(t)}has(t){return this._services.has(t)}reset(){this._services.clear()}getServiceNames(){return Array.from(this._services.keys())}}const N=new St,R={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4};class It{constructor(){this.logs=[],this.maxLogs=1e3,this.listeners=[],this.defaultLevel=R.INFO,this.nodeLevels=new Map,this.paused=!1}getLogger(t){return{debug:e=>this._log(t,"DEBUG",e),info:e=>this._log(t,"INFO",e),warn:e=>this._log(t,"WARN",e),error:e=>this._log(t,"ERROR",e),fatal:e=>this._log(t,"FATAL",e)}}_log(t,e,s){const i=R[e],o=this.nodeLevels.get(t)??this.defaultLevel;if(i<o)return;const r={timestamp:Date.now(),node:t,level:e,levelValue:i,message:s};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift();const a=`[${t}] [${e}]: ${s}`;switch(e){case"DEBUG":console.debug(a);break;case"INFO":console.info(a);break;case"WARN":console.warn(a);break;case"ERROR":case"FATAL":console.error(a);break}if(!this.paused)for(const l of this.listeners)try{l(r)}catch(c){console.error("Error in log listener:",c)}}setNodeLevel(t,e){const s=R[e.toUpperCase()];s!==void 0&&this.nodeLevels.set(t,s)}setDefaultLevel(t){const e=R[t.toUpperCase()];e!==void 0&&(this.defaultLevel=e)}addListener(t){return this.listeners.push(t),()=>{const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}}getLogs(t={}){let e=[...this.logs];if(t.level){const s=R[t.level.toUpperCase()]??0;e=e.filter(i=>i.levelValue>=s)}return t.node&&(e=e.filter(s=>s.node.includes(t.node))),t.since&&(e=e.filter(s=>s.timestamp>=t.since)),e}clear(){this.logs=[]}pause(){this.paused=!0}resume(){this.paused=!1}formatEntry(t){const s=new Date(t.timestamp).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"}),i=String(t.timestamp%1e3).padStart(3,"0");return`[${s}.${i}] [${t.node}] [${t.level}]: ${t.message}`}getLevels(){return Object.keys(R)}parseLevel(t){return R[t.toUpperCase()]}}const E=new It;N.register("logManager",E);class Ct{constructor(){this.processes=new Map,this.nextProcessId=1,this.logger=E.getLogger("/process_manager")}spawn(t,e,s,i){const o=`proc_${this.nextProcessId++}`;return this.processes.set(o,{node:t,terminalId:e,package:s,executable:i,startTime:Date.now()}),t.start(),this.logger.info(`Spawned ${s}/${i} as ${t.fullName} (pid: ${o})`),window.dispatchEvent(new CustomEvent(f.PROCESS_STARTED,{detail:{processId:o,terminalId:e,nodeName:t.fullName}})),o}kill(t){const e=this.processes.get(t);if(!e)return!1;const s=e.terminalId,i=e.node.fullName;return e.node.destroy(),this.processes.delete(t),this.logger.info(`Killed process ${t}`),window.dispatchEvent(new CustomEvent(f.PROCESS_STOPPED,{detail:{processId:t,terminalId:s,nodeName:i}})),!0}killByNodeName(t){for(const[e,s]of this.processes)if(s.node.fullName===t)return this.kill(e);return!1}killByTerminal(t){let e=0;const s=[];for(const[i,o]of this.processes)o.terminalId===t&&s.push(i);for(const i of s)this.kill(i)&&e++;return e}getProcess(t){return this.processes.get(t)||null}getProcessByNodeName(t){for(const[e,s]of this.processes)if(s.node.fullName===t)return{processId:e,...s};return null}getProcessesByTerminal(t){const e=[];for(const[s,i]of this.processes)i.terminalId===t&&e.push({processId:s,...i});return e}getAllProcesses(){const t=[];for(const[e,s]of this.processes)t.push({processId:e,...s});return t}isNodeRunning(t){for(const[,e]of this.processes)if(e.node.fullName===t)return!0;return!1}getProcessCount(){return this.processes.size}killAll(){const t=Array.from(this.processes.keys());for(const e of t)this.kill(e)}}const P=new Ct;N.register("processManager",P);class kt{constructor(t={}){this.containerId=t.containerId||"terminals-container",this.tabListId=t.tabListId||"terminal-tabs",this.addButtonId=t.addButtonId||"add-terminal",this.maxTerminals=t.maxTerminals||4,this.onCommand=t.onCommand||(()=>{}),this.terminals=new Map,this.activeTerminalId=null,this.nextTerminalNum=1,this.container=document.getElementById(this.containerId),this.tabList=document.querySelector(`#${this.tabListId} .tab-list`),this.addButton=document.getElementById(this.addButtonId),this._setupEventListeners(),this._addTerminal()}_setupEventListeners(){var t;(t=this.addButton)==null||t.addEventListener("click",()=>{this._addTerminal()}),window.addEventListener("resize",()=>{this._resizeAll()}),window.addEventListener(f.LAYOUT_RESIZE,()=>{setTimeout(()=>this._resizeAll(),100)}),window.addEventListener(f.PROCESS_STARTED,e=>{const{terminalId:s}=e.detail||{};s&&this._updateTabIndicator(s,!0)}),window.addEventListener(f.PROCESS_STOPPED,e=>{const{terminalId:s}=e.detail||{};s&&this._updateTabIndicator(s,!1)})}_updateTabIndicator(t,e){const s=this.terminals.get(t);if(!s)return;const i=s.tab.querySelector(".tab-status");i&&i.classList.toggle("running",e)}_addTerminal(){if(this.terminals.size>=this.maxTerminals)return null;const t=`terminal_${this.nextTerminalNum++}`,e=this.terminals.size+1,s=document.createElement("div");s.id=t,s.className="terminal-pane",this.container.appendChild(s);const i=document.createElement("div");i.className="terminal-tab",i.dataset.termId=t,i.setAttribute("role","tab"),i.setAttribute("aria-selected","false"),i.innerHTML=`
      <span class="tab-status" aria-hidden="true"></span>
      <span class="tab-title">Terminal ${e}</span>
      <button class="tab-close" aria-label="Close terminal ${e}">&times;</button>
    `,this.tabList.appendChild(i),i.addEventListener("click",r=>{r.target.classList.contains("tab-close")||this._activateTerminal(t)}),i.querySelector(".tab-close").addEventListener("click",r=>{r.stopPropagation(),this._removeTerminal(t)});const o=new Tt(s,{id:t,onCommand:(r,a)=>this.onCommand(r,a),onInterrupt:r=>this._handleInterrupt(r)});return this.terminals.set(t,{terminal:o,tab:i,container:s}),this._activateTerminal(t),this._updateAddButton(),o}_removeTerminal(t){const e=this.terminals.get(t);if(e&&!(this.terminals.size<=1)){if(P.killByTerminal(t),e.terminal.destroy(),e.container.remove(),e.tab.remove(),this.terminals.delete(t),this.activeTerminalId===t){const s=this.terminals.keys().next().value;s&&this._activateTerminal(s)}this._renumberTabs(),this._updateAddButton()}}_activateTerminal(t){const e=this.terminals.get(t);if(e){if(this.activeTerminalId&&this.activeTerminalId!==t){const s=this.terminals.get(this.activeTerminalId);s&&(s.tab.classList.remove("active"),s.tab.setAttribute("aria-selected","false"),s.container.classList.remove("active"))}e.tab.classList.add("active"),e.tab.setAttribute("aria-selected","true"),e.container.classList.add("active"),this.activeTerminalId=t,setTimeout(()=>{e.terminal.focus(),e.terminal.fit()},0)}}_handleInterrupt(t){P.killByTerminal(t.id)}_renumberTabs(){let t=1;for(const[,e]of this.terminals){const s=e.tab.querySelector(".tab-title");s&&(s.textContent=`Terminal ${t}`),t++}}_updateAddButton(){this.addButton&&(this.addButton.style.display=this.terminals.size>=this.maxTerminals?"none":"block")}_resizeAll(){for(const[,t]of this.terminals)t.terminal.fit()}getActiveTerminal(){if(!this.activeTerminalId)return null;const t=this.terminals.get(this.activeTerminalId);return(t==null?void 0:t.terminal)||null}getTerminal(t){var e;return((e=this.terminals.get(t))==null?void 0:e.terminal)||null}getAllTerminals(){return Array.from(this.terminals.values()).map(t=>t.terminal)}getTerminalCount(){return this.terminals.size}clearAll(){for(const[,t]of this.terminals)t.terminal.clear(),t.terminal.writePrompt()}focus(){const t=this.getActiveTerminal();t&&t.focus()}destroy(){for(const[t]of this.terminals){const e=this.terminals.get(t);e&&(P.killByTerminal(t),e.terminal.destroy())}this.terminals.clear(),this.container.innerHTML="",this.tabList.innerHTML=""}}class Lt{constructor(){this.width=11,this.height=11,this.obstacles=[],this.turtles=new Map,this.onChangeCallback=null,this._initDefaultObstacles()}setOnChangeCallback(t){this.onChangeCallback=t}_initDefaultObstacles(){this.obstacles=[{type:"wall",x:0,y:0,width:11,height:.1},{type:"wall",x:0,y:10.9,width:11,height:.1},{type:"wall",x:0,y:0,width:.1,height:11},{type:"wall",x:10.9,y:0,width:.1,height:11},{type:"box",x:3,y:3,width:1.5,height:1.5},{type:"box",x:7,y:2,width:1,height:2},{type:"box",x:2,y:7,width:2,height:1},{type:"box",x:6,y:6,width:1.5,height:1.5},{type:"box",x:8,y:8,width:1,height:1}]}addObstacle(t){this.obstacles.push(t)}removeObstacle(t){t>=0&&t<this.obstacles.length&&this.obstacles.splice(t,1)}clearObstacles(){this.obstacles=[]}resetObstacles(){this._initDefaultObstacles(),this._notifyChange()}randomizeObstacles(t=5,e={}){const{minSize:s=.5,maxSize:i=2,keepWalls:o=!0,margin:r=1.5}=e;o?this.obstacles=this.obstacles.filter(a=>a.type==="wall"):this.obstacles=[];for(let a=0;a<t;a++){const l=s+Math.random()*(i-s),c=s+Math.random()*(i-s);let h,d,u=0;const m=50;do h=.5+Math.random()*(this.width-l-1),d=.5+Math.random()*(this.height-c-1),u++;while(u<m&&(this._obstacleOverlaps(h,d,l,c)||this._tooCloseToCenter(h,d,l,c,r)));u<m&&this.obstacles.push({type:"box",x:h,y:d,width:l,height:c})}this._notifyChange()}_obstacleOverlaps(t,e,s,i,o=.3){for(const r of this.obstacles){if(r.type==="wall")continue;const a=t<r.x+r.width+o&&t+s+o>r.x,l=e<r.y+r.height+o&&e+i+o>r.y;if(a&&l)return!0}return!1}_tooCloseToCenter(t,e,s,i,o){const r=this.width/2,a=this.height/2,l=Math.max(t,Math.min(r,t+s)),c=Math.max(e,Math.min(a,e+i)),h=r-l,d=a-c;return Math.sqrt(h*h+d*d)<o}findObstacleAt(t,e){for(let s=this.obstacles.length-1;s>=0;s--){const i=this.obstacles[s];if(i.type!=="wall"&&t>=i.x&&t<=i.x+i.width&&e>=i.y&&e<=i.y+i.height)return s}return-1}addObstacleAt(t,e,s=1,i=1){const o={type:"box",x:t-s/2,y:e-i/2,width:s,height:i};return o.x=Math.max(.2,Math.min(this.width-s-.2,o.x)),o.y=Math.max(.2,Math.min(this.height-i-.2,o.y)),this.obstacles.push(o),this._notifyChange(),this.obstacles.length-1}removeObstacleAt(t,e){const s=this.findObstacleAt(t,e);return s>=0?(this.obstacles.splice(s,1),this._notifyChange(),!0):!1}clearNonWallObstacles(){this.obstacles=this.obstacles.filter(t=>t.type==="wall"),this._notifyChange()}_notifyChange(){this.onChangeCallback?this.onChangeCallback():window.dispatchEvent(new CustomEvent(f.WORLD_STATE_CHANGED))}getObstacleCount(){return this.obstacles.filter(t=>t.type!=="wall").length}registerTurtle(t,e,s,i){this.turtles.set(t,{x:e,y:s,theta:i})}updateTurtle(t,e,s,i){this.turtles.has(t)&&this.turtles.set(t,{x:e,y:s,theta:i})}removeTurtle(t){this.turtles.delete(t)}getTurtle(t){return this.turtles.get(t)}checkCollision(t,e,s=.2){if(t-s<0||t+s>this.width||e-s<0||e+s>this.height)return!0;for(const i of this.obstacles)if(this._circleRectCollision(t,e,s,i.x,i.y,i.width,i.height))return!0;return!1}_circleRectCollision(t,e,s,i,o,r,a){const l=Math.max(i,Math.min(t,i+r)),c=Math.max(o,Math.min(e,o+a)),h=t-l,d=e-c;return h*h+d*d<s*s}raycast(t,e,s,i=10){const o=Math.cos(s),r=Math.sin(s);let a=null,l=i;for(const h of this.obstacles){const d=this._rayRectIntersection(t,e,o,r,h.x,h.y,h.width,h.height);d&&d.distance<l&&(l=d.distance,a=d)}const c=[this._rayLineIntersection(t,e,o,r,0,0,this.width,0),this._rayLineIntersection(t,e,o,r,0,this.height,this.width,this.height),this._rayLineIntersection(t,e,o,r,0,0,0,this.height),this._rayLineIntersection(t,e,o,r,this.width,0,this.width,this.height)];for(const h of c)h&&h.distance>0&&h.distance<l&&(l=h.distance,a=h);return a?{hit:!0,distance:l,point:a.point}:{hit:!1,distance:i,point:{x:t+o*i,y:e+r*i}}}_rayRectIntersection(t,e,s,i,o,r,a,l){const c=[{x1:o,y1:r,x2:o+a,y2:r},{x1:o,y1:r+l,x2:o+a,y2:r+l},{x1:o,y1:r,x2:o,y2:r+l},{x1:o+a,y1:r,x2:o+a,y2:r+l}];let h=null,d=1/0;for(const u of c){const m=this._rayLineIntersection(t,e,s,i,u.x1,u.y1,u.x2,u.y2);m&&m.distance>.001&&m.distance<d&&(d=m.distance,h=m)}return h}_rayLineIntersection(t,e,s,i,o,r,a,l){const c=a-o,h=l-r,d=s*h-i*c;if(Math.abs(d)<1e-4)return null;const u=((o-t)*h-(r-e)*c)/d,m=((o-t)*i-(r-e)*s)/d;return u>0&&m>=0&&m<=1?{distance:u,point:{x:t+s*u,y:e+i*u}}:null}lidarScan(t,e,s,i={}){const{angleMin:o=-Math.PI,angleMax:r=Math.PI,angleIncrement:a=Math.PI/180,rangeMin:l=.1,rangeMax:c=10,numRays:h=360}=i,d=[],u=[],m=(r-o)/h;for(let b=0;b<h;b++){const y=s+o+b*m,w=this.raycast(t,e,y,c);w.hit&&w.distance>=l?(d.push(w.distance),u.push(1)):(w.distance<l,d.push(1/0),u.push(0))}return{angle_min:o,angle_max:r,angle_increment:m,time_increment:0,scan_time:.1,range_min:l,range_max:c,ranges:d,intensities:u}}getObstacles(){return this.obstacles}}const S=new Lt;N.register("worldState",S);class Pt{constructor(t="turtle-canvas"){typeof t=="string"?this.canvas=document.getElementById(t):this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.worldWidth=11,this.worldHeight=11,this.turtleImage=new Image,this.turtleImageLoaded=!1,this._loadTurtleImage(),this.showObstacles=!0,this.showLidar=!1,this.showTF=!1,this.showMap=!1,this.mapOpacity=.5,this.mapData=null,this.mapInfo=null,this.mapCanvas=null,this._resizeScheduled=!1,this.editMode="none",this.newObstacleSize=1,this.turtles=[],this.trails=[],this.background={r:69,g:86,b:255},this.lidarData=null,this.hasTurtlesim=!1,this._setupEventListeners(),this._setupClickHandlers(),this._render()}_loadTurtleImage(){const t=`
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48">
        <!-- Shell -->
        <ellipse cx="24" cy="24" rx="16" ry="14" fill="#228B22" stroke="#006400" stroke-width="2"/>
        <!-- Shell pattern -->
        <path d="M24 10 L24 38" stroke="#006400" stroke-width="1"/>
        <path d="M12 24 L36 24" stroke="#006400" stroke-width="1"/>
        <path d="M16 14 L32 34" stroke="#006400" stroke-width="1"/>
        <path d="M32 14 L16 34" stroke="#006400" stroke-width="1"/>
        <!-- Head -->
        <circle cx="40" cy="24" r="6" fill="#90EE90" stroke="#228B22" stroke-width="1.5"/>
        <!-- Eyes -->
        <circle cx="42" cy="22" r="1.5" fill="#000"/>
        <circle cx="42" cy="26" r="1.5" fill="#000"/>
        <!-- Legs -->
        <ellipse cx="14" cy="12" rx="5" ry="4" fill="#90EE90" stroke="#228B22" stroke-width="1"/>
        <ellipse cx="14" cy="36" rx="5" ry="4" fill="#90EE90" stroke="#228B22" stroke-width="1"/>
        <ellipse cx="30" cy="12" rx="5" ry="4" fill="#90EE90" stroke="#228B22" stroke-width="1"/>
        <ellipse cx="30" cy="36" rx="5" ry="4" fill="#90EE90" stroke="#228B22" stroke-width="1"/>
        <!-- Tail -->
        <path d="M6 24 Q2 24 4 22" stroke="#90EE90" stroke-width="3" fill="none"/>
      </svg>
    `,e=new Blob([t],{type:"image/svg+xml"}),s=URL.createObjectURL(e);this.turtleImage.onload=()=>{this.turtleImageLoaded=!0,URL.revokeObjectURL(s),this._render()},this.turtleImage.src=s}_setupEventListeners(){window.addEventListener(f.TURTLESIM_UPDATE,t=>{const{turtles:e,trails:s,background:i}=t.detail;this.turtles=e,this.trails=s,this.background=i,this.hasTurtlesim=e&&e.length>0,this._render()}),window.addEventListener(f.LIDAR_UPDATE,t=>{this.lidarData=t.detail,this.showLidar&&this._render()}),window.addEventListener(f.MAP_UPDATE,t=>{const{map:e,info:s}=t.detail;this.mapData=e,this.mapInfo=s,this._updateMapCanvas(),this.showMap&&this._render()}),window.addEventListener("resize",()=>this._handleResize()),window.addEventListener(f.LAYOUT_RESIZE,()=>this._handleResize()),window.addEventListener(f.WORLD_STATE_CHANGED,()=>this._render()),this._handleResize()}_setupClickHandlers(){this.canvas.addEventListener("click",t=>{if(this.editMode==="none")return;const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,o=this._canvasToWorld(s,i);this.editMode==="add"?S.addObstacleAt(o.x,o.y,this.newObstacleSize,this.newObstacleSize):this.editMode==="delete"&&S.removeObstacleAt(o.x,o.y)}),this.canvas.addEventListener("mousemove",t=>{if(this.editMode==="none")this.canvas.style.cursor="default";else if(this.editMode==="add")this.canvas.style.cursor="crosshair";else if(this.editMode==="delete"){const e=this.canvas.getBoundingClientRect(),s=t.clientX-e.left,i=t.clientY-e.top,o=this._canvasToWorld(s,i),r=S.findObstacleAt(o.x,o.y);this.canvas.style.cursor=r>=0?"pointer":"not-allowed"}})}_canvasToWorld(t,e){const s=this.worldWidth/this.canvas.width,i=this.worldHeight/this.canvas.height;return{x:t*s,y:(this.canvas.height-e)*i}}_handleResize(){this._resizeScheduled||(this._resizeScheduled=!0,requestAnimationFrame(()=>{this._resizeScheduled=!1;const t=this.canvas.parentElement;if(!t)return;const e=t.getBoundingClientRect();if(e.width===0||e.height===0)return;const s=Math.min(e.width,e.height,500);this.canvas.width=s,this.canvas.height=s,this._render()}))}_worldToCanvas(t,e){const s=this.canvas.width/this.worldWidth,i=this.canvas.height/this.worldHeight;return{x:t*s,y:this.canvas.height-e*i}}_worldToCanvasScale(t){return t/this.worldWidth*this.canvas.width}_updateMapCanvas(){if(!this.mapData||!this.mapInfo)return;const{width:t,height:e,resolution:s,origin:i}=this.mapInfo;if(!t||!e)return;this.mapCanvas||(this.mapCanvas=document.createElement("canvas")),this.mapCanvas.width=t,this.mapCanvas.height=e;const o=this.mapCanvas.getContext("2d"),r=o.createImageData(t,e);for(let a=0;a<e;a++)for(let l=0;l<t;l++){const c=a*t+l,h=this.mapData[c],u=((e-1-a)*t+l)*4;let m,b,y;if(h===-1)m=100,b=100,y=120;else if(h<=10)m=220,b=255,y=220;else if(h>=65)m=180-Math.min(100,h),b=20,y=20;else{const w=(h-10)/55;m=Math.round(255-w*75),b=Math.round(180-w*160),y=Math.round(100-w*80)}r.data[u]=m,r.data[u+1]=b,r.data[u+2]=y,r.data[u+3]=255}o.putImageData(r,0,0)}_renderMapOverlay(){if(!this.mapCanvas||!this.mapInfo)return;const t=this.ctx,{width:e,height:s,resolution:i,origin:o}=this.mapInfo;t.save(),t.globalAlpha=this.mapOpacity,t.imageSmoothingEnabled=!1,t.drawImage(this.mapCanvas,0,0,this.canvas.width,this.canvas.height),t.restore()}_render(){const t=this.ctx,e=this.canvas.width,s=this.canvas.height;if(t.fillStyle=`rgb(${this.background.r}, ${this.background.g}, ${this.background.b})`,t.fillRect(0,0,e,s),this.showMap&&this._renderMapOverlay(),this.showObstacles&&this._renderObstacles(),!this.hasTurtlesim){this._renderEmptyState();return}this._renderTrails(),this.showLidar&&this.lidarData&&this._renderLidar(),this._renderTurtles(),this.showTF&&this._renderTFFrames()}_renderEmptyState(){const t=this.ctx,e=this.canvas.width,s=this.canvas.height;t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,e,s),t.fillStyle="#ffffff",t.font='14px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.textAlign="center",t.textBaseline="middle",t.fillText("Run: ros2 run turtlesim turtlesim_node",e/2,s/2),t.font='12px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',t.fillStyle="rgba(255, 255, 255, 0.7)",t.fillText("to start the simulation",e/2,s/2+20)}_renderObstacles(){const t=this.ctx,e=S.getObstacles();t.fillStyle="rgba(100, 100, 100, 0.8)",t.strokeStyle="#444",t.lineWidth=2;for(const s of e){const i=this._worldToCanvas(s.x,s.y+s.height),o=this._worldToCanvasScale(s.width),r=this._worldToCanvasScale(s.height);t.fillRect(i.x,i.y,o,r),t.strokeRect(i.x,i.y,o,r)}}_renderTrails(){const t=this.ctx;for(const e of this.trails){const s=this._worldToCanvas(e.x1,e.y1),i=this._worldToCanvas(e.x2,e.y2);t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(i.x,i.y),t.strokeStyle=e.color,t.lineWidth=e.width,t.lineCap="round",t.stroke()}}_renderTurtles(){const t=this.ctx,e=this._worldToCanvasScale(1.2);for(const s of this.turtles){const i=this._worldToCanvas(s.x,s.y);t.save(),t.translate(i.x,i.y),t.rotate(-s.theta),this.turtleImageLoaded?t.drawImage(this.turtleImage,-e/2,-e/2,e,e):(t.beginPath(),t.moveTo(e/2,0),t.lineTo(-e/2,-e/3),t.lineTo(-e/2,e/3),t.closePath(),t.fillStyle="#00ff00",t.fill(),t.strokeStyle="#006400",t.stroke()),t.restore()}}_renderLidar(){const t=this.ctx,{x:e,y:s,theta:i,scan:o}=this.lidarData;if(!o||!o.ranges)return;const r=this._worldToCanvas(e,s);t.strokeStyle="rgba(255, 0, 0, 0.3)",t.lineWidth=1;const{angle_min:a,angle_increment:l,ranges:c}=o;for(let h=0;h<c.length;h++){const d=c[h];if(!isFinite(d))continue;const u=i+a+h*l,m=e+Math.cos(u)*d,b=s+Math.sin(u)*d,y=this._worldToCanvas(m,b);t.beginPath(),t.moveTo(r.x,r.y),t.lineTo(y.x,y.y),t.stroke(),d<o.range_max-.1&&(t.fillStyle="red",t.beginPath(),t.arc(y.x,y.y,2,0,Math.PI*2),t.fill())}}_renderTFFrames(){const t=this.ctx,e=this._worldToCanvasScale(.5);for(const s of this.turtles){const i=this._worldToCanvas(s.x,s.y);t.save(),t.translate(i.x,i.y),t.rotate(-s.theta),t.beginPath(),t.moveTo(0,0),t.lineTo(e,0),t.strokeStyle="red",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(0,-e),t.strokeStyle="green",t.stroke(),t.restore()}}toggleObstacles(){this.showObstacles=!this.showObstacles,this._render()}toggleLidar(){this.showLidar=!this.showLidar,this._render()}toggleTF(){this.showTF=!this.showTF,this._render()}clearTrails(){this.trails=[],this._render()}setEditMode(t){this.editMode=t,this.canvas.style.cursor=t==="none"?"default":t==="add"?"crosshair":"pointer",window.dispatchEvent(new CustomEvent(f.CANVAS_EDIT_MODE_CHANGED,{detail:{mode:t}}))}getEditMode(){return this.editMode}setObstacleSize(t){this.newObstacleSize=Math.max(.3,Math.min(3,t))}randomizeObstacles(t=5){S.randomizeObstacles(t)}clearObstacles(){S.clearNonWallObstacles()}resetObstacles(){S.resetObstacles()}toggleMap(){return this.showMap=!this.showMap,this._render(),this.showMap}setMapOpacity(t){this.mapOpacity=Math.max(0,Math.min(1,t)),this.showMap&&this._render()}getMapOpacity(){return this.mapOpacity}isMapVisible(){return this.showMap}}class Mt{constructor(t="map-canvas"){typeof t=="string"?this.canvas=document.getElementById(t):this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.mapData=null,this.mapInfo=null,this.robotX=0,this.robotY=0,this.robotTheta=0,this._setupEventListeners(),this._render()}_setupEventListeners(){window.addEventListener(f.MAP_UPDATE,t=>{const{map:e,info:s}=t.detail;this.mapData=e,this.mapInfo=s,this._render()}),window.addEventListener(f.ROBOT_POSE_UPDATE,t=>{const{x:e,y:s,theta:i}=t.detail;this.robotX=e,this.robotY=s,this.robotTheta=i,this._render()}),window.addEventListener("resize",()=>this._handleResize()),window.addEventListener(f.LAYOUT_RESIZE,()=>this._handleResize()),this._handleResize()}_handleResize(){const t=this.canvas.parentElement;if(!t)return;const e=t.getBoundingClientRect(),s=Math.min(e.width,e.height,500);this.canvas.width=s,this.canvas.height=s,this._render()}_mapToCanvas(t,e){if(!this.mapInfo)return{x:0,y:0};const{width:s,height:i,resolution:o,origin:r}=this.mapInfo,a=r.position.x+t*o,l=r.position.y+e*o,c=s*o,h=i*o,d=this.canvas.width/c,u=this.canvas.height/h;return{x:(a-r.position.x)*d,y:this.canvas.height-(l-r.position.y)*u}}_worldToCanvas(t,e){if(!this.mapInfo){const d=this.canvas.width/11;return{x:t*d,y:this.canvas.height-e*d}}const{width:s,height:i,resolution:o,origin:r}=this.mapInfo,a=s*o,l=i*o,c=this.canvas.width/a,h=this.canvas.height/l;return{x:(t-r.position.x)*c,y:this.canvas.height-(e-r.position.y)*h}}_render(){const t=this.ctx,e=this.canvas.width,s=this.canvas.height;t.fillStyle="#808080",t.fillRect(0,0,e,s),this.mapData&&this.mapInfo&&this._renderOccupancyGrid(),this._renderRobot()}_renderOccupancyGrid(){const t=this.ctx,{width:e,height:s,resolution:i,origin:o}=this.mapInfo,r=this.mapData,a=this.canvas.width/e,l=this.canvas.height/s,c=t.createImageData(this.canvas.width,this.canvas.height),h=c.data;for(let d=0;d<s;d++)for(let u=0;u<e;u++){const m=d*e+u,b=r[m],y=s-1-d;let w,x,_;b===-1?w=x=_=128:b===0?w=x=_=255:w=x=_=Math.max(0,255-b*2.55);for(let T=0;T<Math.ceil(l);T++)for(let C=0;C<Math.ceil(a);C++){const k=Math.floor(u*a)+C,L=Math.floor(y*l)+T;if(k<this.canvas.width&&L<this.canvas.height){const M=(L*this.canvas.width+k)*4;h[M]=w,h[M+1]=x,h[M+2]=_,h[M+3]=255}}}t.putImageData(c,0,0)}_renderRobot(){const t=this.ctx,e=this._worldToCanvas(this.robotX,this.robotY),s=15;t.save(),t.translate(e.x,e.y),t.rotate(-this.robotTheta),t.beginPath(),t.moveTo(s,0),t.lineTo(-s/2,-s/2),t.lineTo(-s/3,0),t.lineTo(-s/2,s/2),t.closePath(),t.fillStyle="rgba(0, 150, 255, 0.8)",t.fill(),t.strokeStyle="#0066cc",t.lineWidth=2,t.stroke(),t.restore()}updateMap(t,e){this.mapData=t,this.mapInfo=e,this._render()}updateRobotPose(t,e,s){this.robotX=t,this.robotY=e,this.robotTheta=s,this._render()}clear(){this.mapData=null,this.mapInfo=null,this._render()}}class Et{subscribe(t,e,s){throw new Error("subscribe() must be implemented")}unsubscribe(t){throw new Error("unsubscribe() must be implemented")}publish(t,e,s){throw new Error("publish() must be implemented")}advertise(t,e,s){throw new Error("advertise() must be implemented")}unadvertise(t){throw new Error("unadvertise() must be implemented")}advertiseService(t,e,s,i){throw new Error("advertiseService() must be implemented")}unadvertiseService(t){throw new Error("unadvertiseService() must be implemented")}callService(t,e,s){throw new Error("callService() must be implemented")}advertiseAction(t,e,s,i){throw new Error("advertiseAction() must be implemented")}unadvertiseAction(t){throw new Error("unadvertiseAction() must be implemented")}sendActionGoal(t,e,s,i){throw new Error("sendActionGoal() must be implemented")}getTopics(){throw new Error("getTopics() must be implemented")}getServices(){throw new Error("getServices() must be implemented")}getActions(){throw new Error("getActions() must be implemented")}destroy(){throw new Error("destroy() must be implemented")}}class j extends Et{constructor(){super(),this.topics=new Map,this.services=new Map,this.actions=new Map,this.nextId=1}_generateId(){return`id_${this.nextId++}`}_ensureTopic(t,e){if(!this.topics.has(t))this.topics.set(t,{type:e,publishers:new Map,subscribers:new Map});else{const s=this.topics.get(t);s.type!==e&&e!=="unknown"&&s.type!=="unknown"&&console.warn(`[WARN] Topic '${t}' already exists with type '${s.type}', but was requested with type '${e}'. In ROS2, all publishers and subscribers on a topic must use the same type.`)}return this.topics.get(t)}subscribe(t,e,s,i=null){const o=this._ensureTopic(t,e),r=this._generateId();return o.subscribers.set(r,{callback:s,msgType:e,nodeId:i}),r}unsubscribe(t){for(const[,e]of this.topics)if(e.subscribers.has(t))return e.subscribers.delete(t),!0;return!1}publish(t,e,s){const i=this.topics.get(t);if(!i)return;const o={...s,_timestamp:s._timestamp||Date.now()};for(const[,r]of i.subscribers)try{r.callback(o)}catch(a){console.error(`Error in subscriber callback for ${t}:`,a)}}advertise(t,e,s){const i=this._ensureTopic(t,e),o=this._generateId();return i.publishers.set(o,{nodeId:s,msgType:e}),o}unadvertise(t){for(const[,e]of this.topics)if(e.publishers.has(t))return e.publishers.delete(t),!0;return!1}advertiseService(t,e,s,i){const o=this._generateId();return this.services.set(t,{id:o,type:e,handler:s,nodeId:i}),o}unadvertiseService(t){for(const[e,s]of this.services)if(s.id===t)return this.services.delete(e),!0;return!1}async callService(t,e,s){const i=this.services.get(t);if(!i)throw new Error(`Service '${t}' not available`);if(i.type!==e)throw new Error(`Service type mismatch: expected ${i.type}, got ${e}`);try{return await i.handler(s)}catch(o){throw new Error(`Service call failed: ${o.message}`)}}advertiseAction(t,e,s,i){const o=this._generateId();return this.actions.set(t,{id:o,type:e,handlers:s,nodeId:i,activeGoals:new Map}),o}unadvertiseAction(t){for(const[e,s]of this.actions)if(s.id===t){for(const[i,o]of s.activeGoals)o.cancelCallback&&o.cancelCallback();return this.actions.delete(e),!0}return!1}async sendActionGoal(t,e,s,i){const o=this.actions.get(t);if(!o)throw new Error(`Action '${t}' not available`);if(o.type!==e)throw new Error(`Action type mismatch: expected ${o.type}, got ${e}`);const r=this._generateId();if(o.handlers.goalCallback&&!await o.handlers.goalCallback(s))throw new Error("Goal rejected");const a={id:r,goal:s,feedbackCallback:i,canceled:!1};o.activeGoals.set(r,a);try{const l=await o.handlers.executeCallback(s,r,c=>{i&&!a.canceled&&i(c)},()=>a.canceled);return o.activeGoals.delete(r),l}catch(l){throw o.activeGoals.delete(r),l}}cancelActionGoal(t,e){const s=this.actions.get(t);if(!s)return!1;const i=s.activeGoals.get(e);return i?(i.canceled=!0,s.handlers.cancelCallback&&s.handlers.cancelCallback(e),!0):!1}getTopics(){const t=[];for(const[e,s]of this.topics)t.push({name:e,type:s.type,publishers:Array.from(s.publishers.values()),subscribers:Array.from(s.subscribers.values())});return t}getServices(){const t=[];for(const[e,s]of this.services)t.push({name:e,type:s.type,node:s.nodeId});return t}getActions(){const t=[];for(const[e,s]of this.actions)t.push({name:e,type:s.type,node:s.nodeId});return t}destroy(){for(const[,t]of this.actions)for(const[e,s]of t.activeGoals)s.canceled=!0;this.topics.clear(),this.services.clear(),this.actions.clear()}}class At{constructor(){this.comm=new j,this.nodes=new Map}setCommProvider(t){this.comm&&this.comm.destroy(),this.comm=t}registerNode(t,e={}){this.nodes.set(t,{...e,publishers:[],subscribers:[],services:[],actions:[],parameters:new Map})}unregisterNode(t){const e=this.nodes.get(t);if(e){for(const s of e.publishers)this.comm.unadvertise(s);for(const s of e.subscribers)this.comm.unsubscribe(s);for(const s of e.services)this.comm.unadvertiseService(s);for(const s of e.actions)this.comm.unadvertiseAction(s);this.nodes.delete(t)}}createPublisher(t,e,s){const i=this.comm.advertise(e,s,t),o=this.nodes.get(t);return o&&o.publishers.push(i),{id:i,topic:e,msgType:s,publish:r=>{this.comm.publish(e,s,r)},destroy:()=>{if(this.comm.unadvertise(i),o){const r=o.publishers.indexOf(i);r>=0&&o.publishers.splice(r,1)}}}}createSubscription(t,e,s,i){const o=this.comm.subscribe(e,s,i,t),r=this.nodes.get(t);return r&&r.subscribers.push(o),{id:o,topic:e,msgType:s,destroy:()=>{if(this.comm.unsubscribe(o),r){const a=r.subscribers.indexOf(o);a>=0&&r.subscribers.splice(a,1)}}}}createService(t,e,s,i){const o=this.comm.advertiseService(e,s,i,t),r=this.nodes.get(t);return r&&r.services.push(o),{id:o,name:e,type:s,destroy:()=>{if(this.comm.unadvertiseService(o),r){const a=r.services.indexOf(o);a>=0&&r.services.splice(a,1)}}}}async callService(t,e,s){return this.comm.callService(t,e,s)}createActionServer(t,e,s,i){const o=this.comm.advertiseAction(e,s,i,t),r=this.nodes.get(t);return r&&r.actions.push(o),{id:o,name:e,type:s,destroy:()=>{if(this.comm.unadvertiseAction(o),r){const a=r.actions.indexOf(o);a>=0&&r.actions.splice(a,1)}}}}async sendActionGoal(t,e,s,i){return this.comm.sendActionGoal(t,e,s,i)}publish(t,e,s){this.comm.publish(t,e,s)}subscribe(t,e,s){return this.comm.subscribe(t,e,s)}unsubscribe(t){return this.comm.unsubscribe(t)}getNodes(){return Array.from(this.nodes.keys())}getNodeInfo(t){return this.nodes.get(t)}getTopics(){return this.comm.getTopics()}getTopicInfo(t){return this.comm.getTopics().find(s=>s.name===t)}getServices(){return this.comm.getServices()}getServiceInfo(t){return this.comm.getServices().find(s=>s.name===t)}getActions(){return this.comm.getActions()}getActionInfo(t){return this.comm.getActions().find(s=>s.name===t)}reset(){for(const t of this.nodes.keys())this.unregisterNode(t);this.comm.destroy(),this.comm=new j}}const g=new At;N.register("simDDS",g);class $t{constructor(t="graph-container"){typeof t=="string"?this.container=document.getElementById(t):this.container=t,this.cy=null,this.updateInterval=null,this._initCytoscape()}_initCytoscape(){this.cy=null,this.initialized=!1,this.lastGraphSignature=""}_ensureInitialized(){this.initialized||(this.cy=_t({container:this.container,elements:[],style:[{selector:'node[type="node"]',style:{"background-color":"#4a90d9",label:"data(label)","text-valign":"center","text-halign":"center",color:"#fff","font-size":"12px",width:"80px",height:"40px",shape:"round-rectangle","text-wrap":"wrap","text-max-width":"70px"}},{selector:'node[type="topic"]',style:{"background-color":"#6c757d",label:"data(label)","text-valign":"center","text-halign":"center",color:"#fff","font-size":"10px",width:"100px",height:"30px",shape:"rectangle","text-wrap":"wrap","text-max-width":"90px"}},{selector:"edge",style:{width:2,"line-color":"#aaa","target-arrow-color":"#aaa","target-arrow-shape":"triangle","curve-style":"bezier"}},{selector:'edge[type="publish"]',style:{"line-color":"#28a745","target-arrow-color":"#28a745"}},{selector:'edge[type="subscribe"]',style:{"line-color":"#dc3545","target-arrow-color":"#dc3545"}}],layout:{name:"preset"}}),this.initialized=!0)}update(){if(!this.initialized||!this.cy)return;const t=g.getNodes(),e=g.getTopics(),s=[],i=new Set,o=new Set,r=[];for(const l of t){const c=`node_${l}`;i.add(c),r.push(c),s.push({data:{id:c,label:l.replace(/^\//,""),type:"node"}})}for(const l of e){const c=`topic_${l.name}`;if(!(l.publishers.length===0&&l.subscribers.length===0)){o.has(c)||(o.add(c),r.push(c),s.push({data:{id:c,label:l.name,type:"topic"}}));for(const h of l.publishers){const d=`node_${h.nodeId}`;if(i.has(d)){const u=`${d}_to_${c}`;r.push(u),s.push({data:{id:u,source:d,target:c,type:"publish"}})}}for(const h of l.subscribers){const d=`node_${h.nodeId}`;if(i.has(d)){const u=`${c}_to_${d}`;r.push(u),s.push({data:{id:u,source:c,target:d,type:"subscribe"}})}}}}const a=r.sort().join(",");a!==this.lastGraphSignature&&(this.lastGraphSignature=a,this.cy.resize(),this.cy.elements().remove(),this.cy.add(s),s.length>0&&(this.cy.layout({name:"cose",animate:!1,nodeDimensionsIncludeLabels:!0,nodeRepulsion:4e3,idealEdgeLength:80,padding:50}).run(),this.cy.fit(void 0,50),this.cy.center()))}startAutoUpdate(t=1e3){this.stopAutoUpdate(),this.update(),this.updateInterval=setInterval(()=>this.update(),t)}stopAutoUpdate(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null)}show(){const t=document.getElementById("canvas-container");t==null||t.classList.add("hidden"),this.container.classList.remove("hidden"),setTimeout(()=>{this._ensureInitialized(),this.cy&&this.cy.resize(),this.startAutoUpdate(),setTimeout(()=>{this.cy&&(this.cy.resize(),this.cy.fit(void 0,50),this.cy.center())},200)},100)}hide(){this.container.classList.add("hidden"),this.stopAutoUpdate();const t=document.getElementById("canvas-container");t==null||t.classList.remove("hidden"),window.dispatchEvent(new Event(f.LAYOUT_RESIZE))}toggle(){this.container.classList.contains("hidden")?this.show():this.hide()}destroy(){this.stopAutoUpdate(),this.cy&&(this.cy.destroy(),this.cy=null),this.initialized=!1}}class Rt{constructor(t={}){this.panel=t.panel||document.getElementById("console-panel"),this.messagesContainer=t.messages||document.getElementById("console-messages"),this.filterLevel=t.filterLevel||document.getElementById("console-filter-level"),this.filterNode=t.filterNode||document.getElementById("console-filter-node"),this.clearButton=t.clearButton||document.getElementById("console-clear"),this.pauseButton=t.pauseButton||document.getElementById("console-pause"),this.closeButton=t.closeButton||document.getElementById("console-close"),this.paused=!1,this.pendingLogs=[],this.maxDisplayedLogs=500,this.unsubscribe=null,this._setupEventListeners()}_setupEventListeners(){var t,e,s,i,o;(t=this.filterLevel)==null||t.addEventListener("change",()=>{this._refreshLogs()}),(e=this.filterNode)==null||e.addEventListener("input",()=>{this._refreshLogs()}),(s=this.clearButton)==null||s.addEventListener("click",()=>{this._clearLogs()}),(i=this.pauseButton)==null||i.addEventListener("click",()=>{this._togglePause()}),(o=this.closeButton)==null||o.addEventListener("click",()=>{this.hide()}),this.unsubscribe=E.addListener(r=>{this._handleLogEntry(r)})}_handleLogEntry(t){if(this.paused){this.pendingLogs.push(t);return}this._addLogEntry(t)}_addLogEntry(t){var o,r,a;if(!this.messagesContainer)return;const e=E.parseLevel(((o=this.filterLevel)==null?void 0:o.value)||"INFO");if(t.levelValue<e)return;const s=(a=(r=this.filterNode)==null?void 0:r.value)==null?void 0:a.toLowerCase();if(s&&!t.node.toLowerCase().includes(s))return;const i=document.createElement("div");for(i.className=`log-entry log-${t.level.toLowerCase()}`,i.textContent=E.formatEntry(t),this.messagesContainer.appendChild(i);this.messagesContainer.children.length>this.maxDisplayedLogs;)this.messagesContainer.removeChild(this.messagesContainer.firstChild);this.messagesContainer.scrollTop=this.messagesContainer.scrollHeight}_refreshLogs(){var i,o;if(!this.messagesContainer)return;this.messagesContainer.innerHTML="";const t={level:(i=this.filterLevel)==null?void 0:i.value,node:(o=this.filterNode)==null?void 0:o.value},e=E.getLogs(t),s=Math.max(0,e.length-this.maxDisplayedLogs);for(let r=s;r<e.length;r++)this._addLogEntry(e[r])}_clearLogs(){this.messagesContainer&&(this.messagesContainer.innerHTML=""),E.clear(),this.pendingLogs=[]}_togglePause(){if(this.paused=!this.paused,this.pauseButton&&(this.pauseButton.textContent=this.paused?"Resume":"Pause"),!this.paused){for(const t of this.pendingLogs)this._addLogEntry(t);this.pendingLogs=[]}}show(){var t;(t=this.panel)==null||t.classList.remove("hidden"),this._refreshLogs()}hide(){var t;(t=this.panel)==null||t.classList.add("hidden")}toggle(){var t;(t=this.panel)!=null&&t.classList.contains("hidden")?this.show():this.hide()}destroy(){this.unsubscribe&&this.unsubscribe()}}class Dt{constructor(t={}){this.visualizationPanel=t.visualizationPanel||document.getElementById("visualization-panel"),this.terminalPanel=t.terminalPanel||document.getElementById("terminal-panel"),this.canvasContainer=t.canvasContainer||document.getElementById("canvas-container"),this.mapContainer=t.mapContainer||document.getElementById("map-container"),this.graphContainer=t.graphContainer||document.getElementById("graph-container"),this.consolePanel=t.consolePanel||document.getElementById("console-panel"),this.resizing=!1,this.currentLayout="desktop",this._detectLayout(),this._setupResizeObserver(),this._setupMobileSwipe()}_detectLayout(){const t=window.innerWidth;t<768?(this.currentLayout="mobile",document.body.classList.add("mobile-layout"),document.body.classList.remove("tablet-layout","desktop-layout")):t<1024?(this.currentLayout="tablet",document.body.classList.add("tablet-layout"),document.body.classList.remove("mobile-layout","desktop-layout")):(this.currentLayout="desktop",document.body.classList.add("desktop-layout"),document.body.classList.remove("mobile-layout","tablet-layout"))}_setupResizeObserver(){window.addEventListener("resize",()=>{this._detectLayout(),this._triggerResize()})}_setupMobileSwipe(){if(!this.terminalPanel)return;let t=0,e=0;this.terminalPanel.addEventListener("touchstart",s=>{t=s.touches[0].clientX,e=s.touches[0].clientY},{passive:!0}),this.terminalPanel.addEventListener("touchend",s=>{const i=s.changedTouches[0].clientX,o=s.changedTouches[0].clientY,r=i-t,a=o-e;if(Math.abs(r)>Math.abs(a)&&Math.abs(r)>50){const l=new CustomEvent("terminal-swipe",{detail:{direction:r>0?"right":"left"}});this.terminalPanel.dispatchEvent(l)}},{passive:!0})}_triggerResize(){window.dispatchEvent(new Event(f.LAYOUT_RESIZE))}showCanvas(){var t;(t=this.canvasContainer)==null||t.classList.remove("hidden")}hideCanvas(){var t;(t=this.canvasContainer)==null||t.classList.add("hidden")}toggleMap(){window.dispatchEvent(new CustomEvent(f.TOGGLE_MAP_OVERLAY)),this._triggerResize()}showMap(){var t;(t=this.mapContainer)==null||t.classList.remove("hidden"),this._triggerResize()}hideMap(){var t;(t=this.mapContainer)==null||t.classList.add("hidden"),this._triggerResize()}toggleGraph(){var t;(t=this.graphContainer)==null||t.classList.toggle("hidden"),this._triggerResize()}showGraph(){var t;(t=this.graphContainer)==null||t.classList.remove("hidden"),this._triggerResize()}hideGraph(){var t;(t=this.graphContainer)==null||t.classList.add("hidden"),this._triggerResize()}toggleConsole(){var t;(t=this.consolePanel)==null||t.classList.toggle("hidden"),this._triggerResize()}showConsole(){var t;(t=this.consolePanel)==null||t.classList.remove("hidden"),this._triggerResize()}hideConsole(){var t;(t=this.consolePanel)==null||t.classList.add("hidden"),this._triggerResize()}getLayout(){return this.currentLayout}isMobile(){return this.currentLayout==="mobile"}isTablet(){return this.currentLayout==="tablet"}isDesktop(){return this.currentLayout==="desktop"}}class Ot{constructor(){this.activeTab="quickstart",this.modal=null,this.body=null,this.tabContent={}}show(t){this.modal=t;const e=document.getElementById("modal-title");this.body=document.getElementById("modal-body"),!(!this.modal||!this.body)&&(e.textContent="ROS 2 Turtle School - Help",this.body.innerHTML=this._renderTabs()+this._renderContent(),this._setupTabListeners(),this._showTab(this.activeTab),this.modal.classList.remove("hidden"))}_renderTabs(){return`
      <div class="help-tabs" role="tablist" aria-label="Help sections">
        <button class="help-tab active" data-tab="quickstart" role="tab" aria-selected="true" aria-controls="panel-quickstart">Quick Start</button>
        <button class="help-tab" data-tab="commands" role="tab" aria-selected="false" aria-controls="panel-commands">Commands</button>
        <button class="help-tab" data-tab="slam" role="tab" aria-selected="false" aria-controls="panel-slam">SLAM Tutorial</button>
        <button class="help-tab" data-tab="nav2" role="tab" aria-selected="false" aria-controls="panel-nav2">Nav2 Tutorial</button>
      </div>
    `}_renderContent(){return`
      <div class="help-panels">
        <div id="panel-quickstart" class="help-panel active" role="tabpanel" aria-labelledby="tab-quickstart">
          ${this._renderQuickStart()}
        </div>
        <div id="panel-commands" class="help-panel" role="tabpanel" aria-labelledby="tab-commands" hidden>
          ${this._renderCommands()}
        </div>
        <div id="panel-slam" class="help-panel" role="tabpanel" aria-labelledby="tab-slam" hidden>
          ${this._renderSlam()}
        </div>
        <div id="panel-nav2" class="help-panel" role="tabpanel" aria-labelledby="tab-nav2" hidden>
          ${this._renderNav2()}
        </div>
      </div>
    `}_renderQuickStart(){return`
      <div class="help-content">
        <div class="help-section help-intro">
          <p>This emulator lets you learn ROS2 CLI commands in your browser. Follow along with the official tutorial:</p>
          <a href="https://docs.ros.org/en/jazzy/Tutorials/Beginner-CLI-Tools.html" target="_blank" rel="noopener" class="tutorial-link">
            ROS2 Jazzy - Beginner CLI Tools Tutorial
          </a>
        </div>

        <h3>Quick Start</h3>
        <ol>
          <li>Run <code>ros2 run turtlesim turtlesim_node</code> to start turtlesim</li>
          <li>Open a new terminal with the <strong>+</strong> button</li>
          <li>Run <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code></li>
          <li>Use <strong>W/A/S/D</strong> keys to move the turtle</li>
        </ol>

        <h3>Available Packages</h3>
        <table class="help-table">
          <tr><td><code>ros2 run turtlesim turtlesim_node</code></td><td>Start turtlesim simulator</td></tr>
          <tr><td><code>ros2 run turtlesim turtle_teleop_key</code></td><td>Control with arrow keys</td></tr>
          <tr><td><code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code></td><td>Control with WASD keys</td></tr>
          <tr><td><code>ros2 run simple_slam slam_node</code></td><td>Start SLAM mapping node</td></tr>
          <tr><td><code>ros2 run tf2_ros static_transform_publisher</code></td><td>Publish static TF</td></tr>
          <tr><td><code>ros2 run tf2_ros tf2_echo &lt;src&gt; &lt;tgt&gt;</code></td><td>Query transform between frames</td></tr>
          <tr><td><code>ros2 run tf2_ros tf2_monitor</code></td><td>Monitor all TF broadcasts</td></tr>
          <tr><td><code>ros2 run tf2_ros view_frames</code></td><td>Print TF frame tree</td></tr>
          <tr><td><code>ros2 run nav2_simple_navigator navigator_node</code></td><td>Start Nav2 path planner</td></tr>
        </table>

        <h3>Keyboard Shortcuts</h3>
        <ul>
          <li><strong>Ctrl+C</strong> - Stop running command</li>
          <li><strong>Up/Down</strong> - Command history</li>
        </ul>
      </div>
    `}_renderCommands(){return`
      <div class="help-content">
        <h3>ros2 run Options</h3>
        <table class="help-table">
          <tr><td><code>--ros-args --remap __node:=name</code></td><td>Rename node</td></tr>
          <tr><td><code>--ros-args --remap topic:=new_topic</code></td><td>Remap topic</td></tr>
          <tr><td><code>--ros-args --log-level WARN</code></td><td>Set log level</td></tr>
        </table>

        <h3>ros2 node Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 node list</code></td><td>List running nodes</td></tr>
          <tr><td><code>ros2 node info &lt;node&gt;</code></td><td>Show node details</td></tr>
        </table>

        <h3>ros2 topic Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 topic list</code></td><td>List all topics</td></tr>
          <tr><td><code>ros2 topic list -t</code></td><td>List with types</td></tr>
          <tr><td><code>ros2 topic info &lt;topic&gt;</code></td><td>Show topic info</td></tr>
          <tr><td><code>ros2 topic type &lt;topic&gt;</code></td><td>Show message type</td></tr>
          <tr><td><code>ros2 topic echo &lt;topic&gt;</code></td><td>Print messages</td></tr>
          <tr><td><code>ros2 topic pub &lt;topic&gt; &lt;type&gt; "&lt;yaml&gt;"</code></td><td>Publish message</td></tr>
          <tr><td><code>ros2 topic pub --once ...</code></td><td>Publish once</td></tr>
          <tr><td><code>ros2 topic pub -r 10 ...</code></td><td>Publish at rate</td></tr>
          <tr><td><code>ros2 topic hz &lt;topic&gt;</code></td><td>Show publish rate</td></tr>
        </table>

        <h3>ros2 service Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 service list</code></td><td>List all services</td></tr>
          <tr><td><code>ros2 service list -t</code></td><td>List with types</td></tr>
          <tr><td><code>ros2 service type &lt;service&gt;</code></td><td>Show service type</td></tr>
          <tr><td><code>ros2 service call &lt;srv&gt; &lt;type&gt; "&lt;yaml&gt;"</code></td><td>Call service</td></tr>
        </table>
        <p><em>Turtlesim services: /spawn, /kill, /turtle1/set_pen, /turtle1/teleport_absolute</em></p>

        <h3>ros2 action Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 action list</code></td><td>List all actions</td></tr>
          <tr><td><code>ros2 action list -t</code></td><td>List with types</td></tr>
          <tr><td><code>ros2 action info &lt;action&gt;</code></td><td>Show action info</td></tr>
          <tr><td><code>ros2 action send_goal &lt;action&gt; &lt;type&gt; "&lt;yaml&gt;"</code></td><td>Send goal</td></tr>
          <tr><td><code>ros2 action send_goal ... --feedback</code></td><td>With feedback</td></tr>
        </table>
        <p><em>Turtlesim action: /turtle1/rotate_absolute</em></p>

        <h3>ros2 param Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 param list</code></td><td>List all parameters</td></tr>
          <tr><td><code>ros2 param list &lt;node&gt;</code></td><td>List node params</td></tr>
          <tr><td><code>ros2 param get &lt;node&gt; &lt;param&gt;</code></td><td>Get parameter value</td></tr>
          <tr><td><code>ros2 param set &lt;node&gt; &lt;param&gt; &lt;value&gt;</code></td><td>Set parameter</td></tr>
          <tr><td><code>ros2 param dump &lt;node&gt;</code></td><td>Dump all params</td></tr>
        </table>
        <p><em>Turtlesim params: background_r, background_g, background_b</em></p>

        <h3>ros2 bag Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 bag record &lt;topics&gt;</code></td><td>Record topics</td></tr>
          <tr><td><code>ros2 bag record -o &lt;name&gt; &lt;topics&gt;</code></td><td>Record with name</td></tr>
          <tr><td><code>ros2 bag record -a</code></td><td>Record all topics</td></tr>
          <tr><td><code>ros2 bag info &lt;bag&gt;</code></td><td>Show bag info</td></tr>
          <tr><td><code>ros2 bag play &lt;bag&gt;</code></td><td>Play back bag</td></tr>
          <tr><td><code>ros2 bag play &lt;bag&gt; --rate 2.0</code></td><td>Play at 2x speed</td></tr>
        </table>

        <h3>ros2 interface Commands</h3>
        <table class="help-table">
          <tr><td><code>ros2 interface show &lt;type&gt;</code></td><td>Show message/service definition</td></tr>
          <tr><td><code>ros2 pkg executables &lt;pkg&gt;</code></td><td>List package executables</td></tr>
        </table>

        <h3>rqt Tools</h3>
        <table class="help-table">
          <tr><td><code>rqt_graph</code></td><td>Node/topic graph visualization</td></tr>
          <tr><td><code>rqt_console</code></td><td>Log message viewer</td></tr>
          <tr><td><code>rqt</code></td><td>Open tool selector</td></tr>
        </table>
      </div>
    `}_renderSlam(){return`
      <div class="help-content">
        <div class="slam-tutorial">
          <p>Learn how occupancy grid mapping works with our simple SLAM demo.</p>

          <h4>Step 1: Start Turtlesim</h4>
          <p>In Terminal 1:</p>
          <code>ros2 run turtlesim turtlesim_node</code>
          <p>This spawns a turtle with a simulated LIDAR sensor. The gray boxes are obstacles.</p>

          <h4>Step 2: Start SLAM Node</h4>
          <p>Click <strong>+</strong> to add Terminal 2, then run:</p>
          <code>ros2 run simple_slam slam_node</code>
          <p>The SLAM node subscribes to <code>/scan</code> (LIDAR) and <code>/turtle1/pose</code> (position).</p>

          <h4>Step 3: View the Map</h4>
          <p>Click the <strong>Map</strong> button in the header. You'll see a gray grid (unknown space).</p>

          <h4>Step 4: Start Teleop</h4>
          <p>Click <strong>+</strong> to add Terminal 3, then run:</p>
          <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code>
          <p>Use <strong>W/A/S/D</strong> keys to drive the turtle around.</p>

          <h4>Step 5: Watch the Map Build</h4>
          <p>As the turtle moves:</p>
          <ul>
            <li><strong>White cells</strong> = Free space (LIDAR rays passed through)</li>
            <li><strong>Black cells</strong> = Obstacles (LIDAR rays hit something)</li>
            <li><strong>Gray cells</strong> = Unknown (not yet scanned)</li>
          </ul>
          <p>Drive around all the obstacles to build a complete map!</p>

          <h4>Step 6: Inspect the System</h4>
          <p>Open a 4th terminal and explore what SLAM is doing:</p>
          <table class="help-table">
            <tr><td><code>ros2 node info /slam_node</code></td><td>See what the SLAM node subscribes to and publishes</td></tr>
            <tr><td><code>ros2 topic list -t</code></td><td>See all active topics with their types</td></tr>
            <tr><td><code>ros2 interface show sensor_msgs/msg/LaserScan</code></td><td>Understand the lidar message structure</td></tr>
            <tr><td><code>ros2 interface show nav_msgs/msg/OccupancyGrid</code></td><td>Understand the map message structure</td></tr>
          </table>

          <h4>Step 7: Monitor Live Data</h4>
          <table class="help-table">
            <tr><td><code>ros2 topic echo /scan</code></td><td>Watch raw lidar data streaming in</td></tr>
            <tr><td><code>ros2 topic echo /map</code></td><td>Watch occupancy grid values update</td></tr>
            <tr><td><code>ros2 topic hz /scan</code></td><td>Check lidar rate (~10 Hz)</td></tr>
            <tr><td><code>ros2 topic hz /map</code></td><td>Check map publish rate (~2 Hz)</td></tr>
            <tr><td><code>ros2 topic bw /scan</code></td><td>Measure lidar bandwidth</td></tr>
          </table>

          <h4>Step 8: Tune Parameters</h4>
          <p>Change SLAM behavior at runtime:</p>
          <table class="help-table">
            <tr><td><code>ros2 param list /slam_node</code></td><td>See all tunable parameters</td></tr>
            <tr><td><code>ros2 param get /slam_node hit_prob</code></td><td>Check obstacle detection confidence</td></tr>
            <tr><td><code>ros2 param set /slam_node hit_prob 0.95</code></td><td>Increase obstacle confidence</td></tr>
            <tr><td><code>ros2 param set /slam_node miss_prob 0.1</code></td><td>More confident free-space marking</td></tr>
            <tr><td><code>ros2 param dump /slam_node</code></td><td>Dump all current parameter values</td></tr>
          </table>

          <h4>Step 9: Record and Replay</h4>
          <p>Record a mapping session for later analysis:</p>
          <table class="help-table">
            <tr><td><code>ros2 bag record -o my_run /scan /turtle1/pose /map</code></td><td>Record SLAM topics</td></tr>
            <tr><td><code>ros2 bag info my_run</code></td><td>Inspect recorded data</td></tr>
            <tr><td><code>ros2 bag play my_run</code></td><td>Replay the session</td></tr>
            <tr><td><code>ros2 bag play my_run --rate 0.5</code></td><td>Replay at half speed</td></tr>
          </table>

          <h4>SLAM Cell Values</h4>
          <p><code>ros2 topic echo /map</code> shows OccupancyGrid data: <strong>-1</strong> = unknown, <strong>0</strong> = free, <strong>100</strong> = occupied.</p>
        </div>
      </div>
    `}_renderNav2(){return`
      <div class="help-content">
        <div class="slam-tutorial">
          <p>Learn autonomous navigation: build a map with SLAM, then use Nav2 to plan and follow paths.</p>

          <h4>Step 1: Build a Map</h4>
          <p>Follow the SLAM Tutorial first to build a map. You need three terminals:</p>
          <code>ros2 run turtlesim turtlesim_node</code><br>
          <code>ros2 run simple_slam slam_node</code><br>
          <code>ros2 run teleop_twist_keyboard teleop_twist_keyboard</code>
          <p>Drive the turtle around with <strong>W/A/S/D</strong> to scan all obstacles.</p>

          <h4>Step 2: Start the Navigator</h4>
          <p>Open a new terminal and start the Nav2 path planner:</p>
          <code>ros2 run nav2_simple_navigator navigator_node</code>
          <p>The navigator subscribes to <code>/map</code> from SLAM and waits for goals.</p>

          <h4>Step 3: Send a Navigation Goal</h4>
          <p>Send the turtle to a target position using an action goal:</p>
          <code>ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose "{pose: {position: {x: 8.0, y: 8.0}}}"</code>
          <p>Watch the turtle plan a path and drive itself to the goal!</p>

          <h4>Step 4: Monitor Navigation</h4>
          <table class="help-table">
            <tr><td><code>ros2 topic echo /plan</code></td><td>See the planned path waypoints</td></tr>
            <tr><td><code>ros2 action send_goal ... --feedback</code></td><td>Watch distance remaining</td></tr>
            <tr><td><code>ros2 param get /navigator_node goal_tolerance</code></td><td>Check goal tolerance</td></tr>
          </table>

          <h4>Step 5: Tune Navigator Parameters</h4>
          <table class="help-table">
            <tr><td><code>ros2 param set /navigator_node goal_tolerance 0.5</code></td><td>Increase tolerance (reach goals sooner)</td></tr>
            <tr><td><code>ros2 param set /navigator_node max_speed 2.0</code></td><td>Drive faster</td></tr>
            <tr><td><code>ros2 param set /navigator_node obstacle_threshold 30</code></td><td>Avoid even partially occupied cells</td></tr>
          </table>

          <h4>Step 6: Loop Closure &amp; Drift</h4>
          <p>Explore how odometry drift affects mapping and why loop closure matters:</p>
          <table class="help-table">
            <tr><td><code>ros2 param set /slam_node drift_enabled true</code></td><td>Enable simulated odometry drift</td></tr>
            <tr><td><code>ros2 param set /slam_node drift_rate 0.02</code></td><td>Increase drift rate to see the effect</td></tr>
            <tr><td><code>ros2 topic echo /loop_closures</code></td><td>Watch for loop closure events</td></tr>
            <tr><td><code>ros2 param set /slam_node loop_closure_enabled true</code></td><td>Enable loop closure correction</td></tr>
          </table>
          <p>Drive in a loop and watch the SLAM node detect when you revisit a location!</p>

          <h4>Step 7: Localization Mode</h4>
          <p>Save your map and switch to localization (no new mapping):</p>
          <table class="help-table">
            <tr><td><code>ros2 service call /slam/save_map std_srvs/srv/Empty</code></td><td>Save the current map</td></tr>
            <tr><td><code>ros2 param set /slam_node localization_mode true</code></td><td>Switch to localization mode</td></tr>
            <tr><td><code>ros2 param set /slam_node localization_mode false</code></td><td>Switch back to mapping</td></tr>
          </table>

          <h4>Step 8: TF2 Frame Queries</h4>
          <p>Explore coordinate transforms between frames:</p>
          <table class="help-table">
            <tr><td><code>ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 world base_link</code></td><td>Publish a transform</td></tr>
            <tr><td><code>ros2 run tf2_ros tf2_echo world base_link</code></td><td>Continuously print the transform</td></tr>
            <tr><td><code>ros2 run tf2_ros view_frames</code></td><td>Print the frame tree</td></tr>
            <tr><td><code>ros2 run tf2_ros tf2_monitor</code></td><td>Monitor all TF broadcasts</td></tr>
          </table>

          <h4>How A* Path Planning Works</h4>
          <p>The navigator uses the A* algorithm on the occupancy grid:</p>
          <ul>
            <li>Converts start and goal positions to grid cells</li>
            <li>Searches the grid using A* with 8-connected neighbors</li>
            <li>Avoids cells with occupancy above <code>obstacle_threshold</code></li>
            <li>Publishes the path to <code>/plan</code></li>
            <li>Follows the path using a proportional controller on <code>/turtle1/cmd_vel</code></li>
          </ul>
        </div>
      </div>
    `}_setupTabListeners(){this.body.querySelectorAll(".help-tab").forEach(e=>{e.addEventListener("click",()=>{const s=e.dataset.tab;this._showTab(s)})})}_showTab(t){this.activeTab=t,this.body.querySelectorAll(".help-tab").forEach(i=>{const o=i.dataset.tab===t;i.classList.toggle("active",o),i.setAttribute("aria-selected",o?"true":"false")}),this.body.querySelectorAll(".help-panel").forEach(i=>{const o=i.id===`panel-${t}`;i.classList.toggle("active",o),i.hidden=!o})}}const Nt=new Ot;class zt{constructor(){this.commands=new Map,this.ros2Commands=new Map}register(t,e){this.commands.set(t,e)}registerRos2(t,e){this.ros2Commands.set(t,e)}hasCommand(t){return this.commands.has(t)}hasRos2Command(t){return this.ros2Commands.has(t)}async execute(t,e,s){const i=this.commands.get(t);return i?(await i(e,s),!0):!1}async executeRos2(t,e,s){const i=this.ros2Commands.get(t);return i?(await i(e,s),!0):!1}listCommands(){return Array.from(this.commands.keys())}listRos2Commands(){return Array.from(this.ros2Commands.keys())}}const v=new zt;class Ft{constructor(){this.packages={}}getNode(t,e){const s=this.packages[t];return s&&s[e]||null}listPackages(){return Object.keys(this.packages)}listExecutables(t){const e=this.packages[t];return e?Object.keys(e):[]}register(t,e,s){this.packages[t]||(this.packages[t]={}),this.packages[t][e]=s}hasPackage(t){return!!this.packages[t]}hasExecutable(t,e){return!!this.getNode(t,e)}}const I=new Ft;async function Bt(n,t){if(n.length<2){t.writeln("usage: ros2 run <package_name> <executable_name>"),t.writeln(""),t.writeln("Run an executable from a package."),t.finishCommand();return}const e=n[0],s=n[1],i=Gt(n.slice(2)),o=I.getNode(e,s);if(!o){t.writeln(`\x1B[31mPackage '${e}' not found or executable '${s}' not found\x1B[0m`),t.writeln(""),t.writeln("Available packages and executables:");const l=I.listPackages();for(const c of l){const h=I.listExecutables(c);for(const d of h)t.writeln(`  ${c} ${d}`)}t.finishCommand();return}let r=s;i.remap&&i.remap.__node&&(r=i.remap.__node);const a=`/${r}`;if(P.isNodeRunning(a)){t.writeln(`\x1B[33mNode with name '${a}' is already running\x1B[0m`),t.finishCommand();return}i.logLevel&&E.setNodeLevel(a,i.logLevel);try{const l=[];for(const d of n.slice(2)){if(d==="--ros-args")break;l.push(d)}const c=new o(r,{namespace:i.namespace,parameters:i.params,remappings:i.remap,args:l}),h=P.spawn(c,t.id,e,s);t.writeln(`\x1B[32m[INFO] Started ${e}/${s}\x1B[0m`)}catch(l){t.writeln(`\x1B[31mError starting node: ${l.message}\x1B[0m`),t.finishCommand()}}function Gt(n){const t={remap:{},params:{},namespace:"",logLevel:null,paramsFile:null};let e=0,s=!1;for(;e<n.length;){const i=n[e];if(i==="--ros-args"){s=!0,e++;continue}if(!s){e++;continue}if(i==="--remap"||i==="-r"){if(e+1<n.length){const r=n[e+1].split(":=");r.length===2&&(t.remap[r[0]]=r[1]),e+=2}else e++;continue}if(i.includes(":=")){const o=i.split(":=");o.length===2&&(t.remap[o[0]]=o[1]),e++;continue}if(i==="--param"||i==="-p"){if(e+1<n.length){const r=n[e+1].split(":=");r.length===2&&(t.params[r[0]]=Ht(r[1])),e+=2}else e++;continue}if(i==="--params-file"){e+1<n.length?(t.paramsFile=n[e+1],e+=2):e++;continue}if(i==="--log-level"){e+1<n.length?(t.logLevel=n[e+1].toUpperCase(),e+=2):e++;continue}if(i==="-n"||i==="--namespace"){e+1<n.length?(t.namespace=n[e+1],e+=2):e++;continue}e++}return t}function Ht(n){if(n==="true")return!0;if(n==="false")return!1;const t=Number(n);return isNaN(t)?n:t}v.registerRos2("run",Bt);async function Wt(n,t){if(n.length===0){Q(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"list":Ut(s,t);break;case"info":Vt(s,t);break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),Q(t)}t.finishCommand()}function Q(n){n.writeln("usage: ros2 node <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  list    List running nodes"),n.writeln("  info    Show information about a node")}function Ut(n,t){const e=g.getNodes();if(e.length===0){t.writeln("No nodes are currently running.");return}for(const s of e.sort())t.writeln(s)}function Vt(n,t){var a,l,c,h;if(n.length===0){t.writeln("usage: ros2 node info <node_name>");return}let e=n[0];if(e.startsWith("/")||(e="/"+e),!g.getNodeInfo(e)){t.writeln(`\x1B[31mNode '${e}' not found\x1B[0m`);return}t.writeln(`${e}`);const i=P.getProcessByNodeName(e),o=i==null?void 0:i.node,r=[{label:"Subscribers",items:((a=o==null?void 0:o.subscriptions)==null?void 0:a.map(d=>`${d.topic}: ${d.msgType}`))||[]},{label:"Publishers",items:((l=o==null?void 0:o.publishers)==null?void 0:l.map(d=>`${d.topic}: ${d.msgType}`))||[]},{label:"Service Servers",items:((c=o==null?void 0:o.services)==null?void 0:c.map(d=>`${d.name}: ${d.type}`))||[]},{label:"Service Clients",items:[]},{label:"Action Servers",items:((h=o==null?void 0:o.actionServers)==null?void 0:h.map(d=>`${d.name}: ${d.type}`))||[]},{label:"Action Clients",items:[]}];for(const d of r)if(t.writeln(`  ${d.label}:`),d.items.length>0)for(const u of d.items)t.writeln(`    ${u}`)}v.registerRos2("node",Wt);function U(n){if(!n||typeof n!="string")return{};let t=n.trim();if(t.startsWith("{")&&t.endsWith("}")&&(t=t.slice(1,-1)),!t.trim())return{};try{return JSON.parse(`{${t}}`)}catch{return Yt(t)}}function Yt(n){const t={};let e=0,s="",i="",o=!1,r=!1,a="",l=0;for(;l<n.length;){const c=n[l];if((c==='"'||c==="'")&&!r){r=!0,a=c,o&&(i+=c),l++;continue}if(r&&c===a){r=!1,o&&(i+=c),l++;continue}if(r){o?i+=c:s+=c,l++;continue}if(c==="{"||c==="["){e++,o&&(i+=c),l++;continue}if(c==="}"||c==="]"){e--,o&&(i+=c),l++;continue}if(c===":"&&e===0&&!o){for(o=!0,l++;l<n.length&&n[l]===" ";)l++;continue}if(c===","&&e===0){for(s.trim()&&(t[s.trim()]=H(i.trim())),s="",i="",o=!1,l++;l<n.length&&n[l]===" ";)l++;continue}o?i+=c:s+=c,l++}return s.trim()&&(t[s.trim()]=H(i.trim())),t}function H(n){if(!n)return null;if(n.startsWith("{")&&n.endsWith("}"))return U(n);if(n.startsWith("[")&&n.endsWith("]"))return qt(n.slice(1,-1));if(n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'"))return n.slice(1,-1);if(n==="true")return!0;if(n==="false")return!1;if(n==="null"||n==="~")return null;const t=Number(n);return isNaN(t)?n:t}function qt(n){const t=[];let e=0,s="",i=!1,o="";for(let r=0;r<n.length;r++){const a=n[r];if((a==='"'||a==="'")&&!i){i=!0,o=a,s+=a;continue}if(i&&a===o){i=!1,s+=a;continue}if(i){s+=a;continue}if(a==="{"||a==="["){e++,s+=a;continue}if(a==="}"||a==="]"){e--,s+=a;continue}if(a===","&&e===0){s.trim()&&t.push(H(s.trim())),s="";continue}s+=a}return s.trim()&&t.push(H(s.trim())),t}function $(n,t=0){if(n==null)return"null";if(typeof n!="object")return String(n);if(Array.isArray(n))return n.length===0?"[]":`[${n.map(o=>$(o,t)).join(", ")}]`;const e="  ".repeat(t),s=[];for(const[i,o]of Object.entries(n))if(!i.startsWith("_"))if(typeof o=="object"&&o!==null&&!Array.isArray(o))s.push(`${e}${i}:`),s.push($(o,t+1));else{const r=$(o,t);s.push(`${e}${i}: ${r}`)}return s.join(`
`)}class Xt{constructor(){this.messages={},this.services={},this.actions={}}registerMessage(t,e){this.messages[t]=e}registerService(t,e){this.services[t]=e}registerAction(t,e){this.actions[t]=e}getMessage(t){return this.messages[t]||null}getService(t){return this.services[t]||null}getAction(t){return this.actions[t]||null}getInterface(t){return this.messages[t]||this.services[t]||this.actions[t]||null}listMessages(){return Object.keys(this.messages)}listServices(){return Object.keys(this.services)}listActions(){return Object.keys(this.actions)}findMessages(t){const e=new RegExp(t,"i");return Object.keys(this.messages).filter(s=>e.test(s))}findServices(t){const e=new RegExp(t,"i");return Object.keys(this.services).filter(s=>e.test(s))}findActions(t){const e=new RegExp(t,"i");return Object.keys(this.actions).filter(s=>e.test(s))}validateMessage(t,e){const s=this.messages[t];if(!s)return{valid:!1,errors:[`Unknown message type: ${t}`]};const i=[];for(const[o,r]of Object.entries(s.fields||{}))e[o]===void 0&&r.default===void 0&&i.push(`Missing required field: ${o}`);return{valid:i.length===0,errors:i}}createMessage(t,e={}){const s=this.messages[t];return!s||!s.create?null:s.create(e)}getDefinition(t){const e=this.getInterface(t);return(e==null?void 0:e.definition)||null}}const p=new Xt,Kt={name:"std_msgs/msg/Header",fields:{stamp:{type:"builtin_interfaces/msg/Time",default:{sec:0,nanosec:0}},frame_id:{type:"string",default:""}},create:(n={})=>({stamp:n.stamp||{sec:0,nanosec:0},frame_id:n.frame_id||""}),definition:`# Standard metadata for higher-level stamped data types.
builtin_interfaces/Time stamp
string frame_id`},jt={name:"std_msgs/msg/String",fields:{data:{type:"string",default:""}},create:(n={})=>({data:n.data||""}),definition:`# A simple string message.
string data`},Qt={name:"std_msgs/msg/Bool",fields:{data:{type:"bool",default:!1}},create:(n={})=>({data:n.data||!1}),definition:`# A simple boolean message.
bool data`},Jt={name:"std_msgs/msg/Int32",fields:{data:{type:"int32",default:0}},create:(n={})=>({data:n.data||0}),definition:`# A 32-bit signed integer.
int32 data`},Zt={name:"std_msgs/msg/Int64",fields:{data:{type:"int64",default:0}},create:(n={})=>({data:n.data||0}),definition:`# A 64-bit signed integer.
int64 data`},te={name:"std_msgs/msg/Float32",fields:{data:{type:"float32",default:0}},create:(n={})=>({data:n.data||0}),definition:`# A 32-bit floating point number.
float32 data`},ee={name:"std_msgs/msg/Float64",fields:{data:{type:"float64",default:0}},create:(n={})=>({data:n.data||0}),definition:`# A 64-bit floating point number.
float64 data`},se={name:"std_msgs/msg/Empty",fields:{},create:()=>({}),definition:"# Empty message type."},ie={name:"std_msgs/msg/ColorRGBA",fields:{r:{type:"float32",default:0},g:{type:"float32",default:0},b:{type:"float32",default:0},a:{type:"float32",default:1}},create:(n={})=>({r:n.r??0,g:n.g??0,b:n.b??0,a:n.a??1}),definition:`# RGBA color with float values.
float32 r
float32 g
float32 b
float32 a`};p.registerMessage("std_msgs/msg/Header",Kt);p.registerMessage("std_msgs/msg/String",jt);p.registerMessage("std_msgs/msg/Bool",Qt);p.registerMessage("std_msgs/msg/Int32",Jt);p.registerMessage("std_msgs/msg/Int64",Zt);p.registerMessage("std_msgs/msg/Float32",te);p.registerMessage("std_msgs/msg/Float64",ee);p.registerMessage("std_msgs/msg/Empty",se);p.registerMessage("std_msgs/msg/ColorRGBA",ie);const ne={name:"std_srvs/srv/Empty",type:"service",request:{},response:{},createRequest:()=>({}),createResponse:()=>({}),definition:`# Empty service - no request or response data.
---`};p.registerService("std_srvs/srv/Empty",ne);const W={name:"geometry_msgs/msg/Vector3",fields:{x:{type:"float64",default:0},y:{type:"float64",default:0},z:{type:"float64",default:0}},create:(n={})=>({x:n.x??0,y:n.y??0,z:n.z??0}),definition:`# A 3D vector.
float64 x
float64 y
float64 z`},at={name:"geometry_msgs/msg/Point",fields:{x:{type:"float64",default:0},y:{type:"float64",default:0},z:{type:"float64",default:0}},create:(n={})=>({x:n.x??0,y:n.y??0,z:n.z??0}),definition:`# A point in 3D space.
float64 x
float64 y
float64 z`},K={name:"geometry_msgs/msg/Quaternion",fields:{x:{type:"float64",default:0},y:{type:"float64",default:0},z:{type:"float64",default:0},w:{type:"float64",default:1}},create:(n={})=>({x:n.x??0,y:n.y??0,z:n.z??0,w:n.w??1}),definition:`# A quaternion representing orientation.
float64 x
float64 y
float64 z
float64 w`},lt={name:"geometry_msgs/msg/Pose",fields:{position:{type:"geometry_msgs/msg/Point"},orientation:{type:"geometry_msgs/msg/Quaternion"}},create:(n={})=>({position:at.create(n.position),orientation:K.create(n.orientation)}),definition:`# A representation of pose in free space.
Point position
Quaternion orientation`},oe={name:"geometry_msgs/msg/PoseStamped",fields:{header:{type:"std_msgs/msg/Header"},pose:{type:"geometry_msgs/msg/Pose"}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:""},pose:lt.create(n.pose)}),definition:`# A Pose with reference coordinate frame and timestamp.
std_msgs/Header header
Pose pose`},ct={name:"geometry_msgs/msg/Twist",fields:{linear:{type:"geometry_msgs/msg/Vector3"},angular:{type:"geometry_msgs/msg/Vector3"}},create:(n={})=>({linear:W.create(n.linear),angular:W.create(n.angular)}),definition:`# Velocity in free space, broken into linear and angular parts.
Vector3 linear
Vector3 angular`},re={name:"geometry_msgs/msg/TwistStamped",fields:{header:{type:"std_msgs/msg/Header"},twist:{type:"geometry_msgs/msg/Twist"}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:""},twist:ct.create(n.twist)}),definition:`# A twist with reference coordinate frame and timestamp.
std_msgs/Header header
Twist twist`},ht={name:"geometry_msgs/msg/Transform",fields:{translation:{type:"geometry_msgs/msg/Vector3"},rotation:{type:"geometry_msgs/msg/Quaternion"}},create:(n={})=>({translation:W.create(n.translation),rotation:K.create(n.rotation)}),definition:`# A transform between two coordinate frames.
Vector3 translation
Quaternion rotation`},dt={name:"geometry_msgs/msg/TransformStamped",fields:{header:{type:"std_msgs/msg/Header"},child_frame_id:{type:"string",default:""},transform:{type:"geometry_msgs/msg/Transform"}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:""},child_frame_id:n.child_frame_id||"",transform:ht.create(n.transform)}),definition:`# A transform with reference and child coordinate frames.
std_msgs/Header header
string child_frame_id
Transform transform`};p.registerMessage("geometry_msgs/msg/Vector3",W);p.registerMessage("geometry_msgs/msg/Point",at);p.registerMessage("geometry_msgs/msg/Quaternion",K);p.registerMessage("geometry_msgs/msg/Pose",lt);p.registerMessage("geometry_msgs/msg/PoseStamped",oe);p.registerMessage("geometry_msgs/msg/Twist",ct);p.registerMessage("geometry_msgs/msg/TwistStamped",re);p.registerMessage("geometry_msgs/msg/Transform",ht);p.registerMessage("geometry_msgs/msg/TransformStamped",dt);const ae={name:"turtlesim/msg/Pose",fields:{x:{type:"float32",default:0},y:{type:"float32",default:0},theta:{type:"float32",default:0},linear_velocity:{type:"float32",default:0},angular_velocity:{type:"float32",default:0}},create:(n={})=>({x:n.x??0,y:n.y??0,theta:n.theta??0,linear_velocity:n.linear_velocity??0,angular_velocity:n.angular_velocity??0}),definition:`# Pose of a turtle in turtlesim.
float32 x
float32 y
float32 theta

float32 linear_velocity
float32 angular_velocity`},le={name:"turtlesim/msg/Color",fields:{r:{type:"uint8",default:0},g:{type:"uint8",default:0},b:{type:"uint8",default:0}},create:(n={})=>({r:n.r??0,g:n.g??0,b:n.b??0}),definition:`# RGB color values.
uint8 r
uint8 g
uint8 b`};p.registerMessage("turtlesim/msg/Pose",ae);p.registerMessage("turtlesim/msg/Color",le);const ce={name:"turtlesim/srv/Spawn",type:"service",request:{x:{type:"float32",default:0},y:{type:"float32",default:0},theta:{type:"float32",default:0},name:{type:"string",default:""}},response:{name:{type:"string"}},createRequest:(n={})=>({x:n.x??5.544445,y:n.y??5.544445,theta:n.theta??0,name:n.name||""}),createResponse:(n={})=>({name:n.name||""}),definition:`# Spawn a new turtle.
float32 x
float32 y
float32 theta
string name
---
string name`},he={name:"turtlesim/srv/Kill",type:"service",request:{name:{type:"string",default:""}},response:{},createRequest:(n={})=>({name:n.name||""}),createResponse:()=>({}),definition:`# Kill a turtle by name.
string name
---`},de={name:"turtlesim/srv/SetPen",type:"service",request:{r:{type:"uint8",default:0},g:{type:"uint8",default:0},b:{type:"uint8",default:0},width:{type:"uint8",default:1},off:{type:"uint8",default:0}},response:{},createRequest:(n={})=>({r:n.r??255,g:n.g??255,b:n.b??255,width:n.width??3,off:n.off??0}),createResponse:()=>({}),definition:`# Set the pen parameters.
uint8 r
uint8 g
uint8 b
uint8 width
uint8 off
---`},ue={name:"turtlesim/srv/TeleportAbsolute",type:"service",request:{x:{type:"float32",default:0},y:{type:"float32",default:0},theta:{type:"float32",default:0}},response:{},createRequest:(n={})=>({x:n.x??0,y:n.y??0,theta:n.theta??0}),createResponse:()=>({}),definition:`# Teleport the turtle to an absolute position.
float32 x
float32 y
float32 theta
---`},me={name:"turtlesim/srv/TeleportRelative",type:"service",request:{linear:{type:"float32",default:0},angular:{type:"float32",default:0}},response:{},createRequest:(n={})=>({linear:n.linear??0,angular:n.angular??0}),createResponse:()=>({}),definition:`# Teleport the turtle relative to its current position.
float32 linear
float32 angular
---`};p.registerService("turtlesim/srv/Spawn",ce);p.registerService("turtlesim/srv/Kill",he);p.registerService("turtlesim/srv/SetPen",de);p.registerService("turtlesim/srv/TeleportAbsolute",ue);p.registerService("turtlesim/srv/TeleportRelative",me);const pe={name:"turtlesim/action/RotateAbsolute",type:"action",goal:{theta:{type:"float32",default:0}},result:{delta:{type:"float32"}},feedback:{remaining:{type:"float32"}},createGoal:(n={})=>({theta:n.theta??0}),createResult:(n={})=>({delta:n.delta??0}),createFeedback:(n={})=>({remaining:n.remaining??0}),definition:`# Rotate the turtle to an absolute orientation.
# Goal
float32 theta
---
# Result
float32 delta
---
# Feedback
float32 remaining`};p.registerAction("turtlesim/action/RotateAbsolute",pe);const fe={name:"tf2_msgs/msg/TFMessage",fields:{transforms:{type:"geometry_msgs/msg/TransformStamped[]",default:[]}},create:(n={})=>({transforms:(n.transforms||[]).map(t=>dt.create(t))}),definition:`# TF2 transform message.
geometry_msgs/TransformStamped[] transforms`};p.registerMessage("tf2_msgs/msg/TFMessage",fe);const ge={name:"sensor_msgs/msg/LaserScan",fields:{header:{type:"std_msgs/msg/Header"},angle_min:{type:"float32",default:0},angle_max:{type:"float32",default:0},angle_increment:{type:"float32",default:0},time_increment:{type:"float32",default:0},scan_time:{type:"float32",default:0},range_min:{type:"float32",default:0},range_max:{type:"float32",default:0},ranges:{type:"float32[]",default:[]},intensities:{type:"float32[]",default:[]}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:"laser"},angle_min:n.angle_min??-Math.PI,angle_max:n.angle_max??Math.PI,angle_increment:n.angle_increment??Math.PI/180,time_increment:n.time_increment??0,scan_time:n.scan_time??.1,range_min:n.range_min??.1,range_max:n.range_max??10,ranges:n.ranges||[],intensities:n.intensities||[]}),definition:`# Single scan from a planar laser range-finder.
std_msgs/Header header

float32 angle_min        # start angle of the scan [rad]
float32 angle_max        # end angle of the scan [rad]
float32 angle_increment  # angular distance between measurements [rad]

float32 time_increment   # time between measurements [seconds]
float32 scan_time        # time between scans [seconds]

float32 range_min        # minimum range value [m]
float32 range_max        # maximum range value [m]

float32[] ranges         # range data [m]
float32[] intensities    # intensity data [device-specific units]`},be={name:"sensor_msgs/msg/Imu",fields:{header:{type:"std_msgs/msg/Header"},orientation:{type:"geometry_msgs/msg/Quaternion"},orientation_covariance:{type:"float64[9]",default:new Array(9).fill(0)},angular_velocity:{type:"geometry_msgs/msg/Vector3"},angular_velocity_covariance:{type:"float64[9]",default:new Array(9).fill(0)},linear_acceleration:{type:"geometry_msgs/msg/Vector3"},linear_acceleration_covariance:{type:"float64[9]",default:new Array(9).fill(0)}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:"imu"},orientation:n.orientation||{x:0,y:0,z:0,w:1},orientation_covariance:n.orientation_covariance||new Array(9).fill(0),angular_velocity:n.angular_velocity||{x:0,y:0,z:0},angular_velocity_covariance:n.angular_velocity_covariance||new Array(9).fill(0),linear_acceleration:n.linear_acceleration||{x:0,y:0,z:0},linear_acceleration_covariance:n.linear_acceleration_covariance||new Array(9).fill(0)}),definition:`# IMU sensor data.
std_msgs/Header header

geometry_msgs/Quaternion orientation
float64[9] orientation_covariance

geometry_msgs/Vector3 angular_velocity
float64[9] angular_velocity_covariance

geometry_msgs/Vector3 linear_acceleration
float64[9] linear_acceleration_covariance`};p.registerMessage("sensor_msgs/msg/LaserScan",ge);p.registerMessage("sensor_msgs/msg/Imu",be);const ut={name:"nav_msgs/msg/MapMetaData",fields:{map_load_time:{type:"builtin_interfaces/msg/Time",default:{sec:0,nanosec:0}},resolution:{type:"float32",default:.05},width:{type:"uint32",default:0},height:{type:"uint32",default:0},origin:{type:"geometry_msgs/msg/Pose"}},create:(n={})=>({map_load_time:n.map_load_time||{sec:0,nanosec:0},resolution:n.resolution??.05,width:n.width??0,height:n.height??0,origin:n.origin||{position:{x:0,y:0,z:0},orientation:{x:0,y:0,z:0,w:1}}}),definition:`# Metadata about a map.
builtin_interfaces/Time map_load_time
float32 resolution
uint32 width
uint32 height
geometry_msgs/Pose origin`},ye={name:"nav_msgs/msg/OccupancyGrid",fields:{header:{type:"std_msgs/msg/Header"},info:{type:"nav_msgs/msg/MapMetaData"},data:{type:"int8[]",default:[]}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:"map"},info:ut.create(n.info),data:n.data||[]}),definition:`# 2D occupancy grid map.
# Values: -1 = unknown, 0 = free, 100 = occupied
std_msgs/Header header
MapMetaData info
int8[] data`},we={name:"nav_msgs/msg/Odometry",fields:{header:{type:"std_msgs/msg/Header"},child_frame_id:{type:"string",default:""},pose:{type:"geometry_msgs/msg/PoseWithCovariance"},twist:{type:"geometry_msgs/msg/TwistWithCovariance"}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:"odom"},child_frame_id:n.child_frame_id||"base_link",pose:n.pose||{pose:{position:{x:0,y:0,z:0},orientation:{x:0,y:0,z:0,w:1}},covariance:new Array(36).fill(0)},twist:n.twist||{twist:{linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}},covariance:new Array(36).fill(0)}}),definition:`# Robot odometry.
std_msgs/Header header
string child_frame_id
geometry_msgs/PoseWithCovariance pose
geometry_msgs/TwistWithCovariance twist`},_e={name:"nav_msgs/msg/Path",fields:{header:{type:"std_msgs/msg/Header"},poses:{type:"geometry_msgs/msg/PoseStamped[]",default:[]}},create:(n={})=>({header:n.header||{stamp:{sec:0,nanosec:0},frame_id:"map"},poses:n.poses||[]}),definition:`# A path represented as a series of poses.
std_msgs/Header header
geometry_msgs/PoseStamped[] poses`};p.registerMessage("nav_msgs/msg/MapMetaData",ut);p.registerMessage("nav_msgs/msg/OccupancyGrid",ye);p.registerMessage("nav_msgs/msg/Odometry",we);p.registerMessage("nav_msgs/msg/Path",_e);const ve={name:"nav2_msgs/action/NavigateToPose",type:"action",goal:{pose:{type:"geometry_msgs/msg/PoseStamped"}},result:{},feedback:{current_pose:{type:"geometry_msgs/msg/PoseStamped"},distance_remaining:{type:"float32",default:0}},createGoal:(n={})=>{var t,e,s,i,o,r,a,l,c,h,d,u,m,b,y,w;return{pose:{header:((t=n.pose)==null?void 0:t.header)||{stamp:{sec:0,nanosec:0},frame_id:"map"},pose:{position:{x:((i=(s=(e=n.pose)==null?void 0:e.pose)==null?void 0:s.position)==null?void 0:i.x)??((r=(o=n.pose)==null?void 0:o.position)==null?void 0:r.x)??0,y:((c=(l=(a=n.pose)==null?void 0:a.pose)==null?void 0:l.position)==null?void 0:c.y)??((d=(h=n.pose)==null?void 0:h.position)==null?void 0:d.y)??0,z:((b=(m=(u=n.pose)==null?void 0:u.pose)==null?void 0:m.position)==null?void 0:b.z)??((w=(y=n.pose)==null?void 0:y.position)==null?void 0:w.z)??0},orientation:{x:0,y:0,z:0,w:1}}}}},createResult:()=>({}),createFeedback:(n={})=>{var t,e,s,i,o,r;return{current_pose:{header:{stamp:{sec:0,nanosec:0},frame_id:"map"},pose:{position:{x:((s=(e=(t=n.current_pose)==null?void 0:t.pose)==null?void 0:e.position)==null?void 0:s.x)??0,y:((r=(o=(i=n.current_pose)==null?void 0:i.pose)==null?void 0:o.position)==null?void 0:r.y)??0,z:0},orientation:{x:0,y:0,z:0,w:1}}},distance_remaining:n.distance_remaining??0}},definition:`# Navigate to a pose.
# Goal
geometry_msgs/PoseStamped pose
---
# Result (empty - status conveyed by action state)
---
# Feedback
geometry_msgs/PoseStamped current_pose
float32 distance_remaining`};p.registerAction("nav2_msgs/action/NavigateToPose",ve);function xe(n){return p.getMessage(n)}function Te(n){return p.getService(n)}function Se(n){return p.getAction(n)}function mt(){return p.listMessages()}function pt(){return p.listServices()}function ft(){return p.listActions()}function Ie(n){return p.findMessages(n)}function Ce(n){return p.findServices(n)}function ke(n){return p.findActions(n)}function Le(n){return p.getDefinition(n)}async function Pe(n,t){if(n.length===0){J(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"list":Me(s,t),t.finishCommand();break;case"info":Ee(s,t),t.finishCommand();break;case"type":Ae(s,t),t.finishCommand();break;case"find":$e(s,t),t.finishCommand();break;case"echo":Re(s,t);break;case"pub":await De(s,t);break;case"hz":Oe(s,t);break;case"bw":Ne(s,t);break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),J(t),t.finishCommand()}}function J(n){n.writeln("usage: ros2 topic <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  list    List all active topics"),n.writeln("  info    Show information about a topic"),n.writeln("  type    Show the type of a topic"),n.writeln("  find    Find topics by type"),n.writeln("  echo    Subscribe and print messages"),n.writeln("  pub     Publish a message to a topic"),n.writeln("  hz      Show message rate for a topic"),n.writeln("  bw      Show bandwidth for a topic")}function Me(n,t){const e=n.includes("-t")||n.includes("--show-types"),s=g.getTopics();if(s.length===0){t.writeln("No topics are currently active.");return}for(const i of s.sort((o,r)=>o.name.localeCompare(r.name)))e?t.writeln(`${i.name} [${i.type}]`):t.writeln(i.name)}function Ee(n,t){const e=n.includes("--verbose")||n.includes("-v"),s=n.find(o=>!o.startsWith("-"));if(!s){t.writeln("usage: ros2 topic info <topic_name> [--verbose]");return}const i=g.getTopicInfo(s);if(!i){t.writeln(`\x1B[31mTopic '${s}' not found\x1B[0m`);return}if(t.writeln(`Type: ${i.type}`),t.writeln(`Publisher count: ${i.publishers.length}`),t.writeln(`Subscription count: ${i.subscribers.length}`),e){t.writeln(""),t.writeln("Publishers:");for(const o of i.publishers)t.writeln(`  Node: ${o.nodeId}`);t.writeln(""),t.writeln("Subscribers:");for(const o of i.subscribers)t.writeln("  Node: (subscription)")}}function Ae(n,t){if(n.length===0){t.writeln("usage: ros2 topic type <topic_name>");return}const e=n[0],s=g.getTopicInfo(e);if(!s){t.writeln(`\x1B[31mTopic '${e}' not found\x1B[0m`);return}t.writeln(s.type)}function $e(n,t){if(n.length===0){t.writeln("usage: ros2 topic find <msg_type>");return}const e=n[0],i=g.getTopics().filter(o=>o.type===e);if(i.length===0){t.writeln(`No topics of type '${e}' found.`);return}for(const o of i)t.writeln(o.name)}function Re(n,t){if(n.length===0){t.writeln("usage: ros2 topic echo <topic_name>"),t.finishCommand();return}const e=n[0];let s=g.getTopicInfo(e),i=null,o=null;const r=a=>{i&&g.unsubscribe(i),i=g.subscribe(e,a,l=>{t.writeln("---"),t.writeln($(l))})};s?r(s.type):(t.writeln(`\x1B[33mTopic '${e}' does not exist yet.\x1B[0m`),t.writeln("\x1B[33mWill start echoing when a publisher creates it...\x1B[0m"),o=setInterval(()=>{const a=g.getTopicInfo(e);a&&a.type!=="unknown"&&(t.writeln(`\x1B[32mTopic '${e}' is now available [${a.type}]\x1B[0m`),clearInterval(o),o=null,r(a.type))},1e3),r("unknown")),t.addSubscription({destroy:()=>{o&&clearInterval(o),i&&g.unsubscribe(i)}})}async function De(n,t){let e=!1,s=1,i=null,o=null,r=null;for(let u=0;u<n.length;u++){const m=n[u];m==="--once"||m==="-1"?e=!0:m==="-r"||m==="--rate"?s=parseFloat(n[++u])||1:m==="-w"||m==="--wait"?parseInt(n[++u]):i?o?r||(r=m):o=m:i=m}if(!i||!o){t.writeln('usage: ros2 topic pub [--once] [-r RATE] <topic> <msg_type> "<data>"'),t.finishCommand();return}const a=xe(o);if(!a){t.writeln(`\x1B[31mUnknown message type: ${o}\x1B[0m`),t.writeln(""),t.writeln("Available message types matching this pattern:");const u=Ie(o.split("/").pop());for(const m of u.slice(0,10))t.writeln(`  ${m}`);t.finishCommand();return}const l=r?U(r):{},c=a.create(l);if(t.writeln("publisher: beginning loop"),t.writeln(`publishing #1: ${JSON.stringify(c)}`),g.publish(i,o,c),e){t.finishCommand();return}let h=1;const d=setInterval(()=>{h++,t.writeln(`publishing #${h}: ${JSON.stringify(c)}`),g.publish(i,o,c)},1e3/s);t.addSubscription({destroy:()=>clearInterval(d)})}function Oe(n,t){if(n.length===0){t.writeln("usage: ros2 topic hz <topic_name>"),t.finishCommand();return}const e=n[0],s=g.getTopicInfo(e);s||t.writeln(`\x1B[33mWaiting for topic '${e}'...\x1B[0m`);const i=[],o=100,r=g.subscribe(e,(s==null?void 0:s.type)||"unknown",()=>{const a=Date.now();for(i.push(a);i.length>o;)i.shift();if(i.length>=2){const l=Math.max((i[i.length-1]-i[0])/1e3,.001),c=(i.length-1)/l,h=l/(i.length-1);t.writeln(`average rate: ${c.toFixed(3)}`),t.writeln(`	min: ${(h*.9).toFixed(3)}s max: ${(h*1.1).toFixed(3)}s std dev: ${(h*.05).toFixed(5)}s window: ${i.length}`)}});t.addSubscription({destroy:()=>g.unsubscribe(r)})}function G(n){return n>=1e6?`${(n/1e6).toFixed(2)} MB`:n>=1e3?`${(n/1e3).toFixed(2)} KB`:`${Math.round(n)} B`}function Ne(n,t){if(n.length===0){t.writeln("usage: ros2 topic bw <topic_name>"),t.finishCommand();return}const e=n[0],s=g.getTopicInfo(e);s||t.writeln(`\x1B[33mWaiting for topic '${e}'...\x1B[0m`);const i=[],o=100;let r=!1;const a=g.subscribe(e,(s==null?void 0:s.type)||"unknown",l=>{const c=Date.now(),h=JSON.stringify(l).length;for(i.push({time:c,size:h});i.length>o;)i.shift();if(r||(t.writeln(`Subscribed to [${e}]`),r=!0),i.length>=2){const d=Math.max((i[i.length-1].time-i[0].time)/1e3,.001),u=i.reduce((x,_)=>x+_.size,0),m=u/d,b=u/i.length,y=Math.min(...i.map(x=>x.size)),w=Math.max(...i.map(x=>x.size));t.writeln(`${G(m)}/s from ${i.length} messages`),t.writeln(`	Message size mean: ${G(b)} min: ${G(y)} max: ${G(w)}`)}});t.addSubscription({destroy:()=>g.unsubscribe(a)})}v.registerRos2("topic",Pe);async function ze(n,t){if(n.length===0){Z(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"list":Fe(s,t),t.finishCommand();break;case"type":Be(s,t),t.finishCommand();break;case"info":Ge(s,t),t.finishCommand();break;case"find":He(s,t),t.finishCommand();break;case"call":await We(s,t),t.finishCommand();break;case"echo":Ue(s,t);break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),Z(t),t.finishCommand()}}function Z(n){n.writeln("usage: ros2 service <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  list    List all active services"),n.writeln("  type    Show the type of a service"),n.writeln("  info    Show information about a service"),n.writeln("  find    Find services by type"),n.writeln("  call    Call a service"),n.writeln("  echo    Echo service calls")}function Fe(n,t){const e=n.includes("-t")||n.includes("--show-types"),s=g.getServices();if(s.length===0){t.writeln("No services are currently available.");return}for(const i of s.sort((o,r)=>o.name.localeCompare(r.name)))e?t.writeln(`${i.name} [${i.type}]`):t.writeln(i.name)}function Be(n,t){if(n.length===0){t.writeln("usage: ros2 service type <service_name>");return}const e=n[0],s=g.getServiceInfo(e);if(!s){t.writeln(`\x1B[31mService '${e}' not found\x1B[0m`);return}t.writeln(s.type)}function Ge(n,t){if(n.length===0){t.writeln("usage: ros2 service info <service_name>");return}const e=n[0],s=g.getServiceInfo(e);if(!s){t.writeln(`\x1B[31mService '${e}' not found\x1B[0m`);return}t.writeln(`Type: ${s.type}`),t.writeln(`Node: ${s.node}`)}function He(n,t){if(n.length===0){t.writeln("usage: ros2 service find <srv_type>");return}const e=n[0],i=g.getServices().filter(o=>o.type===e);if(i.length===0){t.writeln(`No services of type '${e}' found.`);return}for(const o of i)t.writeln(o.name)}async function We(n,t){let e=null,s=null,i=null;for(let c=0;c<n.length;c++){const h=n[c];e?s?i||(i=h):s=h:e=h}if(!e||!s){t.writeln('usage: ros2 service call <service_name> <srv_type> "<request_data>"');return}const o=Te(s);if(!o){t.writeln(`\x1B[31mUnknown service type: ${s}\x1B[0m`),t.writeln(""),t.writeln("Available service types:");const c=Ce(s.split("/").pop());for(const h of c.slice(0,10))t.writeln(`  ${h}`);return}if(!g.getServiceInfo(e)){t.writeln(`\x1B[31mService '${e}' not available\x1B[0m`);return}const a=i?U(i):{},l=o.createRequest(a);t.writeln(`requester: making request: ${e}`),t.writeln("");try{const c=await g.callService(e,s,l);t.writeln("response:"),t.writeln($(c))}catch(c){t.writeln(`\x1B[31mService call failed: ${c.message}\x1B[0m`)}}function Ue(n,t){t.writeln("\x1B[33mService echo is not fully supported in this simulation.\x1B[0m"),t.finishCommand()}v.registerRos2("service",ze);async function Ve(n,t){if(n.length===0){tt(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"list":Ye(s,t),t.finishCommand();break;case"type":qe(s,t),t.finishCommand();break;case"info":Xe(s,t),t.finishCommand();break;case"send_goal":await Ke(s,t),t.finishCommand();break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),tt(t),t.finishCommand()}}function tt(n){n.writeln("usage: ros2 action <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  list       List all action servers"),n.writeln("  type       Show the type of an action"),n.writeln("  info       Show information about an action"),n.writeln("  send_goal  Send a goal to an action server")}function Ye(n,t){const e=n.includes("-t")||n.includes("--show-types"),s=g.getActions();if(s.length===0){t.writeln("No action servers are currently available.");return}for(const i of s.sort((o,r)=>o.name.localeCompare(r.name)))e?t.writeln(`${i.name} [${i.type}]`):t.writeln(i.name)}function qe(n,t){if(n.length===0){t.writeln("usage: ros2 action type <action_name>");return}const e=n[0],s=g.getActionInfo(e);if(!s){t.writeln(`\x1B[31mAction '${e}' not found\x1B[0m`);return}t.writeln(s.type)}function Xe(n,t){if(n.length===0){t.writeln("usage: ros2 action info <action_name>");return}const e=n[0],s=g.getActionInfo(e);if(!s){t.writeln(`\x1B[31mAction '${e}' not found\x1B[0m`);return}t.writeln(`Action: ${e}`),t.writeln("Action clients: 0"),t.writeln("Action servers: 1"),t.writeln(`    ${s.node}`)}async function Ke(n,t){let e=null,s=null,i=null,o=!1;for(let h=0;h<n.length;h++){const d=n[h];d==="--feedback"||d==="-f"?o=!0:e?s?i||(i=d):s=d:e=d}if(!e||!s){t.writeln('usage: ros2 action send_goal <action_name> <action_type> "<goal>" [--feedback]');return}const r=Se(s);if(!r){t.writeln(`\x1B[31mUnknown action type: ${s}\x1B[0m`),t.writeln(""),t.writeln("Available action types:");const h=ke(s.split("/").pop());for(const d of h.slice(0,10))t.writeln(`  ${d}`);return}if(!g.getActionInfo(e)){t.writeln(`\x1B[31mAction '${e}' not available\x1B[0m`);return}const l=i?U(i):{},c=r.createGoal(l);t.writeln("Waiting for an action server to become available..."),t.writeln("Sending goal:"),t.writeln($(c)),t.writeln("");try{let h=null;o&&(h=u=>{t.writeln("Feedback:"),t.writeln($(u)),t.writeln("")}),t.writeln("Goal accepted with ID: goal_1"),t.writeln("");const d=await g.sendActionGoal(e,s,c,h);t.writeln("Result:"),t.writeln($(d)),t.writeln(""),t.writeln("Goal finished with status: SUCCEEDED")}catch(h){t.writeln(`\x1B[31mAction failed: ${h.message}\x1B[0m`)}}v.registerRos2("action",Ve);async function je(n,t){if(n.length===0){et(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"list":Qe(s,t);break;case"get":Je(s,t);break;case"set":Ze(s,t);break;case"dump":ts(s,t);break;case"load":es(s,t);break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),et(t)}t.finishCommand()}function et(n){n.writeln("usage: ros2 param <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  list    List all parameters"),n.writeln("  get     Get a parameter value"),n.writeln("  set     Set a parameter value"),n.writeln("  dump    Dump all parameters for a node"),n.writeln("  load    Load parameters from a file (not supported in sim)")}function V(n){return n?n.startsWith("/")?n:"/"+n:null}function B(n){return P.getProcessByNodeName(n)}function Qe(n,t){const e=n.length>0?V(n[0]):null;if(e){const s=B(e);if(!s){t.writeln(`\x1B[31mNode '${e}' not found\x1B[0m`);return}const i=s.node.getParameterNames();if(i.length===0){t.writeln("No parameters.");return}t.writeln(`${e}:`);for(const o of i.sort())t.writeln(`  ${o}`)}else{const s=g.getNodes();for(const i of s.sort()){const o=B(i);if(o&&o.node){const r=o.node.getParameterNames();if(r.length>0){t.writeln(`${i}:`);for(const a of r.sort())t.writeln(`  ${a}`)}}}}}function Je(n,t){if(n.length<2){t.writeln("usage: ros2 param get <node_name> <parameter_name>");return}const e=V(n[0]),s=n[1],i=B(e);if(!i){t.writeln(`\x1B[31mNode '${e}' not found\x1B[0m`);return}const o=i.node.getParameter(s);if(o===void 0){t.writeln(`\x1B[31mParameter '${s}' not found on node '${e}'\x1B[0m`);return}t.writeln(`${ss(o)} ${Y(o)}`)}function Ze(n,t){if(n.length<3){t.writeln("usage: ros2 param set <node_name> <parameter_name> <value>");return}const e=V(n[0]),s=n[1],i=n.slice(2).join(" "),o=B(e);if(!o){t.writeln(`\x1B[31mNode '${e}' not found\x1B[0m`);return}const r=is(i),a=o.node.setParameters({[s]:r});if(!a.successful){t.writeln(`\x1B[31m${a.reason}\x1B[0m`);return}t.writeln(`Set parameter '${s}' to: ${Y(r)}`)}function ts(n,t){if(n.length<1){t.writeln("usage: ros2 param dump <node_name>");return}const e=V(n[0]),s=B(e);if(!s){t.writeln(`\x1B[31mNode '${e}' not found\x1B[0m`);return}const i=s.node.getParameterNames();if(i.length===0){t.writeln("No parameters.");return}t.writeln(`${e}:`),t.writeln("  ros__parameters:");for(const o of i.sort()){const r=s.node.getParameter(o);t.writeln(`    ${o}: ${Y(r)}`)}}function es(n,t){t.writeln("\x1B[33mParameter file loading is not supported in this simulation.\x1B[0m"),t.writeln("Use ros2 param set to set individual parameters.")}function ss(n){if(typeof n=="boolean")return"Boolean value is:";if(typeof n=="number")return Number.isInteger(n)?"Integer value is:":"Double value is:";if(typeof n=="string")return"String value is:";if(Array.isArray(n)){if(n.length===0)return"String values are:";const t=n[0];return typeof t=="boolean"?"Boolean values are:":typeof t=="number"?Number.isInteger(t)?"Integer values are:":"Double values are:":"String values are:"}return"String value is:"}function is(n){if(n==="true")return!0;if(n==="false")return!1;const t=Number(n);return isNaN(t)?n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'")?n.slice(1,-1):n:t}function Y(n){return typeof n=="string"?`"${n}"`:typeof n=="boolean"?n?"true":"false":typeof n=="number"?Number.isInteger(n)?n.toString():n.toFixed(6):Array.isArray(n)?`[${n.map(Y).join(", ")}]`:String(n)}v.registerRos2("param",je);class D{constructor(t,e=[]){this.name=t,this.topics=e,this.messages=[],this.subscriptions=[],this.recording=!1,this.startTime=null,this.endTime=null}start(){if(!this.recording){this.recording=!0,this.startTime=Date.now(),this.messages=[];for(const t of this.topics){const e=g.getTopicInfo(t);if(e){const s=g.subscribe(t,e.type,i=>{this.recording&&this.messages.push({topic:t,type:e.type,timestamp:Date.now()-this.startTime,message:{...i}})});this.subscriptions.push(s)}}}}stop(){if(this.recording){this.recording=!1,this.endTime=Date.now();for(const t of this.subscriptions)g.unsubscribe(t);this.subscriptions=[]}}getInfo(){const t={};for(const e of this.messages)t[e.topic]=(t[e.topic]||0)+1;return{name:this.name,duration:this.endTime?(this.endTime-this.startTime)/1e3:null,startTime:this.startTime,endTime:this.endTime,messageCount:this.messages.length,topics:this.topics,topicCounts:t}}getMessages(){return this.messages}toJSON(){return{name:this.name,startTime:this.startTime,endTime:this.endTime,topics:this.topics,messages:this.messages}}static fromJSON(t){const e=new D(t.name,t.topics);return e.startTime=t.startTime,e.endTime=t.endTime,e.messages=t.messages,e}saveToStorage(){try{const t=`ros2bag_${this.name}`;return localStorage.setItem(t,JSON.stringify(this.toJSON())),!0}catch(t){return console.error("Failed to save bag to localStorage:",t),!1}}static loadFromStorage(t){try{const e=`ros2bag_${t}`,s=localStorage.getItem(e);if(s)return D.fromJSON(JSON.parse(s))}catch(e){console.error("Failed to load bag from localStorage:",e)}return null}static listStoredBags(){const t=[];for(let e=0;e<localStorage.length;e++){const s=localStorage.key(e);s.startsWith("ros2bag_")&&t.push(s.substring(8))}return t}static deleteFromStorage(t){const e=`ros2bag_${t}`;localStorage.removeItem(e)}}class ns{constructor(){this.bags=new Map}store(t){this.bags.set(t.name,t)}get(t){return this.bags.has(t)?this.bags.get(t):D.loadFromStorage(t)}list(){const t=Array.from(this.bags.keys()),e=D.listStoredBags();return[...new Set([...t,...e])]}delete(t){this.bags.delete(t),D.deleteFromStorage(t)}}const O=new ns;class os{constructor(t){this.recorder=t,this.messages=t.getMessages(),this.playing=!1,this.paused=!1,this.rate=1,this.currentIndex=0,this.playStartTime=null,this.pauseTime=null,this.timeouts=[],this.onComplete=null,this.onMessage=null,this.playbackId=0}play(t=1){this.playing||(this.rate=t,this.playing=!0,this.paused=!1,this.currentIndex=0,this.playStartTime=Date.now(),this.playbackId++,this._scheduleMessages())}_scheduleMessages(){this._clearTimeouts();const t=this.playbackId;for(let e=this.currentIndex;e<this.messages.length;e++){const s=this.messages[e],i=s.timestamp/this.rate,o=setTimeout(()=>{t===this.playbackId&&this.playing&&!this.paused&&(this._publishMessage(s),this.currentIndex=e+1,this.currentIndex>=this.messages.length&&(this.stop(),this.onComplete&&this.onComplete()))},i);this.timeouts.push(o)}}_publishMessage(t){g.publish(t.topic,t.type,t.message),this.onMessage&&this.onMessage(t)}_clearTimeouts(){for(const t of this.timeouts)clearTimeout(t);this.timeouts=[]}pause(){!this.playing||this.paused||(this.paused=!0,this.pauseTime=Date.now(),this._clearTimeouts())}resume(){if(!this.playing||!this.paused)return;this.paused=!1;const t=Date.now()-this.pauseTime;this.playStartTime+=t,this._scheduleRemainingMessages()}_scheduleRemainingMessages(){const t=(Date.now()-this.playStartTime)*this.rate,e=this.playbackId;for(let s=this.currentIndex;s<this.messages.length;s++){const i=this.messages[s],o=Math.max(0,(i.timestamp-t)/this.rate),r=setTimeout(()=>{e===this.playbackId&&this.playing&&!this.paused&&(this._publishMessage(i),this.currentIndex=s+1,this.currentIndex>=this.messages.length&&(this.stop(),this.onComplete&&this.onComplete()))},o);this.timeouts.push(r)}}stop(){this._clearTimeouts(),this.playbackId++,this.playing=!1,this.paused=!1}setRate(t){this.playing&&!this.paused?(this._clearTimeouts(),this.playbackId++,this.paused=!0,this.pauseTime=Date.now(),this.rate=t,this.resume()):this.rate=t}getStatus(){return{playing:this.playing,paused:this.paused,rate:this.rate,progress:this.currentIndex/this.messages.length,currentIndex:this.currentIndex,totalMessages:this.messages.length}}}async function rs(n,t){if(n.length===0){st(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"record":as(s,t);break;case"play":await ls(s,t),t.finishCommand();break;case"info":cs(s,t),t.finishCommand();break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),st(t),t.finishCommand()}}function st(n){n.writeln("usage: ros2 bag <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  record  Record topics to a bag"),n.writeln("  play    Play back a recorded bag"),n.writeln("  info    Show information about a bag")}function as(n,t){let e=!1,s=`rosbag2_${Date.now()}`;const i=[];for(let a=0;a<n.length;a++){const l=n[a];l==="-a"||l==="--all"?e=!0:l==="-o"||l==="--output"?a+1<n.length&&(s=n[++a]):l.startsWith("-")||i.push(l)}let o=i;if(e&&(o=g.getTopics().map(a=>a.name),o.length===0)){t.writeln("\x1B[33mNo topics available to record.\x1B[0m"),t.finishCommand();return}if(o.length===0){t.writeln("usage: ros2 bag record [-a] [-o <bag_name>] <topic1> <topic2> ..."),t.finishCommand();return}const r=new D(s,o);r.start(),t.writeln(`\x1B[32m[INFO] Recording to '${s}'\x1B[0m`),t.writeln("Topics:");for(const a of o)t.writeln(`  ${a}`);t.writeln(""),t.writeln("Press Ctrl+C to stop recording..."),t.addBagRecorder({stop:()=>{var l;r.stop(),O.store(r);const a=r.getInfo();t.writeln(""),t.writeln("\x1B[32m[INFO] Stopped recording.\x1B[0m"),t.writeln(`Bag: ${s}`),t.writeln(`Duration: ${((l=a.duration)==null?void 0:l.toFixed(2))||0}s`),t.writeln(`Messages: ${a.messageCount}`)}})}async function ls(n,t){var a;let e=null,s=1;for(let l=0;l<n.length;l++){const c=n[l];c==="--rate"||c==="-r"?l+1<n.length&&(s=parseFloat(n[++l])||1):c.startsWith("-")||(e=c)}if(!e){t.writeln("usage: ros2 bag play <bag_name> [--rate N]"),t.writeln(""),t.writeln("Available bags:");const l=O.list();for(const c of l)t.writeln(`  ${c}`);return}const i=O.get(e);if(!i){t.writeln(`\x1B[31mBag '${e}' not found.\x1B[0m`),t.writeln(""),t.writeln("Available bags:");const l=O.list();for(const c of l)t.writeln(`  ${c}`);return}const o=i.getInfo();t.writeln(`\x1B[32m[INFO] Playing bag '${e}'\x1B[0m`),t.writeln(`Duration: ${((a=o.duration)==null?void 0:a.toFixed(2))||0}s`),t.writeln(`Rate: ${s}x`),t.writeln("");const r=new os(i);return new Promise(l=>{r.onComplete=()=>{t.writeln(""),t.writeln("\x1B[32m[INFO] Playback complete.\x1B[0m"),l()},r.onMessage=c=>{},r.play(s)})}function cs(n,t){var o;if(n.length===0){t.writeln("usage: ros2 bag info <bag_name>"),t.writeln(""),t.writeln("Available bags:");const r=O.list();for(const a of r)t.writeln(`  ${a}`);return}const e=n[0],s=O.get(e);if(!s){t.writeln(`\x1B[31mBag '${e}' not found.\x1B[0m`);return}const i=s.getInfo();t.writeln(`Bag: ${i.name}`),t.writeln(`Duration: ${((o=i.duration)==null?void 0:o.toFixed(2))||0}s`),t.writeln(`Messages: ${i.messageCount}`),t.writeln(""),t.writeln("Topics:");for(const r of i.topics){const a=i.topicCounts[r]||0;t.writeln(`  ${r}: ${a} messages`)}}v.registerRos2("bag",rs);async function hs(n,t){if(n.length===0){it(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"show":ds(s,t);break;case"list":us(s,t);break;case"package":ms(s,t);break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),it(t)}t.finishCommand()}function it(n){n.writeln("usage: ros2 interface <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  show      Show the definition of an interface"),n.writeln("  list      List all available interfaces"),n.writeln("  package   List interfaces in a package")}function ds(n,t){if(n.length===0){t.writeln("usage: ros2 interface show <interface_type>");return}const e=n[0],s=Le(e);if(!s){t.writeln(`\x1B[31mInterface '${e}' not found.\x1B[0m`),t.writeln(""),t.writeln('Use "ros2 interface list" to see available interfaces.');return}t.writeln(s)}function us(n,t){const e=n.includes("-m")||n.includes("--only-msgs"),s=n.includes("-s")||n.includes("--only-srvs"),i=n.includes("-a")||n.includes("--only-actions"),o=!e&&!s&&!i;if(o||e){t.writeln("Messages:");for(const r of mt().sort())t.writeln(`    ${r}`);t.writeln("")}if(o||s){t.writeln("Services:");for(const r of pt().sort())t.writeln(`    ${r}`);t.writeln("")}if(o||i){t.writeln("Actions:");for(const r of ft().sort())t.writeln(`    ${r}`)}}function ms(n,t){if(n.length===0){t.writeln("usage: ros2 interface package <package_name>");return}const e=n[0],s=e+"/",i=mt().filter(a=>a.startsWith(s)),o=pt().filter(a=>a.startsWith(s)),r=ft().filter(a=>a.startsWith(s));if(i.length===0&&o.length===0&&r.length===0){t.writeln(`\x1B[31mNo interfaces found in package '${e}'.\x1B[0m`);return}for(const a of i.sort())t.writeln(a);for(const a of o.sort())t.writeln(a);for(const a of r.sort())t.writeln(a)}v.registerRos2("interface",hs);async function ps(n,t){if(n.length===0){nt(t),t.finishCommand();return}const e=n[0],s=n.slice(1);switch(e){case"executables":fs(s,t);break;case"list":gs(s,t);break;default:t.writeln(`\x1B[31mUnknown subcommand: ${e}\x1B[0m`),nt(t)}t.finishCommand()}function nt(n){n.writeln("usage: ros2 pkg <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  executables   List executables in a package"),n.writeln("  list          List available packages")}function fs(n,t){if(n.length===0){const i=I.listPackages();for(const o of i.sort()){const r=I.listExecutables(o);for(const a of r.sort())t.writeln(`${o} ${a}`)}return}const e=n[0],s=I.listExecutables(e);if(s.length===0){t.writeln(`\x1B[31mPackage '${e}' not found or has no executables.\x1B[0m`);return}for(const i of s.sort())t.writeln(`${e} ${i}`)}function gs(n,t){const e=I.listPackages();if(e.length===0){t.writeln("No packages available.");return}for(const s of e.sort())t.writeln(s)}v.registerRos2("pkg",ps);function bs(n,t){return t.clear(),t.finishCommand(),!0}function ys(n,t){const e=n.includes("-a")||n.includes("-la")||n.includes("-al"),s=n.includes("-l")||n.includes("-la")||n.includes("-al"),i=[{name:"src",type:"d",size:4096},{name:"install",type:"d",size:4096},{name:"build",type:"d",size:4096},{name:"log",type:"d",size:4096},{name:"package.xml",type:"-",size:1024},{name:"CMakeLists.txt",type:"-",size:2048},{name:"setup.py",type:"-",size:512}],r=e?[...[{name:".",type:"d",size:4096},{name:"..",type:"d",size:4096},{name:".colcon",type:"d",size:4096}],...i]:i;if(s){t.writeln("total "+r.length);for(const a of r){const l=a.type==="d"?"drwxr-xr-x":"-rw-r--r--",c=String(a.size).padStart(6),h="Jan 27 12:00",d=a.type==="d"?"\x1B[34m":"",u=a.type==="d"?"\x1B[0m":"";t.writeln(`${l} 1 ros2 ros2 ${c} ${h} ${d}${a.name}${u}`)}}else{const a=r.map(l=>{const c=l.type==="d"?"\x1B[34m":"",h=l.type==="d"?"\x1B[0m":"";return`${c}${l.name}${h}`});t.writeln(a.join("  "))}return t.finishCommand(),!0}function ws(n,t){return t.writeln("/home/ros2/ws"),t.finishCommand(),!0}function _s(n,t){return n.length>0&&t.writeln(n.join(" ")),t.finishCommand(),!0}v.register("clear",bs);v.register("ls",ys);v.register("pwd",ws);v.register("echo",_s);function vs(n,t){return t.writeln("ROS2 Web Emulator - Available Commands:"),t.writeln(""),t.writeln("\x1B[33mROS2 Commands:\x1B[0m"),t.writeln('  ros2 <subcommand>  - ROS2 CLI commands (type "ros2 --help")'),t.writeln("  rqt               - Open rqt tool selector"),t.writeln("  rqt_graph         - Open node graph visualization"),t.writeln("  rqt_console       - Open log console"),t.writeln(""),t.writeln("\x1B[33mShell Commands:\x1B[0m"),t.writeln("  ls [-la]          - List directory contents"),t.writeln("  pwd               - Print working directory"),t.writeln("  clear             - Clear the terminal"),t.writeln("  echo <text>       - Print text"),t.writeln("  help              - Show this help message"),t.writeln(""),t.writeln('Type "ros2 --help" for ros2 subcommands.'),t.finishCommand(),!0}v.register("help",vs);function xs(n,t){return window.dispatchEvent(new CustomEvent(f.OPEN_RQT_MODAL)),t.finishCommand(),!0}function Ts(n,t){return window.dispatchEvent(new CustomEvent(f.TOGGLE_GRAPH)),t.writeln("Opening rqt_graph..."),t.finishCommand(),!0}function Ss(n,t){return window.dispatchEvent(new CustomEvent(f.TOGGLE_CONSOLE)),t.writeln("Opening rqt_console..."),t.finishCommand(),!0}v.register("rqt",xs);v.register("rqt_graph",Ts);v.register("rqt_console",Ss);function ot(n){n.writeln("usage: ros2 <command> [options]"),n.writeln(""),n.writeln("Commands:"),n.writeln("  run        Run an executable from a package"),n.writeln("  node       Node-related commands"),n.writeln("  topic      Topic-related commands"),n.writeln("  service    Service-related commands"),n.writeln("  action     Action-related commands"),n.writeln("  param      Parameter-related commands"),n.writeln("  bag        Bag file commands"),n.writeln("  interface  Interface introspection"),n.writeln("  pkg        Package-related commands")}async function Is(n,t){if(n.length===0||n[0]==="--help"||n[0]==="-h")return ot(t),t.finishCommand(),!0;const e=n[0],s=n.slice(1);return await v.executeRos2(e,s,t)||(t.writeln(`\x1B[31mUnknown ros2 command: ${e}\x1B[0m`),ot(t),t.finishCommand()),!0}v.register("ros2",Is);async function rt(n,t){const e=n.trim();if(!e){t.finishCommand();return}const s=Cs(e);if(s.length===0){t.finishCommand();return}const i=s[0],o=s.slice(1);await v.execute(i,o,t)||(t.writeln(`\x1B[31mCommand not found: ${i}\x1B[0m`),t.writeln('Type "help" for available commands.'),t.finishCommand())}function Cs(n){const t=[];let e="",s=!1,i="",o=0;for(;o<n.length;){const r=n[o];if((r==='"'||r==="'")&&!s){s=!0,i=r,o++;continue}if(s&&r===i){s=!1,i="",o++;continue}if(r===" "&&!s){e&&(t.push(e),e=""),o++;continue}e+=r,o++}return e&&t.push(e),t}class A{constructor(t,e={}){if(this.name=t,this.namespace=e.namespace||"",this.fullName=this.namespace?`${this.namespace}/${t}`:`/${t}`,this.publishers=[],this.subscriptions=[],this.services=[],this.actionServers=[],this.timers=[],this.parameters=new Map,this.parameterCallbacks=[],this.running=!1,this.simDDS=e.simDDS||N.get("simDDS")||g,this.logManager=e.logManager||N.get("logManager")||E,this.logger=this.logManager.getLogger(this.fullName),this.simDDS.registerNode(this.fullName,{name:this.name,namespace:this.namespace}),e.parameters)for(const[s,i]of Object.entries(e.parameters))this.declareParameter(s,i)}declareParameter(t,e){return this.parameters.has(t)||this.parameters.set(t,e),this.parameters.get(t)}getParameter(t){return this.parameters.get(t)}setParameter(t,e){return this.setParameters({[t]:e}).successful}setParameters(t){for(const s of Object.keys(t))if(!this.parameters.has(s))return{successful:!1,reason:`Parameter '${s}' not declared on node '${this.fullName}'`};const e=this._validateParameterChanges(t);if(!e.successful)return e;for(const[s,i]of Object.entries(t))this.parameters.set(s,i),this.onParameterChange(s,i);return{successful:!0,reason:""}}getParameterNames(){return Array.from(this.parameters.keys())}onParameterChange(t,e){}addOnSetParametersCallback(t){return this.parameterCallbacks.push(t),this.parameterCallbacks.length-1}removeParameterCallback(t){t>=0&&t<this.parameterCallbacks.length&&(this.parameterCallbacks[t]=null)}_validateParameterChanges(t){for(const e of this.parameterCallbacks)if(e!==null)try{const s=e(t);if(!s.successful)return s}catch(s){return{successful:!1,reason:`Callback error: ${s.message}`}}return{successful:!0,reason:""}}createPublisher(t,e){const s=this.simDDS.createPublisher(this.fullName,t,e);return this.publishers.push(s),s}createSubscription(t,e,s){const i=this.simDDS.createSubscription(this.fullName,t,e,s.bind(this));return this.subscriptions.push(i),i}createService(t,e,s){const i=this.simDDS.createService(this.fullName,t,e,s.bind(this));return this.services.push(i),i}createActionServer(t,e,s){var r,a;const i={executeCallback:s.executeCallback.bind(this),goalCallback:(r=s.goalCallback)==null?void 0:r.bind(this),cancelCallback:(a=s.cancelCallback)==null?void 0:a.bind(this)},o=this.simDDS.createActionServer(this.fullName,t,e,i);return this.actionServers.push(o),o}createTimer(t,e){const s=setInterval(()=>{this.running&&e.call(this)},t);return this.timers.push(s),s}cancelTimer(t){clearInterval(t);const e=this.timers.indexOf(t);e>=0&&this.timers.splice(e,1)}now(){return{sec:Math.floor(Date.now()/1e3),nanosec:Date.now()%1e3*1e6}}logDebug(t){this.logger.debug(t)}logInfo(t){this.logger.info(t)}logWarn(t){this.logger.warn(t)}logError(t){this.logger.error(t)}logFatal(t){this.logger.fatal(t)}onInit(){}onShutdown(){}start(){this.running=!0,this.onInit(),this.logInfo("Node started")}destroy(){this.running=!1,this.onShutdown();for(const t of this.timers)clearInterval(t);this.timers=[],this.logInfo("Node destroyed"),this.publishers=[],this.subscriptions=[],this.services=[],this.actionServers=[],this.simDDS.unregisterNode(this.fullName)}}class ks extends A{constructor(t="turtlesim",e={}){super(t,{...e,parameters:{background_r:69,background_g:86,background_b:255,...e.parameters}}),this.turtles=new Map,this.canvas=null,this.ctx=null,this.turtleImage=null,this.turtleImageLoaded=!1,this.trails=[],this.updateRate=60,this.publishRate=10,this.lastPosePublish=0,this.lidarEnabled=!0,this.lidarPublishRate=10,this.lastLidarPublish=0}onInit(){this._spawnTurtle("turtle1",5.544445,5.544445,0),this.createService("/spawn","turtlesim/srv/Spawn",this._handleSpawn.bind(this)),this.createService("/kill","turtlesim/srv/Kill",this._handleKill.bind(this)),this.createService("/clear","turtlesim/srv/Empty",this._handleClear.bind(this)),this.createService("/reset","turtlesim/srv/Empty",this._handleReset.bind(this)),this.createTimer(1e3/this.updateRate,this._update.bind(this)),this._notifyCanvas(),this.addOnSetParametersCallback(t=>{for(const e of["background_r","background_g","background_b"])if(e in t){const s=t[e];if(typeof s!="number"||!Number.isInteger(s)||s<0||s>255)return{successful:!1,reason:`${e} must be an integer between 0 and 255`}}return{successful:!0,reason:""}}),this.logInfo("Turtlesim node started")}onShutdown(){for(const[t,e]of this.turtles)e.activeActionInterval&&(clearInterval(e.activeActionInterval),e.activeActionInterval=null),S.removeTurtle(t);this.turtles.clear(),this.trails=[]}onParameterChange(t,e){t.startsWith("background_")&&this._notifyCanvas()}_spawnTurtle(t,e,s,i){if(this.turtles.has(t))return null;const o={name:t,x:e,y:s,theta:i,linearVelocity:0,angularVelocity:0,pen:{r:184,g:184,b:184,width:3,off:!1},activeActionInterval:null};this.turtles.set(t,o),S.registerTurtle(t,e,s,i);const r=`/${t}`;return o.posePub=this.createPublisher(`${r}/pose`,"turtlesim/msg/Pose"),o.colorPub=this.createPublisher(`${r}/color_sensor`,"turtlesim/msg/Color"),o.cmdVelSub=this.createSubscription(`${r}/cmd_vel`,"geometry_msgs/msg/Twist",a=>this._handleCmdVel(t,a)),o.setPenService=this.createService(`${r}/set_pen`,"turtlesim/srv/SetPen",a=>this._handleSetPen(t,a)),o.teleportAbsService=this.createService(`${r}/teleport_absolute`,"turtlesim/srv/TeleportAbsolute",a=>this._handleTeleportAbsolute(t,a)),o.teleportRelService=this.createService(`${r}/teleport_relative`,"turtlesim/srv/TeleportRelative",a=>this._handleTeleportRelative(t,a)),t==="turtle1"&&(o.rotateAbsAction=this.createActionServer(`${r}/rotate_absolute`,"turtlesim/action/RotateAbsolute",{executeCallback:(a,l,c,h)=>this._executeRotateAbsolute(t,a,c,h),goalCallback:()=>!0}),this.lidarEnabled&&(o.scanPub=this.createPublisher("/scan","sensor_msgs/msg/LaserScan"))),this.logInfo(`Spawned turtle '${t}' at (${e.toFixed(2)}, ${s.toFixed(2)})`),t}_handleSpawn(t){let e=t.name;if(!e){let i=1;for(;this.turtles.has(`turtle${i}`);)i++;e=`turtle${i}`}return{name:this._spawnTurtle(e,t.x,t.y,t.theta)||""}}_handleKill(t){const e=this.turtles.get(t.name);if(!e)throw new Error(`Turtle '${t.name}' not found`);return e.activeActionInterval&&(clearInterval(e.activeActionInterval),e.activeActionInterval=null),e.posePub&&e.posePub.destroy(),e.colorPub&&e.colorPub.destroy(),e.cmdVelSub&&e.cmdVelSub.destroy(),e.setPenService&&e.setPenService.destroy(),e.teleportAbsService&&e.teleportAbsService.destroy(),e.teleportRelService&&e.teleportRelService.destroy(),e.rotateAbsAction&&e.rotateAbsAction.destroy(),e.scanPub&&e.scanPub.destroy(),this.turtles.delete(t.name),S.removeTurtle(t.name),this.logInfo(`Killed turtle '${t.name}'`),{}}_handleClear(){return this.trails=[],this._notifyCanvas(),{}}_handleReset(){for(const[e]of this.turtles)e!=="turtle1"&&this._handleKill({name:e});const t=this.turtles.get("turtle1");return t&&(t.x=5.544445,t.y=5.544445,t.theta=0,t.linearVelocity=0,t.angularVelocity=0,S.updateTurtle("turtle1",t.x,t.y,t.theta)),this.trails=[],this._notifyCanvas(),{}}_handleCmdVel(t,e){var i,o;const s=this.turtles.get(t);s&&(s.linearVelocity=((i=e.linear)==null?void 0:i.x)||0,s.angularVelocity=((o=e.angular)==null?void 0:o.z)||0)}_handleSetPen(t,e){const s=this.turtles.get(t);if(!s)throw new Error(`Turtle '${t}' not found`);return s.pen={r:e.r,g:e.g,b:e.b,width:e.width,off:e.off!==0},{}}_handleTeleportAbsolute(t,e){const s=this.turtles.get(t);if(!s)throw new Error(`Turtle '${t}' not found`);return s.x=e.x,s.y=e.y,s.theta=e.theta,S.updateTurtle(t,s.x,s.y,s.theta),{}}_handleTeleportRelative(t,e){const s=this.turtles.get(t);if(!s)throw new Error(`Turtle '${t}' not found`);return s.theta+=e.angular,s.x+=Math.cos(s.theta)*e.linear,s.y+=Math.sin(s.theta)*e.linear,S.updateTurtle(t,s.x,s.y,s.theta),{}}async _executeRotateAbsolute(t,e,s,i){const o=this.turtles.get(t);if(!o)throw new Error(`Turtle '${t}' not found`);o.activeActionInterval&&(clearInterval(o.activeActionInterval),o.activeActionInterval=null);const r=e.theta,a=o.theta;let l=r-o.theta;for(;l>Math.PI;)l-=2*Math.PI;for(;l<-Math.PI;)l+=2*Math.PI;const c=1,h=l>0?1:-1,d=Math.abs(l);let u=0;return new Promise(m=>{const b=setInterval(()=>{if(i()){clearInterval(b),o.activeActionInterval=null,m({delta:u*h});return}const y=c/30;if(u+=y,u>=d)o.theta=r,clearInterval(b),o.activeActionInterval=null,m({delta:d*h});else{o.theta=a+u*h,S.updateTurtle(t,o.x,o.y,o.theta);const w=d-u;s({remaining:w})}},33.333333333333336);o.activeActionInterval=b})}_update(){const t=1/this.updateRate,e=Date.now();for(const[s,i]of this.turtles){const o=i.x,r=i.y;if(i.linearVelocity!==0||i.angularVelocity!==0){for(i.theta+=i.angularVelocity*t;i.theta>Math.PI;)i.theta-=2*Math.PI;for(;i.theta<-Math.PI;)i.theta+=2*Math.PI;const a=i.x+Math.cos(i.theta)*i.linearVelocity*t,l=i.y+Math.sin(i.theta)*i.linearVelocity*t;i.x=Math.max(0,Math.min(11,a)),i.y=Math.max(0,Math.min(11,l)),S.updateTurtle(s,i.x,i.y,i.theta),!i.pen.off&&(i.x!==o||i.y!==r)&&this.trails.push({x1:o,y1:r,x2:i.x,y2:i.y,color:`rgb(${i.pen.r}, ${i.pen.g}, ${i.pen.b})`,width:i.pen.width})}if(e-this.lastPosePublish>=1e3/this.publishRate){const a={x:i.x,y:i.y,theta:i.theta,linear_velocity:i.linearVelocity,angular_velocity:i.angularVelocity};i.posePub.publish(a)}if(s==="turtle1"&&this.lidarEnabled&&i.scanPub&&e-this.lastLidarPublish>=1e3/this.lidarPublishRate){const a=S.lidarScan(i.x,i.y,i.theta,{angleMin:-Math.PI,angleMax:Math.PI,numRays:360,rangeMax:10});a.header={stamp:this.now(),frame_id:"base_link"},i.scanPub.publish(a),this.lastLidarPublish=e}}e-this.lastPosePublish>=1e3/this.publishRate&&(this.lastPosePublish=e),this._notifyCanvas()}_notifyCanvas(){window.dispatchEvent(new CustomEvent(f.TURTLESIM_UPDATE,{detail:{turtles:Array.from(this.turtles.values()),trails:this.trails,background:{r:this.getParameter("background_r"),g:this.getParameter("background_g"),b:this.getParameter("background_b")}}}))}getTurtleData(){return{turtles:Array.from(this.turtles.values()),trails:this.trails,background:{r:this.getParameter("background_r"),g:this.getParameter("background_g"),b:this.getParameter("background_b")}}}}I.register("turtlesim","turtlesim_node",ks);class Ls extends A{constructor(t="turtle_teleop_key",e={}){var s;super(t,{...e,parameters:{scale_linear:2,scale_angular:2,...e.parameters}}),this.targetTopic=((s=e.remappings)==null?void 0:s.cmd_vel)||"/turtle1/cmd_vel",this.keyHandler=null,this.activeKeys=new Set}onInit(){this.cmdVelPub=this.createPublisher(this.targetTopic,"geometry_msgs/msg/Twist"),this.keyHandler=this._handleKeyDown.bind(this),this.keyUpHandler=this._handleKeyUp.bind(this),window.addEventListener("keydown",this.keyHandler),window.addEventListener("keyup",this.keyUpHandler),this.createTimer(100,this._publishVelocity.bind(this)),this.logInfo("Turtle teleop started. Use arrow keys to move the turtle."),this.logInfo(`Publishing to: ${this.targetTopic}`),window.dispatchEvent(new CustomEvent(f.TELEOP_ACTIVE,{detail:{type:"arrow-keys",node:this.fullName}}))}onShutdown(){this.keyHandler&&(window.removeEventListener("keydown",this.keyHandler),window.removeEventListener("keyup",this.keyUpHandler)),this.activeKeys.clear(),window.dispatchEvent(new CustomEvent(f.TELEOP_INACTIVE,{detail:{node:this.fullName}}))}_handleKeyDown(t){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&(t.preventDefault(),this.activeKeys.add(t.key))}_handleKeyUp(t){["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&(t.preventDefault(),this.activeKeys.delete(t.key))}_publishVelocity(){const t=this.getParameter("scale_linear"),e=this.getParameter("scale_angular");let s=0,i=0;if(this.activeKeys.has("ArrowUp")&&(s+=t),this.activeKeys.has("ArrowDown")&&(s-=t),this.activeKeys.has("ArrowLeft")&&(i+=e),this.activeKeys.has("ArrowRight")&&(i-=e),s!==0||i!==0||this.lastVelocity){const o={linear:{x:s,y:0,z:0},angular:{x:0,y:0,z:i}};this.cmdVelPub.publish(o),this.lastVelocity=s!==0||i!==0}}}I.register("turtlesim","turtle_teleop_key",Ls);class Ps extends A{constructor(t="teleop_twist_keyboard",e={}){var s;super(t,{...e,parameters:{speed:.5,turn:1,speed_limit:2,turn_limit:2,...e.parameters}}),this.targetTopic=((s=e.remappings)==null?void 0:s.cmd_vel)||"/turtle1/cmd_vel",this.keyHandler=null,this.keyUpHandler=null,this.activeKeys=new Set,this.currentSpeed=.5,this.currentTurn=1}onInit(){this.cmdVelPub=this.createPublisher(this.targetTopic,"geometry_msgs/msg/Twist"),this.keyHandler=this._handleKeyDown.bind(this),this.keyUpHandler=this._handleKeyUp.bind(this),window.addEventListener("keydown",this.keyHandler),window.addEventListener("keyup",this.keyUpHandler),this.createTimer(100,this._publishVelocity.bind(this)),this.logInfo("Teleop Twist Keyboard started."),this.logInfo("W/S: forward/back, A/D: turn, Q/E: diagonal, X: stop"),this.logInfo(`Publishing to: ${this.targetTopic}`),window.dispatchEvent(new CustomEvent(f.TELEOP_ACTIVE,{detail:{type:"wasd-keys",node:this.fullName}}))}onShutdown(){this.keyHandler&&(window.removeEventListener("keydown",this.keyHandler),window.removeEventListener("keyup",this.keyUpHandler)),this.activeKeys.clear(),window.dispatchEvent(new CustomEvent(f.TELEOP_INACTIVE,{detail:{node:this.fullName}}))}_handleKeyDown(t){const e=t.key.toLowerCase();if(["w","a","s","d","q","e","x"].includes(e)){t.preventDefault(),this.activeKeys.add(e);return}if(e==="i"){this.currentSpeed=Math.min(this.getParameter("speed_limit"),this.currentSpeed+.1),this.logInfo(`Speed: ${this.currentSpeed.toFixed(1)}`),t.preventDefault();return}if(e==="k"){this.currentSpeed=Math.max(.1,this.currentSpeed-.1),this.logInfo(`Speed: ${this.currentSpeed.toFixed(1)}`),t.preventDefault();return}if(e==="o"){this.currentTurn=Math.min(this.getParameter("turn_limit"),this.currentTurn+.1),this.logInfo(`Turn: ${this.currentTurn.toFixed(1)}`),t.preventDefault();return}if(e==="l"){this.currentTurn=Math.max(.1,this.currentTurn-.1),this.logInfo(`Turn: ${this.currentTurn.toFixed(1)}`),t.preventDefault();return}}_handleKeyUp(t){const e=t.key.toLowerCase();["w","a","s","d","q","e","x"].includes(e)&&(t.preventDefault(),this.activeKeys.delete(e))}_publishVelocity(){let t=0,e=0;if(this.activeKeys.has("x")){const s={linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}};this.cmdVelPub.publish(s),this.lastVelocity=!1;return}if(this.activeKeys.has("w")&&(t+=this.currentSpeed),this.activeKeys.has("s")&&(t-=this.currentSpeed),this.activeKeys.has("a")&&(e+=this.currentTurn),this.activeKeys.has("d")&&(e-=this.currentTurn),this.activeKeys.has("q")&&(t+=this.currentSpeed,e+=this.currentTurn),this.activeKeys.has("e")&&(t+=this.currentSpeed,e-=this.currentTurn),t!==0||e!==0||this.lastVelocity){const s={linear:{x:t,y:0,z:0},angular:{x:0,y:0,z:e}};this.cmdVelPub.publish(s),this.lastVelocity=t!==0||e!==0}}}I.register("teleop_twist_keyboard","teleop_twist_keyboard",Ps);class Ms extends A{constructor(t="slam_node",e={}){super(t,{...e,parameters:{map_resolution:.1,map_width:110,map_height:110,origin_x:0,origin_y:0,hit_prob:.9,miss_prob:.3,loop_closure_enabled:!0,loop_closure_distance:.5,loop_closure_min_travel:3,loop_closure_cooldown:5e3,drift_enabled:!1,drift_rate:.005,drift_max:.3,localization_mode:!1,...e.parameters}}),this.grid=null,this.gridWidth=0,this.gridHeight=0,this.resolution=0,this.originX=0,this.originY=0,this.robotX=5.5,this.robotY=5.5,this.robotTheta=0,this.driftX=0,this.driftY=0,this.driftTheta=0,this.l0=0,this.lOcc=0,this.lFree=0,this.lMin=-5,this.lMax=5,this.poseGraph=[],this.totalDistanceTraveled=0,this.lastPoseX=5.5,this.lastPoseY=5.5,this.lastLoopClosureTime=0,this.loopClosureCount=0,this.storedGrid=null}onInit(){this._initializeGrid();const t=this.getParameter("hit_prob"),e=this.getParameter("miss_prob");this.lOcc=Math.log(t/(1-t)),this.lFree=Math.log(e/(1-e)),this.createSubscription("/turtle1/pose","turtlesim/msg/Pose",this._handlePose.bind(this)),this.createSubscription("/scan","sensor_msgs/msg/LaserScan",this._handleScan.bind(this)),this.mapPub=this.createPublisher("/map","nav_msgs/msg/OccupancyGrid"),this.loopClosurePub=this.createPublisher("/loop_closures","std_msgs/msg/String"),this.createTimer(500,this._publishMap.bind(this)),this.createService("/slam/save_map","std_srvs/srv/Empty",this._handleSaveMap.bind(this)),this.createService("/slam/load_map","std_srvs/srv/Empty",this._handleLoadMap.bind(this)),this.addOnSetParametersCallback(i=>{if("map_resolution"in i){const o=i.map_resolution;if(typeof o!="number"||o<=0||o>1)return{successful:!1,reason:"map_resolution must be between 0.0 (exclusive) and 1.0"}}if("hit_prob"in i){const o=i.hit_prob;if(typeof o!="number"||o<.5||o>1)return{successful:!1,reason:"hit_prob must be between 0.5 and 1.0"}}if("miss_prob"in i){const o=i.miss_prob;if(typeof o!="number"||o<0||o>.5)return{successful:!1,reason:"miss_prob must be between 0.0 and 0.5"}}if("loop_closure_distance"in i){const o=i.loop_closure_distance;if(typeof o!="number"||o<=0)return{successful:!1,reason:"loop_closure_distance must be positive"}}if("drift_rate"in i){const o=i.drift_rate;if(typeof o!="number"||o<0)return{successful:!1,reason:"drift_rate must be non-negative"}}return{successful:!0,reason:""}});const s=this.getParameter("localization_mode")?"LOCALIZATION":"MAPPING";this.logInfo(`SLAM node started in ${s} mode. Subscribe to /scan and /turtle1/pose`),this.logInfo(`Map: ${this.gridWidth}x${this.gridHeight} cells, ${this.resolution}m resolution`),this.getParameter("loop_closure_enabled")&&this.logInfo("Loop closure detection enabled"),this.getParameter("drift_enabled")&&this.logInfo(`Odometry drift simulation enabled (rate: ${this.getParameter("drift_rate")})`),window.dispatchEvent(new CustomEvent(f.SHOW_MAP)),this.logInfo("Map visualization enabled - watch the occupancy grid build as you explore!")}_initializeGrid(){this.gridWidth=this.getParameter("map_width"),this.gridHeight=this.getParameter("map_height"),this.resolution=this.getParameter("map_resolution"),this.originX=this.getParameter("origin_x"),this.originY=this.getParameter("origin_y"),this.grid=new Float32Array(this.gridWidth*this.gridHeight),this.grid.fill(0)}_handlePose(t){const e=this.robotX,s=this.robotY;this.robotX=t.x,this.robotY=t.y,this.robotTheta=t.theta;const i=this.robotX-e,o=this.robotY-s,r=Math.sqrt(i*i+o*o);this.totalDistanceTraveled+=r,this.getParameter("drift_enabled")&&r>.001&&this._simulateDrift(r),Math.sqrt((this.robotX-this.lastPoseX)**2+(this.robotY-this.lastPoseY)**2)>=.5&&(this._addToPoseGraph(),this.lastPoseX=this.robotX,this.lastPoseY=this.robotY),window.dispatchEvent(new CustomEvent(f.ROBOT_POSE_UPDATE,{detail:{x:this.robotX,y:this.robotY,theta:this.robotTheta}}))}_simulateDrift(t){const e=this.getParameter("drift_rate"),s=this.getParameter("drift_max");this.driftX+=(Math.random()-.5)*e*t*2,this.driftY+=(Math.random()-.5)*e*t*2,this.driftTheta+=(Math.random()-.5)*e*t*.5,this.driftX=Math.max(-s,Math.min(s,this.driftX)),this.driftY=Math.max(-s,Math.min(s,this.driftY)),this.driftTheta=Math.max(-s*.3,Math.min(s*.3,this.driftTheta))}_addToPoseGraph(){this.poseGraph.push({x:this.robotX,y:this.robotY,theta:this.robotTheta,timestamp:Date.now(),distanceTraveled:this.totalDistanceTraveled}),this.poseGraph.length>1e3&&(this.poseGraph=this.poseGraph.slice(-500))}_handleScan(t){if(this.getParameter("localization_mode")&&this.storedGrid)return;const e=this.robotX+this.driftX,s=this.robotY+this.driftY,i=this.robotTheta+this.driftTheta,{angle_min:o,angle_increment:r,ranges:a,range_max:l}=t;for(let c=0;c<a.length;c++){const h=a[c],d=i+o+c*r;if(!isFinite(h)||h<=0)continue;const u=h<l-.1,m=u?Math.max(0,h-this.resolution*.5):h,b=e+Math.cos(d)*m,y=s+Math.sin(d)*m;this._rayTrace(e,s,b,y,u)}this.getParameter("loop_closure_enabled")&&this._checkLoopClosure()}_checkLoopClosure(){const t=Date.now(),e=this.getParameter("loop_closure_cooldown"),s=this.getParameter("loop_closure_min_travel"),i=this.getParameter("loop_closure_distance");if(t-this.lastLoopClosureTime<e||this.totalDistanceTraveled<s||this.poseGraph.length<10)return;const o=this.poseGraph.length-10;for(let r=0;r<o;r++){const a=this.poseGraph[r],l=this.robotX-a.x,c=this.robotY-a.y,h=Math.sqrt(l*l+c*c);if(!(this.totalDistanceTraveled-a.distanceTraveled<s)&&h<i){this._applyLoopClosure(a),this.lastLoopClosureTime=t;return}}}_applyLoopClosure(t){this.loopClosureCount++;const e=this.driftX,s=this.driftY,i=this.driftTheta;this.logInfo(`Loop closure #${this.loopClosureCount} detected!`),this.logInfo(`  Matched pose: (${t.x.toFixed(2)}, ${t.y.toFixed(2)})`),this.logInfo(`  Current pose: (${this.robotX.toFixed(2)}, ${this.robotY.toFixed(2)})`),this.getParameter("drift_enabled")&&(this.logInfo(`  Drift corrected: dx=${e.toFixed(3)}, dy=${s.toFixed(3)}, dtheta=${i.toFixed(3)}`),this.driftX=0,this.driftY=0,this.driftTheta=0),this.loopClosurePub.publish({data:`Loop closure #${this.loopClosureCount} at (${this.robotX.toFixed(2)}, ${this.robotY.toFixed(2)})`}),window.dispatchEvent(new CustomEvent(f.LOOP_CLOSURE_DETECTED,{detail:{currentPose:{x:this.robotX,y:this.robotY,theta:this.robotTheta},matchedPose:{x:t.x,y:t.y,theta:t.theta},error:{x:e,y:s,theta:i},count:this.loopClosureCount}}))}_handleSaveMap(){return this.storedGrid=new Float32Array(this.grid),this.logInfo("Map saved for localization. Use ros2 param set /slam_node localization_mode true to switch."),{}}_handleLoadMap(){return this.storedGrid?(this.grid=new Float32Array(this.storedGrid),this.logInfo("Stored map loaded into active grid.")):this.logWarn("No stored map available. Save a map first with /slam/save_map."),{}}_rayTrace(t,e,s,i,o){const r=this._worldToGridX(t),a=this._worldToGridY(e),l=this._worldToGridX(s),c=this._worldToGridY(i),h=l-r,d=c-a,u=Math.max(Math.abs(h),Math.abs(d));if(u===0){if(r>=0&&r<this.gridWidth&&a>=0&&a<this.gridHeight){const T=a*this.gridWidth+r;o&&(this.grid[T]=Math.min(this.lMax,this.grid[T]+this.lOcc))}return}const m=h/u,b=d/u;let y=r,w=a,x=-1,_=-1;for(let T=0;T<=u;T++){const C=Math.round(y),k=Math.round(w);if(C===x&&k===_){y+=m,w+=b;continue}if(x=C,_=k,C>=0&&C<this.gridWidth&&k>=0&&k<this.gridHeight){const L=k*this.gridWidth+C;T===u?o&&(this.grid[L]=Math.min(this.lMax,this.grid[L]+this.lOcc)):this.grid[L]=Math.max(this.lMin,this.grid[L]+this.lFree)}y+=m,w+=b}}_worldToGridX(t){return Math.floor((t-this.originX)/this.resolution)}_worldToGridY(t){return Math.floor((t-this.originY)/this.resolution)}_logOddsToProbability(t){return 1-1/(1+Math.exp(t))}_publishMap(){const t=new Int8Array(this.grid.length);for(let s=0;s<this.grid.length;s++){const i=this.grid[s];if(Math.abs(i)<.1)t[s]=-1;else{const o=this._logOddsToProbability(i);t[s]=Math.round(o*100)}}const e={header:{stamp:this.now(),frame_id:"map"},info:{map_load_time:this.now(),resolution:this.resolution,width:this.gridWidth,height:this.gridHeight,origin:{position:{x:this.originX,y:this.originY,z:0},orientation:{x:0,y:0,z:0,w:1}}},data:Array.from(t)};this.mapPub.publish(e),window.dispatchEvent(new CustomEvent(f.MAP_UPDATE,{detail:{map:Array.from(t),info:e.info}}))}onParameterChange(t,e){t==="hit_prob"?this.lOcc=Math.log(e/(1-e)):t==="miss_prob"?this.lFree=Math.log(e/(1-e)):t==="localization_mode"?e&&this.storedGrid?(this.grid=new Float32Array(this.storedGrid),this.logInfo("Switched to LOCALIZATION mode - using stored map")):e&&!this.storedGrid?this.logWarn("No stored map available. Save map first: ros2 service call /slam/save_map std_srvs/srv/Empty"):this.logInfo("Switched to MAPPING mode"):t==="drift_enabled"&&(e?this.logInfo("Odometry drift simulation enabled"):(this.driftX=0,this.driftY=0,this.driftTheta=0,this.logInfo("Odometry drift simulation disabled, drift reset")))}onShutdown(){this.grid=null,this.storedGrid=null,this.poseGraph=[]}}I.register("simple_slam","slam_node",Ms);class Es{constructor(){this.transforms=new Map,this.staticTransforms=new Map,this.bufferDuration=1e4}setTransform(t,e=!1){const{header:s,child_frame_id:i,transform:o}=t,r=s.frame_id,a=i,l=e?this.staticTransforms:this.transforms;l.has(a)||l.set(a,new Map);const c=l.get(a);c.has(r)||c.set(r,[]);const h=c.get(r),d={timestamp:s.stamp.sec*1e3+s.stamp.nanosec/1e6,transform:o};e?c.set(r,[d]):(h.push(d),this._cleanupBuffer(h))}_cleanupBuffer(t){const s=Date.now()-this.bufferDuration;for(;t.length>0&&t[0].timestamp<s;)t.shift()}lookupTransform(t,e,s=0){let i=this._getDirectTransform(e,t,s);if(i)return i;if(i=this._getDirectTransform(t,e,s),i)return this._invertTransform(i);const o=this._findPath(e,t);return o?this._chainTransforms(o,s):null}_getDirectTransform(t,e,s){const i=this.staticTransforms.get(t);if(i&&i.has(e)){const r=i.get(e);if(r.length>0)return r[r.length-1].transform}const o=this.transforms.get(t);if(o&&o.has(e)){const r=o.get(e);if(r.length===0)return null;if(s===0)return r[r.length-1].transform;for(let a=r.length-1;a>=0;a--)if(r[a].timestamp<=s)return r[a].transform;return r[0].transform}return null}_invertTransform(t){const{translation:e,rotation:s}=t,i={x:-s.x,y:-s.y,z:-s.z,w:s.w};return{translation:this._rotateVector({x:-e.x,y:-e.y,z:-e.z},i),rotation:i}}_rotateVector(t,e){const{x:s,y:i,z:o,w:r}=e,a=[2*(i*t.z-o*t.y),2*(o*t.x-s*t.z),2*(s*t.y-i*t.x)];return{x:t.x+r*a[0]+i*a[2]-o*a[1],y:t.y+r*a[1]+o*a[0]-s*a[2],z:t.z+r*a[2]+s*a[1]-i*a[0]}}_findPath(t,e){this._getAllFrames();const s=new Set,i=[[t,[t]]];for(;i.length>0;){const[o,r]=i.shift();if(o===e)return r;if(s.has(o))continue;s.add(o);const a=this._getConnectedFrames(o);for(const l of a)s.has(l)||i.push([l,[...r,l]])}return null}_getConnectedFrames(t){const e=new Set;for(const[s]of[[this.transforms],[this.staticTransforms]]){const i=s.get(t);if(i)for(const o of i.keys())e.add(o);for(const[o,r]of s)r.has(t)&&e.add(o)}return e}_chainTransforms(t,e){let s={translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1}};for(let i=0;i<t.length-1;i++){const o=t[i],r=t[i+1];let a=this._getDirectTransform(o,r,e);if(!a)if(a=this._getDirectTransform(r,o,e),a)a=this._invertTransform(a);else return null;s=this._composeTransforms(s,a)}return s}_composeTransforms(t,e){const s=t.rotation,i=e.rotation,o={x:s.w*i.x+s.x*i.w+s.y*i.z-s.z*i.y,y:s.w*i.y-s.x*i.z+s.y*i.w+s.z*i.x,z:s.w*i.z+s.x*i.y-s.y*i.x+s.z*i.w,w:s.w*i.w-s.x*i.x-s.y*i.y-s.z*i.z},r=this._rotateVector(e.translation,s);return{translation:{x:t.translation.x+r.x,y:t.translation.y+r.y,z:t.translation.z+r.z},rotation:o}}_getAllFrames(){const t=new Set;for(const e of[this.transforms,this.staticTransforms])for(const[s,i]of e){t.add(s);for(const o of i.keys())t.add(o)}return t}getFrameTree(){const t={},e=this._getAllFrames();for(const s of e)t[s]={parents:[],children:[]};for(const s of[this.transforms,this.staticTransforms])for(const[i,o]of s)for(const r of o.keys())t[i]&&t[i].parents.push(r),t[r]&&t[r].children.push(i);return t}clear(){this.transforms.clear(),this.staticTransforms.clear()}}const q=new Es;class As extends A{constructor(t="static_transform_publisher",e={}){super(t,e),this.transform={translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0,w:1}},this.frameId="world",this.childFrameId="base_link",this._parseArgs(e.args||[])}_parseArgs(t){if(t.length!==0&&t.length>=8)if(this.transform.translation.x=parseFloat(t[0])||0,this.transform.translation.y=parseFloat(t[1])||0,this.transform.translation.z=parseFloat(t[2])||0,t.length===8){const e=parseFloat(t[3])||0,s=parseFloat(t[4])||0,i=parseFloat(t[5])||0;this.transform.rotation=this._eulerToQuaternion(e,s,i),this.frameId=t[6],this.childFrameId=t[7]}else t.length>=9&&(this.transform.rotation.x=parseFloat(t[3])||0,this.transform.rotation.y=parseFloat(t[4])||0,this.transform.rotation.z=parseFloat(t[5])||0,this.transform.rotation.w=parseFloat(t[6])||1,this.frameId=t[7],this.childFrameId=t[8])}_eulerToQuaternion(t,e,s){const i=Math.cos(t*.5),o=Math.sin(t*.5),r=Math.cos(e*.5),a=Math.sin(e*.5),l=Math.cos(s*.5),c=Math.sin(s*.5);return{w:l*r*i+c*a*o,x:c*r*i-l*a*o,y:l*a*i+c*r*o,z:l*r*o-c*a*i}}onInit(){this.tfPub=this.createPublisher("/tf_static","tf2_msgs/msg/TFMessage");const t={header:{stamp:this.now(),frame_id:this.frameId},child_frame_id:this.childFrameId,transform:this.transform};q.setTransform(t,!0),this.tfPub.publish({transforms:[t]}),this.createTimer(1e3,()=>{const e={transforms:[{header:{stamp:this.now(),frame_id:this.frameId},child_frame_id:this.childFrameId,transform:this.transform}]};this.tfPub.publish(e)}),this.logInfo(`Publishing static transform: ${this.frameId} -> ${this.childFrameId}`),this.logInfo(`  Translation: (${this.transform.translation.x}, ${this.transform.translation.y}, ${this.transform.translation.z})`),this.logInfo(`  Rotation: (${this.transform.rotation.x}, ${this.transform.rotation.y}, ${this.transform.rotation.z}, ${this.transform.rotation.w})`)}}I.register("tf2_ros","static_transform_publisher",As);class $s extends A{constructor(t="tf2_echo",e={}){super(t,e);const s=e.args||[];this.sourceFrame=s[0]||"world",this.targetFrame=s[1]||"base_link"}onInit(){this.logInfo(`Listening to transform from ${this.sourceFrame} to ${this.targetFrame}`),this.createTimer(1e3,this._queryTransform.bind(this))}_queryTransform(){const t=q.lookupTransform(this.targetFrame,this.sourceFrame);if(t){const{translation:e,rotation:s}=t;this.logInfo(`At time ${(Date.now()/1e3).toFixed(3)}`),this.logInfo(`- Translation: [${e.x.toFixed(3)}, ${e.y.toFixed(3)}, ${e.z.toFixed(3)}]`),this.logInfo(`- Rotation: in Quaternion [${s.x.toFixed(3)}, ${s.y.toFixed(3)}, ${s.z.toFixed(3)}, ${s.w.toFixed(3)}]`);const i=Math.atan2(2*(s.w*s.z+s.x*s.y),1-2*(s.y*s.y+s.z*s.z));this.logInfo(`- Rotation: in RPY (radian) [0.000, 0.000, ${i.toFixed(3)}]`)}else this.logWarn(`Could not transform ${this.sourceFrame} to ${this.targetFrame}: frame not found`)}}I.register("tf2_ros","tf2_echo",$s);class Rs extends A{constructor(t="tf2_monitor",e={}){super(t,e),this.frameCounts=new Map,this.lastResetTime=Date.now()}onInit(){this.createSubscription("/tf","tf2_msgs/msg/TFMessage",this._handleTF.bind(this)),this.createSubscription("/tf_static","tf2_msgs/msg/TFMessage",this._handleStaticTF.bind(this)),this.createTimer(1e3,this._displayStatus.bind(this)),this.logInfo("Monitoring all transforms. Press Ctrl+C to stop.")}_handleTF(t){if(t.transforms)for(const e of t.transforms){const s=`${e.header.frame_id} -> ${e.child_frame_id}`;this.frameCounts.set(s,(this.frameCounts.get(s)||0)+1)}}_handleStaticTF(t){if(t.transforms)for(const e of t.transforms){const s=`${e.header.frame_id} -> ${e.child_frame_id} [static]`;this.frameCounts.set(s,(this.frameCounts.get(s)||0)+1)}}_displayStatus(){const t=Date.now(),e=(t-this.lastResetTime)/1e3,s=q.getFrameTree(),i=Object.keys(s);if(this.logInfo(""),this.logInfo(`Frames: ${i.length}`),this.frameCounts.size===0)this.logInfo("No transforms received yet.");else for(const[o,r]of this.frameCounts.entries()){const a=e>0?(r/e).toFixed(1):"0.0";this.logInfo(`  ${o}  Average rate: ${a} Hz`)}this.frameCounts.clear(),this.lastResetTime=t}}I.register("tf2_ros","tf2_monitor",Rs);class Ds extends A{constructor(t="view_frames",e={}){super(t,e)}onInit(){const t=q.getFrameTree(),e=Object.keys(t);if(e.length===0)this.logInfo("No transform data available. Publish transforms first."),this.logInfo("Example: ros2 run tf2_ros static_transform_publisher 0 0 0 0 0 0 world base_link");else{const s=e.filter(i=>t[i].parents.length===0);if(this.logInfo(`Frames (${e.length}):`),s.length===0)for(const i of e.sort()){const o=t[i].parents.join(", "),r=t[i].children.join(", ");this.logInfo(`  ${i}  parents: [${o}]  children: [${r}]`)}else for(const i of s)this._printTree(i,t,"",!0)}setTimeout(()=>{const s=P.getProcessByNodeName(this.fullName);s&&P.kill(s.processId)},100)}_printTree(t,e,s,i){const o=s===""?"":i?"\\-- ":"+-- ";this.logInfo(s+o+t);const r=e[t].children,a=s===""?"    ":s+(i?"    ":"|   ");r.forEach((l,c)=>{const h=c===r.length-1;this._printTree(l,e,a,h)})}}I.register("tf2_ros","view_frames",Ds);class Os extends A{constructor(t="navigator_node",e={}){super(t,{...e,parameters:{goal_tolerance:.3,max_speed:1.5,max_angular_speed:2.5,obstacle_threshold:50,...e.parameters}}),this.mapData=null,this.mapInfo=null,this.currentPose={x:5.5,y:5.5,theta:0},this.isNavigating=!1}onInit(){this.createSubscription("/map","nav_msgs/msg/OccupancyGrid",this._handleMap.bind(this)),this.createSubscription("/turtle1/pose","turtlesim/msg/Pose",this._handlePose.bind(this)),this.pathPub=this.createPublisher("/plan","nav_msgs/msg/Path"),this.cmdVelPub=this.createPublisher("/turtle1/cmd_vel","geometry_msgs/msg/Twist"),this.createActionServer("/navigate_to_pose","nav2_msgs/action/NavigateToPose",{executeCallback:this._executeNavigate.bind(this),goalCallback:()=>!0}),this.addOnSetParametersCallback(t=>"goal_tolerance"in t&&(t.goal_tolerance<=0||t.goal_tolerance>5)?{successful:!1,reason:"goal_tolerance must be between 0 (exclusive) and 5.0"}:"max_speed"in t&&(t.max_speed<=0||t.max_speed>10)?{successful:!1,reason:"max_speed must be between 0 (exclusive) and 10.0"}:"obstacle_threshold"in t&&(t.obstacle_threshold<0||t.obstacle_threshold>100)?{successful:!1,reason:"obstacle_threshold must be between 0 and 100"}:{successful:!0,reason:""}),this.logInfo("Navigator node started. Waiting for map and goals..."),this.logInfo('Send goals: ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose "{pose: {position: {x: 8, y: 8}}}"')}_handleMap(t){this.mapInfo=t.info,this.mapData=t.data}_handlePose(t){this.currentPose={x:t.x,y:t.y,theta:t.theta}}async _executeNavigate(t,e,s,i){var u,m,b,y,w,x,_,T,C,k;const o=((b=(m=(u=t.pose)==null?void 0:u.pose)==null?void 0:m.position)==null?void 0:b.x)??((w=(y=t.pose)==null?void 0:y.position)==null?void 0:w.x)??0,r=((T=(_=(x=t.pose)==null?void 0:x.pose)==null?void 0:_.position)==null?void 0:T.y)??((k=(C=t.pose)==null?void 0:C.position)==null?void 0:k.y)??0;if(this.logInfo(`Received navigation goal: (${o.toFixed(2)}, ${r.toFixed(2)})`),!this.mapData||!this.mapInfo)return this.logError("No map available. Start SLAM node first: ros2 run simple_slam slam_node"),{};const a=this._planPath(this.currentPose.x,this.currentPose.y,o,r);if(!a)return this.logError("Failed to find path to goal. Target may be in an obstacle or unreachable."),{};this.logInfo(`Path planned with ${a.length} waypoints`),this._publishPath(a),this._visualizePath(a),this.isNavigating=!0;const l=this.getParameter("goal_tolerance");let c=0;const h=Math.max(1,Math.floor(a.length/50));for(;c<a.length&&this.running;){if(i())return this._stopRobot(),this.logInfo("Navigation cancelled"),this.isNavigating=!1,this._clearPath(),{};const L=a[c],M=this._distance(this.currentPose,L);if(s({current_pose:{header:{stamp:this.now(),frame_id:"map"},pose:{position:{x:this.currentPose.x,y:this.currentPose.y,z:0},orientation:{x:0,y:0,z:0,w:1}}},distance_remaining:this._pathDistanceFrom(a,c)}),M<l){c+=h;continue}const z=this._computeControl(this.currentPose,L);this.cmdVelPub.publish(z),await this._sleep(100)}this._stopRobot(),this.isNavigating=!1,this._clearPath();const d=this._distance(this.currentPose,{x:o,y:r});return d<l*2?this.logInfo(`Goal reached! Final distance: ${d.toFixed(2)}m`):this.logWarn(`Navigation ended. Distance to goal: ${d.toFixed(2)}m`),{}}_planPath(t,e,s,i){const o=this.getParameter("obstacle_threshold"),r=this._worldToGrid(t,e),a=this._worldToGrid(s,i);if(!this._isGridFree(a.gx,a.gy,o))return this.logWarn("Goal position is inside an obstacle"),null;const l=(_,T)=>`${_},${T}`,c=l(r.gx,r.gy),h=l(a.gx,a.gy),d=new Ns,u=new Map,m=new Map,b=new Set;u.set(c,0),d.push(this._heuristic(r,a),c);const y=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]];let w=0;const x=5e4;for(;!d.isEmpty()&&w<x;){w++;const _=d.pop();if(b.has(_))continue;if(b.add(_),_===h)return this._reconstructPath(m,_);const[T,C]=_.split(",").map(Number);for(const[k,L]of y){const M=T+k,z=C+L;if(!this._isGridFree(M,z,o))continue;const F=l(M,z),gt=k!==0&&L!==0?1.414:1,X=u.get(_)+gt;if(!u.has(F)||X<u.get(F)){m.set(F,_),u.set(F,X);const bt=X+this._heuristic({gx:M,gy:z},a);d.push(bt,F)}}}return null}_heuristic(t,e){const s=e.gx-t.gx,i=e.gy-t.gy;return Math.sqrt(s*s+i*i)}_isGridFree(t,e,s){if(!this.mapInfo||t<0||t>=this.mapInfo.width||e<0||e>=this.mapInfo.height)return!1;const i=e*this.mapInfo.width+t,o=this.mapData[i];return o>=0&&o<s}_worldToGrid(t,e){const s=Math.floor((t-this.mapInfo.origin.position.x)/this.mapInfo.resolution),i=Math.floor((e-this.mapInfo.origin.position.y)/this.mapInfo.resolution);return{gx:s,gy:i}}_gridToWorld(t,e){const s=t*this.mapInfo.resolution+this.mapInfo.origin.position.x+this.mapInfo.resolution/2,i=e*this.mapInfo.resolution+this.mapInfo.origin.position.y+this.mapInfo.resolution/2;return{x:s,y:i}}_reconstructPath(t,e){const s=[];let i=e;for(;i;){const[o,r]=i.split(",").map(Number);s.unshift(this._gridToWorld(o,r)),i=t.get(i)}return s}_computeControl(t,e){const s=e.x-t.x,i=e.y-t.y,o=Math.sqrt(s*s+i*i);let a=Math.atan2(i,s)-t.theta;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;const l=this.getParameter("max_speed"),c=this.getParameter("max_angular_speed"),h=Math.max(.1,1-Math.abs(a)/Math.PI);let d=Math.min(l,.8*o)*h,u=Math.max(-c,Math.min(c,2.5*a));return{linear:{x:d,y:0,z:0},angular:{x:0,y:0,z:u}}}_stopRobot(){this.cmdVelPub.publish({linear:{x:0,y:0,z:0},angular:{x:0,y:0,z:0}})}_publishPath(t){this.pathPub.publish({header:{stamp:this.now(),frame_id:"map"},poses:t.map(e=>({header:{stamp:this.now(),frame_id:"map"},pose:{position:{x:e.x,y:e.y,z:0},orientation:{x:0,y:0,z:0,w:1}}}))})}_visualizePath(t){window.dispatchEvent(new CustomEvent(f.PATH_PLANNED,{detail:{path:t}}))}_clearPath(){window.dispatchEvent(new CustomEvent(f.PATH_CLEARED))}_distance(t,e){const s=e.x-t.x,i=e.y-t.y;return Math.sqrt(s*s+i*i)}_pathDistanceFrom(t,e){let s=0;for(let i=e;i<t.length-1;i++)s+=this._distance(t[i],t[i+1]);return s}_sleep(t){return new Promise(e=>setTimeout(e,t))}onShutdown(){this._stopRobot(),this._clearPath(),this.isNavigating=!1}}class Ns{constructor(){this.heap=[]}push(t,e){this.heap.push({priority:t,value:e}),this._bubbleUp(this.heap.length-1)}pop(){if(this.heap.length===0)return null;const t=this.heap[0],e=this.heap.pop();return this.heap.length>0&&(this.heap[0]=e,this._bubbleDown(0)),t.value}isEmpty(){return this.heap.length===0}_bubbleUp(t){for(;t>0;){const e=Math.floor((t-1)/2);if(this.heap[t].priority>=this.heap[e].priority)break;[this.heap[t],this.heap[e]]=[this.heap[e],this.heap[t]],t=e}}_bubbleDown(t){for(;;){let e=t;const s=2*t+1,i=2*t+2;if(s<this.heap.length&&this.heap[s].priority<this.heap[e].priority&&(e=s),i<this.heap.length&&this.heap[i].priority<this.heap[e].priority&&(e=i),e===t)break;[this.heap[t],this.heap[e]]=[this.heap[e],this.heap[t]],t=e}}}I.register("nav2_simple_navigator","navigator_node",Os);class zs{constructor(){this.terminalManager=null,this.canvas=null,this.mapCanvas=null,this.graph=null,this.rqtConsole=null,this.layout=null,this.logger=E.getLogger("/ros2_turtle_school")}init(){this.logger.info("Initializing ROS 2 Turtle School..."),this.layout=new Dt,this.terminalManager=new kt({containerId:"terminals-container",tabListId:"terminal-tabs",addButtonId:"add-terminal",onCommand:(e,s)=>rt(e,s)}),this.canvas=new Pt("turtle-canvas"),this.mapCanvas=new Mt("map-canvas"),this.graph=new $t("graph-container"),this.rqtConsole=new Rt,this._setupEventListeners(),this.terminalManager.focus();const t=this.terminalManager.getActiveTerminal();t&&(t.writeln(""),t.writeln("\x1B[32m\x1B[0m"),t.writeln("\x1B[32m                    ROS 2 Turtle School                       \x1B[0m"),t.writeln("\x1B[32m\x1B[0m"),t.writeln(""),t.writeln("Welcome! This is a browser-based ROS2 CLI emulator."),t.writeln("Try these commands to get started:"),t.writeln(""),t.writeln("  \x1B[33mros2 run turtlesim turtlesim_node\x1B[0m  - Start turtlesim"),t.writeln("  \x1B[33mros2 topic list\x1B[0m                   - List topics"),t.writeln("  \x1B[33mros2 node list\x1B[0m                    - List nodes"),t.writeln("  \x1B[33mhelp\x1B[0m                              - Show all commands"),t.writeln(""),t.writeln("Use the \x1B[36m+\x1B[0m button to add more terminal panes."),t.writeln("Press \x1B[36mCtrl+C\x1B[0m to stop running commands."),t.writeln(""),t.finishCommand()),this.logger.info("ROS 2 Turtle School initialized")}_setupEventListeners(){const t=document.getElementById("toggle-graph");t==null||t.addEventListener("click",()=>{this.graph.toggle()});const e=document.getElementById("toggle-map");e==null||e.addEventListener("click",()=>{this.layout.toggleMap()});const s=document.getElementById("toggle-console");s==null||s.addEventListener("click",()=>{this.rqtConsole.toggle()});const i=document.getElementById("show-help");i==null||i.addEventListener("click",()=>{this._showHelpModal()}),this._setupObstacleButtons(),this._setupMapOverlayButtons(),window.addEventListener(f.TOGGLE_GRAPH,()=>{this.graph.toggle()}),window.addEventListener(f.TOGGLE_CONSOLE,()=>{this.rqtConsole.toggle()}),window.addEventListener(f.SHOW_MAP,()=>{this.layout.showMap()}),window.addEventListener(f.OPEN_RQT_MODAL,()=>{this._showRqtModal()}),document.querySelectorAll("#quick-commands button").forEach(l=>{l.addEventListener("click",()=>{const c=l.dataset.cmd;if(c){const h=this.terminalManager.getActiveTerminal();h&&(h.writeln(c),rt(c,h))}})}),window.addEventListener(f.TELEOP_ACTIVE,l=>{const{type:c}=l.detail;this._showTeleopHint(c)}),window.addEventListener(f.TELEOP_INACTIVE,()=>{this._hideTeleopHint()});const r=document.getElementById("modal-overlay"),a=document.getElementById("modal-close");r==null||r.addEventListener("click",l=>{l.target===r&&r.classList.add("hidden")}),a==null||a.addEventListener("click",()=>{r==null||r.classList.add("hidden")})}_setupObstacleButtons(){const t=document.getElementById("randomize-obstacles"),e=document.getElementById("add-obstacle-mode"),s=document.getElementById("delete-obstacle-mode"),i=document.getElementById("clear-obstacles"),o=document.getElementById("reset-obstacles");t==null||t.addEventListener("click",()=>{this.canvas.randomizeObstacles(5)}),e==null||e.addEventListener("click",()=>{const a=this.canvas.getEditMode()==="add"?"none":"add";this.canvas.setEditMode(a),this._updateObstacleButtons(a)}),s==null||s.addEventListener("click",()=>{const a=this.canvas.getEditMode()==="delete"?"none":"delete";this.canvas.setEditMode(a),this._updateObstacleButtons(a)}),i==null||i.addEventListener("click",()=>{this.canvas.clearObstacles()}),o==null||o.addEventListener("click",()=>{this.canvas.resetObstacles()}),window.addEventListener(f.CANVAS_EDIT_MODE_CHANGED,r=>{this._updateObstacleButtons(r.detail.mode)})}_updateObstacleButtons(t){const e=document.getElementById("add-obstacle-mode"),s=document.getElementById("delete-obstacle-mode");e==null||e.classList.toggle("active",t==="add"),s==null||s.classList.toggle("active",t==="delete")}_setupMapOverlayButtons(){const t=document.getElementById("toggle-map-overlay"),e=document.getElementById("map-opacity-control"),s=document.getElementById("map-opacity-slider"),i=document.getElementById("map-opacity-value");t==null||t.addEventListener("click",()=>{const o=this.canvas.toggleMap();t.classList.toggle("active",o),e==null||e.classList.toggle("hidden",!o)}),s==null||s.addEventListener("input",o=>{const r=parseInt(o.target.value,10)/100;this.canvas.setMapOpacity(r),i&&(i.textContent=`${o.target.value}%`)}),window.addEventListener(f.TOGGLE_MAP_OVERLAY,()=>{const o=this.canvas.toggleMap();t==null||t.classList.toggle("active",o),e==null||e.classList.toggle("hidden",!o)})}_showRqtModal(){const t=document.getElementById("modal-overlay"),e=document.getElementById("modal-title"),s=document.getElementById("modal-body");!t||!s||(e.textContent="rqt - ROS2 Tools",s.innerHTML=`
      <div class="rqt-tools">
        <button class="rqt-tool-btn" data-tool="graph">
          <span class="icon"></span>
          <span class="label">Node Graph</span>
          <span class="desc">Visualize nodes and topics</span>
        </button>
        <button class="rqt-tool-btn" data-tool="console">
          <span class="icon"></span>
          <span class="label">Console</span>
          <span class="desc">View log messages</span>
        </button>
      </div>
    `,s.querySelectorAll(".rqt-tool-btn").forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.tool;t.classList.add("hidden"),o==="graph"?this.graph.toggle():o==="console"&&this.rqtConsole.toggle()})}),t.classList.remove("hidden"))}_showHelpModal(){const t=document.getElementById("modal-overlay");Nt.show(t)}_showTeleopHint(t){let e=document.getElementById("teleop-hint");e||(e=document.createElement("div"),e.id="teleop-hint",document.body.appendChild(e)),t==="arrow-keys"?e.innerHTML="Use <kbd></kbd> <kbd></kbd> <kbd></kbd> <kbd></kbd> to control turtle":t==="wasd-keys"&&(e.innerHTML="Use <kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> to move, <kbd>Q</kbd><kbd>E</kbd> to rotate"),e.classList.add("visible")}_hideTeleopHint(){const t=document.getElementById("teleop-hint");t&&t.classList.remove("visible")}destroy(){var t,e,s;P.killAll(),g.reset(),(t=this.terminalManager)==null||t.destroy(),(e=this.graph)==null||e.destroy(),(s=this.rqtConsole)==null||s.destroy()}}document.addEventListener("DOMContentLoaded",()=>{new zs().init()});
//# sourceMappingURL=index-BvlaL45d.js.map
